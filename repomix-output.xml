This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
.gitignore
app/(auth)/login/page.tsx
app/(auth)/register/page.tsx
app/(dashboard)/book/[rinkId]/page.tsx
app/(dashboard)/bookings/[id]/page.tsx
app/(dashboard)/bookings/page.tsx
app/(dashboard)/clubs/new/page.tsx
app/(dashboard)/clubs/page.tsx
app/(dashboard)/dashboard/page.tsx
app/(dashboard)/games/[id]/edit/page.tsx
app/(dashboard)/games/[id]/page.tsx
app/(dashboard)/games/new/page.tsx
app/(dashboard)/games/page.tsx
app/(dashboard)/layout.tsx
app/(dashboard)/manage-rink/page.tsx
app/(dashboard)/my-games/page.tsx
app/(dashboard)/notifications/page.tsx
app/(dashboard)/profile/edit/page.tsx
app/(dashboard)/profile/page.tsx
app/(dashboard)/rinks/page.tsx
app/[locale]/(auth)/login/LoginClient.tsx
app/[locale]/(auth)/login/page.tsx
app/[locale]/(auth)/register/page.tsx
app/[locale]/(auth)/register/RegisterClient.tsx
app/[locale]/(dashboard)/book/[rinkId]/page.tsx
app/[locale]/(dashboard)/bookings/[id]/page.tsx
app/[locale]/(dashboard)/bookings/page.tsx
app/[locale]/(dashboard)/clubs/new/page.tsx
app/[locale]/(dashboard)/clubs/page.tsx
app/[locale]/(dashboard)/dashboard/page.tsx
app/[locale]/(dashboard)/games-test/page.tsx
app/[locale]/(dashboard)/games/[id]/edit/page.tsx
app/[locale]/(dashboard)/games/[id]/page.tsx
app/[locale]/(dashboard)/games/new/page.tsx
app/[locale]/(dashboard)/games/page.tsx
app/[locale]/(dashboard)/layout.tsx
app/[locale]/(dashboard)/manage-rink/page.tsx
app/[locale]/(dashboard)/my-games/page.tsx
app/[locale]/(dashboard)/notifications/page.tsx
app/[locale]/(dashboard)/profile/edit/page.tsx
app/[locale]/(dashboard)/profile/page.tsx
app/[locale]/(dashboard)/rinks/page.tsx
app/[locale]/layout.tsx
app/[locale]/page.tsx
app/api/notifications/test/route.ts
app/api/sync-ottawa-rinks/route.ts
app/check-database/page.tsx
app/favicon.ico
app/globals.css
app/layout.tsx
app/not-found.tsx
app/page.tsx
app/providers/pwa-register.tsx
app/test-connection/page.tsx
app/test-notifications/page.tsx
components.json
components/auth/AuthActions.tsx
components/features/game-card-working.tsx
components/features/game-card.tsx
components/features/hero-section.tsx
components/layout/footer.tsx
components/layout/navbar.tsx
components/layout/navigation.tsx
components/LoadingSpinner.tsx
components/LocaleSwitcher.tsx
components/notifications/notification-bell.tsx
components/rating/RatingStars.tsx
components/ui/badge.tsx
components/ui/button.tsx
components/ui/card.tsx
components/ui/input.tsx
Copy-Pages.ps1
eslint.config.mjs
i18n.ts
lib/supabase/client.ts
lib/supabase/service.ts
lib/utils.ts
lib/utils/format.ts
messages/en.json
messages/fr.json
messages/hi.json
messages/zh.json
middleware.ts
next.config.mjs
package.json
postcss.config.js
postcss.config.mjs
project-structure.txt
public/create-icons.html
public/file.svg
public/globe.svg
public/grid.svg
public/icon-192.png
public/icon-512.png
public/manifest.json
public/next.svg
public/sw.js
public/vercel.svg
public/window.svg
README.md
tailwind.config.js
tsconfig.json
vercel.json
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path=".gitignore">
# See https://help.github.com/articles/ignoring-files/ for more about ignoring files.

# dependencies
/node_modules
/.pnp
.pnp.*
.yarn/*
!.yarn/patches
!.yarn/plugins
!.yarn/releases
!.yarn/versions

# testing
/coverage

# next.js
/.next/
/out/

# production
/build

# misc
.DS_Store
*.pem

# debug
npm-debug.log*
yarn-debug.log*
yarn-error.log*
.pnpm-debug.log*

# env files (can opt-in for committing if needed)
.env*

# vercel
.vercel

# typescript
*.tsbuildinfo
next-env.d.ts
</file>

<file path="app/(auth)/login/page.tsx">
'use client'

import { useState } from 'react'
import { createClient } from '@/lib/supabase/client'

export default function LoginPage() {
  const [email, setEmail] = useState('')
  const [password, setPassword] = useState('')
  const [loading, setLoading] = useState(false)
  const [message, setMessage] = useState('')

  const handleLogin = async (e: React.FormEvent) => {
    e.preventDefault()
    setLoading(true)
    setMessage('')

    const supabase = createClient()
    
    const { data, error } = await supabase.auth.signInWithPassword({
      email,
      password,
    })

    if (error) {
      setMessage('Error: ' + error.message)
    } else {
      setMessage('Login successful!')
      window.location.href = '/games'
    }
    setLoading(false)
  }

  return (
    <div className="min-h-screen bg-gray-50 flex items-center justify-center py-12 px-4">
      <div className="max-w-md w-full space-y-8">
        <div className="text-center">
          <h2 className="text-3xl font-bold">Welcome back</h2>
          <p className="mt-2 text-gray-600">Sign in to your account</p>
        </div>

        <form className="mt-8 space-y-6" onSubmit={handleLogin}>
          <div className="space-y-4">
            <div>
              <label className="block text-sm font-medium text-gray-700">
                Email
              </label>
              <input
                type="email"
                required
                value={email}
                onChange={(e) => setEmail(e.target.value)}
                className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md"
              />
            </div>

            <div>
              <label className="block text-sm font-medium text-gray-700">
                Password
              </label>
              <input
                type="password"
                required
                value={password}
                onChange={(e) => setPassword(e.target.value)}
                className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md"
              />
            </div>
          </div>

          {message && (
            <div className={`text-sm ${message.includes('Error') ? 'text-red-600' : 'text-green-600'}`}>
              {message}
            </div>
          )}

          <button
            type="submit"
            disabled={loading}
            className="w-full py-2 px-4 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-md disabled:opacity-50"
          >
            {loading ? 'Signing in...' : 'Sign In'}
          </button>

          <div className="text-center text-sm">
            Don't have an account?{' '}
            <a href="/register" className="text-blue-600 hover:text-blue-700">
              Sign up
            </a>
          </div>
        </form>
      </div>
    </div>
  )
}
</file>

<file path="app/(auth)/register/page.tsx">
'use client';

import { useState } from 'react';
import { createClient } from '@/lib/supabase/client';
import { useRouter } from 'next/navigation';
import Link from 'next/link';

export default function RegisterPage() {
  const router = useRouter();
  const supabase = createClient();
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState('');
  const [step, setStep] = useState(1); // Two-step registration
  
  // Step 1: Basic info
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [fullName, setFullName] = useState('');
  
  // Step 2: Hockey profile
  const [profile, setProfile] = useState({
    age_group: '',
    skill_level: '',
    position: '',
    area: '',
    years_playing: 0,
    phone: '',
    jersey_number: '',
    preferred_shot: ''
  });

  const handleStep1Submit = (e: React.FormEvent) => {
    e.preventDefault();
    if (!email || !password || !fullName) {
      setError('Please fill in all required fields');
      return;
    }
    setStep(2);
  };

  const handleRegister = async (e: React.FormEvent) => {
    e.preventDefault();
    setIsLoading(true);
    setError('');

    try {
      // Create auth user
      const { data: authData, error: authError } = await supabase.auth.signUp({
        email,
        password,
      });

      if (authError) throw authError;

      if (authData.user) {
        // Update profile with hockey details
        const { error: profileError } = await supabase
          .from('profiles')
          .update({
            full_name: fullName,
            age_group: profile.age_group,
            skill_level: profile.skill_level,
            position: profile.position,
            area: profile.area,
            years_playing: profile.years_playing,
            phone: profile.phone,
            jersey_number: profile.jersey_number,
            preferred_shot: profile.preferred_shot
          })
          .eq('id', authData.user.id);

        if (profileError) throw profileError;

        router.push('/dashboard');
      }
    } catch (error: any) {
      setError(error.message);
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <div className="min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8">
      <div className="max-w-md w-full space-y-8">
        <div>
          <h2 className="mt-6 text-center text-3xl font-extrabold text-gray-900">
            Create your HockeyHub account
          </h2>
          <p className="mt-2 text-center text-sm text-gray-600">
            Step {step} of 2: {step === 1 ? 'Basic Information' : 'Hockey Profile'}
          </p>
        </div>

        {step === 1 ? (
          // Step 1: Basic Information
          <form className="mt-8 space-y-6" onSubmit={handleStep1Submit}>
            <div className="rounded-md shadow-sm -space-y-px">
              <div>
                <label htmlFor="full-name" className="sr-only">Full Name</label>
                <input
                  id="full-name"
                  name="fullName"
                  type="text"
                  required
                  className="appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-t-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-sm"
                  placeholder="Full Name"
                  value={fullName}
                  onChange={(e) => setFullName(e.target.value)}
                />
              </div>
              <div>
                <label htmlFor="email-address" className="sr-only">Email address</label>
                <input
                  id="email-address"
                  name="email"
                  type="email"
                  autoComplete="email"
                  required
                  className="appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-sm"
                  placeholder="Email address"
                  value={email}
                  onChange={(e) => setEmail(e.target.value)}
                />
              </div>
              <div>
                <label htmlFor="password" className="sr-only">Password</label>
                <input
                  id="password"
                  name="password"
                  type="password"
                  autoComplete="new-password"
                  required
                  className="appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-b-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-sm"
                  placeholder="Password (min 6 characters)"
                  value={password}
                  onChange={(e) => setPassword(e.target.value)}
                />
              </div>
            </div>

            {error && (
              <div className="text-red-500 text-sm text-center">{error}</div>
            )}

            <button
              type="submit"
              className="group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
            >
              Continue to Hockey Profile
            </button>
          </form>
        ) : (
          // Step 2: Hockey Profile
          <form className="mt-8 space-y-4" onSubmit={handleRegister}>
            <div className="grid grid-cols-2 gap-4">
              {/* Age Group */}
              <div>
                <label className="block text-sm font-medium text-gray-700">Age Group *</label>
                <select
                  required
                  className="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md"
                  value={profile.age_group}
                  onChange={(e) => setProfile({...profile, age_group: e.target.value})}
                >
                  <option value="">Select</option>
                  <option value="U7">U7</option>
                  <option value="U9">U9</option>
                  <option value="U11">U11</option>
                  <option value="U13">U13</option>
                  <option value="U15">U15</option>
                  <option value="U18">U18</option>
                  <option value="Adult">Adult</option>
                </select>
              </div>

              {/* Skill Level */}
              <div>
                <label className="block text-sm font-medium text-gray-700">Skill Level *</label>
                <select
                  required
                  className="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md"
                  value={profile.skill_level}
                  onChange={(e) => setProfile({...profile, skill_level: e.target.value})}
                >
                  <option value="">Select</option>
                  <option value="AAA">AAA</option>
                  <option value="AA">AA</option>
                  <option value="A">A</option>
                  <option value="B">B</option>
                  <option value="C">C</option>
                  <option value="House League">House League</option>
                  <option value="Beginner">Beginner</option>
                </select>
              </div>

              {/* Position */}
              <div>
                <label className="block text-sm font-medium text-gray-700">Position *</label>
                <select
                  required
                  className="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md"
                  value={profile.position}
                  onChange={(e) => setProfile({...profile, position: e.target.value})}
                >
                  <option value="">Select</option>
                  <option value="Forward">Forward</option>
                  <option value="Defense">Defense</option>
                  <option value="Goalie">Goalie</option>
                  <option value="Any">Any Position</option>
                </select>
              </div>

              {/* Preferred Shot */}
              <div>
                <label className="block text-sm font-medium text-gray-700">Shoots</label>
                <select
                  className="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md"
                  value={profile.preferred_shot}
                  onChange={(e) => setProfile({...profile, preferred_shot: e.target.value})}
                >
                  <option value="">Select</option>
                  <option value="Left">Left</option>
                  <option value="Right">Right</option>
                </select>
              </div>
            </div>

            {/* Area */}
            <div>
              <label className="block text-sm font-medium text-gray-700">Area/Location *</label>
              <select
                required
                className="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md"
                value={profile.area}
                onChange={(e) => setProfile({...profile, area: e.target.value})}
              >
                <option value="">Select your area</option>
                <option value="Downtown Ottawa">Downtown Ottawa</option>
                <option value="Ottawa East">Ottawa East</option>
                <option value="Ottawa West">Ottawa West</option>
                <option value="Ottawa South">Ottawa South</option>
                <option value="Kanata">Kanata</option>
                <option value="Nepean">Nepean</option>
                <option value="Orleans">Orleans</option>
                <option value="Gloucester">Gloucester</option>
                <option value="Barrhaven">Barrhaven</option>
                <option value="Stittsville">Stittsville</option>
              </select>
            </div>

            <div className="grid grid-cols-2 gap-4">
              {/* Years Playing */}
              <div>
                <label className="block text-sm font-medium text-gray-700">Years Playing</label>
                <input
                  type="number"
                  min="0"
                  max="50"
                  className="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                  value={profile.years_playing}
                  onChange={(e) => setProfile({...profile, years_playing: parseInt(e.target.value) || 0})}
                />
              </div>

              {/* Jersey Number */}
              <div>
                <label className="block text-sm font-medium text-gray-700">Jersey #</label>
                <input
                  type="text"
                  maxLength={3}
                  className="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                  value={profile.jersey_number}
                  onChange={(e) => setProfile({...profile, jersey_number: e.target.value})}
                />
              </div>
            </div>

            {/* Phone */}
            <div>
              <label className="block text-sm font-medium text-gray-700">Phone Number</label>
              <input
                type="tel"
                className="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                placeholder="(613) 555-0100"
                value={profile.phone}
                onChange={(e) => setProfile({...profile, phone: e.target.value})}
              />
            </div>

            {error && (
              <div className="text-red-500 text-sm text-center">{error}</div>
            )}

            <div className="flex space-x-4">
              <button
                type="button"
                onClick={() => setStep(1)}
                className="flex-1 py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
              >
                Back
              </button>
              <button
                type="submit"
                disabled={isLoading}
                className="flex-1 py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:bg-gray-400"
              >
                {isLoading ? 'Creating...' : 'Complete Registration'}
              </button>
            </div>
          </form>
        )}

        <div className="text-center">
          <span className="text-sm text-gray-600">
            Already have an account?{' '}
            <Link href="/login" className="font-medium text-blue-600 hover:text-blue-500">
              Sign in
            </Link>
          </span>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="app/(dashboard)/clubs/page.tsx">
'use client'

import { useState, useEffect } from 'react'
import { createClient } from '@/lib/supabase/client'

// Simple LoadingSpinner component
const LoadingSpinner = () => (
  <div className="flex items-center justify-center p-8">
    <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
  </div>
)

export default function ClubsPage() {
  const [clubs, setClubs] = useState<any[]>([])
  const [loading, setLoading] = useState(true)

  useEffect(() => {
    fetchClubs()
  }, [])

  const fetchClubs = async () => {
    const supabase = createClient()
    const { data, error } = await supabase
      .from('clubs')
      .select('*')
      .order('name')
    
    if (data) {
      setClubs(data)
    }
    setLoading(false)
  }

  return (
    <div className="min-h-screen bg-gray-50">
      {/* Navigation */}
      <nav className="bg-white shadow-sm">
        <div className="container mx-auto px-4 h-16 flex items-center justify-between">
          <a href="/" className="text-xl font-bold">üèí HockeyHub</a>
          <div className="flex gap-4">
            <a href="/games" className="text-gray-600">Games</a>
            <a href="/rinks" className="text-gray-600">Rinks</a>
            <a href="/clubs" className="text-blue-600">Clubs</a>
            <a href="/profile" className="text-gray-600">Profile</a>
          </div>
        </div>
      </nav>

      {/* Main Content */}
      <div className="container mx-auto px-4 py-8">
        {/* Header with Register Button */}
        <div className="flex justify-between items-center mb-6">
          <h1 className="text-3xl font-bold">Ottawa Hockey Clubs</h1>
          <a
            href="/clubs/new"
            className="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700"
          >
            Register Your Club
          </a>
        </div>

        {loading ? (
          <LoadingSpinner />
        ) : clubs.length === 0 ? (
          <div className="bg-white rounded-lg shadow p-8 text-center">
            <p className="text-gray-500 mb-4">No clubs registered yet</p>
            <a
              href="/clubs/new"
              className="text-blue-600 hover:text-blue-700"
            >
              Be the first to register your club!
            </a>
          </div>
        ) : (
          <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
            {clubs.map((club) => (
              <div key={club.id} className="bg-white rounded-lg shadow p-6">
                <div className="flex justify-between items-start mb-2">
                  <h2 className="text-xl font-semibold">{club.name}</h2>
                  {club.verified && (
                    <span className="bg-green-100 text-green-800 px-2 py-1 rounded text-xs">
                      Verified
                    </span>
                  )}
                </div>
                
                {club.description && (
                  <p className="text-gray-600 mb-3 text-sm">{club.description}</p>
                )}
                
                {club.contact_email && (
                  <p className="text-gray-600 text-sm mb-1">üìß {club.contact_email}</p>
                )}
                
                {club.contact_phone && (
                  <p className="text-gray-600 text-sm mb-1">üìû {club.contact_phone}</p>
                )}
                
                {club.home_rink && (
                  <p className="text-gray-600 text-sm mb-1">üèí Home: {club.home_rink}</p>
                )}
                
                {club.age_groups && (
                  <div className="mt-3 flex flex-wrap gap-1">
                    {club.age_groups.split(',').map((ageGroup: string) => (
                      <span
                        key={ageGroup}
                        className="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs"
                      >
                        {ageGroup}
                      </span>
                    ))}
                  </div>
                )}
                
                {club.website && (
                  <a
                    href={club.website}
                    target="_blank"
                    rel="noopener noreferrer"
                    className="inline-block mt-3 text-blue-600 hover:text-blue-700 text-sm"
                  >
                    Visit Website ‚Üí
                  </a>
                )}
              </div>
            ))}
          </div>
        )}
      </div>
    </div>
  )
}
</file>

<file path="app/(dashboard)/manage-rink/page.tsx">
'use client'

import { useState, useEffect } from 'react'
import { createClient } from '@/lib/supabase/client'

export default function ManageRinkPage() {
  const [myRink, setMyRink] = useState<any>(null)
  const [loading, setLoading] = useState(false)
  const [formData, setFormData] = useState({
    hourly_rate: '',
    booking_url: '',
    amenities: '',
    peak_hours: '',
    special_notes: ''
  })

  useEffect(() => {
    fetchMyRink()
  }, [])

  const fetchMyRink = async () => {
    const supabase = createClient()
    
    // Get current user
    const { data: { user } } = await supabase.auth.getUser()
    if (!user) return

    // Check if user is a rink manager
    const { data: managerData } = await supabase
      .from('rink_managers')
      .select('*, rinks(*)')
      .eq('user_id', user.id)
      .eq('verified', true)
      .single()

    if (managerData) {
      setMyRink(managerData.rinks)
      setFormData({
        hourly_rate: managerData.rinks.hourly_rate || '',
        booking_url: managerData.rinks.booking_url || '',
        amenities: managerData.rinks.amenities?.join(', ') || '',
        peak_hours: managerData.rinks.custom_info?.peak_hours || '',
        special_notes: managerData.rinks.custom_info?.special_notes || ''
      })
    }
  }

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()
    setLoading(true)

    const supabase = createClient()
    
    // Update rink information
    const { error } = await supabase
      .from('rinks')
      .update({
        hourly_rate: parseFloat(formData.hourly_rate),
        booking_url: formData.booking_url,
        amenities: formData.amenities.split(',').map((a: string) => a.trim()),
        custom_info: {
          peak_hours: formData.peak_hours,
          special_notes: formData.special_notes
        },
        source: 'manager_updated'
      })
      .eq('id', myRink.id)

    if (!error) {
      alert('Rink information updated successfully!')
      
      // Log the update
      const { data: { user } } = await supabase.auth.getUser()
      if (user) {
        await supabase
          .from('rink_updates_log')
          .insert({
            rink_id: myRink.id,
            updated_by: user.id,
            changes: formData,
            update_type: 'manager_update'
          })
      }
    }
    
    setLoading(false)
  }

  if (!myRink) {
    return (
      <div className="min-h-screen bg-gray-50 p-8">
        <div className="max-w-2xl mx-auto">
          <h1 className="text-2xl font-bold mb-4">Rink Manager Portal</h1>
          <div className="bg-yellow-50 p-4 rounded">
            <p>You are not registered as a rink manager.</p>
            <button className="mt-2 bg-blue-600 text-white px-4 py-2 rounded">
              Apply to Manage a Rink
            </button>
          </div>
        </div>
      </div>
    )
  }

  return (
    <div className="min-h-screen bg-gray-50 p-8">
      <div className="max-w-2xl mx-auto">
        <h1 className="text-2xl font-bold mb-4">Manage: {myRink.name}</h1>
        
        <form onSubmit={handleSubmit} className="bg-white p-6 rounded-lg shadow">
          <div className="mb-4">
            <label className="block text-sm font-medium mb-2">
              Hourly Rate ($)
            </label>
            <input
              type="number"
              value={formData.hourly_rate}
              onChange={(e) => setFormData({...formData, hourly_rate: e.target.value})}
              className="w-full px-3 py-2 border rounded"
            />
          </div>

          <div className="mb-4">
            <label className="block text-sm font-medium mb-2">
              Online Booking URL
            </label>
            <input
              type="url"
              value={formData.booking_url}
              onChange={(e) => setFormData({...formData, booking_url: e.target.value})}
              className="w-full px-3 py-2 border rounded"
              placeholder="https://..."
            />
          </div>

          <div className="mb-4">
            <label className="block text-sm font-medium mb-2">
              Amenities (comma separated)
            </label>
            <input
              type="text"
              value={formData.amenities}
              onChange={(e) => setFormData({...formData, amenities: e.target.value})}
              className="w-full px-3 py-2 border rounded"
              placeholder="Skate sharpening, Pro shop, Snack bar"
            />
          </div>

          <div className="mb-4">
            <label className="block text-sm font-medium mb-2">
              Peak Hours
            </label>
            <input
              type="text"
              value={formData.peak_hours}
              onChange={(e) => setFormData({...formData, peak_hours: e.target.value})}
              className="w-full px-3 py-2 border rounded"
              placeholder="Weekdays 6-9pm, Weekends all day"
            />
          </div>

          <div className="mb-4">
            <label className="block text-sm font-medium mb-2">
              Special Notes
            </label>
            <textarea
              value={formData.special_notes}
              onChange={(e) => setFormData({...formData, special_notes: e.target.value})}
              className="w-full px-3 py-2 border rounded"
              rows={3}
              placeholder="Any special information for users..."
            />
          </div>

          <button
            type="submit"
            disabled={loading}
            className="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700"
          >
            {loading ? 'Saving...' : 'Update Rink Information'}
          </button>
        </form>
      </div>
    </div>
  )
}
</file>

<file path="app/not-found.tsx">
export default function NotFound() {
  return (
    <div className="min-h-screen bg-gray-50 flex items-center justify-center">
      <div className="text-center">
        <div className="text-6xl mb-4">üèí</div>
        <h1 className="text-4xl font-bold text-gray-900 mb-2">404</h1>
        <h2 className="text-2xl font-semibold text-gray-700 mb-4">Page Not Found</h2>
        <p className="text-gray-600 mb-8">
          Looks like this page is in the penalty box!
        </p>
        <a 
          href="/" 
          className="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 inline-block"
        >
          Back to Home Ice
        </a>
      </div>
    </div>
  )
}
</file>

<file path="components.json">
{
  "$schema": "https://ui.shadcn.com/schema.json",
  "style": "new-york",
  "rsc": true,
  "tsx": true,
  "tailwind": {
    "config": "",
    "css": "app/globals.css",
    "baseColor": "slate",
    "cssVariables": true,
    "prefix": ""
  },
  "aliases": {
    "components": "@/components",
    "utils": "@/lib/utils",
    "ui": "@/components/ui",
    "lib": "@/lib",
    "hooks": "@/hooks"
  },
  "iconLibrary": "lucide"
}
</file>

<file path="components/LoadingSpinner.tsx">
export default function LoadingSpinner() {
    return (
    <div className="flex items-center justify-center p-8">
        <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
    </div>
    )
}
</file>

<file path="components/ui/badge.tsx">
import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const badgeVariants = cva(
  "inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",
  {
    variants: {
      variant: {
        default:
          "border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",
        secondary:
          "border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",
        destructive:
          "border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",
        outline:
          "text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
)

function Badge({
  className,
  variant,
  asChild = false,
  ...props
}: React.ComponentProps<"span"> &
  VariantProps<typeof badgeVariants> & { asChild?: boolean }) {
  const Comp = asChild ? Slot : "span"

  return (
    <Comp
      data-slot="badge"
      className={cn(badgeVariants({ variant }), className)}
      {...props}
    />
  )
}

export { Badge, badgeVariants }
</file>

<file path="eslint.config.mjs">
import { dirname } from "path";
import { fileURLToPath } from "url";
import { FlatCompat } from "@eslint/eslintrc";

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

const compat = new FlatCompat({
  baseDirectory: __dirname,
});

const eslintConfig = [
  ...compat.extends("next/core-web-vitals", "next/typescript"),
  {
    ignores: [
      "node_modules/**",
      ".next/**",
      "out/**",
      "build/**",
      "next-env.d.ts",
    ],
    rules: {
      "@typescript-eslint/no-explicit-any": "off",
      "@typescript-eslint/no-unused-vars": "off",
      "react/no-unescaped-entities": "off",
      "@next/next/no-html-link-for-pages": "off"
    }
  },
];

export default eslintConfig;
</file>

<file path="lib/supabase/client.ts">
import { createBrowserClient } from '@supabase/ssr'

export function createClient() {
return createBrowserClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
    )
}
</file>

<file path="postcss.config.mjs">
const config = {
  plugins: ["@tailwindcss/postcss"],
};

export default config;
</file>

<file path="public/file.svg">
<svg fill="none" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M14.5 13.5V5.41a1 1 0 0 0-.3-.7L9.8.29A1 1 0 0 0 9.08 0H1.5v13.5A2.5 2.5 0 0 0 4 16h8a2.5 2.5 0 0 0 2.5-2.5m-1.5 0v-7H8v-5H3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1M9.5 5V2.12L12.38 5zM5.13 5h-.62v1.25h2.12V5zm-.62 3h7.12v1.25H4.5zm.62 3h-.62v1.25h7.12V11z" clip-rule="evenodd" fill="#666" fill-rule="evenodd"/></svg>
</file>

<file path="public/globe.svg">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><g clip-path="url(#a)"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.27 14.1a6.5 6.5 0 0 0 3.67-3.45q-1.24.21-2.7.34-.31 1.83-.97 3.1M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16m.48-1.52a7 7 0 0 1-.96 0H7.5a4 4 0 0 1-.84-1.32q-.38-.89-.63-2.08a40 40 0 0 0 3.92 0q-.25 1.2-.63 2.08a4 4 0 0 1-.84 1.31zm2.94-4.76q1.66-.15 2.95-.43a7 7 0 0 0 0-2.58q-1.3-.27-2.95-.43a18 18 0 0 1 0 3.44m-1.27-3.54a17 17 0 0 1 0 3.64 39 39 0 0 1-4.3 0 17 17 0 0 1 0-3.64 39 39 0 0 1 4.3 0m1.1-1.17q1.45.13 2.69.34a6.5 6.5 0 0 0-3.67-3.44q.65 1.26.98 3.1M8.48 1.5l.01.02q.41.37.84 1.31.38.89.63 2.08a40 40 0 0 0-3.92 0q.25-1.2.63-2.08a4 4 0 0 1 .85-1.32 7 7 0 0 1 .96 0m-2.75.4a6.5 6.5 0 0 0-3.67 3.44 29 29 0 0 1 2.7-.34q.31-1.83.97-3.1M4.58 6.28q-1.66.16-2.95.43a7 7 0 0 0 0 2.58q1.3.27 2.95.43a18 18 0 0 1 0-3.44m.17 4.71q-1.45-.12-2.69-.34a6.5 6.5 0 0 0 3.67 3.44q-.65-1.27-.98-3.1" fill="#666"/></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h16v16H0z"/></clipPath></defs></svg>
</file>

<file path="public/next.svg">
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 394 80"><path fill="#000" d="M262 0h68.5v12.7h-27.2v66.6h-13.6V12.7H262V0ZM149 0v12.7H94v20.4h44.3v12.6H94v21h55v12.6H80.5V0h68.7zm34.3 0h-17.8l63.8 79.4h17.9l-32-39.7 32-39.6h-17.9l-23 28.6-23-28.6zm18.3 56.7-9-11-27.1 33.7h17.8l18.3-22.7z"/><path fill="#000" d="M81 79.3 17 0H0v79.3h13.6V17l50.2 62.3H81Zm252.6-.4c-1 0-1.8-.4-2.5-1s-1.1-1.6-1.1-2.6.3-1.8 1-2.5 1.6-1 2.6-1 1.8.3 2.5 1a3.4 3.4 0 0 1 .6 4.3 3.7 3.7 0 0 1-3 1.8zm23.2-33.5h6v23.3c0 2.1-.4 4-1.3 5.5a9.1 9.1 0 0 1-3.8 3.5c-1.6.8-3.5 1.3-5.7 1.3-2 0-3.7-.4-5.3-1s-2.8-1.8-3.7-3.2c-.9-1.3-1.4-3-1.4-5h6c.1.8.3 1.6.7 2.2s1 1.2 1.6 1.5c.7.4 1.5.5 2.4.5 1 0 1.8-.2 2.4-.6a4 4 0 0 0 1.6-1.8c.3-.8.5-1.8.5-3V45.5zm30.9 9.1a4.4 4.4 0 0 0-2-3.3 7.5 7.5 0 0 0-4.3-1.1c-1.3 0-2.4.2-3.3.5-.9.4-1.6 1-2 1.6a3.5 3.5 0 0 0-.3 4c.3.5.7.9 1.3 1.2l1.8 1 2 .5 3.2.8c1.3.3 2.5.7 3.7 1.2a13 13 0 0 1 3.2 1.8 8.1 8.1 0 0 1 3 6.5c0 2-.5 3.7-1.5 5.1a10 10 0 0 1-4.4 3.5c-1.8.8-4.1 1.2-6.8 1.2-2.6 0-4.9-.4-6.8-1.2-2-.8-3.4-2-4.5-3.5a10 10 0 0 1-1.7-5.6h6a5 5 0 0 0 3.5 4.6c1 .4 2.2.6 3.4.6 1.3 0 2.5-.2 3.5-.6 1-.4 1.8-1 2.4-1.7a4 4 0 0 0 .8-2.4c0-.9-.2-1.6-.7-2.2a11 11 0 0 0-2.1-1.4l-3.2-1-3.8-1c-2.8-.7-5-1.7-6.6-3.2a7.2 7.2 0 0 1-2.4-5.7 8 8 0 0 1 1.7-5 10 10 0 0 1 4.3-3.5c2-.8 4-1.2 6.4-1.2 2.3 0 4.4.4 6.2 1.2 1.8.8 3.2 2 4.3 3.4 1 1.4 1.5 3 1.5 5h-5.8z"/></svg>
</file>

<file path="public/vercel.svg">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1155 1000"><path d="m577.3 0 577.4 1000H0z" fill="#fff"/></svg>
</file>

<file path="public/window.svg">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.5 2.5h13v10a1 1 0 0 1-1 1h-11a1 1 0 0 1-1-1zM0 1h16v11.5a2.5 2.5 0 0 1-2.5 2.5h-11A2.5 2.5 0 0 1 0 12.5zm3.75 4.5a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5M7 4.75a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0m1.75.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5" fill="#666"/></svg>
</file>

<file path="README.md">
This is a [Next.js](https://nextjs.org) project bootstrapped with [`create-next-app`](https://nextjs.org/docs/app/api-reference/cli/create-next-app).

## Getting Started

First, run the development server:

```bash
npm run dev
# or
yarn dev
# or
pnpm dev
# or
bun dev
```

Open [http://localhost:3000](http://localhost:3000) with your browser to see the result.

You can start editing the page by modifying `app/page.tsx`. The page auto-updates as you edit the file.

This project uses [`next/font`](https://nextjs.org/docs/app/building-your-application/optimizing/fonts) to automatically optimize and load [Geist](https://vercel.com/font), a new font family for Vercel.

## Learn More

To learn more about Next.js, take a look at the following resources:

- [Next.js Documentation](https://nextjs.org/docs) - learn about Next.js features and API.
- [Learn Next.js](https://nextjs.org/learn) - an interactive Next.js tutorial.

You can check out [the Next.js GitHub repository](https://github.com/vercel/next.js) - your feedback and contributions are welcome!

## Deploy on Vercel

The easiest way to deploy your Next.js app is to use the [Vercel Platform](https://vercel.com/new?utm_medium=default-template&filter=next.js&utm_source=create-next-app&utm_campaign=create-next-app-readme) from the creators of Next.js.

Check out our [Next.js deployment documentation](https://nextjs.org/docs/app/building-your-application/deploying) for more details.
</file>

<file path="vercel.json">
{
    "crons": [
    {
        "path": "/api/sync-ottawa-rinks",
      "schedule": "0 3 * * *"
    }
    ]
}
</file>

<file path="app/(dashboard)/clubs/new/page.tsx">
'use client'

import { useState } from 'react'
import { useRouter } from 'next/navigation'
import { createClient } from '@/lib/supabase/client'

export default function NewClubPage() {
  const router = useRouter()
  const [loading, setLoading] = useState(false)
  const [message, setMessage] = useState('')
  
  const [formData, setFormData] = useState({
    name: '',
    description: '',
    contact_email: '',
    contact_phone: '',
    website: '',
    founded_year: new Date().getFullYear().toString(),
    home_rink: '',
    age_groups: [] as string[],
  })

  const ageGroups = ['U7', 'U9', 'U11', 'U13', 'U15', 'U18']

  const handleAgeGroupToggle = (ageGroup: string) => {
    setFormData(prev => ({
      ...prev,
      age_groups: prev.age_groups.includes(ageGroup)
        ? prev.age_groups.filter(ag => ag !== ageGroup)
        : [...prev.age_groups, ageGroup]
    }))
  }

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()
    setLoading(true)
    setMessage('')

    try {
      const supabase = createClient()
      
      // Get current user
      const { data: { user } } = await supabase.auth.getUser()
      
      if (!user) {
        setMessage('Please login to create a club')
        setLoading(false)
        return
      }

      // Create club
      const { data, error } = await supabase
        .from('clubs')
        .insert({
          ...formData,
          manager_id: user.id,
          verified: false,
          age_groups: formData.age_groups.join(',')
        })
        .select()
        .single()

      if (error) {
        setMessage('Error creating club: ' + error.message)
      } else {
        setMessage('Club created successfully!')
        setTimeout(() => {
          router.push('/clubs')
        }, 1500)
      }
    } catch (error) {
      setMessage('An unexpected error occurred')
    } finally {
      setLoading(false)
    }
  }

  return (
    <div className="min-h-screen bg-gray-50">
      {/* Navigation */}
      <nav className="bg-white shadow-sm">
        <div className="container mx-auto px-4 h-16 flex items-center justify-between">
          <a href="/" className="text-xl font-bold">üèí HockeyHub</a>
          <div className="flex gap-4">
            <a href="/games" className="text-gray-600">Games</a>
            <a href="/rinks" className="text-gray-600">Rinks</a>
            <a href="/clubs" className="text-blue-600">Clubs</a>
            <a href="/profile" className="text-gray-600">Profile</a>
          </div>
        </div>
      </nav>

      {/* Main Content */}
      <div className="container mx-auto px-4 py-8 max-w-2xl">
        <h1 className="text-3xl font-bold mb-6">Register Your Club</h1>
        
        <div className="bg-white rounded-lg shadow p-6">
          <form onSubmit={handleSubmit} className="space-y-4">
            {/* Club Name */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">
                Club Name *
              </label>
              <input
                type="text"
                required
                value={formData.name}
                onChange={(e) => setFormData({ ...formData, name: e.target.value })}
                className="w-full px-3 py-2 border border-gray-300 rounded-md"
                placeholder="Ottawa Knights Hockey Club"
              />
            </div>

            {/* Description */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">
                Description
              </label>
              <textarea
                value={formData.description}
                onChange={(e) => setFormData({ ...formData, description: e.target.value })}
                className="w-full px-3 py-2 border border-gray-300 rounded-md"
                rows={3}
                placeholder="Tell us about your club..."
              />
            </div>

            {/* Contact Email */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">
                Contact Email *
              </label>
              <input
                type="email"
                required
                value={formData.contact_email}
                onChange={(e) => setFormData({ ...formData, contact_email: e.target.value })}
                className="w-full px-3 py-2 border border-gray-300 rounded-md"
                placeholder="info@clubname.com"
              />
            </div>

            {/* Contact Phone */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">
                Contact Phone
              </label>
              <input
                type="tel"
                value={formData.contact_phone}
                onChange={(e) => setFormData({ ...formData, contact_phone: e.target.value })}
                className="w-full px-3 py-2 border border-gray-300 rounded-md"
                placeholder="(613) 555-0100"
              />
            </div>

            {/* Website */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">
                Website
              </label>
              <input
                type="url"
                value={formData.website}
                onChange={(e) => setFormData({ ...formData, website: e.target.value })}
                className="w-full px-3 py-2 border border-gray-300 rounded-md"
                placeholder="https://www.clubname.com"
              />
            </div>

            {/* Founded Year */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">
                Founded Year
              </label>
              <input
                type="number"
                min="1900"
                max={new Date().getFullYear()}
                value={formData.founded_year}
                onChange={(e) => setFormData({ ...formData, founded_year: e.target.value })}
                className="w-full px-3 py-2 border border-gray-300 rounded-md"
              />
            </div>

            {/* Home Rink */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">
                Home Rink
              </label>
              <input
                type="text"
                value={formData.home_rink}
                onChange={(e) => setFormData({ ...formData, home_rink: e.target.value })}
                className="w-full px-3 py-2 border border-gray-300 rounded-md"
                placeholder="Bell Sensplex"
              />
            </div>

            {/* Age Groups */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Age Groups
              </label>
              <div className="flex flex-wrap gap-2">
                {ageGroups.map((ageGroup) => (
                  <button
                    key={ageGroup}
                    type="button"
                    onClick={() => handleAgeGroupToggle(ageGroup)}
                    className={`px-3 py-1 rounded-md border ${
                      formData.age_groups.includes(ageGroup)
                        ? 'bg-blue-600 text-white border-blue-600'
                        : 'bg-white text-gray-700 border-gray-300'
                    }`}
                  >
                    {ageGroup}
                  </button>
                ))}
              </div>
            </div>

            {/* Message */}
            {message && (
              <div className={`text-sm p-3 rounded ${
                message.includes('Error') || message.includes('login')
                  ? 'bg-red-50 text-red-600'
                  : 'bg-green-50 text-green-600'
              }`}>
                {message}
              </div>
            )}

            {/* Submit Buttons */}
            <div className="flex gap-2">
              <button
                type="submit"
                disabled={loading}
                className="flex-1 bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 disabled:opacity-50"
              >
                {loading ? 'Creating...' : 'Register Club'}
              </button>
              <button
                type="button"
                onClick={() => router.push('/clubs')}
                className="flex-1 bg-gray-200 text-gray-700 py-2 px-4 rounded-md hover:bg-gray-300"
              >
                Cancel
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  )
}
</file>

<file path="app/(dashboard)/games/[id]/edit/page.tsx">
'use client';

import { useState, useEffect } from 'react';
import { createClient } from '@/lib/supabase/client';
import { useRouter, useParams } from 'next/navigation';
import Link from 'next/link';
import { ArrowLeft, Calendar, Clock, MapPin, Users, Trophy, Save, X } from 'lucide-react';

interface GameData {
  title: string;
  game_date: string;
  game_time: string;
  location: string;
  age_group: string;
  skill_level: string;
  description: string;
  max_players: string;
  contact_info: string;
  status: string;
}

export default function EditGamePage() {
  const router = useRouter();
  const params = useParams();
  const gameId = params.id as string;
  const supabase = createClient();
  
  const [loading, setLoading] = useState(true);
  const [saving, setSaving] = useState(false);
  const [isOwner, setIsOwner] = useState(false);
  const [formData, setFormData] = useState<GameData>({
    title: '',
    game_date: '',
    game_time: '',
    location: '',
    age_group: 'U11',
    skill_level: 'Intermediate',
    description: '',
    max_players: '',
    contact_info: '',
    status: 'open'
  });

  const ageGroups = ['U7', 'U9', 'U11', 'U13', 'U15', 'U18', 'Adult'];
  const skillLevels = ['Beginner', 'Intermediate', 'Advanced', 'Elite'];

  useEffect(() => {
    loadGame();
  }, [gameId]);

  async function loadGame() {
    try {
      // Get current user
      const { data: { user } } = await supabase.auth.getUser();
      if (!user) {
        router.push('/login');
        return;
      }

      // Load game data
      const { data: game, error } = await supabase
        .from('game_invitations')
        .select('*')
        .eq('id', gameId)
        .single();

      if (error || !game) {
        alert('Game not found');
        router.push('/my-games');
        return;
      }

      // Check if user is the owner
      if (game.created_by !== user.id) {
        alert('You can only edit your own games');
        router.push(`/games/${gameId}`);
        return;
      }

      setIsOwner(true);
      setFormData({
        title: game.title || '',
        game_date: game.game_date || '',
        game_time: game.game_time || '',
        location: game.location || '',
        age_group: game.age_group || 'U11',
        skill_level: game.skill_level || 'Intermediate',
        description: game.description || '',
        max_players: game.max_players?.toString() || '',
        contact_info: game.contact_info || '',
        status: game.status || 'open'
      });

    } catch (error) {
      console.error('Error loading game:', error);
      alert('Failed to load game');
      router.push('/my-games');
    } finally {
      setLoading(false);
    }
  }

  async function handleSubmit(e: React.FormEvent) {
    e.preventDefault();
    setSaving(true);

    try {
      const { error } = await supabase
        .from('game_invitations')
        .update({
          title: formData.title,
          game_date: formData.game_date,
          game_time: formData.game_time,
          location: formData.location,
          age_group: formData.age_group,
          skill_level: formData.skill_level,
          description: formData.description,
          max_players: formData.max_players ? parseInt(formData.max_players) : null,
          contact_info: formData.contact_info,
          status: formData.status
        })
        .eq('id', gameId);

      if (error) throw error;

      // Success - redirect to game details
      router.push(`/games/${gameId}`);
      
    } catch (error: any) {
      console.error('Error updating game:', error);
      alert(error.message || 'Failed to update game');
    } finally {
      setSaving(false);
    }
  }

  function handleChange(e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement>) {
    setFormData(prev => ({
      ...prev,
      [e.target.name]: e.target.value
    }));
  }

  if (loading) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
      </div>
    );
  }

  if (!isOwner) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <div className="text-center">
          <p className="text-gray-500">You don't have permission to edit this game</p>
          <Link href="/my-games" className="text-blue-600 hover:text-blue-800 mt-4 inline-block">
            Back to My Games
          </Link>
        </div>
      </div>
    );
  }

  // Get tomorrow's date as minimum
  const tomorrow = new Date();
  tomorrow.setDate(tomorrow.getDate() + 1);
  const minDate = tomorrow.toISOString().split('T')[0];

  return (
    <div className="min-h-screen bg-gray-50 py-8">
      <div className="max-w-3xl mx-auto px-4">
        {/* Header */}
        <div className="mb-8">
          <Link
            href="/my-games"
            className="inline-flex items-center text-gray-600 hover:text-gray-900 mb-4"
          >
            <ArrowLeft className="h-4 w-4 mr-2" />
            Back to My Games
          </Link>
          <h1 className="text-3xl font-bold text-gray-900">Edit Game</h1>
          <p className="mt-2 text-gray-600">Update your game information</p>
        </div>

        {/* Form */}
        <form onSubmit={handleSubmit} className="bg-white rounded-lg shadow p-6 space-y-6">
          {/* Status */}
          <div>
            <label htmlFor="status" className="block text-sm font-medium text-gray-700 mb-2">
              Game Status
            </label>
            <select
              id="status"
              name="status"
              value={formData.status}
              onChange={handleChange}
              className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
            >
              <option value="open">Open - Accepting responses</option>
              <option value="matched">Matched - Found opponent</option>
              <option value="cancelled">Cancelled - No longer available</option>
            </select>
          </div>

          {/* Title */}
          <div>
            <label htmlFor="title" className="block text-sm font-medium text-gray-700 mb-2">
              Game Title *
            </label>
            <input
              type="text"
              id="title"
              name="title"
              required
              value={formData.title}
              onChange={handleChange}
              placeholder="e.g., U13 Friendly Match Looking for Opponent"
              className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
            />
          </div>

          {/* Date and Time */}
          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label htmlFor="game_date" className="block text-sm font-medium text-gray-700 mb-2">
                <Calendar className="inline h-4 w-4 mr-1" />
                Game Date *
              </label>
              <input
                type="date"
                id="game_date"
                name="game_date"
                required
                value={formData.game_date}
                onChange={handleChange}
                className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
              />
            </div>
            <div>
              <label htmlFor="game_time" className="block text-sm font-medium text-gray-700 mb-2">
                <Clock className="inline h-4 w-4 mr-1" />
                Game Time *
              </label>
              <input
                type="time"
                id="game_time"
                name="game_time"
                required
                value={formData.game_time}
                onChange={handleChange}
                className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
              />
            </div>
          </div>

          {/* Location */}
          <div>
            <label htmlFor="location" className="block text-sm font-medium text-gray-700 mb-2">
              <MapPin className="inline h-4 w-4 mr-1" />
              Location *
            </label>
            <input
              type="text"
              id="location"
              name="location"
              required
              value={formData.location}
              onChange={handleChange}
              placeholder="e.g., Bell Sensplex, Kanata"
              className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
            />
          </div>

          {/* Age Group and Skill Level */}
          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label htmlFor="age_group" className="block text-sm font-medium text-gray-700 mb-2">
                <Users className="inline h-4 w-4 mr-1" />
                Age Group *
              </label>
              <select
                id="age_group"
                name="age_group"
                required
                value={formData.age_group}
                onChange={handleChange}
                className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
              >
                {ageGroups.map(group => (
                  <option key={group} value={group}>{group}</option>
                ))}
              </select>
            </div>
            <div>
              <label htmlFor="skill_level" className="block text-sm font-medium text-gray-700 mb-2">
                <Trophy className="inline h-4 w-4 mr-1" />
                Skill Level *
              </label>
              <select
                id="skill_level"
                name="skill_level"
                required
                value={formData.skill_level}
                onChange={handleChange}
                className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
              >
                {skillLevels.map(level => (
                  <option key={level} value={level}>{level}</option>
                ))}
              </select>
            </div>
          </div>

          {/* Max Players */}
          <div>
            <label htmlFor="max_players" className="block text-sm font-medium text-gray-700 mb-2">
              Max Players (Optional)
            </label>
            <input
              type="number"
              id="max_players"
              name="max_players"
              min="1"
              max="50"
              value={formData.max_players}
              onChange={handleChange}
              placeholder="e.g., 20"
              className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
            />
          </div>

          {/* Description */}
          <div>
            <label htmlFor="description" className="block text-sm font-medium text-gray-700 mb-2">
              Description
            </label>
            <textarea
              id="description"
              name="description"
              rows={4}
              value={formData.description}
              onChange={handleChange}
              placeholder="Provide additional details about the game, rules, or requirements..."
              className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
            />
          </div>

          {/* Contact Info */}
          <div>
            <label htmlFor="contact_info" className="block text-sm font-medium text-gray-700 mb-2">
              Contact Information (Optional)
            </label>
            <input
              type="text"
              id="contact_info"
              name="contact_info"
              value={formData.contact_info}
              onChange={handleChange}
              placeholder="e.g., Coach John - 613-555-0123"
              className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
            />
            <p className="mt-1 text-sm text-gray-500">
              This will be shared only with interested teams
            </p>
          </div>

          {/* Submit Buttons */}
          <div className="flex gap-4 pt-4">
            <button
              type="submit"
              disabled={saving}
              className="flex-1 bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition flex items-center justify-center gap-2"
            >
              <Save className="h-4 w-4" />
              {saving ? 'Saving...' : 'Save Changes'}
            </button>
            <Link
              href="/my-games"
              className="flex-1 bg-gray-200 text-gray-800 py-2 px-4 rounded-md hover:bg-gray-300 text-center transition flex items-center justify-center gap-2"
            >
              <X className="h-4 w-4" />
              Cancel
            </Link>
          </div>
        </form>
      </div>
    </div>
  );
}
</file>

<file path="app/(dashboard)/profile/page.tsx">
'use client';

import {useEffect, useState} from 'react';
import {createClient} from '@/lib/supabase/client';
import {User} from '@supabase/supabase-js';
import {useRouter, useParams} from 'next/navigation';
import {
  User as UserIcon,
  Mail,
  Phone,
  MapPin,
  Trophy,
  Calendar,
  Shield,
  Target,
  Edit2,
  AlertCircle
} from 'lucide-react';

interface Profile {
  id: string;
  full_name: string;
  email?: string;
  age_group?: string;
  skill_level?: string;
  position?: string;
  area?: string;
  years_playing?: number;
  phone?: string;
  jersey_number?: string;
  preferred_shot?: string;
  bio?: string;
  created_at?: string;
}

export default function ProfilePage() {
  // Read locale from the URL segment: /{locale}/...
  const {locale} = useParams<{locale: string}>();

  const [user, setUser] = useState<User | null>(null);
  const [profile, setProfile] = useState<Profile | null>(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);
  const router = useRouter();
  const supabase = createClient();

  useEffect(() => {
    getProfile();
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, []);

  async function getProfile() {
    try {
      setError(null);
      const {
        data: {user},
        error: userError
      } = await supabase.auth.getUser();

      if (userError) throw userError;

      if (!user) {
        // Localized login redirect
        router.push(`/${locale}/login`);
        return;
      }

      setUser(user);

      const {data: profileData, error: profileError} = await supabase
        .from('profiles')
        .select('*')
        .eq('id', user.id)
        .single();

      // Create a profile row if not found
      if (profileError && (profileError as any).code === 'PGRST116') {
        const fallbackName =
          user.user_metadata?.full_name ||
          user.email?.split('@')[0] ||
          'Hockey Player';

        const {data: newProfile, error: insertError} = await supabase
          .from('profiles')
          .insert([{id: user.id, full_name: fallbackName, email: user.email}])
          .select()
          .single();

        if (insertError) {
          // Fallback to upsert
          const {data: upsertProfile, error: upsertError} = await supabase
            .from('profiles')
            .upsert({id: user.id, full_name: fallbackName, email: user.email})
            .select()
            .single();

          if (upsertError) throw upsertError;
          setProfile(upsertProfile);
        } else {
          setProfile(newProfile);
        }
      } else if (profileError) {
        throw profileError;
      } else {
        setProfile(profileData);
      }
    } catch (error: any) {
      setError(error.message || 'Failed to load profile');
    } finally {
      setLoading(false);
    }
  }

  const getSkillLevelColor = (level: string) => {
    const colors: Record<string, string> = {
      AAA: 'bg-purple-100 text-purple-800',
      AA: 'bg-indigo-100 text-indigo-800',
      A: 'bg-blue-100 text-blue-800',
      B: 'bg-green-100 text-green-800',
      C: 'bg-yellow-100 text-yellow-800',
      'House League': 'bg-orange-100 text-orange-800',
      Beginner: 'bg-gray-100 text-gray-800'
    };
    return colors[level] || 'bg-gray-100 text-gray-800';
  };

  const getPositionIcon = (position: string) => {
    switch (position) {
      case 'Forward':
        return '‚ö°';
      case 'Defense':
        return 'üõ°Ô∏è';
      case 'Goalie':
        return 'ü•Ö';
      default:
        return 'üèí';
    }
  };

  if (loading) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
      </div>
    );
  }

  if (error) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <div className="bg-red-50 border border-red-200 rounded-lg p-6 max-w-md">
          <div className="flex items-center space-x-3">
            <AlertCircle className="h-6 w-6 text-red-600" />
            <div>
              <h3 className="text-lg font-medium text-red-900">Error loading profile</h3>
              <p className="text-sm text-red-700 mt-1">{error}</p>
              <button
                onClick={() => window.location.reload()}
                className="mt-3 text-sm text-red-600 hover:text-red-800 underline"
              >
                Try again
              </button>
            </div>
          </div>
        </div>
      </div>
    );
  }

  if (!profile) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <div className="text-center">
          <p className="text-gray-500">Profile not found</p>
          <button
            onClick={() => window.location.reload()}
            className="mt-3 text-blue-600 hover:text-blue-800 underline"
          >
            Reload page
          </button>
        </div>
      </div>
    );
  }

  const isIncomplete =
    !profile.age_group || !profile.skill_level || !profile.position || !profile.area;

  return (
    <div className="min-h-screen bg-gray-50 py-8">
      <div className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        {/* Incomplete profile alert */}
        {isIncomplete && (
          <div className="mb-6 bg-yellow-50 border border-yellow-200 rounded-lg p-4">
            <div className="flex">
              <AlertCircle className="h-5 w-5 text-yellow-600 mt-0.5" />
              <div className="ml-3">
                <h3 className="text-sm font-medium text-yellow-800">
                  Complete your profile
                </h3>
                <p className="mt-1 text-sm text-yellow-700">
                  Add your hockey details to find better game matches and connect with other players.
                </p>
                <button
                  onClick={() => router.push(`/${locale}/profile/edit`)}
                  className="mt-2 text-sm font-medium text-yellow-800 hover:text-yellow-900 underline"
                >
                  Complete now ‚Üí
                </button>
              </div>
            </div>
          </div>
        )}

        {/* Header card */}
        <div className="bg-white shadow-xl rounded-lg overflow-hidden">
          <div className="h-32 bg-gradient-to-r from-blue-500 to-blue-600"></div>

          <div className="relative px-6 pb-6">
            {/* Avatar */}
            <div className="absolute -top-12 left-6">
              <div className="h-24 w-24 rounded-full bg-white border-4 border-white shadow-lg flex items-center justify-center">
                <UserIcon className="h-12 w-12 text-gray-400" />
              </div>
            </div>

            {/* Edit button */}
            <div className="flex justify-end pt-4">
              <button
                onClick={() => router.push(`/${locale}/profile/edit`)}
                className="flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition"
              >
                <Edit2 className="h-4 w-4" />
                <span>Edit Profile</span>
              </button>
            </div>

            {/* Name and badges */}
            <div className="mt-4">
              <h1 className="text-3xl font-bold text-gray-900">
                {profile.full_name || 'Hockey Player'}
              </h1>

              <div className="mt-4 flex flex-wrap gap-2">
                {profile.age_group && (
                  <span className="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-gray-100 text-gray-800">
                    {profile.age_group}
                  </span>
                )}
                {profile.skill_level && (
                  <span
                    className={`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${getSkillLevelColor(
                      profile.skill_level
                    )}`}
                  >
                    {profile.skill_level}
                  </span>
                )}
                {profile.position && (
                  <span className="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800">
                    {getPositionIcon(profile.position)} {profile.position}
                  </span>
                )}
                {profile.jersey_number && (
                  <span className="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-red-100 text-red-800">
                    #{profile.jersey_number}
                  </span>
                )}
              </div>
            </div>
          </div>
        </div>

        {/* Details */}
        <div className="mt-6 grid grid-cols-1 md:grid-cols-2 gap-6">
          {/* Contact */}
          <div className="bg-white shadow rounded-lg p-6">
            <h2 className="text-lg font-semibold text-gray-900 mb-4">Contact Information</h2>
            <div className="space-y-3">
              <div className="flex items-center text-gray-600">
                <Mail className="h-5 w-5 mr-3 text-gray-400" />
                <span>{user?.email || profile.email || 'No email'}</span>
              </div>
              <div className="flex items-center text-gray-600">
                <Phone className="h-5 w-5 mr-3 text-gray-400" />
                <span className={!profile.phone ? 'text-gray-400' : ''}>
                  {profile.phone || 'Add phone number'}
                </span>
              </div>
              <div className="flex items-center text-gray-600">
                <MapPin className="h-5 w-5 mr-3 text-gray-400" />
                <span className={!profile.area ? 'text-gray-400' : ''}>
                  {profile.area || 'Add location'}
                </span>
              </div>
            </div>
          </div>

          {/* Hockey profile */}
          <div className="bg-white shadow rounded-lg p-6">
            <h2 className="text-lg font-semibold text-gray-900 mb-4">Hockey Profile</h2>
            <div className="space-y-3">
              <div className="flex items-center justify-between">
                <span className="text-gray-600 flex items-center">
                  <Trophy className="h-5 w-5 mr-3 text-gray-400" />
                  Experience
                </span>
                <span className={`font-medium ${!profile.years_playing ? 'text-gray-400' : ''}`}>
                  {profile.years_playing ? `${profile.years_playing} years` : 'Not specified'}
                </span>
              </div>
              <div className="flex items-center justify-between">
                <span className="text-gray-600 flex items-center">
                  <Target className="h-5 w-5 mr-3 text-gray-400" />
                  Shoots
                </span>
                <span className={`font-medium ${!profile.preferred_shot ? 'text-gray-400' : ''}`}>
                  {profile.preferred_shot || 'Not specified'}
                </span>
              </div>
              <div className="flex items-center justify-between">
                <span className="text-gray-600 flex items-center">
                  <Shield className="h-5 w-5 mr-3 text-gray-400" />
                  Position
                </span>
                <span className={`font-medium ${!profile.position ? 'text-gray-400' : ''}`}>
                  {profile.position || 'Not specified'}
                </span>
              </div>
              <div className="flex items-center justify-between">
                <span className="text-gray-600 flex items-center">
                  <Calendar className="h-5 w-5 mr-3 text-gray-400" />
                  Age Group
                </span>
                <span className={`font-medium ${!profile.age_group ? 'text-gray-400' : ''}`}>
                  {profile.age_group || 'Not specified'}
                </span>
              </div>
            </div>
          </div>
        </div>

        {/* Stats preview (placeholder) */}
        <div className="mt-6 bg-white shadow rounded-lg p-6">
          <h2 className="text-lg font-semibold text-gray-900 mb-4">Season Statistics</h2>
          <div className="grid grid-cols-3 gap-4 text-center">
            <div className="bg-gray-50 rounded-lg p-4">
              <p className="text-2xl font-bold text-blue-600">0</p>
              <p className="text-sm text-gray-600 mt-1">Games Played</p>
            </div>
            <div className="bg-gray-50 rounded-lg p-4">
              <p className="text-2xl font-bold text-green-600">0</p>
              <p className="text-sm text-gray-600 mt-1">Games Organized</p>
            </div>
            <div className="bg-gray-50 rounded-lg p-4">
              <p className="text-2xl font-bold text-purple-600">0</p>
              <p className="text-sm text-gray-600 mt-1">Teams Joined</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="app/[locale]/(auth)/login/LoginClient.tsx">
//app/[locale]/(auth)/login/LoginClient.tsx
'use client';

import { useState } from 'react';
import { createClient } from '@/lib/supabase/client';
import Link from 'next/link';
import { useParams } from 'next/navigation';

export default function LoginClient() {
  const { locale } = useParams<{ locale: string }>();
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [loading, setLoading] = useState(false);
  const [message, setMessage] = useState('');

  const handleLogin = async (e: React.FormEvent) => {
    e.preventDefault();
    setLoading(true);
    setMessage('');

    const supabase = createClient();

    const { data, error } = await supabase.auth.signInWithPassword({
      email,
      password,
    });

    if (error) {
      setMessage('Error: ' + error.message);
    } else {
      setMessage('Login successful!');
      window.location.href = `/${locale}/games`;
    }
    setLoading(false);
  };

  return (
    <div className="min-h-screen bg-gray-50 flex items-center justify-center py-12 px-4">
      <div className="max-w-md w-full space-y-8">
        <div className="text-center">
          <h2 className="text-3xl font-bold">Welcome back</h2>
          <p className="mt-2 text-gray-600">Sign in to your account</p>
        </div>

        <form className="mt-8 space-y-6" onSubmit={handleLogin}>
          <div className="space-y-4">
            <div>
              <label className="block text-sm font-medium text-gray-700">
                Email
              </label>
              <input
                type="email"
                required
                value={email}
                onChange={(e) => setEmail(e.target.value)}
                className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md"
              />
            </div>

            <div>
              <label className="block text-sm font-medium text-gray-700">
                Password
              </label>
              <input
                type="password"
                required
                value={password}
                onChange={(e) => setPassword(e.target.value)}
                className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md"
              />
            </div>
          </div>

          {message && (
            <div className={`text-sm ${message.includes('Error') ? 'text-red-600' : 'text-green-600'}`}>
              {message}
            </div>
          )}

          <button
            type="submit"
            disabled={loading}
            className="w-full py-2 px-4 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-md disabled:opacity-50"
          >
            {loading ? 'Signing in...' : 'Sign In'}
          </button>

          <div className="text-center text-sm">
            Don&apos;t have an account?{' '}
            <Link href={`/${locale}/register`} className="text-blue-600 hover:text-blue-700">
              Sign up
            </Link>
          </div>
        </form>
      </div>
    </div>
  );
}
</file>

<file path="app/[locale]/(auth)/register/RegisterClient.tsx">
// app/[locale]/(auth)/register/RegisterClient.tsx
'use client';

import { useState } from 'react';
import { createClient } from '@/lib/supabase/client';
import { useRouter } from 'next/navigation';
import Link from 'next/link';
import { useParams } from 'next/navigation';

export default function RegisterClient() {
  const router = useRouter();
  const { locale } = useParams<{ locale: string }>();
  const supabase = createClient();
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState('');
  const [step, setStep] = useState(1);
  
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [fullName, setFullName] = useState('');
  
  const [profile, setProfile] = useState({
    age_group: '',
    skill_level: '',
    position: '',
    area: '',
    years_playing: 0,
    phone: '',
    jersey_number: '',
    preferred_shot: ''
  });

  const handleStep1Submit = (e: React.FormEvent) => {
    e.preventDefault();
    if (!email || !password || !fullName) {
      setError('Please fill in all required fields');
      return;
    }
    setStep(2);
  };

  const handleRegister = async (e: React.FormEvent) => {
    e.preventDefault();
    setIsLoading(true);
    setError('');

    try {
      const { data: authData, error: authError } = await supabase.auth.signUp({
        email,
        password,
      });

      if (authError) throw authError;

      if (authData.user) {
        const { error: profileError } = await supabase
          .from('profiles')
          .update({
            full_name: fullName,
            age_group: profile.age_group,
            skill_level: profile.skill_level,
            position: profile.position,
            area: profile.area,
            years_playing: profile.years_playing,
            phone: profile.phone,
            jersey_number: profile.jersey_number,
            preferred_shot: profile.preferred_shot
          })
          .eq('id', authData.user.id);

        if (profileError) throw profileError;

        router.push(`/${locale}/dashboard`);
      }
    } catch (error: any) {
      setError(error.message);
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <div className="min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8">
      <div className="max-w-md w-full space-y-8">
        <div>
          <h2 className="mt-6 text-center text-3xl font-extrabold text-gray-900">
            Create your HockeyHub account
          </h2>
          <p className="mt-2 text-center text-sm text-gray-600">
            Step {step} of 2: {step === 1 ? 'Basic Information' : 'Hockey Profile'}
          </p>
        </div>

        {step === 1 ? (
          <form className="mt-8 space-y-6" onSubmit={handleStep1Submit}>
            <div className="rounded-md shadow-sm -space-y-px">
              <div>
                <label htmlFor="full-name" className="sr-only">Full Name</label>
                <input
                  id="full-name"
                  name="fullName"
                  type="text"
                  required
                  className="appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-t-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-sm"
                  placeholder="Full Name"
                  value={fullName}
                  onChange={(e) => setFullName(e.target.value)}
                />
              </div>
              <div>
                <label htmlFor="email-address" className="sr-only">Email address</label>
                <input
                  id="email-address"
                  name="email"
                  type="email"
                  autoComplete="email"
                  required
                  className="appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-sm"
                  placeholder="Email address"
                  value={email}
                  onChange={(e) => setEmail(e.target.value)}
                />
              </div>
              <div>
                <label htmlFor="password" className="sr-only">Password</label>
                <input
                  id="password"
                  name="password"
                  type="password"
                  autoComplete="new-password"
                  required
                  className="appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-b-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-sm"
                  placeholder="Password (min 6 characters)"
                  value={password}
                  onChange={(e) => setPassword(e.target.value)}
                />
              </div>
            </div>

            {error && (
              <div className="text-red-500 text-sm text-center">{error}</div>
            )}

            <button
              type="submit"
              className="group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
            >
              Continue to Hockey Profile
            </button>
          </form>
        ) : (
          <form className="mt-8 space-y-4" onSubmit={handleRegister}>
            <div className="grid grid-cols-2 gap-4">
              <div>
                <label className="block text-sm font-medium text-gray-700">Age Group *</label>
                <select
                  required
                  className="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md"
                  value={profile.age_group}
                  onChange={(e) => setProfile({...profile, age_group: e.target.value})}
                >
                  <option value="">Select</option>
                  <option value="U7">U7</option>
                  <option value="U9">U9</option>
                  <option value="U11">U11</option>
                  <option value="U13">U13</option>
                  <option value="U15">U15</option>
                  <option value="U18">U18</option>
                  <option value="Adult">Adult</option>
                </select>
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700">Skill Level *</label>
                <select
                  required
                  className="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md"
                  value={profile.skill_level}
                  onChange={(e) => setProfile({...profile, skill_level: e.target.value})}
                >
                  <option value="">Select</option>
                  <option value="AAA">AAA</option>
                  <option value="AA">AA</option>
                  <option value="A">A</option>
                  <option value="B">B</option>
                  <option value="C">C</option>
                  <option value="House League">House League</option>
                  <option value="Beginner">Beginner</option>
                </select>
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700">Position *</label>
                <select
                  required
                  className="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md"
                  value={profile.position}
                  onChange={(e) => setProfile({...profile, position: e.target.value})}
                >
                  <option value="">Select</option>
                  <option value="Forward">Forward</option>
                  <option value="Defense">Defense</option>
                  <option value="Goalie">Goalie</option>
                  <option value="Any">Any Position</option>
                </select>
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700">Shoots</label>
                <select
                  className="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md"
                  value={profile.preferred_shot}
                  onChange={(e) => setProfile({...profile, preferred_shot: e.target.value})}
                >
                  <option value="">Select</option>
                  <option value="Left">Left</option>
                  <option value="Right">Right</option>
                </select>
              </div>
            </div>

            <div>
              <label className="block text-sm font-medium text-gray-700">Area/Location *</label>
              <select
                required
                className="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md"
                value={profile.area}
                onChange={(e) => setProfile({...profile, area: e.target.value})}
              >
                <option value="">Select your area</option>
                <option value="Downtown Ottawa">Downtown Ottawa</option>
                <option value="Ottawa East">Ottawa East</option>
                <option value="Ottawa West">Ottawa West</option>
                <option value="Ottawa South">Ottawa South</option>
                <option value="Kanata">Kanata</option>
                <option value="Nepean">Nepean</option>
                <option value="Orleans">Orleans</option>
                <option value="Gloucester">Gloucester</option>
                <option value="Barrhaven">Barrhaven</option>
                <option value="Stittsville">Stittsville</option>
              </select>
            </div>

            <div className="grid grid-cols-2 gap-4">
              <div>
                <label className="block text-sm font-medium text-gray-700">Years Playing</label>
                <input
                  type="number"
                  min="0"
                  max="50"
                  className="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                  value={profile.years_playing}
                  onChange={(e) => setProfile({...profile, years_playing: parseInt(e.target.value) || 0})}
                />
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700">Jersey #</label>
                <input
                  type="text"
                  maxLength={3}
                  className="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                  value={profile.jersey_number}
                  onChange={(e) => setProfile({...profile, jersey_number: e.target.value})}
                />
              </div>
            </div>

            <div>
              <label className="block text-sm font-medium text-gray-700">Phone Number</label>
              <input
                type="tel"
                className="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                placeholder="(613) 555-0100"
                value={profile.phone}
                onChange={(e) => setProfile({...profile, phone: e.target.value})}
              />
            </div>

            {error && (
              <div className="text-red-500 text-sm text-center">{error}</div>
            )}

            <div className="flex space-x-4">
              <button
                type="button"
                onClick={() => setStep(1)}
                className="flex-1 py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
              >
                Back
              </button>
              <button
                type="submit"
                disabled={isLoading}
                className="flex-1 py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:bg-gray-400"
              >
                {isLoading ? 'Creating...' : 'Complete Registration'}
              </button>
            </div>
          </form>
        )}

        <div className="text-center">
          <span className="text-sm text-gray-600">
            Already have an account?{' '}
            <Link href={`/${locale}/login`} className="font-medium text-blue-600 hover:text-blue-500">
              Sign in
            </Link>
          </span>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="app/[locale]/(dashboard)/layout.tsx">
'use client';

import {useEffect, useState} from 'react';
import {createClient} from '@/lib/supabase/client';
import Link from 'next/link';
import {usePathname, useRouter} from 'next/navigation';
import {Home, Trophy, MapPin, Calendar, Users, Bell, LogOut, FileText} from 'lucide-react';

/**
 * Dashboard shell (top nav + children)
 * - Derives `locale` from the first URL segment: /{locale}/...
 * - Localizes all nav links and redirects to `/${locale}/...`
 */
export default function DashboardLayout({
  children
}: {
  children: React.ReactNode;
}) {
  const pathname = usePathname();
  const router = useRouter();
  const supabase = createClient();

  // Resolve locale from path: ['', '{locale}', ...]
  const locale = (pathname?.split('/')?.[1] || '').trim();

  const [userEmail, setUserEmail] = useState<string | null>(null);
  const [unreadCount, setUnreadCount] = useState(0);

  // Build a localized href safely (avoid double slashes)
  const withLocale = (p: string) => `/${locale || ''}${p}`.replace('//', '/');

  useEffect(() => {
    checkUser();
    loadUnreadCount();

    // Subscribe to realtime notifications for the current user
    let cleanup: (() => void) | undefined;

    (async () => {
      const {
        data: {user}
      } = await supabase.auth.getUser();
      if (!user) return;

      const channel = supabase
        .channel('unread-notifications')
        .on(
          'postgres_changes',
          {
            event: '*',
            schema: 'public',
            table: 'notifications',
            filter: `user_id=eq.${user.id}`
          },
          () => {
            loadUnreadCount();
          }
        )
        .subscribe();

      cleanup = () => supabase.removeChannel(channel);
    })();

    return () => {
      if (cleanup) cleanup();
    };
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, []);

  async function checkUser() {
    const {
      data: {user}
    } = await supabase.auth.getUser();
    if (user) {
      setUserEmail(user.email || null);
    } else {
      // Localized redirect when unauthenticated
      router.push(withLocale('/login'));
    }
  }

  async function loadUnreadCount() {
    try {
      const {
        data: {user}
      } = await supabase.auth.getUser();
      if (!user) return;

      const {count} = await supabase
        .from('notifications')
        .select('*', {count: 'exact', head: true})
        .eq('user_id', user.id)
        .eq('is_read', false);

      setUnreadCount(count || 0);
    } catch (error) {
      console.error('Error loading unread count:', error);
    }
  }

  async function handleLogout() {
    await supabase.auth.signOut();
    // Localized redirect after logout
    router.push(withLocale('/login'));
  }

  // Define nav items without locale; we prepend it via `withLocale`
  const navItems = [
    {path: '/dashboard', label: 'Dashboard', icon: Home},
    {path: '/games', label: 'Games', icon: Trophy},
    {path: '/my-games', label: 'My Games', icon: FileText},
    {path: '/rinks', label: 'Rinks', icon: MapPin},
    {path: '/bookings', label: 'My Bookings', icon: Calendar},
    {path: '/clubs', label: 'Clubs', icon: Users}
  ] as const;

  return (
    <div className="min-h-screen bg-gray-50">
      {/* Top Navigation */}
      <nav className="bg-white shadow-sm border-b">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div className="flex justify-between h-16">
            {/* Logo + Desktop Nav */}
            <div className="flex">
              <Link href={withLocale('/dashboard')} className="flex items-center px-2">
                <span className="text-2xl">üèí</span>
                <span className="ml-2 text-xl font-bold text-gray-900">HockeyHub</span>
              </Link>

              <div className="hidden md:ml-8 md:flex md:space-x-4">
                {navItems.map((item) => {
                  const Icon = item.icon;
                  const href = withLocale(item.path);
                  const isActive =
                    pathname === href ||
                    (item.path !== '/dashboard' && pathname?.startsWith(href));

                  return (
                    <Link
                      key={item.path}
                      href={href}
                      className={`inline-flex items-center px-3 py-2 text-sm font-medium rounded-md transition ${
                        isActive
                          ? 'text-blue-600 bg-blue-50'
                          : 'text-gray-600 hover:text-gray-900 hover:bg-gray-50'
                      }`}
                    >
                      <Icon className="h-4 w-4 mr-2" />
                      {item.label}
                    </Link>
                  );
                })}
              </div>
            </div>

            {/* Right Side */}
            <div className="flex items-center space-x-4">
              {/* Notifications */}
              <Link
                href={withLocale('/notifications')}
                className={`relative p-2 rounded-full transition ${
                  pathname === withLocale('/notifications')
                    ? 'text-blue-600 bg-blue-50'
                    : 'text-gray-600 hover:text-gray-900 hover:bg-gray-100'
                }`}
              >
                <Bell className="h-5 w-5" />
                {unreadCount > 0 && (
                  <span className="absolute top-0 right-0 block h-4 w-4 rounded-full bg-red-500 text-white text-xs text-center leading-4">
                    {unreadCount > 9 ? '9+' : unreadCount}
                  </span>
                )}
              </Link>

              {/* User section */}
              <div className="flex items-center space-x-3">
                <span className="text-sm text-gray-700 hidden sm:block">{userEmail}</span>
                <button
                  onClick={handleLogout}
                  className="inline-flex items-center px-3 py-2 text-sm font-medium text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-md transition"
                >
                  <LogOut className="h-4 w-4" />
                  <span className="ml-2 hidden sm:inline">Logout</span>
                </button>
              </div>
            </div>
          </div>
        </div>

        {/* Mobile Navigation */}
        <div className="md:hidden border-t">
          <div className="px-2 pt-2 pb-3 space-y-1">
            {navItems.map((item) => {
              const Icon = item.icon;
              const href = withLocale(item.path);
              const isActive =
                pathname === href || (item.path !== '/dashboard' && pathname?.startsWith(href));

              return (
                <Link
                  key={item.path}
                  href={href}
                  className={`block px-3 py-2 rounded-md text-base font-medium ${
                    isActive
                      ? 'text-blue-600 bg-blue-50'
                      : 'text-gray-600 hover:text-gray-900 hover:bg-gray-50'
                  }`}
                >
                  <Icon className="inline h-4 w-4 mr-2" />
                  {item.label}
                </Link>
              );
            })}
          </div>
        </div>
      </nav>

      {/* Page Content */}
      <main>{children}</main>
    </div>
  );
}
</file>

<file path="app/[locale]/page.tsx">
// app/[locale]/page.tsx
import HeroSection from '@/components/features/hero-section';
import GameCard from '@/components/features/game-card-working';
import { createClient } from '@supabase/supabase-js';

const supabase = createClient(
  process.env.NEXT_PUBLIC_SUPABASE_URL!,
  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
);

export default async function HomePage() {
  const { data: games, error } = await supabase
    .from('game_invitations')
    .select('*')
    .eq('status', 'open')
    .order('created_at', { ascending: false })
    .limit(6);

  if (process.env.NODE_ENV === 'development') {
    console.log('Games fetched:', games);
    console.log('Error:', error);
  }

  return (
    <main>
      <HeroSection />
      <section className="py-20 bg-gray-50">
        <div className="container mx-auto px-4">
          <div className="text-center mb-12">
            <h2 className="text-4xl font-bold mb-4">Recent Games</h2>
            <p className="text-xl text-gray-600">Join a game happening soon</p>
          </div>
          {games && games.length > 0 ? (
            <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
              {games.map((game, index) => (
                <GameCard key={game.id} game={game} index={index} />
              ))}
            </div>
          ) : (
            <div className="text-center py-10">
              <p className="text-gray-500">No games available at the moment.</p>
              <p className="text-sm text-gray-400 mt-2">Check back later or create your own game!</p>
            </div>
          )}
        </div>
      </section>
    </main>
  );
}
</file>

<file path="app/check-database/page.tsx">
'use client';

import { useEffect, useState } from 'react';
import { createClient } from '@supabase/supabase-js';

export default function CheckDatabase() {
  const [tables, setTables] = useState<any>({});
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const checkTables = async () => {
      const supabase = createClient(
        process.env.NEXT_PUBLIC_SUPABASE_URL!,
        process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
      );

      // Check each table
      const tablesToCheck = [
        'game_invitations',
        'game_interests', 
        'notifications',
        'rinks',
        'bookings',
        'profiles',
        'ratings',
        'messages'
      ];

      const results: any = {};

      for (const table of tablesToCheck) {
        try {
          const { data, error, count } = await supabase
            .from(table)
            .select('*', { count: 'exact', head: false })
            .limit(1);

          if (error) {
            results[table] = { 
              exists: false, 
              error: error.message 
            };
          } else {
            const { count: totalCount } = await supabase
              .from(table)
              .select('*', { count: 'exact', head: true });
              
            results[table] = { 
              exists: true, 
              count: totalCount || 0 
            };
          }
        } catch (err: any) {
          results[table] = { 
            exists: false, 
            error: err.message 
          };
        }
      }

      setTables(results);
      setLoading(false);
    };

    checkTables();
  }, []);

  if (loading) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <div className="text-xl">Checking database tables...</div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-cyan-50 p-8">
      <div className="max-w-4xl mx-auto">
        <div className="bg-white rounded-lg shadow-xl p-8">
          <h1 className="text-3xl font-bold mb-6 text-gray-800">
            Database Status Check
          </h1>
          
          <div className="space-y-2">
            {Object.entries(tables).map(([table, info]: [string, any]) => (
              <div 
                key={table} 
                className={`p-3 rounded-lg flex justify-between items-center ${
                  info.exists ? 'bg-green-50' : 'bg-red-50'
                }`}
              >
                <div className="flex items-center gap-3">
                  <span className="text-2xl">
                    {info.exists ? '‚úÖ' : '‚ùå'}
                  </span>
                  <span className="font-medium">{table}</span>
                </div>
                
                <div>
                  {info.exists ? (
                    <span className="text-green-700 font-semibold">
                      {info.count} records
                    </span>
                  ) : (
                    <span className="text-red-700 text-sm">
                      {info.error}
                    </span>
                  )}
                </div>
              </div>
            ))}
          </div>
          
          <div className="mt-8 p-4 bg-blue-50 rounded-lg">
            <h2 className="font-semibold mb-2">Summary:</h2>
            <p>‚úÖ Existing tables: {Object.values(tables).filter((t: any) => t.exists).length}</p>
            <p>‚ùå Missing tables: {Object.values(tables).filter((t: any) => !t.exists).length}</p>
            {tables.rinks?.exists && (
              <p className="mt-2 text-green-700 font-semibold">
                üèí Rinks table has {tables.rinks.count} ice rinks!
              </p>
            )}
          </div>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="app/providers/pwa-register.tsx">
'use client'

import { useEffect } from 'react'

export default function PWARegister() {
  useEffect(() => {
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
      })
    }
  }, [])
  
  return null
}
</file>

<file path="app/test-connection/page.tsx">
'use client';

import { useEffect, useState } from 'react';
import { createClient } from '@supabase/supabase-js';

export default function TestConnection() {
  const [status, setStatus] = useState<string>('Checking...');
  const [details, setDetails] = useState<any>({});

  useEffect(() => {
    // Test environment variables
    const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;
    const supabaseKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;
    
    if (!supabaseUrl || !supabaseKey) {
      setStatus('‚ùå Environment variables not configured');
      setDetails({
        url: supabaseUrl ? '‚úÖ Configured' : '‚ùå Not found',
        key: supabaseKey ? '‚úÖ Configured' : '‚ùå Not found',
      });
      return;
    }

    // Test connection
    const supabase = createClient(supabaseUrl, supabaseKey);
    
    // Simple connection test
    supabase
      .from('users')
      .select('count')
      .limit(1)
      .then(({ error }) => {
        if (error && error.message.includes('does not exist')) {
          setStatus('‚úÖ Supabase connected successfully!');
          setDetails({
            url: '‚úÖ ' + supabaseUrl,
            key: '‚úÖ Key loaded',
            connection: '‚úÖ Database accessible',
            note: 'Tables may not be created yet, but connection is working'
          });
        } else if (error) {
          setStatus('‚ö†Ô∏è Connection issue');
          setDetails({
            url: '‚úÖ ' + supabaseUrl,
            key: '‚úÖ Key loaded',
            error: error.message
          });
        } else {
          setStatus('‚úÖ Supabase connected successfully!');
          setDetails({
            url: '‚úÖ ' + supabaseUrl,
            key: '‚úÖ Key loaded',
            connection: '‚úÖ Database connection normal'
          });
        }
      });
  }, []);

  return (
    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-cyan-50 p-8">
      <div className="max-w-2xl mx-auto">
        <div className="bg-white rounded-lg shadow-xl p-8">
          <h1 className="text-3xl font-bold mb-6 text-gray-800">
            Supabase Connection Test
          </h1>
          
          <div className="mb-6">
            <div className="text-2xl font-semibold mb-4">{status}</div>
          </div>
          
          <div className="space-y-3">
            <h2 className="text-xl font-semibold text-gray-700">Details:</h2>
            {Object.entries(details).map(([key, value]) => (
              <div key={key} className="flex items-start">
                <span className="font-medium text-gray-600 min-w-[100px]">
                  {key}:
                </span>
                <span className="text-gray-800 ml-2">{String(value)}</span>
              </div>
            ))}
          </div>
          
          <div className="mt-8 p-4 bg-blue-50 rounded-lg">
            <p className="text-sm text-blue-800">
              Visit this page: http://localhost:3000/test-connection
            </p>
            <p className="text-sm text-blue-600 mt-2">
              If connection is successful, you can delete this test page.
            </p>
          </div>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="app/test-notifications/page.tsx">
'use client';
import { useEffect, useState } from 'react';
import { createClient } from '@/lib/supabase/client';

export default function TestPage() {
  const [data, setData] = useState<any[]>([]);
  
  useEffect(() => {
    async function test() {
      const supabase = createClient();
      const { data, error } = await supabase
        .from('notifications')
        .select('*');
      
      console.log('Test result:', { data, error });
      if (data) setData(data);
    }
    test();
  }, []);

  return (
    <div className="p-8">
      <h1>Test Notifications</h1>
      <pre>{JSON.stringify(data, null, 2)}</pre>
    </div>
  );
}
</file>

<file path="components/auth/AuthActions.tsx">
//components/auth/AuthActions.tsx
'use client';

import {useEffect, useMemo, useState} from 'react';
import Link from 'next/link';
import {usePathname, useRouter} from 'next/navigation';
import {createClient} from '@/lib/supabase/client';

function useLocale() {
  const pathname = usePathname();
  const seg = pathname?.split('/').filter(Boolean)[0] || 'en';
  return seg === 'fr' ? 'fr' : 'en';
}
const withLocale = (loc: string, p: string) => `/${loc}${p}`.replace('//', '/');

export default function AuthActions() {
  const supabase = useMemo(() => createClient(), []);
  const router = useRouter();
  const locale = useLocale();
  const [email, setEmail] = useState<string | null>(null);

  useEffect(() => {
    (async () => {
      const {data: {user}} = await supabase.auth.getUser();
      setEmail(user?.email ?? null);
    })();
  }, [supabase]);

  const signOut = async () => {
    await supabase.auth.signOut();
    setEmail(null);
    router.push(withLocale(locale, '/'));
  };

  if (!email) {
    return (
      <div className="flex items-center gap-3">
        <Link href={withLocale(locale, '/login')} className="text-sm hover:text-blue-600">
          Sign In
        </Link>
        <Link
          href={withLocale(locale, '/register')}
          className="rounded-md bg-gradient-to-r from-blue-600 to-cyan-500 px-3 py-1.5 text-sm font-medium text-white hover:from-blue-500 hover:to-cyan-500"
        >
          Get Started
        </Link>
      </div>
    );
  }

  return (
    <div className="flex items-center gap-3">
      <span className="text-sm text-gray-600">{email}</span>
      <button
        onClick={signOut}
        className="inline-flex items-center gap-1 rounded-md border px-3 py-1.5 text-sm text-gray-700 hover:bg-gray-50"
      >
        Logout
      </button>
    </div>
  );
}
</file>

<file path="components/features/game-card-working.tsx">
'use client';

import React from 'react';
import { Calendar, Clock, MapPin, Trophy, Users, Heart, Eye } from 'lucide-react';
import Link from 'next/link';

interface GameCardProps {
  game: {
    id: string;
    title: string;
    game_date: string;
    game_time: string;
    location: string;
    age_group: string;
    skill_level: string;
    description?: string;
    status: string;
    view_count: number;
    interested_count: number;
    max_players: number;
  };
  index?: number;
}

export default function GameCard({ game, index = 0 }: GameCardProps) {
  const spotsLeft = game.max_players - game.interested_count;
  const isFull = spotsLeft <= 0;
  
  // Format date
  const formatDate = (dateString: string) => {
    const date = new Date(dateString);
    return date.toLocaleDateString('en-CA', { 
      month: 'short', 
      day: 'numeric',
      year: 'numeric'
    });
  };
  
  // Format time
  const formatTime = (timeString: string) => {
    if (!timeString) return 'TBD';
    const [hours, minutes] = timeString.split(':');
    const hour = parseInt(hours);
    const ampm = hour >= 12 ? 'PM' : 'AM';
    const displayHour = hour > 12 ? hour - 12 : hour === 0 ? 12 : hour;
    return `${displayHour}:${minutes} ${ampm}`;
  };

  return (
    <div className="bg-white rounded-lg shadow-lg hover:shadow-xl transition-shadow duration-300 overflow-hidden h-full">
      {/* Top colored bar */}
      <div className="h-2 bg-gradient-to-r from-blue-500 to-cyan-500"></div>
      
      {/* Status badge */}
      <div className="relative">
        <div className="absolute top-2 right-2 z-10">
          <span className={`px-2 py-1 text-xs font-semibold rounded-full text-white ${
            game.status === 'open' ? 'bg-green-500' : 'bg-gray-500'
          }`}>
            {game.status}
          </span>
        </div>
      </div>
      
      <div className="p-6">
        {/* Title */}
        <h3 className="text-xl font-bold text-gray-900 mb-3 pr-20">
          {game.title}
        </h3>
        
        {/* Date and Time */}
        <div className="flex items-center gap-4 mb-3 text-sm text-gray-600">
          <div className="flex items-center gap-1">
            <Calendar className="w-4 h-4 text-blue-500" />
            <span>{formatDate(game.game_date)}</span>
          </div>
          <div className="flex items-center gap-1">
            <Clock className="w-4 h-4 text-blue-500" />
            <span>{formatTime(game.game_time)}</span>
          </div>
        </div>
        
        {/* Location */}
        <div className="flex items-center gap-2 mb-4">
          <MapPin className="w-4 h-4 text-blue-500" />
          <span className="text-sm font-medium">{game.location}</span>
        </div>
        
        {/* Age group and skill level */}
        <div className="flex gap-2 mb-4">
          <span className="px-3 py-1 text-xs font-medium bg-blue-50 text-blue-700 rounded-full inline-flex items-center">
            <Users className="w-3 h-3 mr-1" />
            {game.age_group}
          </span>
          <span className="px-3 py-1 text-xs font-medium bg-purple-50 text-purple-700 rounded-full inline-flex items-center">
            <Trophy className="w-3 h-3 mr-1" />
            {game.skill_level}
          </span>
        </div>
        
        {/* Players count */}
        <div className="mb-4">
          <div className="flex justify-between text-sm mb-1">
            <span className="text-gray-600">Players</span>
            <span className="font-medium">{game.interested_count}/{game.max_players}</span>
          </div>
          <div className="w-full h-2 bg-gray-200 rounded-full overflow-hidden">
            <div 
              className={`h-full ${isFull ? 'bg-red-500' : 'bg-gradient-to-r from-blue-500 to-cyan-500'}`}
              style={{ width: `${(game.interested_count / game.max_players) * 100}%` }}
            />
          </div>
          <p className="text-xs mt-1 font-medium">
            {isFull ? (
              <span className="text-red-600">Game Full</span>
            ) : (
              <span className="text-green-600">{spotsLeft} spots left</span>
            )}
          </p>
        </div>
        
        {/* Stats */}
        <div className="flex items-center gap-4 text-xs text-gray-500 mb-4">
          <div className="flex items-center gap-1">
            <Eye className="w-3.5 h-3.5" />
            <span>{game.view_count} views</span>
          </div>
          <div className="flex items-center gap-1">
            <Heart className="w-3.5 h-3.5" />
            <span>{game.interested_count} interested</span>
          </div>
        </div>
        
        {/* Action button */}
        <Link href={`/games/${game.id}`}>
          <button className="w-full py-2 px-4 bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700 text-white font-semibold rounded-md transition-all">
            {isFull ? 'View Details' : 'Join Game'}
          </button>
        </Link>
      </div>
    </div>
  );
}
</file>

<file path="components/features/game-card.tsx">
'use client';

import React from 'react';
import { motion } from 'framer-motion';
import { TypeAnimation } from 'react-type-animation';
import { ArrowRight, Calendar, MapPin, Users, PlayCircle, Star, Trophy, Clock } from 'lucide-react';
import { Button } from '@/components/ui/button';
import Link from 'next/link';

export default function HeroSection() {
  return (
    <section className="relative min-h-screen overflow-hidden bg-gradient-to-br from-slate-900 via-blue-900 to-cyan-900">
      {/* Animated background elements */}
      <div className="absolute inset-0">
        <div className="absolute inset-0 bg-[url('/grid.svg')] opacity-20"></div>
        
        {/* Floating hockey pucks animation */}
        <motion.div
          animate={{
            rotate: 360,
            x: [0, 100, 0],
            y: [0, -50, 0]
          }}
          transition={{ duration: 20, repeat: Infinity, ease: "linear" }}
          className="absolute top-20 right-20 w-32 h-32 opacity-10"
        >
          <div className="w-full h-full rounded-full bg-white"></div>
        </motion.div>
        
        <motion.div
          animate={{
            rotate: -360,
            x: [0, -100, 0],
            y: [0, 50, 0]
          }}
          transition={{ duration: 25, repeat: Infinity, ease: "linear" }}
          className="absolute bottom-20 left-20 w-40 h-40 opacity-10"
        >
          <div className="w-full h-full rounded-full bg-blue-400"></div>
        </motion.div>
      </div>

      {/* Main content */}
      <div className="relative z-10 flex items-center justify-center min-h-screen px-4">
        <motion.div
          initial={{ opacity: 0, y: 30 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.8 }}
          className="text-center max-w-5xl mx-auto"
        >
          {/* Logo or icon */}
          <motion.div
            initial={{ scale: 0 }}
            animate={{ scale: 1 }}
            transition={{ duration: 0.5, delay: 0.2 }}
            className="mb-8 inline-block"
          >
            <div className="w-24 h-24 mx-auto bg-gradient-to-br from-blue-400 to-cyan-400 rounded-2xl flex items-center justify-center shadow-2xl">
              <Trophy className="w-12 h-12 text-white" />
            </div>
          </motion.div>

          {/* Main heading with gradient */}
          <h1 className="text-5xl sm:text-6xl md:text-7xl lg:text-8xl font-black mb-6">
            <span className="bg-clip-text text-transparent bg-gradient-to-r from-blue-400 via-cyan-300 to-white">
              HockeyHub
            </span>
          </h1>

          {/* Animated subtitle */}
          <div className="text-xl sm:text-2xl md:text-3xl text-blue-200 mb-8 h-10">
            <TypeAnimation
              sequence={[
                'Find Your Next Game',
                2000,
                'Book Premium Ice Time',
                2000,
                'Connect with Local Players',
                2000,
                'Build Your Hockey Community',
                2000,
              ]}
              wrapper="span"
              speed={50}
              repeat={Infinity}
            />
          </div>

          {/* Description */}
          <motion.p
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            transition={{ delay: 0.5 }}
            className="text-lg md:text-xl text-gray-300 mb-10 max-w-2xl mx-auto"
          >
            Ottawa&apos;s premier platform for organizing hockey games and booking ice time. 
            Join thousands of players already on the ice!
          </motion.p>

          {/* CTA Buttons */}
          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.7 }}
            className="flex flex-col sm:flex-row gap-4 justify-center mb-12"
          >
            <Link href="/games">
              <Button 
                size="xl"
                className="group relative px-8 py-6 text-lg font-semibold overflow-hidden bg-gradient-to-r from-blue-600 to-cyan-500 hover:from-blue-700 hover:to-cyan-600"
              >
                <span className="relative flex items-center gap-2">
                  Find Games Now
                  <ArrowRight className="group-hover:translate-x-1 transition-transform" />
                </span>
              </Button>
            </Link>

            <Link href="/register">
              <Button
                variant="outline"
                size="xl"
                className="border-2 border-blue-400/50 text-blue-300 backdrop-blur-sm hover:bg-blue-400/10 px-8 py-6 text-lg"
              >
                <PlayCircle className="mr-2" />
                Get Started Free
              </Button>
            </Link>
          </motion.div>

          {/* Trust indicators */}
          <motion.div
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            transition={{ delay: 1 }}
            className="flex flex-wrap items-center justify-center gap-8 text-blue-300"
          >
            <div className="flex items-center gap-2">
              <Users className="w-5 h-5" />
              <span className="font-semibold">2,000+</span>
              <span>Active Players</span>
            </div>
            <div className="flex items-center gap-2">
              <MapPin className="w-5 h-5" />
              <span className="font-semibold">54</span>
              <span>Ice Rinks</span>
            </div>
            <div className="flex items-center gap-2">
              <Calendar className="w-5 h-5" />
              <span className="font-semibold">500+</span>
              <span>Games/Month</span>
            </div>
            <div className="flex items-center gap-2">
              <Star className="w-5 h-5 fill-yellow-400 text-yellow-400" />
              <span className="font-semibold">4.9</span>
              <span>Rating</span>
            </div>
          </motion.div>
        </motion.div>
      </div>

      {/* Bottom wave transition */}
      <div className="absolute bottom-0 w-full">
        <svg viewBox="0 0 1440 120" className="w-full h-20 fill-white">
          <path d="M0,64 C480,140 960,0 1440,64 L1440,120 L0,120 Z"></path>
        </svg>
      </div>
    </section>
  );
}
</file>

<file path="components/features/hero-section.tsx">
'use client';

import React from 'react';
import { motion } from 'framer-motion';
import { TypeAnimation } from 'react-type-animation';
import { ArrowRight, Calendar, MapPin, Users, PlayCircle, Star, Trophy, Clock } from 'lucide-react';
import { Button } from '@/components/ui/button';
import Link from 'next/link';

export default function HeroSection() {
  return (
    <section className="relative min-h-screen overflow-hidden bg-gradient-to-br from-slate-900 via-blue-900 to-cyan-900">
      {/* Animated background elements */}
      <div className="absolute inset-0">
        <div className="absolute inset-0 bg-[url('/grid.svg')] opacity-20"></div>
        
        {/* Floating hockey pucks animation */}
        <motion.div
          animate={{
            rotate: 360,
            x: [0, 100, 0],
            y: [0, -50, 0]
          }}
          transition={{ duration: 20, repeat: Infinity, ease: "linear" }}
          className="absolute top-20 right-20 w-32 h-32 opacity-10"
        >
          <div className="w-full h-full rounded-full bg-white"></div>
        </motion.div>
        
        <motion.div
          animate={{
            rotate: -360,
            x: [0, -100, 0],
            y: [0, 50, 0]
          }}
          transition={{ duration: 25, repeat: Infinity, ease: "linear" }}
          className="absolute bottom-20 left-20 w-40 h-40 opacity-10"
        >
          <div className="w-full h-full rounded-full bg-blue-400"></div>
        </motion.div>
      </div>

      {/* Main content */}
      <div className="relative z-10 flex items-center justify-center min-h-screen px-4">
        <motion.div
          initial={{ opacity: 0, y: 30 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.8 }}
          className="text-center max-w-5xl mx-auto"
        >
          {/* Logo or icon */}
          <motion.div
            initial={{ scale: 0 }}
            animate={{ scale: 1 }}
            transition={{ duration: 0.5, delay: 0.2 }}
            className="mb-8 inline-block"
          >
            <div className="w-24 h-24 mx-auto bg-gradient-to-br from-blue-400 to-cyan-400 rounded-2xl flex items-center justify-center shadow-2xl">
              <Trophy className="w-12 h-12 text-white" />
            </div>
          </motion.div>

          {/* Main heading with gradient */}
          <h1 className="text-5xl sm:text-6xl md:text-7xl lg:text-8xl font-black mb-6">
            <span className="bg-clip-text text-transparent bg-gradient-to-r from-blue-400 via-cyan-300 to-white">
              HockeyHub
            </span>
          </h1>

          {/* Animated subtitle */}
          <div className="text-xl sm:text-2xl md:text-3xl text-blue-200 mb-8 h-10">
            <TypeAnimation
              sequence={[
                'Find Your Next Game',
                2000,
                'Book Premium Ice Time',
                2000,
                'Connect with Local Players',
                2000,
                'Build Your Hockey Community',
                2000,
              ]}
              wrapper="span"
              speed={50}
              repeat={Infinity}
            />
          </div>

          {/* Description */}
          <motion.p
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            transition={{ delay: 0.5 }}
            className="text-lg md:text-xl text-gray-300 mb-10 max-w-2xl mx-auto"
          >
            Ottawa&apos;s premier platform for organizing hockey games and booking ice time. 
            Join thousands of players already on the ice!
          </motion.p>

          {/* CTA Buttons */}
          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.7 }}
            className="flex flex-col sm:flex-row gap-4 justify-center mb-12"
          >
            <Link href="/games">
              <Button 
                size="xl"
                className="group relative px-8 py-6 text-lg font-semibold overflow-hidden bg-gradient-to-r from-blue-600 to-cyan-500 hover:from-blue-700 hover:to-cyan-600"
              >
                <span className="relative flex items-center gap-2">
                  Find Games Now
                  <ArrowRight className="group-hover:translate-x-1 transition-transform" />
                </span>
              </Button>
            </Link>

            <Link href="/register">
              <Button
                variant="outline"
                size="xl"
                className="border-2 border-blue-400/50 text-blue-300 backdrop-blur-sm hover:bg-blue-400/10 px-8 py-6 text-lg"
              >
                <PlayCircle className="mr-2" />
                Get Started Free
              </Button>
            </Link>
          </motion.div>

          {/* Trust indicators */}
          <motion.div
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            transition={{ delay: 1 }}
            className="flex flex-wrap items-center justify-center gap-8 text-blue-300"
          >
            <div className="flex items-center gap-2">
              <Users className="w-5 h-5" />
              <span className="font-semibold">2,000+</span>
              <span>Active Players</span>
            </div>
            <div className="flex items-center gap-2">
              <MapPin className="w-5 h-5" />
              <span className="font-semibold">54</span>
              <span>Ice Rinks</span>
            </div>
            <div className="flex items-center gap-2">
              <Calendar className="w-5 h-5" />
              <span className="font-semibold">500+</span>
              <span>Games/Month</span>
            </div>
            <div className="flex items-center gap-2">
              <Star className="w-5 h-5 fill-yellow-400 text-yellow-400" />
              <span className="font-semibold">4.9</span>
              <span>Rating</span>
            </div>
          </motion.div>
        </motion.div>
      </div>

      {/* Bottom wave transition */}
      <div className="absolute bottom-0 w-full">
        <svg viewBox="0 0 1440 120" className="w-full h-20 fill-white">
          <path d="M0,64 C480,140 960,0 1440,64 L1440,120 L0,120 Z"></path>
        </svg>
      </div>
    </section>
  );
}
</file>

<file path="components/layout/footer.tsx">
// components/layout/footer.tsx
'use client';

import Link from 'next/link';

export default function Footer() {
  return (
    <footer className="border-t bg-white">
      <div className="container mx-auto px-4 py-6 flex flex-col md:flex-row gap-4 items-center justify-between text-sm text-gray-600">
        <div className="flex items-center gap-2">
          <span>¬© {new Date().getFullYear()} HockeyHub</span>
          <span className="hidden md:inline">¬∑</span>
          <Link href="https://vercel.com" className="hover:text-gray-900">Powered by Vercel</Link>
        </div>

        <nav className="flex items-center gap-4">
          <Link href="#" className="hover:text-gray-900">Privacy</Link>
          <Link href="#" className="hover:text-gray-900">Terms</Link>
          <Link href="#" className="hover:text-gray-900">Contact</Link>
        </nav>
      </div>
    </footer>
  );
}
</file>

<file path="components/notifications/notification-bell.tsx">
// components/notifications/notification-bell.tsx
'use client';

import { useEffect, useState } from 'react';
import { createClient } from '@/lib/supabase/client';
import { Bell } from 'lucide-react';
import Link from 'next/link';

export default function NotificationBell() {
  const [unreadCount, setUnreadCount] = useState(0);
  const supabase = createClient();

  useEffect(() => {
    loadUnreadCount();
    
    // Subscribe to real-time notification changes
    const subscribeToNotifications = async () => {
      const { data: userData } = await supabase.auth.getUser();
      if (!userData.user) return;

      const channel = supabase
        .channel('notification-count')
        .on(
          'postgres_changes',
          {
            event: '*',
            schema: 'public',
            table: 'notifications',
            filter: `user_id=eq.${userData.user.id}`
          },
          () => {
            // Reload count when any notification changes
            loadUnreadCount();
          }
        )
        .subscribe();

      return () => {
        supabase.removeChannel(channel);
      };
    };

    subscribeToNotifications();
  }, []);

  async function loadUnreadCount() {
    try {
      const { data: userData } = await supabase.auth.getUser();
      if (!userData.user) return;

      const { data, count, error } = await supabase
        .from('notifications')
        .select('id', { count: 'exact' })
        .eq('user_id', userData.user.id)
        .eq('is_read', false);

      if (error) throw error;
      setUnreadCount(count || 0);
    } catch (error) {
      console.error('Error loading notification count:', error);
    }
  }

  return (
    <Link 
      href="/notifications" 
      className="relative p-2 hover:bg-gray-100 rounded-lg transition-colors"
      title="View notifications"
    >
      <Bell className="h-6 w-6 text-gray-700" />
      {unreadCount > 0 && (
        <span className="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center font-semibold animate-pulse">
          {unreadCount > 9 ? '9+' : unreadCount}
        </span>
      )}
    </Link>
  );
}
</file>

<file path="components/ui/button.tsx">
import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { cva, type VariantProps } from "class-variance-authority"
import { cn } from "@/lib/utils"

const buttonVariants = cva(
  "inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",
  {
    variants: {
      variant: {
        default: "bg-primary text-primary-foreground hover:bg-primary/90 shadow-md hover:shadow-lg hover:-translate-y-0.5 transition-all",
        destructive: "bg-destructive text-destructive-foreground hover:bg-destructive/90 shadow-md",
        outline: "border border-input bg-background hover:bg-accent hover:text-accent-foreground",
        secondary: "bg-secondary text-secondary-foreground hover:bg-secondary/80",
        ghost: "hover:bg-accent hover:text-accent-foreground",
        link: "text-primary underline-offset-4 hover:underline",
        gradient: "bg-gradient-to-r from-blue-600 to-cyan-500 text-white hover:from-blue-700 hover:to-cyan-600 shadow-md hover:shadow-lg hover:-translate-y-0.5 transition-all",
        hockey: "bg-gradient-to-r from-blue-600 to-cyan-500 text-white hover:from-blue-700 hover:to-cyan-600 shadow-lg hover:shadow-xl hover:-translate-y-1 transition-all duration-300",
        glow: "bg-primary text-primary-foreground shadow-[0_0_20px_rgba(59,130,246,0.5)] hover:shadow-[0_0_30px_rgba(59,130,246,0.8)] transition-all",
      },
      size: {
        default: "h-10 px-4 py-2",
        sm: "h-9 rounded-md px-3",
        lg: "h-11 rounded-md px-8",
        xl: "h-14 rounded-lg px-10 text-base",
        icon: "h-10 w-10",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
)

export interface ButtonProps
  extends React.ButtonHTMLAttributes<HTMLButtonElement>,
    VariantProps<typeof buttonVariants> {
  asChild?: boolean
}

const Button = React.forwardRef<HTMLButtonElement, ButtonProps>(
  ({ className, variant, size, asChild = false, ...props }, ref) => {
    const Comp = asChild ? Slot : "button"
    return (
      <Comp
        className={cn(buttonVariants({ variant, size, className }))}
        ref={ref}
        {...props}
      />
    )
  }
)
Button.displayName = "Button"

export { Button, buttonVariants }
</file>

<file path="components/ui/card.tsx">
import * as React from "react"
import { cva, type VariantProps } from "class-variance-authority"
import { cn } from "@/lib/utils"

const badgeVariants = cva(
  "inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",
  {
    variants: {
      variant: {
        default:
          "border-transparent bg-primary text-primary-foreground hover:bg-primary/80",
        secondary:
          "border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",
        destructive:
          "border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",
        outline: "text-foreground",
        success:
          "border-transparent bg-green-100 text-green-800 hover:bg-green-200",
        warning:
          "border-transparent bg-yellow-100 text-yellow-800 hover:bg-yellow-200",
        info:
          "border-transparent bg-blue-100 text-blue-800 hover:bg-blue-200",
        hockey:
          "border-transparent bg-gradient-to-r from-blue-600 to-cyan-500 text-white",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
)

export interface BadgeProps
  extends React.HTMLAttributes<HTMLDivElement>,
    VariantProps<typeof badgeVariants> {}

function Badge({ className, variant, ...props }: BadgeProps) {
  return (
    <div className={cn(badgeVariants({ variant }), className)} {...props} />
  )
}

export { Badge, badgeVariants }
</file>

<file path="components/ui/input.tsx">
import * as React from "react"
import { cn } from "@/lib/utils"

export interface InputProps
  extends React.InputHTMLAttributes<HTMLInputElement> {}

const Input = React.forwardRef<HTMLInputElement, InputProps>(
  ({ className, type, ...props }, ref) => {
    return (
      <input
        type={type}
        className={cn(
          "flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 transition-all duration-200",
          className
        )}
        ref={ref}
        {...props}
      />
    )
  }
)
Input.displayName = "Input"

export { Input }
</file>

<file path="Copy-Pages.ps1">
# Copy all page.tsx files from (dashboard) and (auth) to app\[locale]\...
# Run this script from the project root directory

Write-Host "=== Starting Page Migration ===" -ForegroundColor Cyan
Write-Host ""

$srcRoots = @('app\(dashboard)', 'app\(auth)')
$copiedCount = 0
$skippedCount = 0
$errors = @()

foreach ($srcRoot in $srcRoots) {
  if (-not (Test-Path $srcRoot)) {
    Write-Host "Warning: Source not found: $srcRoot" -ForegroundColor Yellow
    continue
  }

  Write-Host "Processing: $srcRoot" -ForegroundColor Green
  
  $pages = Get-ChildItem -LiteralPath $srcRoot -Recurse -Filter 'page.tsx'
  
  foreach ($page in $pages) {
    try {
      # Get relative path from source root
      $rel = $page.FullName.Substring((Resolve-Path $srcRoot).Path.Length)
      
      # Build destination path
      $groupName = Split-Path $srcRoot -Leaf
      $destDir = Join-Path "app\[locale]\$groupName" (Split-Path $rel -Parent)
      $destFile = Join-Path $destDir 'page.tsx'
      
      # Create destination directory
      if (-not (Test-Path $destDir)) {
        New-Item -ItemType Directory -Force -Path $destDir | Out-Null
      }
      
      # Check if file exists
      if (Test-Path $destFile) {
        Write-Host "  Already exists: $destFile" -ForegroundColor Gray
        $skippedCount++
      } else {
        # Copy file
        Copy-Item -LiteralPath $page.FullName -Destination $destFile -Force
        Write-Host "  Copied: $($page.FullName) -> $destFile" -ForegroundColor Green
        $copiedCount++
      }
    }
    catch {
      $errors += "Error copying $($page.FullName): $_"
      Write-Host "  Error: $($page.FullName)" -ForegroundColor Red
    }
  }
  
  Write-Host ""
}

# Summary
Write-Host "=== Migration Summary ===" -ForegroundColor Cyan
Write-Host ""

$dashboardSource = if (Test-Path 'app\(dashboard)') { 
  (Get-ChildItem -LiteralPath 'app\(dashboard)' -Recurse -Filter 'page.tsx').Count 
} else { 0 }

$dashboardDest = if (Test-Path 'app\[locale]\(dashboard)') { 
  (Get-ChildItem -LiteralPath 'app\[locale]\(dashboard)' -Recurse -Filter 'page.tsx').Count 
} else { 0 }

$authSource = if (Test-Path 'app\(auth)') { 
  (Get-ChildItem -LiteralPath 'app\(auth)' -Recurse -Filter 'page.tsx').Count 
} else { 0 }

$authDest = if (Test-Path 'app\[locale]\(auth)') { 
  (Get-ChildItem -LiteralPath 'app\[locale]\(auth)' -Recurse -Filter 'page.tsx').Count 
} else { 0 }

Write-Host "Source Files:"
Write-Host "  Dashboard pages: $dashboardSource"
Write-Host "  Auth pages: $authSource"
Write-Host "  Total: $($dashboardSource + $authSource)"
Write-Host ""

Write-Host "Destination Files:"
Write-Host "  Dashboard pages in [locale]: $dashboardDest"
Write-Host "  Auth pages in [locale]: $authDest"
Write-Host "  Total: $($dashboardDest + $authDest)"
Write-Host ""

Write-Host "Operation Results:"
Write-Host "  Copied: $copiedCount" -ForegroundColor Green
Write-Host "  Skipped (already exists): $skippedCount" -ForegroundColor Gray

if ($dashboardDest -eq $dashboardSource -and $authDest -eq $authSource) {
  Write-Host ""
  Write-Host "SUCCESS! All files copied." -ForegroundColor Green
} else {
  Write-Host ""
  Write-Host "Warning: File counts don't match. Please check." -ForegroundColor Yellow
}

Write-Host ""
</file>

<file path="lib/utils.ts">
import { type ClassValue, clsx } from "clsx"
import { twMerge } from "tailwind-merge"

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs))
}

export function formatDate(date: string | Date) {
  const d = new Date(date)
  return d.toLocaleDateString('en-CA', {
    year: 'numeric',
    month: 'short',
    day: 'numeric'
  })
}

export function formatTime(time: string) {
  const [hours, minutes] = time.split(':')
  const hour = parseInt(hours)
  const ampm = hour >= 12 ? 'PM' : 'AM'
  const displayHour = hour > 12 ? hour - 12 : hour === 0 ? 12 : hour
  return `${displayHour}:${minutes} ${ampm}`
}

export function formatCurrency(amount: number) {
  return new Intl.NumberFormat('en-CA', {
    style: 'currency',
    currency: 'CAD'
  }).format(amount)
}
</file>

<file path="lib/utils/format.ts">
/**
 * Formatting helpers for currency and date.
 * Keep them pure and SSR-safe.
 */

export function formatCurrency(
  value: number | string | null | undefined,
  currency = 'CAD'
) {
  const num =
    typeof value === 'number'
      ? value
      : typeof value === 'string'
      ? Number.parseFloat(value)
      : 0
  return new Intl.NumberFormat('en-CA', { style: 'currency', currency }).format(num)
}

export function formatDate(input: string | Date) {
  const d = typeof input === 'string' ? new Date(input) : input
  if (Number.isNaN(d.getTime())) return String(input)
  return d.toLocaleDateString('en-CA', {
    year: 'numeric',
    month: 'short',
    day: 'numeric',
  })
}
</file>

<file path="middleware.ts">
// middleware.ts
import createMiddleware from 'next-intl/middleware';

export default createMiddleware({
  locales: ['en', 'fr'],
  defaultLocale: 'en',
  localePrefix: 'always' // Á°Æ‰øùÊÄªÊòØÊúâ locale ÂâçÁºÄ
});

export const config = {
  matcher: ['/((?!api|_next|_vercel|.*\\..*).*)']
};
</file>

<file path="postcss.config.js">
module.exports = {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}
</file>

<file path="public/create-icons.html">
<!DOCTYPE html>
<html>
<head>
  <style>
    canvas { border: 1px solid #ccc; margin: 10px; }
  </style>
</head>
<body>
  <canvas id="c192" width="192" height="192"></canvas>
  <canvas id="c512" width="512" height="512"></canvas>
  <p>Right click each canvas ‚Üí Save image as ‚Üí icon-192.png and icon-512.png</p>
  
  <script>
    function draw(id, size) {
      const c = document.getElementById(id);
      const ctx = c.getContext('2d');
      // Blue background
      ctx.fillStyle = '#2563eb';
      ctx.fillRect(0, 0, size, size);
      // White text
      ctx.fillStyle = 'white';
      ctx.font = `bold ${size/2}px Arial`;
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillText('HH', size/2, size/2);
    }
    draw('c192', 192);
    draw('c512', 512);
  </script>
</body>
</html>
</file>

<file path="public/grid.svg">
<svg width="100" height="100" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <pattern id="grid" width="100" height="100" patternUnits="userSpaceOnUse">
      <path d="M 100 0 L 0 0 0 100" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="1"/>
    </pattern>
  </defs>
  <rect width="100%" height="100%" fill="url(#grid)" />
</svg>
</file>

<file path="public/manifest.json">
{
  "name": "HockeyHub - Ottawa Youth Hockey",
  "short_name": "HockeyHub",
  "description": "Connect Ottawa's youth hockey community",
  "theme_color": "#2563eb",
  "background_color": "#ffffff",
  "display": "standalone",
  "orientation": "portrait",
  "scope": "/",
  "start_url": "/",
  "icons": [
    {
      "src": "/icon-192.png",
      "sizes": "192x192",
      "type": "image/png"
    },
    {
      "src": "/icon-512.png",
      "sizes": "512x512",
      "type": "image/png"
    }
  ]
}
</file>

<file path="public/sw.js">
const CACHE_NAME = 'hockeyhub-v1';
const urlsToCache = [
  '/',
  '/games',
  '/rinks',
  '/clubs'
];

self.addEventListener('install', event => {
  event.waitUntil(
    caches.open(CACHE_NAME)
      .then(cache => cache.addAll(urlsToCache))
  );
});

self.addEventListener('fetch', event => {
  event.respondWith(
    caches.match(event.request)
      .then(response => response || fetch(event.request))
  );
});
</file>

<file path="tailwind.config.js">
import type { Config } from "tailwindcss"

const config = {
  darkMode: ["class"],
  content: [
    './pages/**/*.{ts,tsx}',
    './components/**/*.{ts,tsx}',
    './app/**/*.{ts,tsx}',
    './src/**/*.{ts,tsx}',
  ],
  prefix: "",
  theme: {
    container: {
      center: true,
      padding: "2rem",
      screens: {
        "2xl": "1400px",
      },
    },
    extend: {
      colors: {
        border: "hsl(var(--border))",
        input: "hsl(var(--input))",
        ring: "hsl(var(--ring))",
        background: "hsl(var(--background))",
        foreground: "hsl(var(--foreground))",
        primary: {
          DEFAULT: "hsl(var(--primary))",
          foreground: "hsl(var(--primary-foreground))",
          50: '#eff6ff',
          100: '#dbeafe',
          200: '#bfdbfe',
          300: '#93c5fd',
          400: '#60a5fa',
          500: '#3b82f6',
          600: '#2563eb',
          700: '#1d4ed8',
          800: '#1e40af',
          900: '#1e3a8a',
          950: '#172554',
        },
        secondary: {
          DEFAULT: "hsl(var(--secondary))",
          foreground: "hsl(var(--secondary-foreground))",
        },
        destructive: {
          DEFAULT: "hsl(var(--destructive))",
          foreground: "hsl(var(--destructive-foreground))",
        },
        muted: {
          DEFAULT: "hsl(var(--muted))",
          foreground: "hsl(var(--muted-foreground))",
        },
        accent: {
          DEFAULT: "hsl(var(--accent))",
          foreground: "hsl(var(--accent-foreground))",
        },
        popover: {
          DEFAULT: "hsl(var(--popover))",
          foreground: "hsl(var(--popover-foreground))",
        },
        card: {
          DEFAULT: "hsl(var(--card))",
          foreground: "hsl(var(--card-foreground))",
        },
        hockey: {
          ice: '#e0f2fe',
          rink: '#0c4a6e',
          puck: '#020617',
          goal: '#dc2626',
        }
      },
      borderRadius: {
        lg: "var(--radius)",
        md: "calc(var(--radius) - 2px)",
        sm: "calc(var(--radius) - 4px)",
      },
      keyframes: {
        "accordion-down": {
          from: { height: "0" },
          to: { height: "var(--radix-accordion-content-height)" },
        },
        "accordion-up": {
          from: { height: "var(--radix-accordion-content-height)" },
          to: { height: "0" },
        },
        "slide-in": {
          from: { transform: "translateX(-100%)" },
          to: { transform: "translateX(0)" },
        },
        "fade-in": {
          from: { opacity: "0" },
          to: { opacity: "1" },
        },
        "fade-up": {
          from: { 
            opacity: "0",
            transform: "translateY(10px)"
          },
          to: { 
            opacity: "1",
            transform: "translateY(0)"
          },
        },
        "float": {
          "0%, 100%": { transform: "translateY(0)" },
          "50%": { transform: "translateY(-10px)" },
        },
        "pulse-glow": {
          "0%, 100%": { 
            boxShadow: "0 0 20px rgba(59, 130, 246, 0.5)"
          },
          "50%": { 
            boxShadow: "0 0 40px rgba(59, 130, 246, 0.8)"
          },
        },
        "shimmer": {
          from: {
            backgroundPosition: "0 0"
          },
          to: {
            backgroundPosition: "-200% 0"
          }
        },
        "bounce-slow": {
          "0%, 100%": {
            transform: "translateY(-5%)",
            animationTimingFunction: "cubic-bezier(0.8, 0, 1, 1)",
          },
          "50%": {
            transform: "translateY(0)",
            animationTimingFunction: "cubic-bezier(0, 0, 0.2, 1)",
          },
        },
      },
      animation: {
        "accordion-down": "accordion-down 0.2s ease-out",
        "accordion-up": "accordion-up 0.2s ease-out",
        "slide-in": "slide-in 0.3s ease-out",
        "fade-in": "fade-in 0.5s ease-out",
        "fade-up": "fade-up 0.5s ease-out",
        "float": "float 3s ease-in-out infinite",
        "pulse-glow": "pulse-glow 2s ease-in-out infinite",
        "shimmer": "shimmer 2s linear infinite",
        "bounce-slow": "bounce-slow 2s infinite",
      },
      backgroundImage: {
        'gradient-radial': 'radial-gradient(var(--tw-gradient-stops))',
        'gradient-conic': 'conic-gradient(from 180deg at 50% 50%, var(--tw-gradient-stops))',
        'gradient-hockey': 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
        'gradient-ice': 'linear-gradient(135deg, #e0f2fe 0%, #7dd3fc 50%, #0284c7 100%)',
        'shimmer': 'linear-gradient(105deg, transparent 40%, rgba(255, 255, 255, 0.7) 50%, transparent 60%)',
      },
      fontSize: {
        '2xs': ['0.625rem', { lineHeight: '0.75rem' }],
      },
      boxShadow: {
        'glow': '0 0 20px rgba(59, 130, 246, 0.5)',
        'glow-lg': '0 0 40px rgba(59, 130, 246, 0.8)',
        'inner-glow': 'inset 0 0 20px rgba(59, 130, 246, 0.3)',
      },
      backdropBlur: {
        xs: '2px',
      },
    },
  },
  plugins: [
    require("tailwindcss-animate"),
    require("@tailwindcss/forms"),
    require("@tailwindcss/typography"),
    require("@tailwindcss/aspect-ratio"),
    require("@tailwindcss/container-queries"),
  ],
} satisfies Config

export default config
</file>

<file path="tsconfig.json">
{
  "compilerOptions": {
    "moduleResolution": "Bundler",
    "resolveJsonModule": true,
    "target": "ES2017",
    "lib": [
      "dom",
      "dom.iterable",
      "esnext"
    ],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": false,
    "noEmit": true,
    "incremental": true,
    "module": "esnext",
    "esModuleInterop": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "baseUrl": ".",
    "paths": {
      "@/*": ["./*"]
    },
    "plugins": [
      {
        "name": "next"
      }
    ]
  },
  "include": [
    "next-env.d.ts",
    "**/*.ts",
    "**/*.tsx",
    ".next/types/**/*.ts",
    "i18n.ts"
  ],
  "exclude": [
    "node_modules"
  ]
}
</file>

<file path="app/(dashboard)/book/[rinkId]/page.tsx">
'use client'

import { useState, useEffect } from 'react'
import { createClient } from '@/lib/supabase/client'
import { useRouter, useParams } from 'next/navigation'

export default function BookRinkPage() {
  const router = useRouter()
  const params = useParams()
  const rinkId = params.rinkId as string
  
  const [rink, setRink] = useState<any>(null)
  const [loading, setLoading] = useState(true)
  const [submitting, setSubmitting] = useState(false)
  
  // Form fields
  const [bookingDate, setBookingDate] = useState('')
  const [startTime, setStartTime] = useState('')
  const [hours, setHours] = useState(1)

  useEffect(() => {
    fetchRink()
  }, [rinkId])

  const fetchRink = async () => {
    const supabase = createClient()
    const { data, error } = await supabase
      .from('rinks')
      .select('*')
      .eq('id', rinkId)
      .single()
    
    if (data) {
      setRink(data)
    } else if (error) {
      console.error('Error fetching rink:', error)
    }
    setLoading(false)
  }

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()
    setSubmitting(true)
    
    const supabase = createClient()
    const { data: { user } } = await supabase.auth.getUser()
    
    if (!user) {
      router.push('/login')
      return
    }

    const hourlyRate = rink?.hourly_rate || 150
    const subtotal = hourlyRate * hours
    const platformFee = subtotal * 0.08
    const total = subtotal + platformFee
    const endHour = parseInt(startTime.split(':')[0]) + hours

    const { error } = await supabase
      .from('bookings')
      .insert({
        user_id: user.id,
        rink_id: rinkId,
        booking_date: bookingDate,
        start_time: startTime,
        end_time: `${endHour}:00`,
        hours: hours,
        subtotal: subtotal,
        platform_fee: platformFee.toFixed(2),
        total: total.toFixed(2),
        status: 'pending'
      })

    if (!error) {
        alert('Booking created successfully! Redirecting to your bookings...')
        router.push('/bookings')
    } else {
        console.error('Booking error:', error)
        alert('Failed to create booking. Please try again.')
    }
    setSubmitting(false)
    }

  if (loading) {
    return (
      <div className="flex items-center justify-center min-h-screen">
        <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
      </div>
    )
  }

  if (!rink) {
    return (
      <div className="container mx-auto p-8">
        <p>Rink not found</p>
      </div>
    )
  }

  const hourlyRate = rink.hourly_rate || 150
  const subtotal = hourlyRate * hours
  const platformFee = subtotal * 0.08
  const total = subtotal + platformFee

  // Get today's date for min attribute
  const today = new Date().toISOString().split('T')[0]

  return (
    <div className="container mx-auto p-8 max-w-2xl">
      <h1 className="text-3xl font-bold mb-6">Book {rink.name}</h1>
      
      <div className="bg-white rounded-lg shadow p-6 mb-6">
        <h2 className="text-xl font-semibold mb-4">Rink Details</h2>
        <p className="text-gray-600">{rink.address}</p>
        {rink.phone && <p className="text-gray-600">{rink.phone}</p>}
        <p className="text-lg font-medium mt-2">${hourlyRate}/hour</p>
      </div>

      <form onSubmit={handleSubmit} className="bg-white rounded-lg shadow p-6">
        <h2 className="text-xl font-semibold mb-4">Booking Information</h2>
        
        <div className="space-y-4">
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-1">
              Date
            </label>
            <input
              type="date"
              required
              min={today}
              value={bookingDate}
              onChange={(e) => setBookingDate(e.target.value)}
              className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500"
            />
          </div>

          <div>
            <label className="block text-sm font-medium text-gray-700 mb-1">
              Start Time
            </label>
            <select
              required
              value={startTime}
              onChange={(e) => setStartTime(e.target.value)}
              className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500"
            >
              <option value="">Select time</option>
              {[6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21].map(hour => (
                <option key={hour} value={`${hour}:00`}>
                  {hour}:00
                </option>
              ))}
            </select>
          </div>

          <div>
            <label className="block text-sm font-medium text-gray-700 mb-1">
              Duration (hours)
            </label>
            <select
              value={hours}
              onChange={(e) => setHours(parseInt(e.target.value))}
              className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500"
            >
              {[1,2,3,4].map(h => (
                <option key={h} value={h}>{h} hour{h > 1 ? 's' : ''}</option>
              ))}
            </select>
          </div>

          <div className="pt-4 border-t">
            <h3 className="font-medium mb-2">Price Summary</h3>
            <div className="space-y-1 text-sm">
              <div className="flex justify-between">
                <span>Ice Time ({hours} hours √ó ${hourlyRate})</span>
                <span>${subtotal.toFixed(2)}</span>
              </div>
              <div className="flex justify-between">
                <span>Platform Fee (8%)</span>
                <span>${platformFee.toFixed(2)}</span>
              </div>
              <div className="flex justify-between font-bold text-lg pt-2 border-t">
                <span>Total</span>
                <span>${total.toFixed(2)}</span>
              </div>
            </div>
          </div>

          <button
            type="submit"
            disabled={submitting}
            className="w-full py-2 px-4 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-md disabled:opacity-50 disabled:cursor-not-allowed"
          >
            {submitting ? 'Creating Booking...' : 'Confirm Booking'}
          </button>
        </div>
      </form>
    </div>
  )
}
</file>

<file path="app/(dashboard)/bookings/[id]/page.tsx">
'use client';

import {useCallback, useEffect, useMemo, useState} from 'react';
import {createClient} from '@/lib/supabase/client';
import {usePathname, useParams, useRouter} from 'next/navigation';
import {formatCurrency, formatDate} from '@/lib/utils/format';

/**
 * Booking detail page
 * - Derive locale from pathname and localize internal links.
 * - Require auth: redirect unauthenticated users to /{locale}/login.
 * - Read booking id via useParams(), wrap loader with useCallback.
 */
export default function BookingDetailPage() {
  const [booking, setBooking] = useState<any>(null);
  const [loading, setLoading] = useState(true);

  const router = useRouter();
  const pathname = usePathname();
  const {id: bookingId} = useParams<{id: string}>();

  // Derive locale from the first path segment: /{locale}/...
  const locale = useMemo(() => (pathname?.split('/')?.[1] || '').trim(), [pathname]);

  // Helper to build a locale-prefixed path
  const withLocale = (p: string) => `/${locale || ''}${p}`.replace('//', '/');

  const fetchBookingDetail = useCallback(async () => {
    if (!bookingId) return;
    const supabase = createClient();

    // Auth check: redirect to localized login when no user
    const {
      data: {user},
    } = await supabase.auth.getUser();
    if (!user) {
      router.push(withLocale('/login'));
      setLoading(false);
      return;
    }

    const {data, error} = await supabase
      .from('bookings')
      .select(
        `
        *,
        rinks (name, address, phone, hourly_rate)
      `
      )
      .eq('id', bookingId)
      .single();

    if (error) {
      console.error('Error fetching booking:', error);
      router.push(withLocale('/bookings'));
    } else {
      setBooking(data);
    }
    setLoading(false);
  }, [bookingId, router, locale]); // locale affects redirect target

  useEffect(() => {
    fetchBookingDetail();
  }, [fetchBookingDetail]);

  const handleCancel = async () => {
    if (!bookingId) return;
    if (!confirm('Are you sure you want to cancel this booking?')) return;
    const supabase = createClient();
    const {error} = await supabase
      .from('bookings')
      .update({status: 'cancelled'})
      .eq('id', bookingId);

    if (error) {
      console.error('Cancel failed:', error);
      return;
    }
    alert('Booking cancelled successfully');
    router.push(withLocale('/bookings'));
  };

  if (loading) {
    return (
      <div className="flex items-center justify-center min-h-screen">
        <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
      </div>
    );
  }

  if (!booking) {
    return (
      <div className="container mx-auto p-8">
        <p>Booking not found</p>
      </div>
    );
  }

  const statusColors: Record<string, string> = {
    confirmed: 'bg-green-100 text-green-800',
    pending: 'bg-yellow-100 text-yellow-800',
    cancelled: 'bg-red-100 text-red-800',
    completed: 'bg-gray-100 text-gray-800',
  };
  const statusColor = statusColors[booking.status] || 'bg-gray-100 text-gray-800';

  return (
    <div className="container mx-auto p-8">
      <div className="mb-6">
        <button
          onClick={() => router.push(withLocale('/bookings'))}
          className="text-gray-600 hover:text-gray-800"
        >
          ‚Üê Back to My Bookings
        </button>
      </div>

      <div className="bg-white rounded-lg shadow-lg p-8">
        <div className="flex justify-between items-start mb-6">
          <div>
            <h1 className="text-3xl font-bold mb-2">{booking.rinks?.name}</h1>
            <span className={`px-3 py-1 rounded text-sm ${statusColor}`}>{booking.status}</span>
          </div>
          <div className="text-right">
            <p className="text-3xl font-bold text-blue-600">{formatCurrency(booking.total)}</p>
            <p className="text-sm text-gray-600">Total Amount</p>
          </div>
        </div>

        <div className="grid md:grid-cols-2 gap-8">
          <div>
            <h2 className="text-xl font-semibold mb-4">Booking Details</h2>
            <div className="space-y-3">
              <div>
                <p className="text-sm text-gray-600">Booking ID</p>
                <p className="font-medium">{booking.id}</p>
              </div>
              <div>
                <p className="text-sm text-gray-600">Date</p>
                <p className="font-medium">{formatDate(booking.booking_date)}</p>
              </div>
              <div>
                <p className="text-sm text-gray-600">Time</p>
                <p className="font-medium">
                  {booking.start_time} - {booking.end_time}
                </p>
              </div>
              <div>
                <p className="text-sm text-gray-600">Duration</p>
                <p className="font-medium">{booking.hours} hours</p>
              </div>
            </div>
          </div>

          <div>
            <h2 className="text-xl font-semibold mb-4">Rink Information</h2>
            <div className="space-y-3">
              <div>
                <p className="text-sm text-gray-600">Location</p>
                <p className="font-medium">{booking.rinks?.address}</p>
              </div>
              {booking.rinks?.phone && (
                <div>
                  <p className="text-sm text-gray-600">Phone</p>
                  <p className="font-medium">{booking.rinks.phone}</p>
                </div>
              )}
              <div>
                <p className="text-sm text-gray-600">Hourly Rate</p>
                <p className="font-medium">{formatCurrency(booking.rinks?.hourly_rate)}</p>
              </div>
            </div>
          </div>
        </div>

        <div className="mt-8 pt-8 border-t">
          <h2 className="text-xl font-semibold mb-4">Price Breakdown</h2>
          <div className="space-y-2">
            <div className="flex justify-between">
              <span>
                Ice Time ({booking.hours} hours √ó {formatCurrency(booking.rinks?.hourly_rate)})
              </span>
              <span>{formatCurrency(booking.subtotal)}</span>
            </div>
            <div className="flex justify-between">
              <span>Platform Fee (8%)</span>
              <span>{formatCurrency(booking.platform_fee)}</span>
            </div>
            <div className="flex justify-between font-bold text-lg pt-2 border-t">
              <span>Total</span>
              <span>{formatCurrency(booking.total)}</span>
            </div>
          </div>
        </div>

        {booking.status !== 'cancelled' && booking.status !== 'completed' && (
          <div className="mt-8 flex gap-4">
            <button
              onClick={handleCancel}
              className="px-6 py-2 border border-red-300 text-red-600 rounded hover:bg-red-50"
            >
              Cancel Booking
            </button>
          </div>
        )}
      </div>
    </div>
  );
}
</file>

<file path="app/(dashboard)/dashboard/page.tsx">
'use client'

import { useCallback, useEffect, useState } from 'react'
import { createClient } from '@/lib/supabase/client'

/**
 * Dashboard summary metrics
 * - Wrap data loader with useCallback to satisfy exhaustive-deps rule.
 */
export default function DashboardPage() {
  const [loading, setLoading] = useState(true)
  const [metrics, setMetrics] = useState({
    gamesOpen: 0,
    bookingsUpcoming: 0,
    rinksTotal: 0,
  })

  const loadDashboard = useCallback(async () => {
    const supabase = createClient()

    const { count: gamesOpen } = await supabase
      .from('game_invitations')
      .select('*', { count: 'exact', head: true })
      .eq('status', 'open')

    const today = new Date()
    today.setHours(0, 0, 0, 0)

    const { count: bookingsUpcoming } = await supabase
      .from('bookings')
      .select('*', { count: 'exact', head: true })
      .gte('booking_date', today.toISOString().slice(0, 10))

    const { count: rinksTotal } = await supabase
      .from('rinks')
      .select('*', { count: 'exact', head: true })

    setMetrics({
      gamesOpen: gamesOpen ?? 0,
      bookingsUpcoming: bookingsUpcoming ?? 0,
      rinksTotal: rinksTotal ?? 0,
    })
    setLoading(false)
  }, [])

  useEffect(() => {
    loadDashboard()
  }, [loadDashboard])

  if (loading) {
    return (
      <div className="flex items-center justify-center min-h-[40vh]">
        <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
      </div>
    )
  }

  return (
    <div className="container mx-auto px-4 py-8">
      <h1 className="text-3xl font-bold mb-6">Dashboard</h1>
      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div className="bg-white rounded-lg shadow p-6">
          <div className="text-sm text-gray-600">Open Game Invitations</div>
          <div className="text-3xl font-bold">{metrics.gamesOpen}</div>
        </div>
        <div className="bg-white rounded-lg shadow p-6">
          <div className="text-sm text-gray-600">Upcoming Bookings</div>
          <div className="text-3xl font-bold">{metrics.bookingsUpcoming}</div>
        </div>
        <div className="bg-white rounded-lg shadow p-6">
          <div className="text-sm text-gray-600">Total Rinks</div>
          <div className="text-3xl font-bold">{metrics.rinksTotal}</div>
        </div>
      </div>
    </div>
  )
}
</file>

<file path="app/(dashboard)/games/new/page.tsx">
'use client';

import {useMemo, useState} from 'react';
import {createClient} from '@/lib/supabase/client';
import {usePathname, useRouter} from 'next/navigation';
import Link from 'next/link';
import {ArrowLeft, Calendar, Clock, MapPin, Users, Trophy} from 'lucide-react';

export default function CreateGamePage() {
  const router = useRouter();
  const pathname = usePathname();
  const supabase = createClient();

  // Derive locale from the first path segment: /{locale}/...
  const locale = useMemo(() => (pathname?.split('/')?.[1] || '').trim(), [pathname]);

  // Helper to build a locale-prefixed path
  const withLocale = (p: string) => `/${locale || ''}${p}`.replace('//', '/');

  const [loading, setLoading] = useState(false);
  const [formData, setFormData] = useState({
    title: '',
    game_date: '',
    game_time: '',
    location: '',
    age_group: 'U11',
    skill_level: 'Intermediate',
    description: '',
    max_players: '',
    contact_info: ''
  });

  const ageGroups = ['U7', 'U9', 'U11', 'U13', 'U15', 'U18', 'Adult'];
  const skillLevels = ['Beginner', 'Intermediate', 'Advanced', 'Elite'];

  async function handleSubmit(e: React.FormEvent) {
    e.preventDefault();
    setLoading(true);

    try {
      // Require auth and redirect to localized login
      const {
        data: {user}
      } = await supabase.auth.getUser();

      if (!user) {
        router.push(withLocale('/login'));
        return;
      }

      // Create game invitation
      const {data, error} = await supabase
        .from('game_invitations')
        .insert({
          title: formData.title,
          game_date: formData.game_date,
          game_time: formData.game_time,
          location: formData.location,
          age_group: formData.age_group,
          skill_level: formData.skill_level,
          description: formData.description,
          max_players: formData.max_players ? parseInt(formData.max_players) : null,
          contact_info: formData.contact_info,
          status: 'open',
          created_by: user.id,
          view_count: 0,
          interested_count: 0
        })
        .select()
        .single();

      if (error) throw error;

      // Localized redirect to details page
      router.push(withLocale(`/games/${data.id}`));
    } catch (error: any) {
      console.error('Error creating game:', error);
      alert(error.message || 'Failed to create game');
    } finally {
      setLoading(false);
    }
  }

  function handleChange(
    e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement>
  ) {
    setFormData(prev => ({
      ...prev,
      [e.target.name]: e.target.value
    }));
  }

  // Use tomorrow as the earliest selectable date
  const tomorrow = new Date();
  tomorrow.setDate(tomorrow.getDate() + 1);
  const minDate = tomorrow.toISOString().split('T')[0];

  return (
    <div className="min-h-screen bg-gray-50 py-8">
      <div className="max-w-3xl mx-auto px-4">
        {/* Header */}
        <div className="mb-8">
          <Link
            href={withLocale('/games')}
            className="inline-flex items-center text-gray-600 hover:text-gray-900 mb-4"
          >
            <ArrowLeft className="h-4 w-4 mr-2" />
            Back to Games
          </Link>
          <h1 className="text-3xl font-bold text-gray-900">Post a Game</h1>
          <p className="mt-2 text-gray-600">Create a game invitation for other teams</p>
        </div>

        {/* Form */}
        <form onSubmit={handleSubmit} className="bg-white rounded-lg shadow p-6 space-y-6">
          {/* Title */}
          <div>
            <label htmlFor="title" className="block text-sm font-medium text-gray-700 mb-2">
              Game Title *
            </label>
            <input
              type="text"
              id="title"
              name="title"
              required
              value={formData.title}
              onChange={handleChange}
              placeholder="e.g., U13 Friendly Match Looking for Opponent"
              className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
            />
          </div>

          {/* Date and Time */}
          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label htmlFor="game_date" className="block text-sm font-medium text-gray-700 mb-2">
                <Calendar className="inline h-4 w-4 mr-1" />
                Game Date *
              </label>
              <input
                type="date"
                id="game_date"
                name="game_date"
                required
                min={minDate}
                value={formData.game_date}
                onChange={handleChange}
                className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
              />
            </div>
            <div>
              <label htmlFor="game_time" className="block text-sm font-medium text-gray-700 mb-2">
                <Clock className="inline h-4 w-4 mr-1" />
                Game Time *
              </label>
              <input
                type="time"
                id="game_time"
                name="game_time"
                required
                value={formData.game_time}
                onChange={handleChange}
                className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
              />
            </div>
          </div>

          {/* Location */}
          <div>
            <label htmlFor="location" className="block text-sm font-medium text-gray-700 mb-2">
              <MapPin className="inline h-4 w-4 mr-1" />
              Location *
            </label>
            <input
              type="text"
              id="location"
              name="location"
              required
              value={formData.location}
              onChange={handleChange}
              placeholder="e.g., Bell Sensplex, Kanata"
              className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
            />
          </div>

          {/* Age Group and Skill Level */}
          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label htmlFor="age_group" className="block text-sm font-medium text-gray-700 mb-2">
                <Users className="inline h-4 w-4 mr-1" />
                Age Group *
              </label>
              <select
                id="age_group"
                name="age_group"
                required
                value={formData.age_group}
                onChange={handleChange}
                className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
              >
                {ageGroups.map(group => (
                  <option key={group} value={group}>
                    {group}
                  </option>
                ))}
              </select>
            </div>
            <div>
              <label htmlFor="skill_level" className="block text-sm font-medium text-gray-700 mb-2">
                <Trophy className="inline h-4 w-4 mr-1" />
                Skill Level *
              </label>
              <select
                id="skill_level"
                name="skill_level"
                required
                value={formData.skill_level}
                onChange={handleChange}
                className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
              >
                {skillLevels.map(level => (
                  <option key={level} value={level}>
                    {level}
                  </option>
                ))}
              </select>
            </div>
          </div>

          {/* Max Players */}
          <div>
            <label htmlFor="max_players" className="block text-sm font-medium text-gray-700 mb-2">
              Max Players (Optional)
            </label>
            <input
              type="number"
              id="max_players"
              name="max_players"
              min="1"
              max="50"
              value={formData.max_players}
              onChange={handleChange}
              placeholder="e.g., 20"
              className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
            />
          </div>

          {/* Description */}
          <div>
            <label htmlFor="description" className="block text-sm font-medium text-gray-700 mb-2">
              Description
            </label>
            <textarea
              id="description"
              name="description"
              rows={4}
              value={formData.description}
              onChange={handleChange}
              placeholder="Provide additional details about the game, rules, or requirements..."
              className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
            />
          </div>

          {/* Contact Info */}
          <div>
            <label htmlFor="contact_info" className="block text-sm font-medium text-gray-700 mb-2">
              Contact Information (Optional)
            </label>
            <input
              type="text"
              id="contact_info"
              name="contact_info"
              value={formData.contact_info}
              onChange={handleChange}
              placeholder="e.g., Coach John - 613-555-0123"
              className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
            />
            <p className="mt-1 text-sm text-gray-500">This will be shared only with interested teams</p>
          </div>

          {/* Submit Buttons */}
          <div className="flex gap-4 pt-4">
            <button
              type="submit"
              disabled={loading}
              className="flex-1 bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition"
            >
              {loading ? 'Creating...' : 'Post Game'}
            </button>
            <Link
              href={withLocale('/games')}
              className="flex-1 bg-gray-200 text-gray-800 py-2 px-4 rounded-md hover:bg-gray-300 text-center transition"
            >
              Cancel
            </Link>
          </div>
        </form>

        {/* Tips */}
        <div className="mt-8 bg-blue-50 border border-blue-200 rounded-lg p-4">
          <h3 className="font-semibold text-blue-900 mb-2">Tips for a successful game post:</h3>
          <ul className="text-sm text-blue-800 space-y-1">
            <li>‚Ä¢ Include specific time and location details</li>
            <li>‚Ä¢ Be clear about skill level expectations</li>
            <li>‚Ä¢ Mention if you have ice time already booked</li>
            <li>‚Ä¢ Provide contact information for quick responses</li>
          </ul>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="app/(dashboard)/games/page.tsx">
'use client';

import { useEffect, useState } from 'react';
import { createClient } from '@/lib/supabase/client';
import Link from 'next/link';
import { 
  Calendar, 
  MapPin, 
  Users, 
  Trophy, 
  Eye, 
  Heart, 
  Clock, 
  Plus, 
  AlertCircle,
  Search,
  Filter,
  X
} from 'lucide-react';

interface Game {
  id: string;
  title: string;
  game_date: string;
  game_time: string;
  age_group: string;
  skill_level: string;
  description: string;
  status: string;
  location?: string;
  view_count?: number;
  interested_count?: number;
  created_at: string;
  isExpired?: boolean;
}

export default function GamesPage() {
  const [games, setGames] = useState<Game[]>([]);
  const [filteredGames, setFilteredGames] = useState<Game[]>([]);
  const [loading, setLoading] = useState(true);
  
  // Filter states
  const [dateFilter, setDateFilter] = useState<'all' | 'upcoming' | 'past'>('upcoming');
  const [searchTerm, setSearchTerm] = useState('');
  const [ageGroupFilter, setAgeGroupFilter] = useState('all');
  const [skillLevelFilter, setSkillLevelFilter] = useState('all');
  const [locationFilter, setLocationFilter] = useState('');
  const [showFilters, setShowFilters] = useState(false);
  const [sortBy, setSortBy] = useState<'date' | 'interest' | 'views'>('date');
  
  const supabase = createClient();

  const ageGroups = ['U7', 'U9', 'U11', 'U13', 'U15', 'U18', 'Adult'];
  const skillLevels = ['Beginner', 'Intermediate', 'Advanced', 'Elite'];

  useEffect(() => {
    fetchGames();
  }, []);

  useEffect(() => {
    applyFilters();
  }, [games, dateFilter, searchTerm, ageGroupFilter, skillLevelFilter, locationFilter, sortBy]);

  async function fetchGames() {
    try {
      const { data, error } = await supabase
        .from('game_invitations')
        .select('*')
        .eq('status', 'open')
        .order('game_date', { ascending: true });

      if (error) throw error;

      // Process games with expiry status
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      const todayStr = today.toISOString().split('T')[0];
      
      const sevenDaysAgo = new Date(today);
      sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);
      const sevenDaysAgoStr = sevenDaysAgo.toISOString().split('T')[0];

      const processedGames = (data || [])
        .filter(game => {
          if (!game.game_date) return true;
          return game.game_date >= sevenDaysAgoStr;
        })
        .map(game => ({
          ...game,
          isExpired: game.game_date ? game.game_date < todayStr : false
        }));

      setGames(processedGames);
    } catch (error) {
      console.error('Error:', error);
    } finally {
      setLoading(false);
    }
  }

  function applyFilters() {
    let filtered = [...games];

    // Date filter
    if (dateFilter === 'upcoming') {
      filtered = filtered.filter(game => !game.isExpired);
    } else if (dateFilter === 'past') {
      filtered = filtered.filter(game => game.isExpired);
    }

    // Search filter
    if (searchTerm) {
      filtered = filtered.filter(game =>
        game.title?.toLowerCase().includes(searchTerm.toLowerCase()) ||
        game.description?.toLowerCase().includes(searchTerm.toLowerCase()) ||
        game.location?.toLowerCase().includes(searchTerm.toLowerCase())
      );
    }

    // Age group filter
    if (ageGroupFilter !== 'all') {
      filtered = filtered.filter(game => game.age_group === ageGroupFilter);
    }

    // Skill level filter
    if (skillLevelFilter !== 'all') {
      filtered = filtered.filter(game => game.skill_level === skillLevelFilter);
    }

    // Location filter
    if (locationFilter) {
      filtered = filtered.filter(game =>
        game.location?.toLowerCase().includes(locationFilter.toLowerCase())
      );
    }

    // Sort
    filtered.sort((a, b) => {
      switch (sortBy) {
        case 'interest':
          return (b.interested_count || 0) - (a.interested_count || 0);
        case 'views':
          return (b.view_count || 0) - (a.view_count || 0);
        case 'date':
        default:
          // Upcoming games first, then by date
          if (a.isExpired !== b.isExpired) {
            return a.isExpired ? 1 : -1;
          }
          return (a.game_date || '').localeCompare(b.game_date || '');
      }
    });

    setFilteredGames(filtered);
  }

  function clearFilters() {
    setSearchTerm('');
    setAgeGroupFilter('all');
    setSkillLevelFilter('all');
    setLocationFilter('');
    setDateFilter('upcoming');
    setSortBy('date');
  }

  function hasActiveFilters() {
    return searchTerm || 
           ageGroupFilter !== 'all' || 
           skillLevelFilter !== 'all' || 
           locationFilter ||
           sortBy !== 'date';
  }

  function formatDate(dateStr: string) {
    if (!dateStr) return 'TBD';
    const date = new Date(dateStr);
    const today = new Date();
    const diffTime = date.getTime() - today.getTime();
    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
    
    let relativeTime = '';
    if (diffDays === 0) relativeTime = ' (Today)';
    else if (diffDays === 1) relativeTime = ' (Tomorrow)';
    else if (diffDays === -1) relativeTime = ' (Yesterday)';
    else if (diffDays < -1) relativeTime = ` (${Math.abs(diffDays)} days ago)`;
    else if (diffDays > 1 && diffDays <= 7) relativeTime = ` (In ${diffDays} days)`;
    
    return new Date(dateStr).toLocaleDateString('en-US', { 
      weekday: 'short',
      month: 'short', 
      day: 'numeric' 
    }) + relativeTime;
  }

  if (loading) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gray-50 py-8">
      <div className="max-w-7xl mx-auto px-4">
        {/* Header */}
        <div className="mb-8 flex justify-between items-center">
          <div>
            <h1 className="text-3xl font-bold text-gray-900">Find Games</h1>
            <p className="mt-2 text-gray-600">
              {filteredGames.length} games found
              {hasActiveFilters() && ' (filtered)'}
            </p>
          </div>
          <Link
            href="/games/new"
            className="flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
          >
            <Plus className="h-5 w-5 mr-2" />
            Post a Game
          </Link>
        </div>

        {/* Search Bar */}
        <div className="mb-6 bg-white rounded-lg shadow p-4">
          <div className="flex flex-col lg:flex-row gap-4">
            {/* Search Input */}
            <div className="flex-1 relative">
              <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-5 w-5" />
              <input
                type="text"
                placeholder="Search games by title, description, or location..."
                value={searchTerm}
                onChange={(e) => setSearchTerm(e.target.value)}
                className="pl-10 pr-3 py-2 w-full border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
              />
            </div>
            
            {/* Filter Toggle Button */}
            <button
              onClick={() => setShowFilters(!showFilters)}
              className={`px-4 py-2 border rounded-md transition flex items-center gap-2 ${
                showFilters || hasActiveFilters()
                  ? 'bg-blue-50 border-blue-300 text-blue-700'
                  : 'border-gray-300 text-gray-700 hover:bg-gray-50'
              }`}
            >
              <Filter className="h-4 w-4" />
              Filters
              {hasActiveFilters() && (
                <span className="bg-blue-600 text-white text-xs px-2 py-0.5 rounded-full">
                  Active
                </span>
              )}
            </button>
          </div>

          {/* Expandable Filters */}
          {showFilters && (
            <div className="mt-4 pt-4 border-t grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4">
              {/* Age Group */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">
                  Age Group
                </label>
                <select
                  value={ageGroupFilter}
                  onChange={(e) => setAgeGroupFilter(e.target.value)}
                  className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                >
                  <option value="all">All Ages</option>
                  {ageGroups.map(group => (
                    <option key={group} value={group}>{group}</option>
                  ))}
                </select>
              </div>

              {/* Skill Level */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">
                  Skill Level
                </label>
                <select
                  value={skillLevelFilter}
                  onChange={(e) => setSkillLevelFilter(e.target.value)}
                  className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                >
                  <option value="all">All Levels</option>
                  {skillLevels.map(level => (
                    <option key={level} value={level}>{level}</option>
                  ))}
                </select>
              </div>

              {/* Location */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">
                  Location
                </label>
                <input
                  type="text"
                  placeholder="e.g., Kanata"
                  value={locationFilter}
                  onChange={(e) => setLocationFilter(e.target.value)}
                  className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                />
              </div>

              {/* Sort By */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">
                  Sort By
                </label>
                <select
                  value={sortBy}
                  onChange={(e) => setSortBy(e.target.value as 'date' | 'interest' | 'views')}
                  className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                >
                  <option value="date">Date</option>
                  <option value="interest">Most Interested</option>
                  <option value="views">Most Viewed</option>
                </select>
              </div>

              {/* Clear Filters */}
              <div className="flex items-end">
                <button
                  onClick={clearFilters}
                  className="w-full px-4 py-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-md transition flex items-center justify-center gap-2"
                >
                  <X className="h-4 w-4" />
                  Clear All
                </button>
              </div>
            </div>
          )}
        </div>

        {/* Date Filter Tabs */}
        <div className="mb-6 flex space-x-4 border-b">
          <button
            onClick={() => setDateFilter('all')}
            className={`pb-2 px-1 border-b-2 transition ${
              dateFilter === 'all' 
                ? 'border-blue-600 text-blue-600 font-medium' 
                : 'border-transparent text-gray-500 hover:text-gray-700'
            }`}
          >
            All Games ({games.length})
          </button>
          <button
            onClick={() => setDateFilter('upcoming')}
            className={`pb-2 px-1 border-b-2 transition ${
              dateFilter === 'upcoming' 
                ? 'border-blue-600 text-blue-600 font-medium' 
                : 'border-transparent text-gray-500 hover:text-gray-700'
            }`}
          >
            Upcoming ({games.filter(g => !g.isExpired).length})
          </button>
          <button
            onClick={() => setDateFilter('past')}
            className={`pb-2 px-1 border-b-2 transition ${
              dateFilter === 'past' 
                ? 'border-blue-600 text-blue-600 font-medium' 
                : 'border-transparent text-gray-500 hover:text-gray-700'
            }`}
          >
            Recent Past ({games.filter(g => g.isExpired).length})
          </button>
        </div>

        {/* Games Grid */}
        {filteredGames.length > 0 ? (
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {filteredGames.map((game) => (
              <div 
                key={game.id} 
                className={`bg-white rounded-lg shadow-md hover:shadow-lg transition-shadow relative ${
                  game.isExpired ? 'opacity-75' : ''
                }`}
              >
                {/* Expired Badge */}
                {game.isExpired && (
                  <div className="absolute top-4 right-4 z-10">
                    <span className="bg-gray-500 text-white text-xs px-2 py-1 rounded-full flex items-center">
                      <AlertCircle className="h-3 w-3 mr-1" />
                      Expired
                    </span>
                  </div>
                )}
                
                <div className="p-6">
                  <h3 className="text-lg font-semibold text-gray-900 mb-4 pr-16">
                    {game.title || 'Untitled Game'}
                  </h3>

                  <div className="space-y-2 text-sm text-gray-600">
                    <div className="flex items-center">
                      <Calendar className="h-4 w-4 mr-2" />
                      <span className={game.isExpired ? 'line-through' : ''}>
                        {formatDate(game.game_date)}
                      </span>
                      {game.game_time && (
                        <span className="ml-1">at {game.game_time}</span>
                      )}
                    </div>
                    
                    {game.location && (
                      <div className="flex items-center">
                        <MapPin className="h-4 w-4 mr-2" />
                        <span>{game.location}</span>
                      </div>
                    )}
                    
                    <div className="flex items-center">
                      <Users className="h-4 w-4 mr-2" />
                      <span>{game.age_group} - {game.skill_level}</span>
                    </div>
                  </div>

                  {game.description && (
                    <p className="mt-3 text-sm text-gray-500 line-clamp-2">
                      {game.description}
                    </p>
                  )}

                  <div className="mt-4 flex items-center space-x-4 text-xs text-gray-500">
                    <span className="flex items-center">
                      <Eye className="h-3 w-3 mr-1" />
                      {game.view_count || 0} views
                    </span>
                    <span className="flex items-center">
                      <Heart className="h-3 w-3 mr-1" />
                      {game.interested_count || 0} interested
                    </span>
                  </div>

                  <Link
                    href={`/games/${game.id}`}
                    className={`mt-4 block text-center px-4 py-2 rounded-md transition ${
                      game.isExpired 
                        ? 'bg-gray-400 text-white hover:bg-gray-500' 
                        : 'bg-blue-600 text-white hover:bg-blue-700'
                    }`}
                  >
                    {game.isExpired ? 'View Details (Expired)' : 'View Details'}
                  </Link>
                </div>
              </div>
            ))}
          </div>
        ) : (
          <div className="text-center py-12 bg-white rounded-lg shadow">
            <Trophy className="mx-auto h-12 w-12 text-gray-400 mb-4" />
            <h3 className="text-lg font-medium text-gray-900 mb-2">
              No games found
            </h3>
            <p className="text-gray-500 mb-6">
              {hasActiveFilters() 
                ? 'Try adjusting your filters or search terms'
                : 'Be the first to post a game invitation!'}
            </p>
            {hasActiveFilters() ? (
              <button
                onClick={clearFilters}
                className="inline-flex items-center px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-50"
              >
                <X className="h-5 w-5 mr-2" />
                Clear Filters
              </button>
            ) : (
              <Link
                href="/games/new"
                className="inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700"
              >
                <Plus className="h-5 w-5 mr-2" />
                Post First Game
              </Link>
            )}
          </div>
        )}
      </div>
    </div>
  );
}
</file>

<file path="app/(dashboard)/profile/edit/page.tsx">
'use client';

import {useEffect, useMemo, useState} from 'react';
import {createClient} from '@/lib/supabase/client';
import {usePathname, useRouter} from 'next/navigation';
import {ArrowLeft, Save} from 'lucide-react';

interface Profile {
  id: string;
  full_name: string;
  email?: string;
  age_group?: string;
  skill_level?: string;
  position?: string;
  area?: string;
  years_playing?: number;
  phone?: string;
  jersey_number?: string;
  preferred_shot?: string;
  bio?: string;
}

export default function EditProfilePage() {
  const router = useRouter();
  const pathname = usePathname();
  const supabase = createClient();

  // Derive locale from the first path segment: /{locale}/...
  const locale = useMemo(() => (pathname?.split('/')?.[1] || '').trim(), [pathname]);
  const withLocale = (p: string) => `/${locale || ''}${p}`.replace('//', '/');

  const [profile, setProfile] = useState<Profile | null>(null);
  const [loading, setLoading] = useState(true);
  const [saving, setSaving] = useState(false);
  const [message, setMessage] = useState<{type: 'success' | 'error'; text: string} | null>(null);

  useEffect(() => {
    loadProfile();
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, []);

  async function loadProfile() {
    try {
      const {
        data: {user}
      } = await supabase.auth.getUser();

      if (!user) {
        // Localized redirect to login
        router.push(withLocale('/login'));
        return;
      }

      const {data, error} = await supabase
        .from('profiles')
        .select('*')
        .eq('id', user.id)
        .single();

      if (error) throw error;

      setProfile(data);
    } catch (error) {
      console.error('Error loading profile:', error);
      setMessage({type: 'error', text: 'Failed to load profile'});
    } finally {
      setLoading(false);
    }
  }

  async function handleSubmit(e: React.FormEvent) {
    e.preventDefault();
    if (!profile) return;

    setSaving(true);
    setMessage(null);

    try {
      const {error} = await supabase
        .from('profiles')
        .update({
          full_name: profile.full_name,
          age_group: profile.age_group,
          skill_level: profile.skill_level,
          position: profile.position,
          area: profile.area,
          years_playing: profile.years_playing,
          phone: profile.phone,
          jersey_number: profile.jersey_number,
          preferred_shot: profile.preferred_shot,
          bio: profile.bio
        })
        .eq('id', profile.id);

      if (error) throw error;

      setMessage({type: 'success', text: 'Profile updated successfully!'});
      // Localized redirect after successful save
      setTimeout(() => {
        router.push(withLocale('/profile'));
      }, 1500);
    } catch (error: any) {
      console.error('Error updating profile:', error);
      setMessage({type: 'error', text: error.message || 'Failed to update profile'});
    } finally {
      setSaving(false);
    }
  }

  if (loading) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
      </div>
    );
  }

  if (!profile) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <div className="text-center">
          <p className="text-gray-500">Profile not found</p>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gray-50 py-8">
      <div className="max-w-2xl mx-auto px-4 sm:px-6 lg:px-8">
        {/* Header */}
        <div className="mb-8">
          <button
            onClick={() => router.push(withLocale('/profile'))}
            className="flex items-center text-gray-600 hover:text-gray-900 mb-4"
          >
            <ArrowLeft className="h-4 w-4 mr-2" />
            Back to Profile
          </button>
          <h1 className="text-3xl font-bold text-gray-900">Edit Profile</h1>
          <p className="mt-2 text-gray-600">Update your hockey profile information</p>
        </div>

        {/* Message */}
        {message && (
          <div
            className={`mb-6 p-4 rounded-lg ${
              message.type === 'success'
                ? 'bg-green-50 text-green-800 border border-green-200'
                : 'bg-red-50 text-red-800 border border-red-200'
            }`}
          >
            {message.text}
          </div>
        )}

        {/* Form */}
        <form onSubmit={handleSubmit} className="space-y-6">
          {/* Basic Information */}
          <div className="bg-white shadow rounded-lg p-6">
            <h2 className="text-lg font-semibold text-gray-900 mb-4">Basic Information</h2>

            <div className="space-y-4">
              <div>
                <label className="block text-sm font-medium text-gray-700">Full Name *</label>
                <input
                  type="text"
                  required
                  className="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                  value={profile.full_name || ''}
                  onChange={e => setProfile({...profile, full_name: e.target.value})}
                />
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700">Phone Number</label>
                <input
                  type="tel"
                  className="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                  placeholder="(613) 555-0100"
                  value={profile.phone || ''}
                  onChange={e => setProfile({...profile, phone: e.target.value})}
                />
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700">Area/Location *</label>
                <select
                  required
                  className="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md"
                  value={profile.area || ''}
                  onChange={e => setProfile({...profile, area: e.target.value})}
                >
                  <option value="">Select your area</option>
                  <option value="Downtown Ottawa">Downtown Ottawa</option>
                  <option value="Ottawa East">Ottawa East</option>
                  <option value="Ottawa West">Ottawa West</option>
                  <option value="Ottawa South">Ottawa South</option>
                  <option value="Kanata">Kanata</option>
                  <option value="Nepean">Nepean</option>
                  <option value="Orleans">Orleans</option>
                  <option value="Gloucester">Gloucester</option>
                  <option value="Barrhaven">Barrhaven</option>
                  <option value="Stittsville">Stittsville</option>
                </select>
              </div>
            </div>
          </div>

          {/* Hockey Information */}
          <div className="bg-white shadow rounded-lg p-6">
            <h2 className="text-lg font-semibold text-gray-900 mb-4">Hockey Information</h2>

            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label className="block text-sm font-medium text-gray-700">Age Group *</label>
                <select
                  required
                  className="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md"
                  value={profile.age_group || ''}
                  onChange={e => setProfile({...profile, age_group: e.target.value})}
                >
                  <option value="">Select age group</option>
                  <option value="U7">U7</option>
                  <option value="U9">U9</option>
                  <option value="U11">U11</option>
                  <option value="U13">U13</option>
                  <option value="U15">U15</option>
                  <option value="U18">U18</option>
                  <option value="Adult">Adult</option>
                </select>
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700">Skill Level *</label>
                <select
                  required
                  className="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md"
                  value={profile.skill_level || ''}
                  onChange={e => setProfile({...profile, skill_level: e.target.value})}
                >
                  <option value="">Select skill level</option>
                  <option value="AAA">AAA</option>
                  <option value="AA">AA</option>
                  <option value="A">A</option>
                  <option value="B">B</option>
                  <option value="C">C</option>
                  <option value="House League">House League</option>
                  <option value="Beginner">Beginner</option>
                </select>
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700">Position *</label>
                <select
                  required
                  className="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md"
                  value={profile.position || ''}
                  onChange={e => setProfile({...profile, position: e.target.value})}
                >
                  <option value="">Select position</option>
                  <option value="Forward">Forward</option>
                  <option value="Defense">Defense</option>
                  <option value="Goalie">Goalie</option>
                  <option value="Any">Any Position</option>
                </select>
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700">Preferred Shot</label>
                <select
                  className="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md"
                  value={profile.preferred_shot || ''}
                  onChange={e => setProfile({...profile, preferred_shot: e.target.value})}
                >
                  <option value="">Select</option>
                  <option value="Left">Left</option>
                  <option value="Right">Right</option>
                </select>
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700">Years Playing</label>
                <input
                  type="number"
                  min="0"
                  max="50"
                  className="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                  value={profile.years_playing || 0}
                  onChange={e =>
                    setProfile({...profile, years_playing: parseInt(e.target.value) || 0})
                  }
                />
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700">Jersey Number</label>
                <input
                  type="text"
                  maxLength={3}
                  className="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                  placeholder="99"
                  value={profile.jersey_number || ''}
                  onChange={e => setProfile({...profile, jersey_number: e.target.value})}
                />
              </div>
            </div>
          </div>

            {/* Bio */}
          <div className="bg-white shadow rounded-lg p-6">
            <h2 className="text-lg font-semibold text-gray-900 mb-4">About You</h2>
            <textarea
              rows={4}
              className="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
              placeholder="Tell us about your hockey experience, favorite teams, or anything else..."
              value={profile.bio || ''}
              onChange={e => setProfile({...profile, bio: e.target.value})}
            />
          </div>

          {/* Submit Buttons */}
          <div className="flex justify-end space-x-4">
            <button
              type="button"
              onClick={() => router.push(withLocale('/profile'))}
              className="px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
            >
              Cancel
            </button>
            <button
              type="submit"
              disabled={saving}
              className="flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:bg-gray-400"
            >
              <Save className="h-4 w-4 mr-2" />
              {saving ? 'Saving...' : 'Save Changes'}
            </button>
          </div>
        </form>
      </div>
    </div>
  );
}
</file>

<file path="app/[locale]/(dashboard)/clubs/page.tsx">
'use client'

import { useState, useEffect } from 'react'
import { createClient } from '@/lib/supabase/client'

// Simple LoadingSpinner component
const LoadingSpinner = () => (
  <div className="flex items-center justify-center p-8">
    <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
  </div>
)

export default function ClubsPage() {
  const [clubs, setClubs] = useState<any[]>([])
  const [loading, setLoading] = useState(true)

  useEffect(() => {
    fetchClubs()
  }, [])

  const fetchClubs = async () => {
    const supabase = createClient()
    const { data, error } = await supabase
      .from('clubs')
      .select('*')
      .order('name')
    
    if (data) {
      setClubs(data)
    }
    setLoading(false)
  }

  return (
    <div className="min-h-screen bg-gray-50">
      {/* Navigation */}
      <nav className="bg-white shadow-sm">
        <div className="container mx-auto px-4 h-16 flex items-center justify-between">
          <a href="/" className="text-xl font-bold">üèí HockeyHub</a>
          <div className="flex gap-4">
            <a href="/games" className="text-gray-600">Games</a>
            <a href="/rinks" className="text-gray-600">Rinks</a>
            <a href="/clubs" className="text-blue-600">Clubs</a>
            <a href="/profile" className="text-gray-600">Profile</a>
          </div>
        </div>
      </nav>

      {/* Main Content */}
      <div className="container mx-auto px-4 py-8">
        {/* Header with Register Button */}
        <div className="flex justify-between items-center mb-6">
          <h1 className="text-3xl font-bold">Ottawa Hockey Clubs</h1>
          <a
            href="/clubs/new"
            className="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700"
          >
            Register Your Club
          </a>
        </div>

        {loading ? (
          <LoadingSpinner />
        ) : clubs.length === 0 ? (
          <div className="bg-white rounded-lg shadow p-8 text-center">
            <p className="text-gray-500 mb-4">No clubs registered yet</p>
            <a
              href="/clubs/new"
              className="text-blue-600 hover:text-blue-700"
            >
              Be the first to register your club!
            </a>
          </div>
        ) : (
          <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
            {clubs.map((club) => (
              <div key={club.id} className="bg-white rounded-lg shadow p-6">
                <div className="flex justify-between items-start mb-2">
                  <h2 className="text-xl font-semibold">{club.name}</h2>
                  {club.verified && (
                    <span className="bg-green-100 text-green-800 px-2 py-1 rounded text-xs">
                      Verified
                    </span>
                  )}
                </div>
                
                {club.description && (
                  <p className="text-gray-600 mb-3 text-sm">{club.description}</p>
                )}
                
                {club.contact_email && (
                  <p className="text-gray-600 text-sm mb-1">üìß {club.contact_email}</p>
                )}
                
                {club.contact_phone && (
                  <p className="text-gray-600 text-sm mb-1">üìû {club.contact_phone}</p>
                )}
                
                {club.home_rink && (
                  <p className="text-gray-600 text-sm mb-1">üèí Home: {club.home_rink}</p>
                )}
                
                {club.age_groups && (
                  <div className="mt-3 flex flex-wrap gap-1">
                    {club.age_groups.split(',').map((ageGroup: string) => (
                      <span
                        key={ageGroup}
                        className="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs"
                      >
                        {ageGroup}
                      </span>
                    ))}
                  </div>
                )}
                
                {club.website && (
                  <a
                    href={club.website}
                    target="_blank"
                    rel="noopener noreferrer"
                    className="inline-block mt-3 text-blue-600 hover:text-blue-700 text-sm"
                  >
                    Visit Website ‚Üí
                  </a>
                )}
              </div>
            ))}
          </div>
        )}
      </div>
    </div>
  )
}
</file>

<file path="app/[locale]/(dashboard)/dashboard/page.tsx">
'use client'

import { useCallback, useEffect, useState } from 'react'
import { createClient } from '@/lib/supabase/client'

/**
 * Dashboard summary metrics
 * - Wrap data loader with useCallback to satisfy exhaustive-deps rule.
 */
export default function DashboardPage() {
  const [loading, setLoading] = useState(true)
  const [metrics, setMetrics] = useState({
    gamesOpen: 0,
    bookingsUpcoming: 0,
    rinksTotal: 0,
  })

  const loadDashboard = useCallback(async () => {
    const supabase = createClient()

    const { count: gamesOpen } = await supabase
      .from('game_invitations')
      .select('*', { count: 'exact', head: true })
      .eq('status', 'open')

    const today = new Date()
    today.setHours(0, 0, 0, 0)

    const { count: bookingsUpcoming } = await supabase
      .from('bookings')
      .select('*', { count: 'exact', head: true })
      .gte('booking_date', today.toISOString().slice(0, 10))

    const { count: rinksTotal } = await supabase
      .from('rinks')
      .select('*', { count: 'exact', head: true })

    setMetrics({
      gamesOpen: gamesOpen ?? 0,
      bookingsUpcoming: bookingsUpcoming ?? 0,
      rinksTotal: rinksTotal ?? 0,
    })
    setLoading(false)
  }, [])

  useEffect(() => {
    loadDashboard()
  }, [loadDashboard])

  if (loading) {
    return (
      <div className="flex items-center justify-center min-h-[40vh]">
        <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
      </div>
    )
  }

  return (
    <div className="container mx-auto px-4 py-8">
      <h1 className="text-3xl font-bold mb-6">Dashboard</h1>
      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div className="bg-white rounded-lg shadow p-6">
          <div className="text-sm text-gray-600">Open Game Invitations</div>
          <div className="text-3xl font-bold">{metrics.gamesOpen}</div>
        </div>
        <div className="bg-white rounded-lg shadow p-6">
          <div className="text-sm text-gray-600">Upcoming Bookings</div>
          <div className="text-3xl font-bold">{metrics.bookingsUpcoming}</div>
        </div>
        <div className="bg-white rounded-lg shadow p-6">
          <div className="text-sm text-gray-600">Total Rinks</div>
          <div className="text-3xl font-bold">{metrics.rinksTotal}</div>
        </div>
      </div>
    </div>
  )
}
</file>

<file path="app/[locale]/(dashboard)/games-test/page.tsx">
// app/[locale]/(dashboard)/games-test/page.tsx
'use client';

import {useCallback, useEffect, useMemo, useState} from 'react';
import {createClient} from '@/lib/supabase/client';
import {useParams, useRouter} from 'next/navigation';
import Link from 'next/link';

type Game = {
  id: string;
  title: string | null;
  game_date: string | null; // yyyy-mm-dd
  game_time: string | null; // HH:mm
  age_group: string | null;
  skill_level: string | null;
  status: string | null;
  view_count?: number | null;
  interested_count?: number | null;
};

export default function GamesTestPage() {
  const {locale} = useParams<{locale: string}>();
  const router = useRouter();
  const supabase = useMemo(() => createClient(), []);

  const [games, setGames] = useState<Game[]>([]);
  const [loading, setLoading] = useState(true);

  const withLocale = useCallback((p: string) => `/${locale || ''}${p}`.replace('//', '/'), [locale]);

  const load = useCallback(async () => {
    try {
      const {data: {user}} = await supabase.auth.getUser();
      if (!user) {
        router.push(withLocale('/login'));
        return;
      }

      // ËøôÈáå‰Ωú‰∏∫‚ÄúÊµãËØïÈ°µ‚ÄùÔºåÂèñÊúÄËøë 30 Â§©ÂÜÖÂàõÂª∫ÁöÑ invitation ÂÅöÊºîÁ§∫
      const {data, error} = await supabase
        .from('game_invitations')
        .select('id,title,game_date,game_time,age_group,skill_level,status,view_count,interested_count')
        .order('created_at', {ascending: false})
        .limit(20);

      if (error) throw error;
      setGames(data || []);
    } catch (e) {
      console.error('load games-test error:', e);
      setGames([]);
    } finally {
      setLoading(false);
    }
  }, [router, supabase, withLocale]);

  useEffect(() => {
    load();
  }, [load]);

  if (loading) {
    return (
      <div className="min-h-[40vh] flex items-center justify-center">
        <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600" />
      </div>
    );
  }

  return (
    <div className="container mx-auto px-4 py-8">
      <div className="mb-6 flex items-center justify-between">
        <h1 className="text-2xl font-bold">Games Test</h1>
        <Link
          href={withLocale('/games/new')}
          className="px-4 py-2 rounded-md bg-blue-600 text-white hover:bg-blue-700"
        >
          Post a Game
        </Link>
      </div>

      {games.length === 0 ? (
        <div className="bg-white rounded-lg shadow p-8 text-center">
          <p className="text-gray-600">No sample data yet.</p>
          <p className="text-gray-500 mt-1">Try posting a game, then refresh this page.</p>
        </div>
      ) : (
        <div className="grid gap-4">
          {games.map((g) => (
            <Link
              key={g.id}
              href={withLocale(`/games/${g.id}`)}
              className="bg-white rounded-lg shadow p-6 hover:shadow-md transition"
            >
              <div className="flex items-start justify-between">
                <div>
                  <h3 className="text-lg font-semibold">{g.title || 'Untitled Game'}</h3>
                  <p className="text-gray-600 mt-1">
                    üìÖ {g.game_date || 'TBD'} ‚è∞ {g.game_time || 'TBD'}
                  </p>
                  <p className="text-gray-600">
                    {g.age_group || 'Age?'} ¬∑ {g.skill_level || 'Level?'}
                  </p>
                </div>
                <div className="text-right text-sm text-gray-600">
                  <div>üëÅ {g.view_count ?? 0}</div>
                  <div>‚ù§Ô∏è {g.interested_count ?? 0}</div>
                  <div className="mt-1 inline-block px-2 py-0.5 rounded bg-gray-100">
                    {g.status ?? 'open'}
                  </div>
                </div>
              </div>
            </Link>
          ))}
        </div>
      )}
    </div>
  );
}
</file>

<file path="app/[locale]/(dashboard)/games/[id]/edit/page.tsx">
// app/[locale]/(dashboard)/games/[id]/edit/page.tsx
'use client';

import { useState, useEffect, useCallback, useMemo } from 'react';
import { createClient } from '@/lib/supabase/client';
import { useRouter, useParams } from 'next/navigation';
import Link from 'next/link';
import { ArrowLeft, Calendar, Clock, MapPin, Users, Trophy, Save, X } from 'lucide-react';

type GameStatus = 'open' | 'matched' | 'cancelled' | 'closed';

interface GameData {
  title: string;
  game_date: string;
  game_time: string;
  location: string;
  age_group: string;
  skill_level: string;
  description: string;
  max_players: string;
  contact_info: string;
  status: GameStatus;
}

export default function EditGamePage() {
  const router = useRouter();
  const { locale, id: gameId } = useParams<{ locale: string; id: string }>();
  const supabase = useMemo(() => createClient(), []);

  const [loading, setLoading] = useState(true);
  const [saving, setSaving] = useState(false);
  const [isOwner, setIsOwner] = useState(false);
  const [formData, setFormData] = useState<GameData>({
    title: '',
    game_date: '',
    game_time: '',
    location: '',
    age_group: 'U11',
    skill_level: 'Intermediate',
    description: '',
    max_players: '',
    contact_info: '',
    status: 'open',
  });

  const ageGroups = ['U7', 'U9', 'U11', 'U13', 'U15', 'U18', 'Adult'];
  const skillLevels = ['Beginner', 'Intermediate', 'Advanced', 'Elite'];
  // Áªü‰∏ÄÁä∂ÊÄÅÔºöÂÖÅËÆ∏ cancelled/closedÔºà‰∫åËÄÖÂú®‰∏çÂêåÈ°µÈù¢ÊõæÁî®ËøáÔºâ
  const statusOptions: { value: GameStatus; label: string }[] = [
    { value: 'open',      label: 'Open - Accepting responses' },
    { value: 'matched',   label: 'Matched - Found opponent' },
    { value: 'cancelled', label: 'Cancelled - No longer available' },
    { value: 'closed',    label: 'Closed' },
  ];

  const withLocale = useCallback((p: string) => `/${locale || ''}${p}`.replace('//', '/'), [locale]);

  const loadGame = useCallback(async () => {
    try {
      // Require auth
      const { data: { user } } = await supabase.auth.getUser();
      if (!user) {
        router.push(withLocale('/login'));
        return;
      }

      // Load game
      const { data: game, error } = await supabase
        .from('game_invitations')
        .select('*')
        .eq('id', gameId)
        .single();

      if (error || !game) {
        alert('Game not found');
        router.push(withLocale('/my-games'));
        return;
      }

      // Ownership check
      if (game.created_by !== user.id) {
        alert('You can only edit your own games');
        router.push(withLocale(`/games/${gameId}`));
        return;
      }

      setIsOwner(true);
      setFormData({
        title: game.title || '',
        game_date: game.game_date || '',
        game_time: game.game_time || '',
        location: game.location || '',
        age_group: game.age_group || 'U11',
        skill_level: game.skill_level || 'Intermediate',
        description: game.description || '',
        max_players: game.max_players?.toString() || '',
        contact_info: game.contact_info || '',
        status: (game.status as GameStatus) || 'open',
      });
    } catch (err) {
      console.error('Error loading game:', err);
      alert('Failed to load game');
      router.push(withLocale('/my-games'));
    } finally {
      setLoading(false);
    }
  }, [gameId, router, supabase, withLocale]);

  useEffect(() => {
    loadGame();
  }, [loadGame]);

  async function handleSubmit(e: React.FormEvent) {
    e.preventDefault();
    setSaving(true);

    try {
      // ÂÜçÂÅö‰∏ÄÊ¨°Èâ¥ÊùÉÔºå‰∏îÂú® UPDATE Êó∂ÈôÑÂ∏¶ created_by ÈôêÂà∂ÔºåÈò≤Ë∂äÊùÉ
      const { data: { user } } = await supabase.auth.getUser();
      if (!user) {
        router.push(withLocale('/login'));
        return;
      }

      const { error } = await supabase
        .from('game_invitations')
        .update({
          title: formData.title,
          game_date: formData.game_date,
          game_time: formData.game_time,
          location: formData.location,
          age_group: formData.age_group,
          skill_level: formData.skill_level,
          description: formData.description,
          max_players: formData.max_players ? parseInt(formData.max_players, 10) : null,
          contact_info: formData.contact_info,
          status: formData.status,
        })
        .eq('id', gameId)
        .eq('created_by', user.id); // Âè™Êõ¥Êñ∞Êú¨‰∫∫ÂàõÂª∫ÁöÑ

      if (error) throw error;

      // Go to details (localized)
      router.push(withLocale(`/games/${gameId}`));
    } catch (err: any) {
      console.error('Error updating game:', err);
      alert(err.message || 'Failed to update game');
    } finally {
      setSaving(false);
    }
  }

  function handleChange(e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement>) {
    setFormData(prev => ({
      ...prev,
      [e.target.name]: e.target.value,
    }));
  }

  if (loading) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
      </div>
    );
  }

  if (!isOwner) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <div className="text-center">
          <p className="text-gray-500">You don't have permission to edit this game</p>
          <Link href={withLocale('/my-games')} className="text-blue-600 hover:text-blue-800 mt-4 inline-block">
            Back to My Games
          </Link>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gray-50 py-8">
      <div className="max-w-3xl mx-auto px-4">
        {/* Header */}
        <div className="mb-8">
          <Link
            href={withLocale('/my-games')}
            className="inline-flex items-center text-gray-600 hover:text-gray-900 mb-4"
          >
            <ArrowLeft className="h-4 w-4 mr-2" />
            Back to My Games
          </Link>
          <h1 className="text-3xl font-bold text-gray-900">Edit Game</h1>
          <p className="mt-2 text-gray-600">Update your game information</p>
        </div>

        {/* Form */}
        <form onSubmit={handleSubmit} className="bg-white rounded-lg shadow p-6 space-y-6">
          {/* Status */}
          <div>
            <label htmlFor="status" className="block text-sm font-medium text-gray-700 mb-2">
              Game Status
            </label>
            <select
              id="status"
              name="status"
              value={formData.status}
              onChange={handleChange}
              className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
            >
              {statusOptions.map(s => (
                <option key={s.value} value={s.value}>{s.label}</option>
              ))}
            </select>
          </div>

          {/* Title */}
          <div>
            <label htmlFor="title" className="block text-sm font-medium text-gray-700 mb-2">
              Game Title *
            </label>
            <input
              type="text"
              id="title"
              name="title"
              required
              value={formData.title}
              onChange={handleChange}
              placeholder="e.g., U13 Friendly Match Looking for Opponent"
              className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
            />
          </div>

          {/* Date and Time */}
          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label htmlFor="game_date" className="block text-sm font-medium text-gray-700 mb-2">
                <Calendar className="inline h-4 w-4 mr-1" />
                Game Date *
              </label>
              <input
                type="date"
                id="game_date"
                name="game_date"
                required
                value={formData.game_date}
                onChange={handleChange}
                className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
              />
            </div>
            <div>
              <label htmlFor="game_time" className="block text-sm font-medium text-gray-700 mb-2">
                <Clock className="inline h-4 w-4 mr-1" />
                Game Time *
              </label>
              <input
                type="time"
                id="game_time"
                name="game_time"
                required
                value={formData.game_time}
                onChange={handleChange}
                className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
              />
            </div>
          </div>

          {/* Location */}
          <div>
            <label htmlFor="location" className="block text-sm font-medium text-gray-700 mb-2">
              <MapPin className="inline h-4 w-4 mr-1" />
              Location *
            </label>
            <input
              type="text"
              id="location"
              name="location"
              required
              value={formData.location}
              onChange={handleChange}
              placeholder="e.g., Bell Sensplex, Kanata"
              className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
            />
          </div>

          {/* Age Group and Skill Level */}
          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label htmlFor="age_group" className="block text-sm font-medium text-gray-700 mb-2">
                <Users className="inline h-4 w-4 mr-1" />
                Age Group *
              </label>
              <select
                id="age_group"
                name="age_group"
                required
                value={formData.age_group}
                onChange={handleChange}
                className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
              >
                {ageGroups.map(group => (
                  <option key={group} value={group}>{group}</option>
                ))}
              </select>
            </div>
            <div>
              <label htmlFor="skill_level" className="block text-sm font-medium text-gray-700 mb-2">
                <Trophy className="inline h-4 w-4 mr-1" />
                Skill Level *
              </label>
              <select
                id="skill_level"
                name="skill_level"
                required
                value={formData.skill_level}
                onChange={handleChange}
                className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
              >
                {skillLevels.map(level => (
                  <option key={level} value={level}>{level}</option>
                ))}
              </select>
            </div>
          </div>

          {/* Max Players */}
          <div>
            <label htmlFor="max_players" className="block text-sm font-medium text-gray-700 mb-2">
              Max Players (Optional)
            </label>
            <input
              type="number"
              id="max_players"
              name="max_players"
              min="1"
              max="50"
              value={formData.max_players}
              onChange={handleChange}
              placeholder="e.g., 20"
              className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
            />
          </div>

          {/* Description */}
          <div>
            <label htmlFor="description" className="block text-sm font-medium text-gray-700 mb-2">
              Description
            </label>
            <textarea
              id="description"
              name="description"
              rows={4}
              value={formData.description}
              onChange={handleChange}
              placeholder="Provide additional details about the game, rules, or requirements..."
              className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
            />
          </div>

          {/* Contact Info */}
          <div>
            <label htmlFor="contact_info" className="block text-sm font-medium text-gray-700 mb-2">
              Contact Information (Optional)
            </label>
            <input
              type="text"
              id="contact_info"
              name="contact_info"
              value={formData.contact_info}
              onChange={handleChange}
              placeholder="e.g., Coach John - 613-555-0123"
              className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
            />
            <p className="mt-1 text-sm text-gray-500">
              This will be shared only with interested teams
            </p>
          </div>

          {/* Submit Buttons */}
          <div className="flex gap-4 pt-4">
            <button
              type="submit"
              disabled={saving}
              className="flex-1 bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition flex items-center justify-center gap-2"
            >
              <Save className="h-4 w-4" />
              {saving ? 'Saving...' : 'Save Changes'}
            </button>
            <Link
              href={withLocale('/my-games')}
              className="flex-1 bg-gray-200 text-gray-800 py-2 px-4 rounded-md hover:bg-gray-300 text-center transition flex items-center justify-center gap-2"
            >
              <X className="h-4 w-4" />
              Cancel
            </Link>
          </div>
        </form>
      </div>
    </div>
  );
}
</file>

<file path="app/[locale]/(dashboard)/notifications/page.tsx">
// app/(dashboard)/notifications/page.tsx
'use client';

import {useEffect, useState, useMemo} from 'react';
import {createClient} from '@/lib/supabase/client';
import {Bell, Check, CheckCheck, Trash2, ExternalLink} from 'lucide-react';
import Link from 'next/link';
import {format} from 'date-fns';
import {usePathname, useRouter} from 'next/navigation';

interface Notification {
  id: string;
  user_id: string;
  type: string;
  title: string;
  message: string;
  link: string | null;
  related_id: string | null;
  is_read: boolean;
  created_at: string;
}

export default function NotificationsPage() {
  const [notifications, setNotifications] = useState<Notification[]>([]);
  const [loading, setLoading] = useState(true);

  const supabase = createClient();
  const pathname = usePathname();
  const router = useRouter();

  // Derive locale from the first URL segment: /{locale}/...
  const locale = useMemo(() => (pathname?.split('/')?.[1] || '').trim(), [pathname]);

  // Helper to prefix a path with current locale (keeps external links intact)
  const withLocale = (p: string) => `/${locale || ''}${p}`.replace('//', '/');
  const localizeLink = (href: string) => {
    if (!href) return href;
    // Keep full URLs and mailto/tel as-is
    if (/^(https?:)?\/\//i.test(href) || /^(mailto:|tel:)/i.test(href)) return href;
    // Already localized?
    if (href.startsWith(`/${locale}/`)) return href;
    // Prefix with current locale
    return withLocale(href.startsWith('/') ? href : `/${href}`);
  };

  useEffect(() => {
    loadNotifications();

    // Subscribe to real-time notifications (current user only)
    const channel = supabase
      .channel('notifications')
      .on(
        'postgres_changes',
        {event: '*', schema: 'public', table: 'notifications'},
        () => {
          loadNotifications();
        }
      )
      .subscribe();

    return () => {
      supabase.removeChannel(channel);
    };
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, []);

  async function loadNotifications() {
    try {
      const {
        data: {user},
        error: userError
      } = await supabase.auth.getUser();

      if (userError) {
        console.error('Error getting user:', userError);
        return;
      }

      if (!user) {
        // Localized redirect when unauthenticated
        router.push(withLocale('/login'));
        return;
      }

      const {data, error} = await supabase
        .from('notifications')
        .select(
          'id, user_id, type, title, message, link, related_id, is_read, created_at'
        )
        .eq('user_id', user.id)
        .order('created_at', {ascending: false});

      if (error) {
        console.error('Error loading notifications:', error);
        throw error;
      }

      setNotifications(data || []);
    } catch (error) {
      console.error('Error in loadNotifications:', error);
    } finally {
      setLoading(false);
    }
  }

  async function markAsRead(id: string) {
    try {
      const {error} = await supabase.from('notifications').update({is_read: true}).eq('id', id);
      if (error) throw error;
      setNotifications(prev => prev.map(n => (n.id === id ? {...n, is_read: true} : n)));
    } catch (error) {
      console.error('Error marking as read:', error);
    }
  }

  async function markAllAsRead() {
    try {
      const {
        data: {user}
      } = await supabase.auth.getUser();
      if (!user) return;

      const {error} = await supabase
        .from('notifications')
        .update({is_read: true})
        .eq('user_id', user.id)
        .eq('is_read', false);

      if (error) throw error;
      setNotifications(prev => prev.map(n => ({...n, is_read: true})));
    } catch (error) {
      console.error('Error marking all as read:', error);
    }
  }

  async function deleteNotification(id: string) {
    try {
      const {error} = await supabase.from('notifications').delete().eq('id', id);
      if (error) throw error;
      setNotifications(prev => prev.filter(n => n.id !== id));
    } catch (error) {
      console.error('Error deleting notification:', error);
    }
  }

  const unreadCount = notifications.filter(n => !n.is_read).length;

  const getTypeIcon = (type: string) => {
    switch (type) {
      case 'game_interest':
        return 'üèí';
      case 'interest_accepted':
        return '‚úÖ';
      case 'game_cancelled':
        return '‚ùå';
      case 'game_updated':
        return 'üìù';
      default:
        return 'üì¢';
    }
  };

  const getTypeColor = (type: string) => {
    switch (type) {
      case 'game_interest':
        return 'bg-blue-100 text-blue-800';
      case 'interest_accepted':
        return 'bg-green-100 text-green-800';
      case 'game_cancelled':
        return 'bg-red-100 text-red-800';
      case 'game_updated':
        return 'bg-yellow-100 text-yellow-800';
      default:
        return 'bg-gray-100 text-gray-800';
    }
  };

  if (loading) {
    return (
      <div className="flex items-center justify-center min-h-screen">
        <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
      </div>
    );
  }

  return (
    <div className="container mx-auto px-4 py-8 max-w-4xl">
      {/* Header */}
      <div className="mb-6 flex items-center justify-between">
        <div className="flex items-center gap-3">
          <Bell className="h-8 w-8 text-blue-600" />
          <div>
            <h1 className="text-2xl font-bold">Notifications</h1>
            {unreadCount > 0 && (
              <p className="text-sm text-gray-600">
                You have {unreadCount} unread notification{unreadCount !== 1 ? 's' : ''}
              </p>
            )}
          </div>
        </div>
        {unreadCount > 0 && (
          <button
            onClick={markAllAsRead}
            className="flex items-center gap-2 px-4 py-2 text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700"
          >
            <CheckCheck className="h-4 w-4" />
            Mark all as read
          </button>
        )}
      </div>

      {/* Notifications List */}
      {notifications.length === 0 ? (
        <div className="bg-white rounded-lg shadow p-12 text-center">
          <Bell className="h-16 w-16 text-gray-300 mx-auto mb-4" />
          <h2 className="text-xl font-semibold text-gray-600 mb-2">No notifications yet</h2>
          <p className="text-gray-500">
            When someone shows interest in your games or accepts your requests, you'll see it here.
          </p>
        </div>
      ) : (
        <div className="space-y-2">
          {notifications.map(notification => {
            const href = notification.link ? localizeLink(notification.link) : null;
            return (
              <div
                key={notification.id}
                className={`bg-white rounded-lg shadow p-4 transition-all ${
                  !notification.is_read ? 'border-l-4 border-blue-600' : ''
                }`}
              >
                <div className="flex items-start justify-between">
                  <div className="flex-1">
                    <div className="flex items-center gap-2 mb-2">
                      <span className="text-lg">{getTypeIcon(notification.type)}</span>
                      <span
                        className={`px-2 py-1 rounded text-xs font-medium ${getTypeColor(
                          notification.type
                        )}`}
                      >
                        {notification.type.replace('_', ' ').toUpperCase()}
                      </span>
                      {!notification.is_read && (
                        <span className="px-2 py-1 bg-blue-600 text-white text-xs rounded-full">
                          NEW
                        </span>
                      )}
                    </div>

                    <h3 className="font-semibold text-gray-900 mb-1">{notification.title}</h3>

                    <p className="text-gray-600 mb-2">{notification.message}</p>

                    <div className="flex items-center gap-4">
                      {href && (
                        <Link
                          href={href}
                          className="text-sm text-blue-600 hover:text-blue-800 flex items-center gap-1"
                        >
                          <ExternalLink className="h-3 w-3" />
                          View Details
                        </Link>
                      )}

                      <span className="text-xs text-gray-500">
                        {format(new Date(notification.created_at), 'MMM d, yyyy h:mm a')}
                      </span>
                    </div>
                  </div>

                  <div className="flex items-center gap-2 ml-4">
                    {!notification.is_read && (
                      <button
                        onClick={() => markAsRead(notification.id)}
                        className="p-2 text-gray-500 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors"
                        title="Mark as read"
                      >
                        <Check className="h-4 w-4" />
                      </button>
                    )}

                    <button
                      onClick={() => deleteNotification(notification.id)}
                      className="p-2 text-gray-500 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors"
                      title="Delete notification"
                    >
                      <Trash2 className="h-4 w-4" />
                    </button>
                  </div>
                </div>
              </div>
            );
          })}
        </div>
      )}
    </div>
  );
}
</file>

<file path="app/[locale]/(dashboard)/profile/edit/page.tsx">
'use client';

import {useEffect, useMemo, useState} from 'react';
import {createClient} from '@/lib/supabase/client';
import {usePathname, useRouter} from 'next/navigation';
import {ArrowLeft, Save} from 'lucide-react';

interface Profile {
  id: string;
  full_name: string;
  email?: string;
  age_group?: string;
  skill_level?: string;
  position?: string;
  area?: string;
  years_playing?: number;
  phone?: string;
  jersey_number?: string;
  preferred_shot?: string;
  bio?: string;
}

export default function EditProfilePage() {
  const router = useRouter();
  const pathname = usePathname();
  const supabase = createClient();

  // Derive locale from the first path segment: /{locale}/...
  const locale = useMemo(() => (pathname?.split('/')?.[1] || '').trim(), [pathname]);
  const withLocale = (p: string) => `/${locale || ''}${p}`.replace('//', '/');

  const [profile, setProfile] = useState<Profile | null>(null);
  const [loading, setLoading] = useState(true);
  const [saving, setSaving] = useState(false);
  const [message, setMessage] = useState<{type: 'success' | 'error'; text: string} | null>(null);

  useEffect(() => {
    loadProfile();
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, []);

  async function loadProfile() {
    try {
      const {
        data: {user}
      } = await supabase.auth.getUser();

      if (!user) {
        // Localized redirect to login
        router.push(withLocale('/login'));
        return;
      }

      const {data, error} = await supabase
        .from('profiles')
        .select('*')
        .eq('id', user.id)
        .single();

      if (error) throw error;

      setProfile(data);
    } catch (error) {
      console.error('Error loading profile:', error);
      setMessage({type: 'error', text: 'Failed to load profile'});
    } finally {
      setLoading(false);
    }
  }

  async function handleSubmit(e: React.FormEvent) {
    e.preventDefault();
    if (!profile) return;

    setSaving(true);
    setMessage(null);

    try {
      const {error} = await supabase
        .from('profiles')
        .update({
          full_name: profile.full_name,
          age_group: profile.age_group,
          skill_level: profile.skill_level,
          position: profile.position,
          area: profile.area,
          years_playing: profile.years_playing,
          phone: profile.phone,
          jersey_number: profile.jersey_number,
          preferred_shot: profile.preferred_shot,
          bio: profile.bio
        })
        .eq('id', profile.id);

      if (error) throw error;

      setMessage({type: 'success', text: 'Profile updated successfully!'});
      // Localized redirect after successful save
      setTimeout(() => {
        router.push(withLocale('/profile'));
      }, 1500);
    } catch (error: any) {
      console.error('Error updating profile:', error);
      setMessage({type: 'error', text: error.message || 'Failed to update profile'});
    } finally {
      setSaving(false);
    }
  }

  if (loading) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
      </div>
    );
  }

  if (!profile) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <div className="text-center">
          <p className="text-gray-500">Profile not found</p>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gray-50 py-8">
      <div className="max-w-2xl mx-auto px-4 sm:px-6 lg:px-8">
        {/* Header */}
        <div className="mb-8">
          <button
            onClick={() => router.push(withLocale('/profile'))}
            className="flex items-center text-gray-600 hover:text-gray-900 mb-4"
          >
            <ArrowLeft className="h-4 w-4 mr-2" />
            Back to Profile
          </button>
          <h1 className="text-3xl font-bold text-gray-900">Edit Profile</h1>
          <p className="mt-2 text-gray-600">Update your hockey profile information</p>
        </div>

        {/* Message */}
        {message && (
          <div
            className={`mb-6 p-4 rounded-lg ${
              message.type === 'success'
                ? 'bg-green-50 text-green-800 border border-green-200'
                : 'bg-red-50 text-red-800 border border-red-200'
            }`}
          >
            {message.text}
          </div>
        )}

        {/* Form */}
        <form onSubmit={handleSubmit} className="space-y-6">
          {/* Basic Information */}
          <div className="bg-white shadow rounded-lg p-6">
            <h2 className="text-lg font-semibold text-gray-900 mb-4">Basic Information</h2>

            <div className="space-y-4">
              <div>
                <label className="block text-sm font-medium text-gray-700">Full Name *</label>
                <input
                  type="text"
                  required
                  className="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                  value={profile.full_name || ''}
                  onChange={e => setProfile({...profile, full_name: e.target.value})}
                />
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700">Phone Number</label>
                <input
                  type="tel"
                  className="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                  placeholder="(613) 555-0100"
                  value={profile.phone || ''}
                  onChange={e => setProfile({...profile, phone: e.target.value})}
                />
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700">Area/Location *</label>
                <select
                  required
                  className="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md"
                  value={profile.area || ''}
                  onChange={e => setProfile({...profile, area: e.target.value})}
                >
                  <option value="">Select your area</option>
                  <option value="Downtown Ottawa">Downtown Ottawa</option>
                  <option value="Ottawa East">Ottawa East</option>
                  <option value="Ottawa West">Ottawa West</option>
                  <option value="Ottawa South">Ottawa South</option>
                  <option value="Kanata">Kanata</option>
                  <option value="Nepean">Nepean</option>
                  <option value="Orleans">Orleans</option>
                  <option value="Gloucester">Gloucester</option>
                  <option value="Barrhaven">Barrhaven</option>
                  <option value="Stittsville">Stittsville</option>
                </select>
              </div>
            </div>
          </div>

          {/* Hockey Information */}
          <div className="bg-white shadow rounded-lg p-6">
            <h2 className="text-lg font-semibold text-gray-900 mb-4">Hockey Information</h2>

            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label className="block text-sm font-medium text-gray-700">Age Group *</label>
                <select
                  required
                  className="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md"
                  value={profile.age_group || ''}
                  onChange={e => setProfile({...profile, age_group: e.target.value})}
                >
                  <option value="">Select age group</option>
                  <option value="U7">U7</option>
                  <option value="U9">U9</option>
                  <option value="U11">U11</option>
                  <option value="U13">U13</option>
                  <option value="U15">U15</option>
                  <option value="U18">U18</option>
                  <option value="Adult">Adult</option>
                </select>
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700">Skill Level *</label>
                <select
                  required
                  className="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md"
                  value={profile.skill_level || ''}
                  onChange={e => setProfile({...profile, skill_level: e.target.value})}
                >
                  <option value="">Select skill level</option>
                  <option value="AAA">AAA</option>
                  <option value="AA">AA</option>
                  <option value="A">A</option>
                  <option value="B">B</option>
                  <option value="C">C</option>
                  <option value="House League">House League</option>
                  <option value="Beginner">Beginner</option>
                </select>
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700">Position *</label>
                <select
                  required
                  className="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md"
                  value={profile.position || ''}
                  onChange={e => setProfile({...profile, position: e.target.value})}
                >
                  <option value="">Select position</option>
                  <option value="Forward">Forward</option>
                  <option value="Defense">Defense</option>
                  <option value="Goalie">Goalie</option>
                  <option value="Any">Any Position</option>
                </select>
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700">Preferred Shot</label>
                <select
                  className="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md"
                  value={profile.preferred_shot || ''}
                  onChange={e => setProfile({...profile, preferred_shot: e.target.value})}
                >
                  <option value="">Select</option>
                  <option value="Left">Left</option>
                  <option value="Right">Right</option>
                </select>
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700">Years Playing</label>
                <input
                  type="number"
                  min="0"
                  max="50"
                  className="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                  value={profile.years_playing || 0}
                  onChange={e =>
                    setProfile({...profile, years_playing: parseInt(e.target.value) || 0})
                  }
                />
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700">Jersey Number</label>
                <input
                  type="text"
                  maxLength={3}
                  className="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                  placeholder="99"
                  value={profile.jersey_number || ''}
                  onChange={e => setProfile({...profile, jersey_number: e.target.value})}
                />
              </div>
            </div>
          </div>

            {/* Bio */}
          <div className="bg-white shadow rounded-lg p-6">
            <h2 className="text-lg font-semibold text-gray-900 mb-4">About You</h2>
            <textarea
              rows={4}
              className="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
              placeholder="Tell us about your hockey experience, favorite teams, or anything else..."
              value={profile.bio || ''}
              onChange={e => setProfile({...profile, bio: e.target.value})}
            />
          </div>

          {/* Submit Buttons */}
          <div className="flex justify-end space-x-4">
            <button
              type="button"
              onClick={() => router.push(withLocale('/profile'))}
              className="px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
            >
              Cancel
            </button>
            <button
              type="submit"
              disabled={saving}
              className="flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:bg-gray-400"
            >
              <Save className="h-4 w-4 mr-2" />
              {saving ? 'Saving...' : 'Save Changes'}
            </button>
          </div>
        </form>
      </div>
    </div>
  );
}
</file>

<file path="app/globals.css">
@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  :root {
    --background: 0 0% 100%;
    --foreground: 222.2 84% 4.9%;
    --card: 0 0% 100%;
    --card-foreground: 222.2 84% 4.9%;
    --popover: 0 0% 100%;
    --popover-foreground: 222.2 84% 4.9%;
    --primary: 221.2 83.2% 53.3%;
    --primary-foreground: 210 40% 98%;
    --secondary: 210 40% 96.1%;
    --secondary-foreground: 222.2 47.4% 11.2%;
    --muted: 210 40% 96.1%;
    --muted-foreground: 215.4 16.3% 46.9%;
    --accent: 210 40% 96.1%;
    --accent-foreground: 222.2 47.4% 11.2%;
    --destructive: 0 84.2% 60.2%;
    --destructive-foreground: 210 40% 98%;
    --border: 214.3 31.8% 91.4%;
    --input: 214.3 31.8% 91.4%;
    --ring: 221.2 83.2% 53.3%;
    --radius: 0.75rem;
  }

  .dark {
    --background: 222.2 84% 4.9%;
    --foreground: 210 40% 98%;
    --card: 222.2 84% 4.9%;
    --card-foreground: 210 40% 98%;
    --popover: 222.2 84% 4.9%;
    --popover-foreground: 210 40% 98%;
    --primary: 217.2 91.2% 59.8%;
    --primary-foreground: 222.2 47.4% 11.2%;
    --secondary: 217.2 32.6% 17.5%;
    --secondary-foreground: 210 40% 98%;
    --muted: 217.2 32.6% 17.5%;
    --muted-foreground: 215 20.2% 65.1%;
    --accent: 217.2 32.6% 17.5%;
    --accent-foreground: 210 40% 98%;
    --destructive: 0 62.8% 30.6%;
    --destructive-foreground: 210 40% 98%;
    --border: 217.2 32.6% 17.5%;
    --input: 217.2 32.6% 17.5%;
    --ring: 224.3 76.3% 48%;
  }
}

@layer base {
  * {
    @apply border-border;
  }
  body {
    @apply bg-background text-foreground;
    font-synthesis-weight: none;
    text-rendering: optimizeLegibility;
  }
}

@layer components {
  /* ÁéªÁíÉÊÄÅÊïàÊûú */
  .glass {
    @apply bg-white/70 backdrop-blur-xl border border-white/20 shadow-xl;
  }
  
  .glass-dark {
    @apply bg-gray-900/70 backdrop-blur-xl border border-gray-700/20 shadow-xl;
  }
  
  /* Ê∏êÂèòÊñáÂ≠ó */
  .gradient-text {
    @apply bg-clip-text text-transparent bg-gradient-to-r from-blue-600 to-cyan-500;
  }
  
  /* ÊÇ¨ÊµÆÂç°ÁâáÊïàÊûú */
  .hover-card {
    @apply transition-all duration-300 hover:scale-105 hover:shadow-2xl;
  }
  
  /* ÂÜ∞ÁêÉ‰∏ªÈ¢òÊåâÈíÆ */
  .btn-hockey {
    @apply relative px-6 py-3 font-semibold text-white bg-gradient-to-r from-blue-600 to-cyan-500 rounded-lg 
           hover:from-blue-700 hover:to-cyan-600 transition-all duration-300 
           hover:shadow-lg hover:-translate-y-0.5 active:translate-y-0;
  }
  
  /* Âä†ËΩΩÈ™®Êû∂Â±è */
  .skeleton {
    @apply animate-pulse bg-gray-200 rounded;
  }
  
  /* ÂàÜÂâ≤Á∫øÊ†∑Âºè */
  .divider {
    @apply relative my-8;
  }
  
  .divider::before {
    @apply content-[''] absolute inset-0 flex items-center;
  }
  
  .divider::before {
    @apply border-t border-gray-200;
  }
  
  /* ÂæΩÁ´†Âèò‰Ωì */
  .badge-success {
    @apply bg-green-100 text-green-800 border-green-200;
  }
  
  .badge-warning {
    @apply bg-yellow-100 text-yellow-800 border-yellow-200;
  }
  
  .badge-error {
    @apply bg-red-100 text-red-800 border-red-200;
  }
  
  .badge-info {
    @apply bg-blue-100 text-blue-800 border-blue-200;
  }
  
  /* ËæìÂÖ•Ê°ÜÁÑ¶ÁÇπÊïàÊûú */
  .input-focus {
    @apply focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200;
  }
  
  /* ÁΩëÊ†ºËÉåÊôØ */
  .grid-background {
    background-image: 
      linear-gradient(rgba(59, 130, 246, 0.1) 1px, transparent 1px),
      linear-gradient(90deg, rgba(59, 130, 246, 0.1) 1px, transparent 1px);
    background-size: 50px 50px;
  }
  
  /* Âä®ÁîªÂª∂ËøüÁ±ª */
  .animation-delay-100 {
    animation-delay: 100ms;
  }
  
  .animation-delay-200 {
    animation-delay: 200ms;
  }
  
  .animation-delay-300 {
    animation-delay: 300ms;
  }
  
  .animation-delay-400 {
    animation-delay: 400ms;
  }
  
  .animation-delay-500 {
    animation-delay: 500ms;
  }
}

@layer utilities {
  /* ÊñáÂ≠óÈò¥ÂΩ± */
  .text-shadow {
    text-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }
  
  .text-shadow-lg {
    text-shadow: 0 4px 8px rgba(0,0,0,0.15);
  }
  
  /* ÊªöÂä®Êù°Ê†∑Âºè */
  .scrollbar-thin {
    scrollbar-width: thin;
    scrollbar-color: rgb(203 213 225) transparent;
  }
  
  .scrollbar-thin::-webkit-scrollbar {
    width: 6px;
    height: 6px;
  }
  
  .scrollbar-thin::-webkit-scrollbar-track {
    background: transparent;
  }
  
  .scrollbar-thin::-webkit-scrollbar-thumb {
    @apply bg-gray-300 rounded-full;
  }
  
  .scrollbar-thin::-webkit-scrollbar-thumb:hover {
    @apply bg-gray-400;
  }
  
  /* Á¶ÅÁî®ÈÄâÊã© */
  .no-select {
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
  }
  
  /* Êà™Êñ≠ÊñáÊú¨ */
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  
  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
}

/* Ëá™ÂÆö‰πâÂä®Áîª */
@keyframes float-slow {
  0%, 100% {
    transform: translateY(0px);
  }
  50% {
    transform: translateY(-20px);
  }
}

@keyframes gradient-shift {
  0% {
    background-position: 0% 50%;
  }
  50% {
    background-position: 100% 50%;
  }
  100% {
    background-position: 0% 50%;
  }
}

/* ÂÜ∞ÁêÉ‰∏ªÈ¢òÂä®ÁîªËÉåÊôØ */
.animated-gradient {
  background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
  background-size: 400% 400%;
  animation: gradient-shift 15s ease infinite;
}

/* Âπ≥ÊªëÊªöÂä® */
html {
  scroll-behavior: smooth;
}

/* ÁßªÂä®Á´ØËß¶Êë∏‰ºòÂåñ */
@media (hover: none) {
  .hover-card:active {
    transform: scale(0.98);
  }
}

/* ÊâìÂç∞Ê†∑Âºè */
@media print {
  .no-print {
    display: none !important;
  }
}

/* Âä†ËΩΩÂä®Áîª */
.loader {
  width: 48px;
  height: 48px;
  border: 5px solid #FFF;
  border-bottom-color: #3b82f6;
  border-radius: 50%;
  display: inline-block;
  box-sizing: border-box;
  animation: rotation 1s linear infinite;
}

@keyframes rotation {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}

/* ÂìçÂ∫îÂºèÊñáÂ≠óÂ§ßÂ∞è */
@media (max-width: 640px) {
  html {
    font-size: 14px;
  }
}

/* ÁÑ¶ÁÇπÂèØËßÅÊÄß */
:focus-visible {
  @apply outline-none ring-2 ring-primary ring-offset-2;
}

/* ÈÄâ‰∏≠ÊñáÊú¨Ê†∑Âºè */
::selection {
  @apply bg-blue-500/20 text-blue-900;
}

/* Logo ËΩªÂæÆÊµÆÂä®Âä®Áîª */
@keyframes logo-float {
  0%   { transform: translateY(0px);   box-shadow: 0 8px 20px rgba(56,189,248,.35); }
  50%  { transform: translateY(-1.5px); box-shadow: 0 12px 24px rgba(56,189,248,.45); }
  100% { transform: translateY(0px);   box-shadow: 0 8px 20px rgba(56,189,248,.35); }
}

.logo-float {
  animation: logo-float 3s ease-in-out infinite;
}

/* Logo ÊÇ¨ÂÅúÊµÆËµ∑/ÂèëÂÖâ */
.logo-float{
  will-change: transform, box-shadow;
}
.group:hover .logo-float{
  transform: translateY(-2px) scale(1.04);
  box-shadow:
    0 10px 24px rgba(56,189,248,.35),
    0 2px 6px rgba(2,132,199,.25);
}
</file>

<file path="components/LocaleSwitcher.tsx">
'use client';

import {usePathname, useRouter, useSearchParams} from 'next/navigation';
import {Globe} from 'lucide-react';
import {locales as SUPPORTED_LIST} from '@/i18n';

const SUPPORTED = new Set(SUPPORTED_LIST as readonly string[]);
const DEFAULT_LOCALE = 'en';

function buildPathWithLocale(pathname: string, newLocale: string): string {
  const path = pathname || '/';
  const segs = path.split('/'); // ‰øùÁïôÁ©∫ÊÆµÔºå‰ªéËÄå se gs[1] ÊòØÁ¨¨‰∏ÄÂ±Ç
  const first = segs[1] ?? '';

  if (SUPPORTED.has(first as any)) {
    segs[1] = newLocale;            // /en/... -> /fr/...
  } else {
    segs.splice(1, 0, newLocale);   // /about -> /fr/about
  }
  const joined = segs.join('/').replace(/\/{2,}/g, '/');
  return joined.endsWith('/') && joined !== '/' ? joined.slice(0, -1) : joined;
}

export default function LocaleSwitcher() {
  const pathname = usePathname();
  const search = useSearchParams();
  const router = useRouter();

  const currentLocale = (() => {
    const first = pathname?.split('/').filter(Boolean)[0];
    return (first && SUPPORTED.has(first as any)) ? (first as string) : DEFAULT_LOCALE;
  })();

  const switchLocale = (newLocale: string) => {
    if (!pathname || newLocale === currentLocale) return;
    const base = buildPathWithLocale(pathname, newLocale);
    const qs = search?.toString();
    const url = qs ? `${base}?${qs}` : base;
    router.push(url); // Êàñ replace(url) ‰πüÂèØ‰ª•
  };

  return (
    <div
      className="inline-flex items-center rounded-full border border-slate-300 bg-white px-1 py-1"
      role="group"
      aria-label="Locale switcher"
    >
      <Globe className="h-4 w-4 mx-2 text-slate-500" aria-hidden />
      {SUPPORTED_LIST.map(code => {
        const active = code === currentLocale;
        return (
          <button
            key={code}
            onClick={() => switchLocale(code)}
            className={[
              'h-8 min-w-10 px-3 rounded-full text-sm transition',
              active
                ? 'bg-sky-600 text-white shadow'
                : 'text-slate-700 hover:bg-slate-100'
            ].join(' ')}
            aria-pressed={active}
            aria-current={active ? 'true' : undefined}
            type="button"
          >
            {code.toUpperCase()}
          </button>
        );
      })}
    </div>
  );
}
</file>

<file path="components/rating/RatingStars.tsx">
'use client'

import { Star } from 'lucide-react'

interface RatingStarsProps {
  rating: number
  onChange?: (rating: number) => void
  readonly?: boolean
  size?: 'sm' | 'md' | 'lg'
  showNumber?: boolean  // Add this line
}

export default function RatingStars({ 
  rating, 
  onChange, 
  readonly = false, 
  size = 'md',
  showNumber = false  // Add this parameter
}: RatingStarsProps) {
  const sizes = {
    sm: 'h-4 w-4',
    md: 'h-5 w-5',
    lg: 'h-6 w-6'
  }

  return (
    <div className="flex items-center gap-2">
      <div className="flex gap-1">
        {[1, 2, 3, 4, 5].map((star) => (
          <Star
            key={star}
            className={`${sizes[size]} ${
              star <= rating 
                ? 'fill-yellow-400 text-yellow-400' 
                : 'text-gray-300'
            } ${!readonly && 'cursor-pointer hover:text-yellow-400'}`}
            onClick={() => !readonly && onChange?.(star)}
          />
        ))}
      </div>
      {showNumber && (
        <span className="text-sm text-gray-600">{rating.toFixed(1)}</span>
      )}
    </div>
  )
}
</file>

<file path="i18n.ts">
// i18n.ts
import {getRequestConfig} from 'next-intl/server';

// ===== Êñ∞Â¢û/Ë°•ÂÖÖÔºöÂëΩÂêçÂØºÂá∫Ôºå‰æõÂÆ¢Êà∑Á´ØÁªÑ‰ª∂Â§çÁî® =====
export const locales = ['en', 'fr'] as const;
export type Locale = typeof locales[number];
export const defaultLocale: Locale = 'en';
export const isSupportedLocale = (l: string): l is Locale =>
  (locales as readonly string[]).includes(l);

// ===== ‰øùÁïôÔºödefault ÂØºÂá∫Áªô next-intl Áî® =====
export default getRequestConfig(async ({locale}) => {
  const validLocale = isSupportedLocale(locale as string) ? (locale as Locale) : defaultLocale;
  return {
    locale: validLocale, // ÂÖ≥ÈîÆ
    messages: (await import(`./messages/${validLocale}.json`)).default
  };
});
</file>

<file path="lib/supabase/service.ts">
import { createClient as createSupabaseClient } from '@supabase/supabase-js'

export function createServiceClient() {
  const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!
  const supabaseServiceKey = process.env.SUPABASE_SERVICE_KEY!
  
  if (!supabaseServiceKey) {
    throw new Error('SUPABASE_SERVICE_KEY is required for service client')
  }
  
  return createSupabaseClient(supabaseUrl, supabaseServiceKey, {
    auth: {
      autoRefreshToken: false,
      persistSession: false
    }
  })
}
</file>

<file path="messages/en.json">
{
  "nav": {
    "home": "Home",
    "dashboard": "Dashboard",
    "games": "Find Games",
    "rinks": "Ice Rinks",
    "clubs": "Clubs",
    "profile": "Profile",
    "settings": "Settings",
    "notifications": "Notifications",
    "logout": "Sign Out",
    "login": "Sign In",
    "register": "Get Started"
  },
  "actions": {
    "join": "Post Game",
    "book": "Book",
    "rent": "Rent",
    "pay": "Pay",
    "edit": "Edit",
    "delete": "Delete",
    "cancel": "Cancel",
    "save": "Save",
    "search": "Search",
    "filter": "Filter"
  },
  "common": {
    "loading": "Loading...",
    "error": "Something went wrong",
    "success": "Success!",
    "confirm": "Are you sure?",
    "yes": "Yes",
    "no": "No",
    "close": "Close",
    "back": "Back",
    "next": "Next",
    "submit": "Submit"
  },
  "games": {
    "title": "Available Games",
    "noGames": "No games available",
    "ageGroup": "Age Group",
    "skillLevel": "Skill Level",
    "location": "Location",
    "date": "Date",
    "time": "Time",
    "contact": "Contact",
    "maxPlayers": "Max Players",
    "currentPlayers": "Current Players",
    "description": "Description"
  },
  "errors": {
    "notFound": "Page not found",
    "serverError": "Server error",
    "networkError": "Network error",
    "unauthorized": "Unauthorized access",
    "forbidden": "Access forbidden"
  }
}
</file>

<file path="messages/fr.json">
{
  "nav": {
    "home": "Accueil",
    "dashboard": "Tableau de bord",
    "games": "Trouver des matchs",
    "rinks": "Patinoires",
    "clubs": "Clubs",
    "profile": "Profil",
    "settings": "Param√®tres",
    "notifications": "Notifications",
    "logout": "D√©connexion",
    "login": "Connexion",
    "register": "Commencer"
  },
  "actions": {
    "join": "Publier un match",
    "book": "R√©server",
    "rent": "Louer",
    "pay": "Payer",
    "edit": "Modifier",
    "delete": "Supprimer",
    "cancel": "Annuler",
    "save": "Enregistrer",
    "search": "Rechercher",
    "filter": "Filtrer"
  },
  "common": {
    "loading": "Chargement...",
    "error": "Une erreur s'est produite",
    "success": "Succ√®s !",
    "confirm": "√ätes-vous s√ªr ?",
    "yes": "Oui",
    "no": "Non",
    "close": "Fermer",
    "back": "Retour",
    "next": "Suivant",
    "submit": "Soumettre"
  },
  "games": {
    "title": "Matchs disponibles",
    "noGames": "Aucun match disponible",
    "ageGroup": "Groupe d'√¢ge",
    "skillLevel": "Niveau de comp√©tence",
    "location": "Lieu",
    "date": "Date",
    "time": "Heure",
    "contact": "Contact",
    "maxPlayers": "Joueurs maximum",
    "currentPlayers": "Joueurs actuels",
    "description": "Description"
  },
  "errors": {
    "notFound": "Page introuvable",
    "serverError": "Erreur du serveur",
    "networkError": "Erreur r√©seau",
    "unauthorized": "Acc√®s non autoris√©",
    "forbidden": "Acc√®s interdit"
  }
}
</file>

<file path="messages/hi.json">
{
  "nav": {
    "home": "‡§π‡•ã‡§Æ",
    "rinks": "‡§∞‡§ø‡§Ç‡§ï",
    "games": "‡§ó‡•á‡§Æ‡•ç‡§∏",
    "coaches": "‡§ï‡•ã‡§ö",
    "equipment": "‡§â‡§™‡§ï‡§∞‡§£",
    "login": "‡§≤‡•â‡§ó ‡§á‡§®",
    "signup": "‡§∏‡§æ‡§á‡§® ‡§Ö‡§™",
    "clubs": "‡§ï‡•ç‡§≤‡§¨‡•ç‡§∏",
    "profile": "‡§™‡•ç‡§∞‡•ã‡§´‡§º‡§æ‡§á‡§≤",
    "notifications": "‡§∏‡•Ç‡§ö‡§®‡§æ‡§è‡§Å",
    "logout": "‡§≤‡•â‡§ó ‡§Ü‡§â‡§ü",
    "settings": "‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§∏"
  },
  "actions": { "join": "‡§ó‡•á‡§Æ ‡§™‡•ã‡§∏‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç", "book": "‡§¨‡•Å‡§ï", "rent": "‡§ï‡§ø‡§∞‡§æ‡§è ‡§™‡§∞ ‡§≤‡•á‡§Ç", "pay": "‡§≠‡•Å‡§ó‡§§‡§æ‡§®" },
  "onboarding": { "title": "‡§®‡§è ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ‡§ì‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ó‡§æ‡§á‡§°", "stepRole": "‡§Ö‡§™‡§®‡•Ä ‡§≠‡•Ç‡§Æ‡§ø‡§ï‡§æ ‡§ö‡•Å‡§®‡•á‡§Ç", "stepLang": "‡§≠‡§æ‡§∑‡§æ ‡§ö‡•Å‡§®‡•á‡§Ç", "stepCity": "‡§∂‡§π‡§∞ ‡§∏‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç" }
}
</file>

<file path="messages/zh.json">
{
  "nav": {
    "home": "È¶ñÈ°µ",
    "rinks": "ÂÜ∞Âú∫",
    "games": "ÊØîËµõ",
    "coaches": "ÊïôÁªÉ",
    "equipment": "Ë£ÖÂ§á",
    "login": "ÁôªÂΩï",
    "signup": "Ê≥®ÂÜå",
    "clubs": "‰ø±‰πêÈÉ®",
    "profile": "ÊàëÁöÑËµÑÊñô",
    "notifications": "ÈÄöÁü•",
    "logout": "ÈÄÄÂá∫",
    "settings": "ËÆæÁΩÆ"
  },
  "actions": { "join": "ÂèëÂ∏ÉÊØîËµõ", "book": "È¢ÑËÆ¢", "rent": "ÁßüÂÄü", "pay": "ÊîØ‰ªò" },
  "onboarding": { "title": "Êñ∞ÊâãÊåáÂçó", "stepRole": "ÈÄâÊã©‰Ω†ÁöÑËßíËâ≤", "stepLang": "ÈÄâÊã©ËØ≠Ë®Ä", "stepCity": "ËÆæÁΩÆÂüéÂ∏Ç" }
}
</file>

<file path="app/(dashboard)/bookings/page.tsx">
// app/(dashboard)/bookings/page.tsx
'use client';

import {useCallback, useEffect, useMemo, useState} from 'react';
import {createClient} from '@/lib/supabase/client';
import Link from 'next/link';
import {usePathname, useRouter} from 'next/navigation';
import {formatCurrency, formatDate} from '@/lib/utils/format';

/**
 * Bookings list page
 * - Derive locale from pathname and localize internal links.
 * - Require auth: redirect unauthenticated users to /{locale}/login.
 * - Wrap fetchBookings with useCallback and include in useEffect deps.
 */
export default function BookingsPage() {
  const [bookings, setBookings] = useState<any[]>([]);
  const [loading, setLoading] = useState(true);

  const pathname = usePathname();
  const router = useRouter();

  // Derive locale from the first path segment: /{locale}/...
  const locale = useMemo(() => (pathname?.split('/')?.[1] || '').trim(), [pathname]);

  // Helper to build a locale-prefixed path
  const withLocale = (p: string) => `/${locale || ''}${p}`.replace('//', '/');

  const fetchBookings = useCallback(async () => {
    const supabase = createClient();

    // Auth check: redirect to localized login when no user
    const {
      data: {user},
    } = await supabase.auth.getUser();
    if (!user) {
      router.push(withLocale('/login'));
      setLoading(false);
      return;
    }

    const {data, error} = await supabase
      .from('bookings')
      .select(
        `
        *,
        rinks (name, address)
      `
      )
      // Show only current user's bookings (keeps intent of "My Bookings")
      .eq('user_id', user.id)
      .order('booking_date', {ascending: true});

    if (error) {
      console.error('Failed to load bookings:', error);
      setBookings([]);
    } else {
      setBookings(data || []);
    }
    setLoading(false);
  }, [router, locale]); // locale affects redirect target

  useEffect(() => {
    fetchBookings();
  }, [fetchBookings]);

  if (loading) {
    return (
      <div className="flex items-center justify-center min-h-[40vh]">
        <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
      </div>
    );
  }

  return (
    <div className="container mx-auto px-4 py-8">
      <div className="flex items-center justify-between mb-6">
        <h1 className="text-3xl font-bold">My Bookings</h1>
      </div>

      {bookings.length === 0 ? (
        <div className="bg-white rounded-lg shadow p-8 text-center">
          <p className="text-gray-500 mb-4">No bookings yet.</p>
        </div>
      ) : (
        <div className="grid gap-4">
          {bookings.map((b) => (
            <Link
              key={b.id}
              href={withLocale(`/bookings/${b.id}`)}
              className="bg-white rounded-lg shadow p-6 hover:shadow-md transition"
            >
              <div className="flex items-start justify-between">
                <div>
                  <h3 className="text-xl font-semibold">{b.rinks?.name ?? 'Rink'}</h3>
                  <p className="text-gray-600 mt-1">
                    üìÖ {formatDate(b.booking_date)} ‚Äî {b.start_time} ~ {b.end_time}
                  </p>
                  <p className="text-gray-600">{b.rinks?.address}</p>
                </div>
                <div className="text-right">
                  <div className="text-sm text-gray-600 mb-1">Total</div>
                  <div className="font-bold">{formatCurrency(b.total)}</div>
                </div>
              </div>
            </Link>
          ))}
        </div>
      )}
    </div>
  );
}
</file>

<file path="app/(dashboard)/my-games/page.tsx">
'use client';

import { useEffect, useState } from 'react';
import { createClient } from '@/lib/supabase/client';
import Link from 'next/link';
import { useRouter } from 'next/navigation';
import { 
  Calendar, 
  MapPin, 
  Users, 
  Eye, 
  Heart, 
  Edit, 
  X,
  Plus,
  Trophy,
  Clock,
  CheckCircle,
  AlertCircle,
  Edit2
} from 'lucide-react';

interface Game {
  id: string;
  title: string;
  game_date: string;
  game_time: string;
  location: string;
  age_group: string;
  skill_level: string;
  description: string;
  status: string;
  view_count: number;
  interested_count: number;
  created_at: string;
}

interface GameInterest {
  id: string;
  game_id: string;
  user_id: string;
  status: string;
  created_at: string;
  game_invitations: Game;
}

interface Stats {
  total: number;
  open: number;
  matched: number;
  cancelled: number;
  totalViews: number;
  totalInterested: number;
}

export default function MyGamesPage() {
  const [games, setGames] = useState<Game[]>([]);
  const [interestedGames, setInterestedGames] = useState<GameInterest[]>([]);
  const [loading, setLoading] = useState(true);
  const [stats, setStats] = useState<Stats>({
    total: 0,
    open: 0,
    matched: 0,
    cancelled: 0,
    totalViews: 0,
    totalInterested: 0
  });
  const [filter, setFilter] = useState<'all' | 'open' | 'matched' | 'cancelled'>('all');
  const [activeTab, setActiveTab] = useState<'posted' | 'interested'>('posted');
  
  const router = useRouter();
  const supabase = createClient();

  useEffect(() => {
    loadMyGames();
  }, []);

  async function loadMyGames() {
    try {
      const { data: { user } } = await supabase.auth.getUser();
      if (!user) {
        router.push('/login');
        return;
      }

      // Load posted games
      const { data, error } = await supabase
        .from('game_invitations')
        .select('*')
        .eq('created_by', user.id)
        .order('created_at', { ascending: false });

      // Load interested games
      const { data: interests, error: interestError } = await supabase
        .from('game_interests')
        .select(`
          *,
          game_invitations (*)
        `)
        .eq('user_id', user.id)
        .order('created_at', { ascending: false });

      if (error) throw error;

      const gamesData = data || [];
      setGames(gamesData);
      setInterestedGames(interests || []);

      // Calculate stats for posted games
      const statsData = {
        total: gamesData.length,
        open: gamesData.filter(g => g.status === 'open').length,
        matched: gamesData.filter(g => g.status === 'matched').length,
        cancelled: gamesData.filter(g => g.status === 'cancelled').length,
        totalViews: gamesData.reduce((sum, g) => sum + (g.view_count || 0), 0),
        totalInterested: gamesData.reduce((sum, g) => sum + (g.interested_count || 0), 0)
      };
      setStats(statsData);

    } catch (error) {
      console.error('Error loading games:', error);
    } finally {
      setLoading(false);
    }
  }

  async function updateGameStatus(gameId: string, newStatus: string) {
    try {
      const { error } = await supabase
        .from('game_invitations')
        .update({ status: newStatus })
        .eq('id', gameId);

      if (error) throw error;

      loadMyGames();
      
      if (newStatus === 'cancelled') {
        alert('Game cancelled successfully');
      } else if (newStatus === 'matched') {
        alert('Game marked as matched');
      }
    } catch (error) {
      console.error('Error updating game:', error);
      alert('Failed to update game status');
    }
  }

  async function deleteGame(gameId: string) {
    if (!confirm('Are you sure you want to delete this game? This action cannot be undone.')) {
      return;
    }

    try {
      const { error } = await supabase
        .from('game_invitations')
        .delete()
        .eq('id', gameId);

      if (error) throw error;

      loadMyGames();
      alert('Game deleted successfully');
    } catch (error) {
      console.error('Error deleting game:', error);
      alert('Failed to delete game');
    }
  }

  async function removeInterest(interestId: string) {
    if (!confirm('Remove your interest in this game?')) {
      return;
    }

    try {
      const { error } = await supabase
        .from('game_interests')
        .delete()
        .eq('id', interestId);

      if (error) throw error;

      loadMyGames();
    } catch (error) {
      console.error('Error removing interest:', error);
      alert('Failed to remove interest');
    }
  }

  function formatDate(dateStr: string) {
    if (!dateStr) return 'TBD';
    const date = new Date(dateStr);
    const today = new Date();
    const diffTime = date.getTime() - today.getTime();
    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
    
    let relativeTime = '';
    if (diffDays === 0) relativeTime = ' (Today)';
    else if (diffDays === 1) relativeTime = ' (Tomorrow)';
    else if (diffDays === -1) relativeTime = ' (Yesterday)';
    else if (diffDays < -1) relativeTime = ` (${Math.abs(diffDays)} days ago)`;
    else if (diffDays > 1 && diffDays <= 7) relativeTime = ` (in ${diffDays} days)`;
    
    return new Date(dateStr).toLocaleDateString('en-US', { 
      weekday: 'short',
      month: 'short', 
      day: 'numeric' 
    }) + relativeTime;
  }

  function getStatusBadge(status: string) {
    switch (status) {
      case 'open':
        return <span className="px-2 py-1 text-xs rounded-full bg-green-100 text-green-800">Open</span>;
      case 'matched':
        return <span className="px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-800">Matched</span>;
      case 'cancelled':
        return <span className="px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-800">Cancelled</span>;
      default:
        return <span className="px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-800">{status}</span>;
    }
  }

  const filteredGames = filter === 'all' 
    ? games 
    : games.filter(g => g.status === filter);

  if (loading) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gray-50 py-8">
      <div className="max-w-7xl mx-auto px-4">
        {/* Header */}
        <div className="mb-8 flex justify-between items-center">
          <div>
            <h1 className="text-3xl font-bold text-gray-900">My Games</h1>
            <p className="mt-2 text-gray-600">
              {activeTab === 'posted' ? 'Manage your posted games' : 'Games you\'re interested in'}
            </p>
          </div>
          <Link
            href="/games/new"
            className="flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
          >
            <Plus className="h-5 w-5 mr-2" />
            Post New Game
          </Link>
        </div>

        {/* Main Tabs */}
        <div className="mb-6 flex space-x-1 bg-gray-100 p-1 rounded-lg">
          <button
            onClick={() => setActiveTab('posted')}
            className={`flex-1 py-2 px-4 rounded-md transition ${
              activeTab === 'posted'
                ? 'bg-white text-blue-600 shadow-sm font-medium'
                : 'text-gray-600 hover:text-gray-900'
            }`}
          >
            My Posted Games ({games.length})
          </button>
          <button
            onClick={() => setActiveTab('interested')}
            className={`flex-1 py-2 px-4 rounded-md transition ${
              activeTab === 'interested'
                ? 'bg-white text-blue-600 shadow-sm font-medium'
                : 'text-gray-600 hover:text-gray-900'
            }`}
          >
            Games I'm Interested In ({interestedGames.length})
          </button>
        </div>

        {activeTab === 'posted' ? (
          <>
            {/* Stats Cards - Only for posted games */}
            <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-8">
              <div className="bg-white rounded-lg shadow p-4">
                <div className="text-2xl font-bold text-gray-900">{stats.total}</div>
                <div className="text-sm text-gray-500">Total Games</div>
              </div>
              <div className="bg-white rounded-lg shadow p-4">
                <div className="text-2xl font-bold text-green-600">{stats.open}</div>
                <div className="text-sm text-gray-500">Open</div>
              </div>
              <div className="bg-white rounded-lg shadow p-4">
                <div className="text-2xl font-bold text-blue-600">{stats.matched}</div>
                <div className="text-sm text-gray-500">Matched</div>
              </div>
              <div className="bg-white rounded-lg shadow p-4">
                <div className="text-2xl font-bold text-gray-600">{stats.cancelled}</div>
                <div className="text-sm text-gray-500">Cancelled</div>
              </div>
              <div className="bg-white rounded-lg shadow p-4">
                <div className="text-2xl font-bold text-purple-600">{stats.totalViews}</div>
                <div className="text-sm text-gray-500">Total Views</div>
              </div>
              <div className="bg-white rounded-lg shadow p-4">
                <div className="text-2xl font-bold text-red-600">{stats.totalInterested}</div>
                <div className="text-sm text-gray-500">Total Interested</div>
              </div>
            </div>

            {/* Filter Tabs - Only for posted games */}
            <div className="mb-6 flex space-x-4 border-b">
              <button
                onClick={() => setFilter('all')}
                className={`pb-2 px-1 border-b-2 transition ${
                  filter === 'all' 
                    ? 'border-blue-600 text-blue-600 font-medium' 
                    : 'border-transparent text-gray-500 hover:text-gray-700'
                }`}
              >
                All ({games.length})
              </button>
              <button
                onClick={() => setFilter('open')}
                className={`pb-2 px-1 border-b-2 transition ${
                  filter === 'open' 
                    ? 'border-blue-600 text-blue-600 font-medium' 
                    : 'border-transparent text-gray-500 hover:text-gray-700'
                }`}
              >
                Open ({stats.open})
              </button>
              <button
                onClick={() => setFilter('matched')}
                className={`pb-2 px-1 border-b-2 transition ${
                  filter === 'matched' 
                    ? 'border-blue-600 text-blue-600 font-medium' 
                    : 'border-transparent text-gray-500 hover:text-gray-700'
                }`}
              >
                Matched ({stats.matched})
              </button>
              <button
                onClick={() => setFilter('cancelled')}
                className={`pb-2 px-1 border-b-2 transition ${
                  filter === 'cancelled' 
                    ? 'border-blue-600 text-blue-600 font-medium' 
                    : 'border-transparent text-gray-500 hover:text-gray-700'
                }`}
              >
                Cancelled ({stats.cancelled})
              </button>
            </div>

            {/* Posted Games List */}
            {filteredGames.length > 0 ? (
              <div className="space-y-4">
                {filteredGames.map((game) => (
                  <div key={game.id} className="bg-white rounded-lg shadow hover:shadow-md transition-shadow">
                    <div className="p-6">
                      <div className="flex items-start justify-between">
                        <div className="flex-1">
                          <div className="flex items-center space-x-3 mb-2">
                            <h3 className="text-lg font-semibold text-gray-900">
                              {game.title}
                            </h3>
                            {getStatusBadge(game.status)}
                          </div>

                          <div className="grid md:grid-cols-2 gap-4 text-sm text-gray-600">
                            <div className="space-y-1">
                              <div className="flex items-center">
                                <Calendar className="h-4 w-4 mr-2" />
                                {formatDate(game.game_date)} at {game.game_time || 'TBD'}
                              </div>
                              <div className="flex items-center">
                                <MapPin className="h-4 w-4 mr-2" />
                                {game.location || 'Location TBD'}
                              </div>
                              <div className="flex items-center">
                                <Users className="h-4 w-4 mr-2" />
                                {game.age_group} - {game.skill_level}
                              </div>
                            </div>
                            
                            <div className="space-y-1">
                              <div className="flex items-center">
                                <Eye className="h-4 w-4 mr-2" />
                                {game.view_count || 0} views
                              </div>
                              <div className="flex items-center">
                                <Heart className="h-4 w-4 mr-2" />
                                {game.interested_count || 0} interested
                              </div>
                              <div className="flex items-center">
                                <Clock className="h-4 w-4 mr-2" />
                                Created {new Date(game.created_at).toLocaleDateString()}
                              </div>
                            </div>
                          </div>

                          {game.description && (
                            <p className="mt-3 text-sm text-gray-500 line-clamp-2">
                              {game.description}
                            </p>
                          )}

                          {/* Interest Alert */}
                          {game.interested_count > 0 && game.status === 'open' && (
                            <div className="mt-3 p-2 bg-blue-50 border border-blue-200 rounded text-sm">
                              <AlertCircle className="inline h-4 w-4 text-blue-600 mr-1" />
                              <span className="text-blue-800">
                                {game.interested_count} team{game.interested_count > 1 ? 's are' : ' is'} interested! 
                                <Link href="/notifications" className="ml-2 underline font-medium">
                                  View in notifications
                                </Link>
                              </span>
                            </div>
                          )}
                        </div>

                        {/* Actions */}
                        <div className="ml-4 flex flex-col space-y-2">
                          <Link
                            href={`/games/${game.id}`}
                            className="text-blue-600 hover:text-blue-800 text-sm"
                          >
                            View Details
                          </Link>
                          
                          <Link
                            href={`/games/${game.id}/edit`}
                            className="text-purple-600 hover:text-purple-800 text-sm"
                          >
                            Edit Game
                          </Link>
                          
                          {game.status === 'open' && (
                            <>
                              <button
                                onClick={() => updateGameStatus(game.id, 'matched')}
                                className="text-green-600 hover:text-green-800 text-sm text-left"
                              >
                                Mark as Matched
                              </button>
                              <button
                                onClick={() => updateGameStatus(game.id, 'cancelled')}
                                className="text-orange-600 hover:text-orange-800 text-sm text-left"
                              >
                                Cancel Game
                              </button>
                            </>
                          )}
                          
                          {game.status === 'cancelled' && (
                            <button
                              onClick={() => updateGameStatus(game.id, 'open')}
                              className="text-green-600 hover:text-green-800 text-sm text-left"
                            >
                              Reopen Game
                            </button>
                          )}
                          
                          <button
                            onClick={() => deleteGame(game.id)}
                            className="text-red-600 hover:text-red-800 text-sm text-left"
                          >
                            Delete
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            ) : (
              <div className="text-center py-12 bg-white rounded-lg shadow">
                <Trophy className="mx-auto h-12 w-12 text-gray-400 mb-4" />
                <h3 className="text-lg font-medium text-gray-900 mb-2">
                  {filter === 'all' ? 'No games posted yet' : `No ${filter} games`}
                </h3>
                <p className="text-gray-500 mb-6">Start by posting your first game invitation</p>
                <Link
                  href="/games/new"
                  className="inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700"
                >
                  <Plus className="h-5 w-5 mr-2" />
                  Post Your First Game
                </Link>
              </div>
            )}
          </>
        ) : (
          /* Interested Games Tab */
          <div className="space-y-4">
            {interestedGames.length > 0 ? (
              interestedGames.map((interest) => (
                <div key={interest.id} className="bg-white rounded-lg shadow hover:shadow-md transition-shadow">
                  <div className="p-6">
                    <div className="flex items-start justify-between">
                      <div className="flex-1">
                        <div className="flex items-center space-x-3 mb-2">
                          <h3 className="text-lg font-semibold text-gray-900">
                            {interest.game_invitations?.title}
                          </h3>
                          {getStatusBadge(interest.game_invitations?.status)}
                        </div>

                        <div className="grid md:grid-cols-2 gap-4 text-sm text-gray-600">
                          <div className="space-y-1">
                            <div className="flex items-center">
                              <Calendar className="h-4 w-4 mr-2" />
                              {formatDate(interest.game_invitations?.game_date)} at {interest.game_invitations?.game_time || 'TBD'}
                            </div>
                            <div className="flex items-center">
                              <MapPin className="h-4 w-4 mr-2" />
                              {interest.game_invitations?.location || 'Location TBD'}
                            </div>
                            <div className="flex items-center">
                              <Users className="h-4 w-4 mr-2" />
                              {interest.game_invitations?.age_group} - {interest.game_invitations?.skill_level}
                            </div>
                          </div>
                          
                          <div className="space-y-1">
                            <div className="flex items-center">
                              <Heart className="h-4 w-4 mr-2" />
                              Interested since {new Date(interest.created_at).toLocaleDateString()}
                            </div>
                            <div className="flex items-center">
                              <CheckCircle className="h-4 w-4 mr-2" />
                              Status: {interest.status || 'pending'}
                            </div>
                          </div>
                        </div>

                        {interest.game_invitations?.description && (
                          <p className="mt-3 text-sm text-gray-500 line-clamp-2">
                            {interest.game_invitations.description}
                          </p>
                        )}
                      </div>

                      {/* Actions */}
                      <div className="ml-4 flex flex-col space-y-2">
                        <Link
                          href={`/games/${interest.game_invitations?.id}`}
                          className="text-blue-600 hover:text-blue-800 text-sm"
                        >
                          View Details
                        </Link>
                        
                        <button
                          onClick={() => removeInterest(interest.id)}
                          className="text-red-600 hover:text-red-800 text-sm text-left"
                        >
                          Remove Interest
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              ))
            ) : (
              <div className="text-center py-12 bg-white rounded-lg shadow">
                <Heart className="mx-auto h-12 w-12 text-gray-400 mb-4" />
                <h3 className="text-lg font-medium text-gray-900 mb-2">No games interested yet</h3>
                <p className="text-gray-500 mb-6">Browse available games and show your interest</p>
                <Link
                  href="/games"
                  className="inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700"
                >
                  Browse Games
                </Link>
              </div>
            )}
          </div>
        )}
      </div>
    </div>
  );
}
</file>

<file path="app/[locale]/(auth)/register/page.tsx">
//app/[locale]/(auth)/register/page.tsx
import { Suspense } from 'react';
import RegisterClient from './RegisterClient';

export const dynamic = 'force-dynamic';
export const revalidate = 0;

export default function RegisterPage() {
  return (
    <Suspense fallback={<div className="min-h-screen flex items-center justify-center">Loading...</div>}>
      <RegisterClient />
    </Suspense>
  );
}
</file>

<file path="app/[locale]/(dashboard)/book/[rinkId]/page.tsx">
// app/[locale]/(dashboard)/book/[rinkId]/page.tsx
'use client';

import {useState, useEffect, useMemo, useCallback} from 'react';
import {createClient} from '@/lib/supabase/client';
import {useRouter, useParams} from 'next/navigation';

export default function BookRinkPage() {
  const router = useRouter();
  // Read locale and rinkId from URL params (client-side)
  const { locale, rinkId } = useParams<{ locale: string; rinkId: string }>();

  const supabase = useMemo(() => createClient(), []);

  const [rink, setRink] = useState<any>(null);
  const [loading, setLoading] = useState(true);
  const [submitting, setSubmitting] = useState(false);

  // Form fields
  const [bookingDate, setBookingDate] = useState('');
  const [startTime, setStartTime] = useState('');
  const [hours, setHours] = useState<number>(1);

  // locale-aware link helper
  const withLocale = useCallback((p: string) => `/${locale || ''}${p}`.replace('//', '/'), [locale]);

  const fetchRink = useCallback(async () => {
    if (!rinkId) return;
    const { data, error } = await supabase
      .from('rinks')
      .select('*')
      .eq('id', rinkId)
      .single();

    if (error) {
      console.error('Error fetching rink:', error);
      setRink(null);
    } else {
      setRink(data);
    }
    setLoading(false);
  }, [rinkId, supabase]);

  useEffect(() => {
    fetchRink();
  }, [fetchRink]);

  // pad hour/minute to HH:mm
  const pad2 = (n: number) => (n < 10 ? `0${n}` : `${n}`);

  const calcEndTime = (start: string, durHours: number) => {
    // start expected "HH:mm"
    const [hStr = '0', mStr = '00'] = start.split(':');
    const h = Math.max(0, Math.min(23, parseInt(hStr, 10) || 0));
    const m = Math.max(0, Math.min(59, parseInt(mStr, 10) || 0));
    // simple wraparound by 24h
    const endH = (h + Math.max(1, durHours)) % 24;
    return `${pad2(endH)}:${pad2(m)}`;
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setSubmitting(true);

    try {
      const { data: { user } } = await supabase.auth.getUser();

      if (!user) {
        // Localized redirect to login
        router.push(withLocale('/login'));
        setSubmitting(false);
        return;
      }

      if (!bookingDate || !startTime || !hours) {
        alert('Please fill date, start time and duration.');
        setSubmitting(false);
        return;
      }

      const hourlyRate: number =
        typeof rink?.hourly_rate === 'number'
          ? rink.hourly_rate
          : Number(rink?.hourly_rate) || 150;

      const subtotal = hourlyRate * hours;
      const platformFee = +(subtotal * 0.08).toFixed(2);
      const total = +(subtotal + platformFee).toFixed(2);
      const endTime = calcEndTime(startTime, hours);

      const { error } = await supabase.from('bookings').insert({
        user_id: user.id,
        rink_id: rinkId,
        booking_date: bookingDate, // yyyy-mm-dd
        start_time: startTime,     // HH:mm
        end_time: endTime,         // HH:mm
        hours,
        subtotal,
        platform_fee: platformFee,
        total,
        status: 'pending',
      });

      if (error) throw error;

      alert('Booking created successfully! Redirecting to your bookings...');
      // Localized redirect to bookings
      router.push(withLocale('/bookings'));
    } catch (err) {
      console.error('Booking error:', err);
      alert('Failed to create booking. Please try again.');
      setSubmitting(false);
    }
  };

  if (loading) {
    return (
      <div className="flex items-center justify-center min-h-screen">
        <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600" />
      </div>
    );
  }

  if (!rink) {
    return (
      <div className="container mx-auto p-8">
        <p>Rink not found</p>
      </div>
    );
  }

  const hourlyRate: number =
    typeof rink.hourly_rate === 'number'
      ? rink.hourly_rate
      : Number(rink.hourly_rate) || 150;

  const subtotal = hourlyRate * hours;
  const platformFee = +(subtotal * 0.08).toFixed(2);
  const total = +(subtotal + platformFee).toFixed(2);

  // Today's date for min attribute
  const today = new Date().toISOString().split('T')[0];

  return (
    <div className="container mx-auto p-8 max-w-2xl">
      <h1 className="text-3xl font-bold mb-6">Book {rink.name}</h1>

      <div className="bg-white rounded-lg shadow p-6 mb-6">
        <h2 className="text-xl font-semibold mb-4">Rink Details</h2>
        <p className="text-gray-600">{rink.address}</p>
        {rink.phone && <p className="text-gray-600">{rink.phone}</p>}
        <p className="text-lg font-medium mt-2">${hourlyRate}/hour</p>
      </div>

      <form onSubmit={handleSubmit} className="bg-white rounded-lg shadow p-6">
        <h2 className="text-xl font-semibold mb-4">Booking Information</h2>

        <div className="space-y-4">
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-1">
              Date
            </label>
            <input
              type="date"
              required
              min={today}
              value={bookingDate}
              onChange={(e) => setBookingDate(e.target.value)}
              className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500"
            />
          </div>

          <div>
            <label className="block text-sm font-medium text-gray-700 mb-1">
              Start Time
            </label>
            <select
              required
              value={startTime}
              onChange={(e) => setStartTime(e.target.value)}
              className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500"
            >
              <option value="">Select time</option>
              {[6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21].map((hour) => (
                <option key={hour} value={`${pad2(hour)}:00`}>
                  {pad2(hour)}:00
                </option>
              ))}
            </select>
          </div>

          <div>
            <label className="block text-sm font-medium text-gray-700 mb-1">
              Duration (hours)
            </label>
            <select
              value={hours}
              onChange={(e) => setHours(parseInt(e.target.value, 10))}
              className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500"
            >
              {[1,2,3,4].map((h) => (
                <option key={h} value={h}>
                  {h} hour{h > 1 ? 's' : ''}
                </option>
              ))}
            </select>
          </div>

          <div className="pt-4 border-t">
            <h3 className="font-medium mb-2">Price Summary</h3>
            <div className="space-y-1 text-sm">
              <div className="flex justify-between">
                <span>Ice Time ({hours} hours √ó ${hourlyRate})</span>
                <span>${subtotal.toFixed(2)}</span>
              </div>
              <div className="flex justify-between">
                <span>Platform Fee (8%)</span>
                <span>${platformFee.toFixed(2)}</span>
              </div>
              <div className="flex justify-between font-bold text-lg pt-2 border-t">
                <span>Total</span>
                <span>${total.toFixed(2)}</span>
              </div>
            </div>
          </div>

          <button
            type="submit"
            disabled={submitting}
            className="w-full py-2 px-4 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-md disabled:opacity-50 disabled:cursor-not-allowed"
          >
            {submitting ? 'Creating Booking...' : 'Confirm Booking'}
          </button>
        </div>
      </form>
    </div>
  );
}
</file>

<file path="app/[locale]/(dashboard)/bookings/[id]/page.tsx">
// app/[locale]/(dashboard)/bookings/[id]/page.tsx
'use client';

import {useState, useEffect, useCallback, useMemo} from 'react';
import {createClient} from '@/lib/supabase/client';
import {useRouter, useParams} from 'next/navigation';
import {formatCurrency, formatDate} from '@/lib/utils/format';

/**
 * Booking detail page
 * - Read params via useParams() to get locale and id.
 * - Require auth: unauthenticated users are redirected to /{locale}/login.
 * - Only allow the owner to read the booking (filter by user_id).
 * - Wrap data loader with useCallback to satisfy exhaustive-deps.
 */
export default function BookingDetailPage() {
  const router = useRouter();
  const { locale, id: bookingId } = useParams<{ locale: string; id: string }>();

  const supabase = useMemo(() => createClient(), []);
  const withLocale = useCallback(
    (p: string) => `/${locale || ''}${p}`.replace('//', '/'),
    [locale]
  );

  const [booking, setBooking] = useState<any>(null);
  const [loading, setLoading] = useState(true);

  const fetchBookingDetail = useCallback(async () => {
    if (!bookingId) return;

    // Auth check: redirect to localized login if no user
    const { data: { user } } = await supabase.auth.getUser();

    if (!user) {
      router.push(withLocale('/login'));
      setLoading(false);
      return;
    }

    // Fetch booking that belongs to the current user
    const { data, error } = await supabase
      .from('bookings')
      .select(
        `
          *,
          rinks (name, address, phone, hourly_rate)
        `
      )
      .eq('id', bookingId)
      .eq('user_id', user.id)
      .single();

    if (error || !data) {
      console.error('Error fetching booking:', error);
      router.push(withLocale('/bookings'));
    } else {
      setBooking(data);
    }
    setLoading(false);
  }, [bookingId, router, supabase, withLocale]);

  useEffect(() => {
    fetchBookingDetail();
  }, [fetchBookingDetail]);

  const handleCancel = async () => {
    if (!bookingId) return;
    if (!confirm('Are you sure you want to cancel this booking?')) return;

    const { error } = await supabase
      .from('bookings')
      .update({ status: 'cancelled' })
      .eq('id', bookingId);

    if (error) {
      console.error('Cancel failed:', error);
      return;
    }
    alert('Booking cancelled successfully');
    router.push(withLocale('/bookings'));
  };

  if (loading) {
    return (
      <div className="flex items-center justify-center min-h-screen">
        <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600" />
      </div>
    );
  }

  if (!booking) {
    return (
      <div className="container mx-auto p-8">
        <p>Booking not found</p>
      </div>
    );
  }

  const statusColors: Record<string, string> = {
    confirmed: 'bg-green-100 text-green-800',
    pending: 'bg-yellow-100 text-yellow-800',
    cancelled: 'bg-red-100 text-red-800',
    completed: 'bg-gray-100 text-gray-800',
  };
  const statusColor = statusColors[booking.status] || 'bg-gray-100 text-gray-800';

  return (
    <div className="container mx-auto p-8">
      <div className="mb-6">
        <button
          onClick={() => router.push(withLocale('/bookings'))}
          className="text-gray-600 hover:text-gray-800"
        >
          ‚Üê Back to My Bookings
        </button>
      </div>

      <div className="bg-white rounded-lg shadow-lg p-8">
        <div className="flex justify-between items-start mb-6">
          <div>
            <h1 className="text-3xl font-bold mb-2">{booking.rinks?.name}</h1>
            <span className={`px-3 py-1 rounded text-sm ${statusColor}`}>{booking.status}</span>
          </div>
          <div className="text-right">
            <p className="text-3xl font-bold text-blue-600">
              {formatCurrency(booking.total)}
            </p>
            <p className="text-sm text-gray-600">Total Amount</p>
          </div>
        </div>

        <div className="grid md:grid-cols-2 gap-8">
          <div>
            <h2 className="text-xl font-semibold mb-4">Booking Details</h2>
            <div className="space-y-3">
              <div>
                <p className="text-sm text-gray-600">Booking ID</p>
                <p className="font-medium">{booking.id}</p>
              </div>
              <div>
                <p className="text-sm text-gray-600">Date</p>
                <p className="font-medium">{formatDate(booking.booking_date)}</p>
              </div>
              <div>
                <p className="text-sm text-gray-600">Time</p>
                <p className="font-medium">
                  {booking.start_time} - {booking.end_time}
                </p>
              </div>
              <div>
                <p className="text-sm text-gray-600">Duration</p>
                <p className="font-medium">{booking.hours} hours</p>
              </div>
            </div>
          </div>

          <div>
            <h2 className="text-xl font-semibold mb-4">Rink Information</h2>
            <div className="space-y-3">
              <div>
                <p className="text-sm text-gray-600">Location</p>
                <p className="font-medium">{booking.rinks?.address}</p>
              </div>
              {booking.rinks?.phone && (
                <div>
                  <p className="text-sm text-gray-600">Phone</p>
                  <p className="font-medium">{booking.rinks.phone}</p>
                </div>
              )}
              <div>
                <p className="text-sm text-gray-600">Hourly Rate</p>
                <p className="font-medium">{formatCurrency(booking.rinks?.hourly_rate)}</p>
              </div>
            </div>
          </div>
        </div>

        <div className="mt-8 pt-8 border-t">
          <h2 className="text-xl font-semibold mb-4">Price Breakdown</h2>
          <div className="space-y-2">
            <div className="flex justify-between">
              <span>
                Ice Time ({booking.hours} hours √ó {formatCurrency(booking.rinks?.hourly_rate)})
              </span>
              <span>{formatCurrency(booking.subtotal)}</span>
            </div>
            <div className="flex justify-between">
              <span>Platform Fee (8%)</span>
              <span>{formatCurrency(booking.platform_fee)}</span>
            </div>
            <div className="flex justify-between font-bold text-lg pt-2 border-t">
              <span>Total</span>
              <span>{formatCurrency(booking.total)}</span>
            </div>
          </div>
        </div>

        {booking.status !== 'cancelled' && booking.status !== 'completed' && (
          <div className="mt-8 flex gap-4">
            <button
              onClick={handleCancel}
              className="px-6 py-2 border border-red-300 text-red-600 rounded hover:bg-red-50"
            >
              Cancel Booking
            </button>
          </div>
        )}
      </div>
    </div>
  );
}
</file>

<file path="app/[locale]/(dashboard)/bookings/page.tsx">
// app/[locale]/(dashboard)/bookings/page.tsx
'use client';

import {useCallback, useEffect, useMemo, useState} from 'react';
import {createClient} from '@/lib/supabase/client';
import Link from 'next/link';
import {useParams, useRouter} from 'next/navigation';
import {formatCurrency, formatDate} from '@/lib/utils/format';

/**
 * Bookings list page
 * - Read {locale} via useParams() and localize internal links.
 * - Require auth: redirect unauthenticated users to /{locale}/login.
 * - Only show current user's bookings.
 * - Fetch wrapped in useCallback and used in useEffect deps.
 */
export default function BookingsPage() {
  const { locale } = useParams<{ locale: string }>();
  const router = useRouter();

  const supabase = useMemo(() => createClient(), []);
  const withLocale = useCallback(
    (p: string) => `/${locale || ''}${p}`.replace('//', '/'),
    [locale]
  );

  const [bookings, setBookings] = useState<any[]>([]);
  const [loading, setLoading] = useState(true);

  const fetchBookings = useCallback(async () => {
    // Auth check
    const { data: { user } } = await supabase.auth.getUser();
    if (!user) {
      router.push(withLocale('/login'));
      setLoading(false);
      return;
    }

    const { data, error } = await supabase
      .from('bookings')
      .select(`
        *,
        rinks (name, address)
      `)
      .eq('user_id', user.id)
      .order('booking_date', { ascending: true });

    if (error) {
      console.error('Failed to load bookings:', error);
      setBookings([]);
    } else {
      setBookings(data || []);
    }
    setLoading(false);
  }, [router, supabase, withLocale]);

  useEffect(() => {
    fetchBookings();
  }, [fetchBookings]);

  if (loading) {
    return (
      <div className="flex items-center justify-center min-h-[40vh]">
        <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600" />
      </div>
    );
  }

  return (
    <div className="container mx-auto px-4 py-8">
      <div className="flex items-center justify-between mb-6">
        <h1 className="text-3xl font-bold">My Bookings</h1>
      </div>

      {bookings.length === 0 ? (
        <div className="bg-white rounded-lg shadow p-8 text-center">
          <p className="text-gray-500 mb-4">No bookings yet.</p>
        </div>
      ) : (
        <div className="grid gap-4">
          {bookings.map((b) => (
            <Link
              key={b.id}
              href={withLocale(`/bookings/${b.id}`)}
              className="bg-white rounded-lg shadow p-6 hover:shadow-md transition"
            >
              <div className="flex items-start justify-between">
                <div className="min-w-0">
                  <h3 className="text-xl font-semibold truncate">
                    {b.rinks?.name ?? 'Rink'}
                  </h3>
                  <p className="text-gray-600 mt-1">
                    üìÖ {formatDate(b.booking_date)} ‚Äî {b.start_time} ~ {b.end_time}
                  </p>
                  <p className="text-gray-600 truncate">{b.rinks?.address}</p>
                </div>
                <div className="text-right shrink-0">
                  <div className="text-sm text-gray-600 mb-1">Total</div>
                  <div className="font-bold">{formatCurrency(b.total)}</div>
                </div>
              </div>
            </Link>
          ))}
        </div>
      )}
    </div>
  );
}
</file>

<file path="app/[locale]/(dashboard)/clubs/new/page.tsx">
'use client'

import { useState } from 'react'
import { useRouter } from 'next/navigation'
import { createClient } from '@/lib/supabase/client'

export default function NewClubPage() {
  const router = useRouter()
  const [loading, setLoading] = useState(false)
  const [message, setMessage] = useState('')
  
  const [formData, setFormData] = useState({
    name: '',
    description: '',
    contact_email: '',
    contact_phone: '',
    website: '',
    founded_year: new Date().getFullYear().toString(),
    home_rink: '',
    age_groups: [] as string[],
  })

  const ageGroups = ['U7', 'U9', 'U11', 'U13', 'U15', 'U18']

  const handleAgeGroupToggle = (ageGroup: string) => {
    setFormData(prev => ({
      ...prev,
      age_groups: prev.age_groups.includes(ageGroup)
        ? prev.age_groups.filter(ag => ag !== ageGroup)
        : [...prev.age_groups, ageGroup]
    }))
  }

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()
    setLoading(true)
    setMessage('')

    try {
      const supabase = createClient()
      
      // Get current user
      const { data: { user } } = await supabase.auth.getUser()
      
      if (!user) {
        setMessage('Please login to create a club')
        setLoading(false)
        return
      }

      // Create club
      const { data, error } = await supabase
        .from('clubs')
        .insert({
          ...formData,
          manager_id: user.id,
          verified: false,
          age_groups: formData.age_groups.join(',')
        })
        .select()
        .single()

      if (error) {
        setMessage('Error creating club: ' + error.message)
      } else {
        setMessage('Club created successfully!')
        setTimeout(() => {
          router.push('/clubs')
        }, 1500)
      }
    } catch (error) {
      setMessage('An unexpected error occurred')
    } finally {
      setLoading(false)
    }
  }

  return (
    <div className="min-h-screen bg-gray-50">
      {/* Navigation */}
      <nav className="bg-white shadow-sm">
        <div className="container mx-auto px-4 h-16 flex items-center justify-between">
          <a href="/" className="text-xl font-bold">üèí HockeyHub</a>
          <div className="flex gap-4">
            <a href="/games" className="text-gray-600">Games</a>
            <a href="/rinks" className="text-gray-600">Rinks</a>
            <a href="/clubs" className="text-blue-600">Clubs</a>
            <a href="/profile" className="text-gray-600">Profile</a>
          </div>
        </div>
      </nav>

      {/* Main Content */}
      <div className="container mx-auto px-4 py-8 max-w-2xl">
        <h1 className="text-3xl font-bold mb-6">Register Your Club</h1>
        
        <div className="bg-white rounded-lg shadow p-6">
          <form onSubmit={handleSubmit} className="space-y-4">
            {/* Club Name */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">
                Club Name *
              </label>
              <input
                type="text"
                required
                value={formData.name}
                onChange={(e) => setFormData({ ...formData, name: e.target.value })}
                className="w-full px-3 py-2 border border-gray-300 rounded-md"
                placeholder="Ottawa Knights Hockey Club"
              />
            </div>

            {/* Description */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">
                Description
              </label>
              <textarea
                value={formData.description}
                onChange={(e) => setFormData({ ...formData, description: e.target.value })}
                className="w-full px-3 py-2 border border-gray-300 rounded-md"
                rows={3}
                placeholder="Tell us about your club..."
              />
            </div>

            {/* Contact Email */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">
                Contact Email *
              </label>
              <input
                type="email"
                required
                value={formData.contact_email}
                onChange={(e) => setFormData({ ...formData, contact_email: e.target.value })}
                className="w-full px-3 py-2 border border-gray-300 rounded-md"
                placeholder="info@clubname.com"
              />
            </div>

            {/* Contact Phone */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">
                Contact Phone
              </label>
              <input
                type="tel"
                value={formData.contact_phone}
                onChange={(e) => setFormData({ ...formData, contact_phone: e.target.value })}
                className="w-full px-3 py-2 border border-gray-300 rounded-md"
                placeholder="(613) 555-0100"
              />
            </div>

            {/* Website */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">
                Website
              </label>
              <input
                type="url"
                value={formData.website}
                onChange={(e) => setFormData({ ...formData, website: e.target.value })}
                className="w-full px-3 py-2 border border-gray-300 rounded-md"
                placeholder="https://www.clubname.com"
              />
            </div>

            {/* Founded Year */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">
                Founded Year
              </label>
              <input
                type="number"
                min="1900"
                max={new Date().getFullYear()}
                value={formData.founded_year}
                onChange={(e) => setFormData({ ...formData, founded_year: e.target.value })}
                className="w-full px-3 py-2 border border-gray-300 rounded-md"
              />
            </div>

            {/* Home Rink */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">
                Home Rink
              </label>
              <input
                type="text"
                value={formData.home_rink}
                onChange={(e) => setFormData({ ...formData, home_rink: e.target.value })}
                className="w-full px-3 py-2 border border-gray-300 rounded-md"
                placeholder="Bell Sensplex"
              />
            </div>

            {/* Age Groups */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Age Groups
              </label>
              <div className="flex flex-wrap gap-2">
                {ageGroups.map((ageGroup) => (
                  <button
                    key={ageGroup}
                    type="button"
                    onClick={() => handleAgeGroupToggle(ageGroup)}
                    className={`px-3 py-1 rounded-md border ${
                      formData.age_groups.includes(ageGroup)
                        ? 'bg-blue-600 text-white border-blue-600'
                        : 'bg-white text-gray-700 border-gray-300'
                    }`}
                  >
                    {ageGroup}
                  </button>
                ))}
              </div>
            </div>

            {/* Message */}
            {message && (
              <div className={`text-sm p-3 rounded ${
                message.includes('Error') || message.includes('login')
                  ? 'bg-red-50 text-red-600'
                  : 'bg-green-50 text-green-600'
              }`}>
                {message}
              </div>
            )}

            {/* Submit Buttons */}
            <div className="flex gap-2">
              <button
                type="submit"
                disabled={loading}
                className="flex-1 bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 disabled:opacity-50"
              >
                {loading ? 'Creating...' : 'Register Club'}
              </button>
              <button
                type="button"
                onClick={() => router.push('/clubs')}
                className="flex-1 bg-gray-200 text-gray-700 py-2 px-4 rounded-md hover:bg-gray-300"
              >
                Cancel
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  )
}
</file>

<file path="app/[locale]/(dashboard)/manage-rink/page.tsx">
//app/[locale]/(dashboard)/manage-rink/page.tsx
'use client';

import { useState, useEffect, useMemo, useCallback } from 'react';
import { createClient } from '@/lib/supabase/client';
import { useRouter, useParams } from 'next/navigation';
import Link from 'next/link';

type Rink = {
  id: string;
  name: string;
  hourly_rate?: number | null;
  booking_url?: string | null;
  amenities?: string[] | null;
  custom_info?: { peak_hours?: string | null; special_notes?: string | null } | null;
};

type ManagerRow = {
  rinks: Rink;
};

export default function ManageRinkPage() {
  const router = useRouter();
  const { locale } = useParams<{ locale: string }>();
  const supabase = useMemo(() => createClient(), []);

  const withLocale = useCallback(
    (p: string) => `/${locale || ''}${p}`.replace('//', '/'),
    [locale]
  );

  const [myRink, setMyRink] = useState<Rink | null>(null);
  const [loadingPage, setLoadingPage] = useState(true);
  const [saving, setSaving] = useState(false);

  const [formData, setFormData] = useState({
    hourly_rate: '',
    booking_url: '',
    amenities: '',
    peak_hours: '',
    special_notes: '',
  });

  // ÂàùÂßãÂåñÔºöË¶ÅÊ±ÇÁôªÂΩïÔºõÂä†ËΩΩÂΩìÂâçÁî®Êà∑ÁöÑ rinkÔºà‰ªÖ verified ÁÆ°ÁêÜÂëòÔºâ
  useEffect(() => {
    (async () => {
      try {
        const {
          data: { user },
        } = await supabase.auth.getUser();

        if (!user) {
          router.push(withLocale('/login'));
          return;
        }

        const { data, error } = await supabase
          .from('rink_managers')
          .select('*, rinks(*)')
          .eq('user_id', user.id)
          .eq('verified', true)
          .maybeSingle<ManagerRow>();

        if (error) {
          console.error('fetch manager error:', error);
        }

        if (data?.rinks) {
          const r = data.rinks;
          setMyRink(r);
          setFormData({
            hourly_rate: r.hourly_rate != null ? String(r.hourly_rate) : '',
            booking_url: r.booking_url || '',
            amenities: Array.isArray(r.amenities) ? r.amenities.join(', ') : '',
            peak_hours: r.custom_info?.peak_hours || '',
            special_notes: r.custom_info?.special_notes || '',
          });
        } else {
          setMyRink(null);
        }
      } finally {
        setLoadingPage(false);
      }
    })();
  }, [router, supabase, withLocale]);

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    if (!myRink) return;

    setSaving(true);
    try {
      const parsedRate = Number(formData.hourly_rate);
      const hourly_rate =
        Number.isFinite(parsedRate) && parsedRate >= 0 ? parsedRate : null;

      const amenities =
        formData.amenities.trim() === ''
          ? []
          : formData.amenities.split(',').map((a) => a.trim()).filter(Boolean);

      const { error } = await supabase
        .from('rinks')
        .update({
          hourly_rate,
          booking_url: formData.booking_url || null,
          amenities,
          custom_info: {
            peak_hours: formData.peak_hours || null,
            special_notes: formData.special_notes || null,
          },
          source: 'manager_updated',
        })
        .eq('id', myRink.id);

      if (error) throw error;

      // ËÆ∞ÂΩïÊó•ÂøóÔºàËã•Â∑≤ÁôªÂΩïÔºâ
      const {
        data: { user },
      } = await supabase.auth.getUser();
      if (user) {
        await supabase.from('rink_updates_log').insert({
          rink_id: myRink.id,
          updated_by: user.id,
          changes: formData,
          update_type: 'manager_update',
        });
      }

      alert('Rink information updated successfully!');
    } catch (err) {
      console.error('update rink error:', err);
      alert('Failed to update rink. Please try again.');
    } finally {
      setSaving(false);
    }
  };

  if (loadingPage) {
    return (
      <div className="min-h-screen bg-gray-50 flex items-center justify-center">
        <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600" />
      </div>
    );
  }

  if (!myRink) {
    return (
      <div className="min-h-screen bg-gray-50 p-8">
        <div className="max-w-2xl mx-auto">
          <h1 className="text-2xl font-bold mb-4">Rink Manager Portal</h1>
          <div className="bg-yellow-50 p-4 rounded">
            <p>You are not registered as a rink manager.</p>
            <div className="mt-3 flex gap-3">
              <Link
                href={withLocale('/login')}
                className="bg-gray-200 text-gray-800 px-4 py-2 rounded hover:bg-gray-300"
              >
                Sign in
              </Link>
              {/* Â¶ÇÊûúÂêéÁª≠ÊúâÁî≥ËØ∑È°µÈù¢ÔºåÊääÈìæÊé•Êç¢ÊàêÂØπÂ∫îË∑ØÂæÑ */}
              <button
                className="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700"
                onClick={() => alert('Coming soon: manager application flow')}
              >
                Apply to Manage a Rink
              </button>
            </div>
          </div>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gray-50 p-8">
      <div className="max-w-2xl mx-auto">
        <div className="mb-4">
          <Link href={withLocale('/dashboard')} className="text-gray-600 hover:underline">
            ‚Üê Back
          </Link>
        </div>
        <h1 className="text-2xl font-bold mb-4">Manage: {myRink.name}</h1>

        <form onSubmit={handleSubmit} className="bg-white p-6 rounded-lg shadow">
          <div className="mb-4">
            <label className="block text-sm font-medium mb-2">Hourly Rate ($)</label>
            <input
              type="number"
              inputMode="decimal"
              value={formData.hourly_rate}
              onChange={(e) =>
                setFormData((s) => ({ ...s, hourly_rate: e.target.value }))
              }
              className="w-full px-3 py-2 border rounded"
              placeholder="e.g., 180"
              min="0"
              step="0.01"
            />
          </div>

          <div className="mb-4">
            <label className="block text-sm font-medium mb-2">Online Booking URL</label>
            <input
              type="url"
              value={formData.booking_url}
              onChange={(e) =>
                setFormData((s) => ({ ...s, booking_url: e.target.value }))
              }
              className="w-full px-3 py-2 border rounded"
              placeholder="https://..."
            />
          </div>

          <div className="mb-4">
            <label className="block text-sm font-medium mb-2">
              Amenities (comma separated)
            </label>
            <input
              type="text"
              value={formData.amenities}
              onChange={(e) =>
                setFormData((s) => ({ ...s, amenities: e.target.value }))
              }
              className="w-full px-3 py-2 border rounded"
              placeholder="Skate sharpening, Pro shop, Snack bar"
            />
          </div>

          <div className="mb-4">
            <label className="block text-sm font-medium mb-2">Peak Hours</label>
            <input
              type="text"
              value={formData.peak_hours}
              onChange={(e) =>
                setFormData((s) => ({ ...s, peak_hours: e.target.value }))
              }
              className="w-full px-3 py-2 border rounded"
              placeholder="Weekdays 6-9pm, Weekends all day"
            />
          </div>

          <div className="mb-6">
            <label className="block text-sm font-medium mb-2">Special Notes</label>
            <textarea
              value={formData.special_notes}
              onChange={(e) =>
                setFormData((s) => ({ ...s, special_notes: e.target.value }))
              }
              className="w-full px-3 py-2 border rounded"
              rows={3}
              placeholder="Any special information for users..."
            />
          </div>

          <button
            type="submit"
            disabled={saving}
            className="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed"
          >
            {saving ? 'Saving...' : 'Update Rink Information'}
          </button>
        </form>
      </div>
    </div>
  );
}
</file>

<file path="app/[locale]/(dashboard)/profile/page.tsx">
'use client';

import {useEffect, useState} from 'react';
import {createClient} from '@/lib/supabase/client';
import {User} from '@supabase/supabase-js';
import {useRouter, useParams} from 'next/navigation';
import {
  User as UserIcon,
  Mail,
  Phone,
  MapPin,
  Trophy,
  Calendar,
  Shield,
  Target,
  Edit2,
  AlertCircle
} from 'lucide-react';

interface Profile {
  id: string;
  full_name: string;
  email?: string;
  age_group?: string;
  skill_level?: string;
  position?: string;
  area?: string;
  years_playing?: number;
  phone?: string;
  jersey_number?: string;
  preferred_shot?: string;
  bio?: string;
  created_at?: string;
}

export default function ProfilePage() {
  // Read locale from the URL segment: /{locale}/...
  const {locale} = useParams<{locale: string}>();

  const [user, setUser] = useState<User | null>(null);
  const [profile, setProfile] = useState<Profile | null>(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);
  const router = useRouter();
  const supabase = createClient();

  useEffect(() => {
    getProfile();
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, []);

  async function getProfile() {
    try {
      setError(null);
      const {
        data: {user},
        error: userError
      } = await supabase.auth.getUser();

      if (userError) throw userError;

      if (!user) {
        // Localized login redirect
        router.push(`/${locale}/login`);
        return;
      }

      setUser(user);

      const {data: profileData, error: profileError} = await supabase
        .from('profiles')
        .select('*')
        .eq('id', user.id)
        .single();

      // Create a profile row if not found
      if (profileError && (profileError as any).code === 'PGRST116') {
        const fallbackName =
          user.user_metadata?.full_name ||
          user.email?.split('@')[0] ||
          'Hockey Player';

        const {data: newProfile, error: insertError} = await supabase
          .from('profiles')
          .insert([{id: user.id, full_name: fallbackName, email: user.email}])
          .select()
          .single();

        if (insertError) {
          // Fallback to upsert
          const {data: upsertProfile, error: upsertError} = await supabase
            .from('profiles')
            .upsert({id: user.id, full_name: fallbackName, email: user.email})
            .select()
            .single();

          if (upsertError) throw upsertError;
          setProfile(upsertProfile);
        } else {
          setProfile(newProfile);
        }
      } else if (profileError) {
        throw profileError;
      } else {
        setProfile(profileData);
      }
    } catch (error: any) {
      setError(error.message || 'Failed to load profile');
    } finally {
      setLoading(false);
    }
  }

  const getSkillLevelColor = (level: string) => {
    const colors: Record<string, string> = {
      AAA: 'bg-purple-100 text-purple-800',
      AA: 'bg-indigo-100 text-indigo-800',
      A: 'bg-blue-100 text-blue-800',
      B: 'bg-green-100 text-green-800',
      C: 'bg-yellow-100 text-yellow-800',
      'House League': 'bg-orange-100 text-orange-800',
      Beginner: 'bg-gray-100 text-gray-800'
    };
    return colors[level] || 'bg-gray-100 text-gray-800';
  };

  const getPositionIcon = (position: string) => {
    switch (position) {
      case 'Forward':
        return '‚ö°';
      case 'Defense':
        return 'üõ°Ô∏è';
      case 'Goalie':
        return 'ü•Ö';
      default:
        return 'üèí';
    }
  };

  if (loading) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
      </div>
    );
  }

  if (error) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <div className="bg-red-50 border border-red-200 rounded-lg p-6 max-w-md">
          <div className="flex items-center space-x-3">
            <AlertCircle className="h-6 w-6 text-red-600" />
            <div>
              <h3 className="text-lg font-medium text-red-900">Error loading profile</h3>
              <p className="text-sm text-red-700 mt-1">{error}</p>
              <button
                onClick={() => window.location.reload()}
                className="mt-3 text-sm text-red-600 hover:text-red-800 underline"
              >
                Try again
              </button>
            </div>
          </div>
        </div>
      </div>
    );
  }

  if (!profile) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <div className="text-center">
          <p className="text-gray-500">Profile not found</p>
          <button
            onClick={() => window.location.reload()}
            className="mt-3 text-blue-600 hover:text-blue-800 underline"
          >
            Reload page
          </button>
        </div>
      </div>
    );
  }

  const isIncomplete =
    !profile.age_group || !profile.skill_level || !profile.position || !profile.area;

  return (
    <div className="min-h-screen bg-gray-50 py-8">
      <div className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        {/* Incomplete profile alert */}
        {isIncomplete && (
          <div className="mb-6 bg-yellow-50 border border-yellow-200 rounded-lg p-4">
            <div className="flex">
              <AlertCircle className="h-5 w-5 text-yellow-600 mt-0.5" />
              <div className="ml-3">
                <h3 className="text-sm font-medium text-yellow-800">
                  Complete your profile
                </h3>
                <p className="mt-1 text-sm text-yellow-700">
                  Add your hockey details to find better game matches and connect with other players.
                </p>
                <button
                  onClick={() => router.push(`/${locale}/profile/edit`)}
                  className="mt-2 text-sm font-medium text-yellow-800 hover:text-yellow-900 underline"
                >
                  Complete now ‚Üí
                </button>
              </div>
            </div>
          </div>
        )}

        {/* Header card */}
        <div className="bg-white shadow-xl rounded-lg overflow-hidden">
          <div className="h-32 bg-gradient-to-r from-blue-500 to-blue-600"></div>

          <div className="relative px-6 pb-6">
            {/* Avatar */}
            <div className="absolute -top-12 left-6">
              <div className="h-24 w-24 rounded-full bg-white border-4 border-white shadow-lg flex items-center justify-center">
                <UserIcon className="h-12 w-12 text-gray-400" />
              </div>
            </div>

            {/* Edit button */}
            <div className="flex justify-end pt-4">
              <button
                onClick={() => router.push(`/${locale}/profile/edit`)}
                className="flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition"
              >
                <Edit2 className="h-4 w-4" />
                <span>Edit Profile</span>
              </button>
            </div>

            {/* Name and badges */}
            <div className="mt-4">
              <h1 className="text-3xl font-bold text-gray-900">
                {profile.full_name || 'Hockey Player'}
              </h1>

              <div className="mt-4 flex flex-wrap gap-2">
                {profile.age_group && (
                  <span className="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-gray-100 text-gray-800">
                    {profile.age_group}
                  </span>
                )}
                {profile.skill_level && (
                  <span
                    className={`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${getSkillLevelColor(
                      profile.skill_level
                    )}`}
                  >
                    {profile.skill_level}
                  </span>
                )}
                {profile.position && (
                  <span className="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800">
                    {getPositionIcon(profile.position)} {profile.position}
                  </span>
                )}
                {profile.jersey_number && (
                  <span className="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-red-100 text-red-800">
                    #{profile.jersey_number}
                  </span>
                )}
              </div>
            </div>
          </div>
        </div>

        {/* Details */}
        <div className="mt-6 grid grid-cols-1 md:grid-cols-2 gap-6">
          {/* Contact */}
          <div className="bg-white shadow rounded-lg p-6">
            <h2 className="text-lg font-semibold text-gray-900 mb-4">Contact Information</h2>
            <div className="space-y-3">
              <div className="flex items-center text-gray-600">
                <Mail className="h-5 w-5 mr-3 text-gray-400" />
                <span>{user?.email || profile.email || 'No email'}</span>
              </div>
              <div className="flex items-center text-gray-600">
                <Phone className="h-5 w-5 mr-3 text-gray-400" />
                <span className={!profile.phone ? 'text-gray-400' : ''}>
                  {profile.phone || 'Add phone number'}
                </span>
              </div>
              <div className="flex items-center text-gray-600">
                <MapPin className="h-5 w-5 mr-3 text-gray-400" />
                <span className={!profile.area ? 'text-gray-400' : ''}>
                  {profile.area || 'Add location'}
                </span>
              </div>
            </div>
          </div>

          {/* Hockey profile */}
          <div className="bg-white shadow rounded-lg p-6">
            <h2 className="text-lg font-semibold text-gray-900 mb-4">Hockey Profile</h2>
            <div className="space-y-3">
              <div className="flex items-center justify-between">
                <span className="text-gray-600 flex items-center">
                  <Trophy className="h-5 w-5 mr-3 text-gray-400" />
                  Experience
                </span>
                <span className={`font-medium ${!profile.years_playing ? 'text-gray-400' : ''}`}>
                  {profile.years_playing ? `${profile.years_playing} years` : 'Not specified'}
                </span>
              </div>
              <div className="flex items-center justify-between">
                <span className="text-gray-600 flex items-center">
                  <Target className="h-5 w-5 mr-3 text-gray-400" />
                  Shoots
                </span>
                <span className={`font-medium ${!profile.preferred_shot ? 'text-gray-400' : ''}`}>
                  {profile.preferred_shot || 'Not specified'}
                </span>
              </div>
              <div className="flex items-center justify-between">
                <span className="text-gray-600 flex items-center">
                  <Shield className="h-5 w-5 mr-3 text-gray-400" />
                  Position
                </span>
                <span className={`font-medium ${!profile.position ? 'text-gray-400' : ''}`}>
                  {profile.position || 'Not specified'}
                </span>
              </div>
              <div className="flex items-center justify-between">
                <span className="text-gray-600 flex items-center">
                  <Calendar className="h-5 w-5 mr-3 text-gray-400" />
                  Age Group
                </span>
                <span className={`font-medium ${!profile.age_group ? 'text-gray-400' : ''}`}>
                  {profile.age_group || 'Not specified'}
                </span>
              </div>
            </div>
          </div>
        </div>

        {/* Stats preview (placeholder) */}
        <div className="mt-6 bg-white shadow rounded-lg p-6">
          <h2 className="text-lg font-semibold text-gray-900 mb-4">Season Statistics</h2>
          <div className="grid grid-cols-3 gap-4 text-center">
            <div className="bg-gray-50 rounded-lg p-4">
              <p className="text-2xl font-bold text-blue-600">0</p>
              <p className="text-sm text-gray-600 mt-1">Games Played</p>
            </div>
            <div className="bg-gray-50 rounded-lg p-4">
              <p className="text-2xl font-bold text-green-600">0</p>
              <p className="text-sm text-gray-600 mt-1">Games Organized</p>
            </div>
            <div className="bg-gray-50 rounded-lg p-4">
              <p className="text-2xl font-bold text-purple-600">0</p>
              <p className="text-sm text-gray-600 mt-1">Teams Joined</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="app/[locale]/(dashboard)/rinks/page.tsx">
'use client'

import { useCallback, useEffect, useMemo, useState } from 'react'
import Link from 'next/link'
import { createClient } from '@/lib/supabase/client'
import { formatCurrency } from '@/lib/utils/format'

type Rink = {
  id: string
  name: string
  address: string
  city: string | null
  phone: string | null
  hourly_rate: number | string | null
  amenities: string[] | null
  booking_url: string | null
}

type PriceBand = 'all' | 'budget' | 'standard' | 'premium'

export default function RinksPage() {
  const [rinks, setRinks] = useState<Rink[]>([])
  const [loading, setLoading] = useState(true)

  // UI state
  const [query, setQuery] = useState('')
  const [price, setPrice] = useState<PriceBand>('all')
  const [sort, setSort] = useState<'name' | 'price'>('name')
  const [city, setCity] = useState<string>('all')

  // Load rinks (wrapped with useCallback for stable deps)
  const fetchRinks = useCallback(async () => {
    const supabase = createClient()
    const { data, error } = await supabase
      .from('rinks')
      .select('id, name, address, city, phone, hourly_rate, amenities, booking_url')
      .order('name', { ascending: true })

    if (error) {
      console.error('Failed to load rinks:', error)
      setRinks([])
    } else {
      setRinks((data as Rink[]) || [])
    }
    setLoading(false)
  }, [])

  useEffect(() => {
    fetchRinks()
  }, [fetchRinks])

  // Distinct cities for the filter
  const cities = useMemo(() => {
    const set = new Set<string>()
    rinks.forEach((r) => r.city && set.add(r.city))
    return ['all', ...Array.from(set).sort((a, b) => a.localeCompare(b))]
  }, [rinks])

  // Helpers
  const toNum = (v: number | string | null) =>
    typeof v === 'number' ? v : typeof v === 'string' ? Number.parseFloat(v) : Number.NaN

  const band = (rate: number) => {
    if (Number.isNaN(rate)) return null
    if (rate < 170) return 'Budget'
    if (rate <= 220) return 'Standard'
    return 'Premium'
  }

  // Apply search / filters / sorting
  const filtered = useMemo(() => {
    let list = [...rinks]

    // search by name/address/city/phone
    if (query.trim()) {
      const q = query.trim().toLowerCase()
      list = list.filter((r) =>
        [r.name, r.address, r.city, r.phone].some((f) => (f ?? '').toLowerCase().includes(q))
      )
    }

    // city
    if (city !== 'all') {
      list = list.filter((r) => (r.city ?? '').toLowerCase() === city.toLowerCase())
    }

    // price band
    if (price !== 'all') {
      list = list.filter((r) => {
        const n = toNum(r.hourly_rate)
        if (Number.isNaN(n)) return false
        if (price === 'budget') return n < 170
        if (price === 'standard') return n >= 170 && n <= 220
        return n > 220 // premium
      })
    }

    // sort
    if (sort === 'name') {
      list.sort((a, b) => a.name.localeCompare(b.name))
    } else {
      list.sort((a, b) => (toNum(a.hourly_rate) || 1e9) - (toNum(b.hourly_rate) || 1e9))
    }

    return list
  }, [rinks, query, price, sort, city])

  // Quick Stats computed from the filtered list
  const stats = useMemo(() => {
    if (filtered.length === 0) {
      return { count: 0, avg: null as number | null, min: null as number | null, max: null as number | null }
    }
    const numbers = filtered
      .map((r) => toNum(r.hourly_rate))
      .filter((n) => Number.isFinite(n)) as number[]
    if (numbers.length === 0) return { count: filtered.length, avg: null, min: null, max: null }
    const sum = numbers.reduce((s, n) => s + n, 0)
    const avg = Math.round(sum / numbers.length)
    const min = Math.min(...numbers)
    const max = Math.max(...numbers)
    return { count: filtered.length, avg, min, max }
  }, [filtered])

  if (loading) {
    return (
      <div className="flex items-center justify-center min-h-[40vh]">
        <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600" />
      </div>
    )
  }

  return (
    <div className="container mx-auto px-4 py-8">
      <h1 className="text-4xl font-extrabold mb-2">Ice Rinks in Ottawa</h1>
      <p className="text-gray-600 mb-6">{filtered.length} rinks available</p>

      {/* Toolbar */}
      <div className="bg-white rounded-xl shadow p-4 mb-6 grid gap-4 md:grid-cols-4">
        <div className="md:col-span-2">
          <div className="relative">
            <input
              value={query}
              onChange={(e) => setQuery(e.target.value)}
              placeholder="Search rinks..."
              className="w-full px-4 py-2 pr-10 border border-gray-300 rounded-md"
            />
            <span className="absolute right-3 top-2.5 text-gray-400">‚åï</span>
          </div>
        </div>

        <select
          value={price}
          onChange={(e) => setPrice(e.target.value as PriceBand)}
          className="w-full px-3 py-2 border border-gray-300 rounded-md"
        >
          <option value="all">All Prices</option>
          <option value="budget">Budget (&lt; $170)</option>
          <option value="standard">Standard ($170‚Äì$220)</option>
          <option value="premium">Premium (&gt; $220)</option>
        </select>

        <select
          value={sort}
          onChange={(e) => setSort(e.target.value as 'name' | 'price')}
          className="w-full px-3 py-2 border border-gray-300 rounded-md"
        >
          <option value="name">Sort by Name</option>
          <option value="price">Price: Low ‚Üí High</option>
        </select>

        <select
          value={city}
          onChange={(e) => setCity(e.target.value)}
          className="w-full px-3 py-2 border border-gray-300 rounded-md md:col-span-1"
        >
          {cities.map((c) => (
            <option key={c} value={c}>
              {c === 'all' ? 'All Cities' : c}
            </option>
          ))}
        </select>

        <button
          onClick={() => {
            setQuery('')
            setPrice('all')
            setSort('name')
            setCity('all')
          }}
          className="w-full px-4 py-2 bg-gray-100 rounded-md hover:bg-gray-200 md:col-span-1"
        >
          Clear Filters
        </button>
      </div>

      {/* Cards */}
      {filtered.length === 0 ? (
        <div className="bg-white rounded-lg shadow p-8 text-center">
          <p className="text-gray-500">No rinks match your filters.</p>
        </div>
      ) : (
        <div className="grid gap-6 md:grid-cols-2 xl:grid-cols-3">
          {filtered.map((r) => {
            const rateNum = toNum(r.hourly_rate)
            const tag = band(rateNum)
            return (
              <div key={r.id} className="bg-white rounded-xl shadow p-6 flex flex-col gap-3">
                <div className="flex items-start justify-between">
                  <h3 className="text-xl font-semibold">{r.name}</h3>
                  {tag && (
                    <span className="text-xs px-2 py-1 rounded-full bg-green-100 text-green-700">
                      {tag}
                    </span>
                  )}
                </div>

                <div className="text-gray-600 space-y-1">
                  <div>üìç {r.address}</div>
                  {r.phone && <div>üìû {r.phone}</div>}
                  <div>üí≤ {Number.isNaN(rateNum) ? 'N/A' : `${formatCurrency(rateNum)}/hour`}</div>
                  {r.amenities && r.amenities.length > 0 && (
                    <div className="flex flex-wrap gap-2 pt-2">
                      {r.amenities.slice(0, 6).map((a) => (
                        <span
                          key={a}
                          className="text-xs px-2 py-1 rounded bg-gray-100 text-gray-700"
                        >
                          {a}
                        </span>
                      ))}
                    </div>
                  )}
                </div>

                <div className="mt-3 grid grid-cols-3 gap-2">
                  {/* Book Now ‚Üí internal booking page */}
                  <Link
                    href={`/book/${r.id}`}
                    className="col-span-1 text-center px-3 py-2 rounded bg-blue-600 text-white hover:bg-blue-700"
                  >
                    Book Now
                  </Link>

                  {/* Map ‚Üí open Google Maps place */}
                  <a
                    href={`https://www.google.com/maps?q=${encodeURIComponent(r.address)}`}
                    target="_blank"
                    rel="noreferrer"
                    className="text-center px-3 py-2 rounded border hover:bg-gray-50"
                  >
                    Map
                  </a>

                  {/* Go ‚Üí open Google Maps navigation directly */}
                  <a
                    href={`https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(
                      `${r.name} ${r.address} ${r.city ?? ''}`
                    )}`}
                    target="_blank"
                    rel="noreferrer noopener"
                    className="text-center px-3 py-2 rounded border hover:bg-gray-50"
                  >
                    Go
                  </a>
                </div>
              </div>
            )
          })}
        </div>
      )}

      {/* Quick Stats (based on filtered list) */}
      <div className="mt-10 p-6 bg-blue-50 rounded-xl flex flex-wrap items-center justify-around">
        <div className="text-center">
          <h3 className="font-bold text-lg text-blue-900">Quick Stats</h3>
          <p className="text-blue-800">Total Rinks: {stats.count}</p>
        </div>
        <div className="text-center">
          <p className="text-blue-800">
            Average Price:{' '}
            {stats.avg !== null ? `${formatCurrency(stats.avg)}/hr` : 'N/A'}
          </p>
        </div>
        <div className="text-center">
          <p className="text-blue-800">
            Lowest Price:{' '}
            {stats.min !== null ? `${formatCurrency(stats.min)}/hr` : 'N/A'}
          </p>
        </div>
        <div className="text-center">
          <p className="text-blue-800">
            Highest Price:{' '}
            {stats.max !== null ? `${formatCurrency(stats.max)}/hr` : 'N/A'}
          </p>
        </div>
      </div>
    </div>
  )
}
</file>

<file path="app/api/notifications/test/route.ts">
// app/api/notifications/test/route.ts
import { createServiceClient } from '@/lib/supabase/service';
import { createClient } from '@/lib/supabase/client';
import { NextResponse } from 'next/server';
import { cookies } from 'next/headers';

export async function GET() {
  try {
    // ‰ªécookiesËé∑Âèñsession
    const cookieStore = await cookies();
    const supabase = createClient();
    
    // Ëé∑Âèñsession token
    const token = cookieStore.get('sb-ivrralpjkxmbgultqimc-auth-token');
    
    if (!token) {
      return NextResponse.json(
        { error: 'Please login to test notifications' },
        { status: 401 }
      );
    }

    // Ëß£ÊûêtokenËé∑ÂèñÁî®Êà∑ID
    const tokenParts = token.value.split('.');
    const payload = JSON.parse(Buffer.from(tokenParts[1], 'base64').toString());
    const userId = payload.sub;

    // ‰ΩøÁî®service clientÊèíÂÖ•ÈÄöÁü•
    const serviceClient = createServiceClient();
    
    const notifications = [
      {
        user_id: userId,
        type: 'game_interest',
        title: 'Test: New Interest in Your Game!',
        message: 'John Doe has expressed interest in "Saturday Morning Hockey"',
        link: '/games/test-game-1',
        is_read: false
      },
      {
        user_id: userId,
        type: 'interest_accepted',
        title: 'Test: Your Interest Was Accepted!',
        message: 'Your interest in "Friday Night Game" has been accepted.',
        link: '/games/test-game-2',
        is_read: false
      },
      {
        user_id: userId,
        type: 'game_updated',
        title: 'Test: Game Time Changed',
        message: 'The game "Sunday Practice" has been rescheduled to 3:00 PM',
        link: '/games/test-game-3',
        is_read: true
      }
    ];

    const { data, error } = await serviceClient
      .from('notifications')
      .insert(notifications)
      .select();

    if (error) {
      return NextResponse.json(
        { error: error.message },
        { status: 400 }
      );
    }

    return NextResponse.json({ 
      message: 'Test notifications created successfully!',
      count: data?.length || 0,
      notifications: data
    });
  } catch (error) {
    console.error('Error creating test notifications:', error);
    return NextResponse.json(
      { error: 'Internal server error' },
      { status: 500 }
    );
  }
}
</file>

<file path="app/(dashboard)/layout.tsx">
'use client';

import {useEffect, useState} from 'react';
import {createClient} from '@/lib/supabase/client';
import Link from 'next/link';
import {usePathname, useRouter} from 'next/navigation';
import {Home, Trophy, MapPin, Calendar, Users, Bell, LogOut, FileText} from 'lucide-react';

/**
 * Dashboard shell (top nav + children)
 * - Derives `locale` from the first URL segment: /{locale}/...
 * - Localizes all nav links and redirects to `/${locale}/...`
 */
export default function DashboardLayout({
  children
}: {
  children: React.ReactNode;
}) {
  const pathname = usePathname();
  const router = useRouter();
  const supabase = createClient();

  // Resolve locale from path: ['', '{locale}', ...]
  const locale = (pathname?.split('/')?.[1] || '').trim();

  const [userEmail, setUserEmail] = useState<string | null>(null);
  const [unreadCount, setUnreadCount] = useState(0);

  // Build a localized href safely (avoid double slashes)
  const withLocale = (p: string) => `/${locale || ''}${p}`.replace('//', '/');

  useEffect(() => {
    checkUser();
    loadUnreadCount();

    // Subscribe to realtime notifications for the current user
    let cleanup: (() => void) | undefined;

    (async () => {
      const {
        data: {user}
      } = await supabase.auth.getUser();
      if (!user) return;

      const channel = supabase
        .channel('unread-notifications')
        .on(
          'postgres_changes',
          {
            event: '*',
            schema: 'public',
            table: 'notifications',
            filter: `user_id=eq.${user.id}`
          },
          () => {
            loadUnreadCount();
          }
        )
        .subscribe();

      cleanup = () => supabase.removeChannel(channel);
    })();

    return () => {
      if (cleanup) cleanup();
    };
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, []);

  async function checkUser() {
    const {
      data: {user}
    } = await supabase.auth.getUser();
    if (user) {
      setUserEmail(user.email || null);
    } else {
      // Localized redirect when unauthenticated
      router.push(withLocale('/login'));
    }
  }

  async function loadUnreadCount() {
    try {
      const {
        data: {user}
      } = await supabase.auth.getUser();
      if (!user) return;

      const {count} = await supabase
        .from('notifications')
        .select('*', {count: 'exact', head: true})
        .eq('user_id', user.id)
        .eq('is_read', false);

      setUnreadCount(count || 0);
    } catch (error) {
      console.error('Error loading unread count:', error);
    }
  }

  async function handleLogout() {
    await supabase.auth.signOut();
    // Localized redirect after logout
    router.push(withLocale('/login'));
  }

  // Define nav items without locale; we prepend it via `withLocale`
  const navItems = [
    {path: '/dashboard', label: 'Dashboard', icon: Home},
    {path: '/games', label: 'Games', icon: Trophy},
    {path: '/my-games', label: 'My Games', icon: FileText},
    {path: '/rinks', label: 'Rinks', icon: MapPin},
    {path: '/bookings', label: 'My Bookings', icon: Calendar},
    {path: '/clubs', label: 'Clubs', icon: Users}
  ] as const;

  return (
    <div className="min-h-screen bg-gray-50">
      {/* Top Navigation */}
      <nav className="bg-white shadow-sm border-b">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div className="flex justify-between h-16">
            {/* Logo + Desktop Nav */}
            <div className="flex">
              <Link href={withLocale('/dashboard')} className="flex items-center px-2">
                <span className="text-2xl">üèí</span>
                <span className="ml-2 text-xl font-bold text-gray-900">HockeyHub</span>
              </Link>

              <div className="hidden md:ml-8 md:flex md:space-x-4">
                {navItems.map((item) => {
                  const Icon = item.icon;
                  const href = withLocale(item.path);
                  const isActive =
                    pathname === href ||
                    (item.path !== '/dashboard' && pathname?.startsWith(href));

                  return (
                    <Link
                      key={item.path}
                      href={href}
                      className={`inline-flex items-center px-3 py-2 text-sm font-medium rounded-md transition ${
                        isActive
                          ? 'text-blue-600 bg-blue-50'
                          : 'text-gray-600 hover:text-gray-900 hover:bg-gray-50'
                      }`}
                    >
                      <Icon className="h-4 w-4 mr-2" />
                      {item.label}
                    </Link>
                  );
                })}
              </div>
            </div>

            {/* Right Side */}
            <div className="flex items-center space-x-4">
              {/* Notifications */}
              <Link
                href={withLocale('/notifications')}
                className={`relative p-2 rounded-full transition ${
                  pathname === withLocale('/notifications')
                    ? 'text-blue-600 bg-blue-50'
                    : 'text-gray-600 hover:text-gray-900 hover:bg-gray-100'
                }`}
              >
                <Bell className="h-5 w-5" />
                {unreadCount > 0 && (
                  <span className="absolute top-0 right-0 block h-4 w-4 rounded-full bg-red-500 text-white text-xs text-center leading-4">
                    {unreadCount > 9 ? '9+' : unreadCount}
                  </span>
                )}
              </Link>

              {/* User section */}
              <div className="flex items-center space-x-3">
                <span className="text-sm text-gray-700 hidden sm:block">{userEmail}</span>
                <button
                  onClick={handleLogout}
                  className="inline-flex items-center px-3 py-2 text-sm font-medium text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-md transition"
                >
                  <LogOut className="h-4 w-4" />
                  <span className="ml-2 hidden sm:inline">Logout</span>
                </button>
              </div>
            </div>
          </div>
        </div>

        {/* Mobile Navigation */}
        <div className="md:hidden border-t">
          <div className="px-2 pt-2 pb-3 space-y-1">
            {navItems.map((item) => {
              const Icon = item.icon;
              const href = withLocale(item.path);
              const isActive =
                pathname === href || (item.path !== '/dashboard' && pathname?.startsWith(href));

              return (
                <Link
                  key={item.path}
                  href={href}
                  className={`block px-3 py-2 rounded-md text-base font-medium ${
                    isActive
                      ? 'text-blue-600 bg-blue-50'
                      : 'text-gray-600 hover:text-gray-900 hover:bg-gray-50'
                  }`}
                >
                  <Icon className="inline h-4 w-4 mr-2" />
                  {item.label}
                </Link>
              );
            })}
          </div>
        </div>
      </nav>

      {/* Page Content */}
      <main>{children}</main>
    </div>
  );
}
</file>

<file path="app/(dashboard)/notifications/page.tsx">
// app/(dashboard)/notifications/page.tsx
'use client';

import {useEffect, useState, useMemo} from 'react';
import {createClient} from '@/lib/supabase/client';
import {Bell, Check, CheckCheck, Trash2, ExternalLink} from 'lucide-react';
import Link from 'next/link';
import {format} from 'date-fns';
import {usePathname, useRouter} from 'next/navigation';

interface Notification {
  id: string;
  user_id: string;
  type: string;
  title: string;
  message: string;
  link: string | null;
  related_id: string | null;
  is_read: boolean;
  created_at: string;
}

export default function NotificationsPage() {
  const [notifications, setNotifications] = useState<Notification[]>([]);
  const [loading, setLoading] = useState(true);

  const supabase = createClient();
  const pathname = usePathname();
  const router = useRouter();

  // Derive locale from the first URL segment: /{locale}/...
  const locale = useMemo(() => (pathname?.split('/')?.[1] || '').trim(), [pathname]);

  // Helper to prefix a path with current locale (keeps external links intact)
  const withLocale = (p: string) => `/${locale || ''}${p}`.replace('//', '/');
  const localizeLink = (href: string) => {
    if (!href) return href;
    // Keep full URLs and mailto/tel as-is
    if (/^(https?:)?\/\//i.test(href) || /^(mailto:|tel:)/i.test(href)) return href;
    // Already localized?
    if (href.startsWith(`/${locale}/`)) return href;
    // Prefix with current locale
    return withLocale(href.startsWith('/') ? href : `/${href}`);
  };

  useEffect(() => {
    loadNotifications();

    // Subscribe to real-time notifications (current user only)
    const channel = supabase
      .channel('notifications')
      .on(
        'postgres_changes',
        {event: '*', schema: 'public', table: 'notifications'},
        () => {
          loadNotifications();
        }
      )
      .subscribe();

    return () => {
      supabase.removeChannel(channel);
    };
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, []);

  async function loadNotifications() {
    try {
      const {
        data: {user},
        error: userError
      } = await supabase.auth.getUser();

      if (userError) {
        console.error('Error getting user:', userError);
        return;
      }

      if (!user) {
        // Localized redirect when unauthenticated
        router.push(withLocale('/login'));
        return;
      }

      const {data, error} = await supabase
        .from('notifications')
        .select(
          'id, user_id, type, title, message, link, related_id, is_read, created_at'
        )
        .eq('user_id', user.id)
        .order('created_at', {ascending: false});

      if (error) {
        console.error('Error loading notifications:', error);
        throw error;
      }

      setNotifications(data || []);
    } catch (error) {
      console.error('Error in loadNotifications:', error);
    } finally {
      setLoading(false);
    }
  }

  async function markAsRead(id: string) {
    try {
      const {error} = await supabase.from('notifications').update({is_read: true}).eq('id', id);
      if (error) throw error;
      setNotifications(prev => prev.map(n => (n.id === id ? {...n, is_read: true} : n)));
    } catch (error) {
      console.error('Error marking as read:', error);
    }
  }

  async function markAllAsRead() {
    try {
      const {
        data: {user}
      } = await supabase.auth.getUser();
      if (!user) return;

      const {error} = await supabase
        .from('notifications')
        .update({is_read: true})
        .eq('user_id', user.id)
        .eq('is_read', false);

      if (error) throw error;
      setNotifications(prev => prev.map(n => ({...n, is_read: true})));
    } catch (error) {
      console.error('Error marking all as read:', error);
    }
  }

  async function deleteNotification(id: string) {
    try {
      const {error} = await supabase.from('notifications').delete().eq('id', id);
      if (error) throw error;
      setNotifications(prev => prev.filter(n => n.id !== id));
    } catch (error) {
      console.error('Error deleting notification:', error);
    }
  }

  const unreadCount = notifications.filter(n => !n.is_read).length;

  const getTypeIcon = (type: string) => {
    switch (type) {
      case 'game_interest':
        return 'üèí';
      case 'interest_accepted':
        return '‚úÖ';
      case 'game_cancelled':
        return '‚ùå';
      case 'game_updated':
        return 'üìù';
      default:
        return 'üì¢';
    }
  };

  const getTypeColor = (type: string) => {
    switch (type) {
      case 'game_interest':
        return 'bg-blue-100 text-blue-800';
      case 'interest_accepted':
        return 'bg-green-100 text-green-800';
      case 'game_cancelled':
        return 'bg-red-100 text-red-800';
      case 'game_updated':
        return 'bg-yellow-100 text-yellow-800';
      default:
        return 'bg-gray-100 text-gray-800';
    }
  };

  if (loading) {
    return (
      <div className="flex items-center justify-center min-h-screen">
        <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
      </div>
    );
  }

  return (
    <div className="container mx-auto px-4 py-8 max-w-4xl">
      {/* Header */}
      <div className="mb-6 flex items-center justify-between">
        <div className="flex items-center gap-3">
          <Bell className="h-8 w-8 text-blue-600" />
          <div>
            <h1 className="text-2xl font-bold">Notifications</h1>
            {unreadCount > 0 && (
              <p className="text-sm text-gray-600">
                You have {unreadCount} unread notification{unreadCount !== 1 ? 's' : ''}
              </p>
            )}
          </div>
        </div>
        {unreadCount > 0 && (
          <button
            onClick={markAllAsRead}
            className="flex items-center gap-2 px-4 py-2 text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700"
          >
            <CheckCheck className="h-4 w-4" />
            Mark all as read
          </button>
        )}
      </div>

      {/* Notifications List */}
      {notifications.length === 0 ? (
        <div className="bg-white rounded-lg shadow p-12 text-center">
          <Bell className="h-16 w-16 text-gray-300 mx-auto mb-4" />
          <h2 className="text-xl font-semibold text-gray-600 mb-2">No notifications yet</h2>
          <p className="text-gray-500">
            When someone shows interest in your games or accepts your requests, you'll see it here.
          </p>
        </div>
      ) : (
        <div className="space-y-2">
          {notifications.map(notification => {
            const href = notification.link ? localizeLink(notification.link) : null;
            return (
              <div
                key={notification.id}
                className={`bg-white rounded-lg shadow p-4 transition-all ${
                  !notification.is_read ? 'border-l-4 border-blue-600' : ''
                }`}
              >
                <div className="flex items-start justify-between">
                  <div className="flex-1">
                    <div className="flex items-center gap-2 mb-2">
                      <span className="text-lg">{getTypeIcon(notification.type)}</span>
                      <span
                        className={`px-2 py-1 rounded text-xs font-medium ${getTypeColor(
                          notification.type
                        )}`}
                      >
                        {notification.type.replace('_', ' ').toUpperCase()}
                      </span>
                      {!notification.is_read && (
                        <span className="px-2 py-1 bg-blue-600 text-white text-xs rounded-full">
                          NEW
                        </span>
                      )}
                    </div>

                    <h3 className="font-semibold text-gray-900 mb-1">{notification.title}</h3>

                    <p className="text-gray-600 mb-2">{notification.message}</p>

                    <div className="flex items-center gap-4">
                      {href && (
                        <Link
                          href={href}
                          className="text-sm text-blue-600 hover:text-blue-800 flex items-center gap-1"
                        >
                          <ExternalLink className="h-3 w-3" />
                          View Details
                        </Link>
                      )}

                      <span className="text-xs text-gray-500">
                        {format(new Date(notification.created_at), 'MMM d, yyyy h:mm a')}
                      </span>
                    </div>
                  </div>

                  <div className="flex items-center gap-2 ml-4">
                    {!notification.is_read && (
                      <button
                        onClick={() => markAsRead(notification.id)}
                        className="p-2 text-gray-500 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors"
                        title="Mark as read"
                      >
                        <Check className="h-4 w-4" />
                      </button>
                    )}

                    <button
                      onClick={() => deleteNotification(notification.id)}
                      className="p-2 text-gray-500 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors"
                      title="Delete notification"
                    >
                      <Trash2 className="h-4 w-4" />
                    </button>
                  </div>
                </div>
              </div>
            );
          })}
        </div>
      )}
    </div>
  );
}
</file>

<file path="app/(dashboard)/rinks/page.tsx">
'use client'

import { useCallback, useEffect, useMemo, useState } from 'react'
import Link from 'next/link'
import { createClient } from '@/lib/supabase/client'
import { formatCurrency } from '@/lib/utils/format'

type Rink = {
  id: string
  name: string
  address: string
  city: string | null
  phone: string | null
  hourly_rate: number | string | null
  amenities: string[] | null
  booking_url: string | null
}

type PriceBand = 'all' | 'budget' | 'standard' | 'premium'

export default function RinksPage() {
  const [rinks, setRinks] = useState<Rink[]>([])
  const [loading, setLoading] = useState(true)

  // UI state
  const [query, setQuery] = useState('')
  const [price, setPrice] = useState<PriceBand>('all')
  const [sort, setSort] = useState<'name' | 'price'>('name')
  const [city, setCity] = useState<string>('all')

  // Load rinks (wrapped with useCallback for stable deps)
  const fetchRinks = useCallback(async () => {
    const supabase = createClient()
    const { data, error } = await supabase
      .from('rinks')
      .select('id, name, address, city, phone, hourly_rate, amenities, booking_url')
      .order('name', { ascending: true })

    if (error) {
      console.error('Failed to load rinks:', error)
      setRinks([])
    } else {
      setRinks((data as Rink[]) || [])
    }
    setLoading(false)
  }, [])

  useEffect(() => {
    fetchRinks()
  }, [fetchRinks])

  // Distinct cities for the filter
  const cities = useMemo(() => {
    const set = new Set<string>()
    rinks.forEach((r) => r.city && set.add(r.city))
    return ['all', ...Array.from(set).sort((a, b) => a.localeCompare(b))]
  }, [rinks])

  // Helpers
  const toNum = (v: number | string | null) =>
    typeof v === 'number' ? v : typeof v === 'string' ? Number.parseFloat(v) : Number.NaN

  const band = (rate: number) => {
    if (Number.isNaN(rate)) return null
    if (rate < 170) return 'Budget'
    if (rate <= 220) return 'Standard'
    return 'Premium'
  }

  // Apply search / filters / sorting
  const filtered = useMemo(() => {
    let list = [...rinks]

    // search by name/address/city/phone
    if (query.trim()) {
      const q = query.trim().toLowerCase()
      list = list.filter((r) =>
        [r.name, r.address, r.city, r.phone].some((f) => (f ?? '').toLowerCase().includes(q))
      )
    }

    // city
    if (city !== 'all') {
      list = list.filter((r) => (r.city ?? '').toLowerCase() === city.toLowerCase())
    }

    // price band
    if (price !== 'all') {
      list = list.filter((r) => {
        const n = toNum(r.hourly_rate)
        if (Number.isNaN(n)) return false
        if (price === 'budget') return n < 170
        if (price === 'standard') return n >= 170 && n <= 220
        return n > 220 // premium
      })
    }

    // sort
    if (sort === 'name') {
      list.sort((a, b) => a.name.localeCompare(b.name))
    } else {
      list.sort((a, b) => (toNum(a.hourly_rate) || 1e9) - (toNum(b.hourly_rate) || 1e9))
    }

    return list
  }, [rinks, query, price, sort, city])

  // Quick Stats computed from the filtered list
  const stats = useMemo(() => {
    if (filtered.length === 0) {
      return { count: 0, avg: null as number | null, min: null as number | null, max: null as number | null }
    }
    const numbers = filtered
      .map((r) => toNum(r.hourly_rate))
      .filter((n) => Number.isFinite(n)) as number[]
    if (numbers.length === 0) return { count: filtered.length, avg: null, min: null, max: null }
    const sum = numbers.reduce((s, n) => s + n, 0)
    const avg = Math.round(sum / numbers.length)
    const min = Math.min(...numbers)
    const max = Math.max(...numbers)
    return { count: filtered.length, avg, min, max }
  }, [filtered])

  if (loading) {
    return (
      <div className="flex items-center justify-center min-h-[40vh]">
        <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600" />
      </div>
    )
  }

  return (
    <div className="container mx-auto px-4 py-8">
      <h1 className="text-4xl font-extrabold mb-2">Ice Rinks in Ottawa</h1>
      <p className="text-gray-600 mb-6">{filtered.length} rinks available</p>

      {/* Toolbar */}
      <div className="bg-white rounded-xl shadow p-4 mb-6 grid gap-4 md:grid-cols-4">
        <div className="md:col-span-2">
          <div className="relative">
            <input
              value={query}
              onChange={(e) => setQuery(e.target.value)}
              placeholder="Search rinks..."
              className="w-full px-4 py-2 pr-10 border border-gray-300 rounded-md"
            />
            <span className="absolute right-3 top-2.5 text-gray-400">‚åï</span>
          </div>
        </div>

        <select
          value={price}
          onChange={(e) => setPrice(e.target.value as PriceBand)}
          className="w-full px-3 py-2 border border-gray-300 rounded-md"
        >
          <option value="all">All Prices</option>
          <option value="budget">Budget (&lt; $170)</option>
          <option value="standard">Standard ($170‚Äì$220)</option>
          <option value="premium">Premium (&gt; $220)</option>
        </select>

        <select
          value={sort}
          onChange={(e) => setSort(e.target.value as 'name' | 'price')}
          className="w-full px-3 py-2 border border-gray-300 rounded-md"
        >
          <option value="name">Sort by Name</option>
          <option value="price">Price: Low ‚Üí High</option>
        </select>

        <select
          value={city}
          onChange={(e) => setCity(e.target.value)}
          className="w-full px-3 py-2 border border-gray-300 rounded-md md:col-span-1"
        >
          {cities.map((c) => (
            <option key={c} value={c}>
              {c === 'all' ? 'All Cities' : c}
            </option>
          ))}
        </select>

        <button
          onClick={() => {
            setQuery('')
            setPrice('all')
            setSort('name')
            setCity('all')
          }}
          className="w-full px-4 py-2 bg-gray-100 rounded-md hover:bg-gray-200 md:col-span-1"
        >
          Clear Filters
        </button>
      </div>

      {/* Cards */}
      {filtered.length === 0 ? (
        <div className="bg-white rounded-lg shadow p-8 text-center">
          <p className="text-gray-500">No rinks match your filters.</p>
        </div>
      ) : (
        <div className="grid gap-6 md:grid-cols-2 xl:grid-cols-3">
          {filtered.map((r) => {
            const rateNum = toNum(r.hourly_rate)
            const tag = band(rateNum)
            return (
              <div key={r.id} className="bg-white rounded-xl shadow p-6 flex flex-col gap-3">
                <div className="flex items-start justify-between">
                  <h3 className="text-xl font-semibold">{r.name}</h3>
                  {tag && (
                    <span className="text-xs px-2 py-1 rounded-full bg-green-100 text-green-700">
                      {tag}
                    </span>
                  )}
                </div>

                <div className="text-gray-600 space-y-1">
                  <div>üìç {r.address}</div>
                  {r.phone && <div>üìû {r.phone}</div>}
                  <div>üí≤ {Number.isNaN(rateNum) ? 'N/A' : `${formatCurrency(rateNum)}/hour`}</div>
                  {r.amenities && r.amenities.length > 0 && (
                    <div className="flex flex-wrap gap-2 pt-2">
                      {r.amenities.slice(0, 6).map((a) => (
                        <span
                          key={a}
                          className="text-xs px-2 py-1 rounded bg-gray-100 text-gray-700"
                        >
                          {a}
                        </span>
                      ))}
                    </div>
                  )}
                </div>

                <div className="mt-3 grid grid-cols-3 gap-2">
                  {/* Book Now ‚Üí internal booking page */}
                  <Link
                    href={`/book/${r.id}`}
                    className="col-span-1 text-center px-3 py-2 rounded bg-blue-600 text-white hover:bg-blue-700"
                  >
                    Book Now
                  </Link>

                  {/* Map ‚Üí open Google Maps place */}
                  <a
                    href={`https://www.google.com/maps?q=${encodeURIComponent(r.address)}`}
                    target="_blank"
                    rel="noreferrer"
                    className="text-center px-3 py-2 rounded border hover:bg-gray-50"
                  >
                    Map
                  </a>

                  {/* Go ‚Üí open Google Maps navigation directly */}
                  <a
                    href={`https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(
                      `${r.name} ${r.address} ${r.city ?? ''}`
                    )}`}
                    target="_blank"
                    rel="noreferrer noopener"
                    className="text-center px-3 py-2 rounded border hover:bg-gray-50"
                  >
                    Go
                  </a>
                </div>
              </div>
            )
          })}
        </div>
      )}

      {/* Quick Stats (based on filtered list) */}
      <div className="mt-10 p-6 bg-blue-50 rounded-xl flex flex-wrap items-center justify-around">
        <div className="text-center">
          <h3 className="font-bold text-lg text-blue-900">Quick Stats</h3>
          <p className="text-blue-800">Total Rinks: {stats.count}</p>
        </div>
        <div className="text-center">
          <p className="text-blue-800">
            Average Price:{' '}
            {stats.avg !== null ? `${formatCurrency(stats.avg)}/hr` : 'N/A'}
          </p>
        </div>
        <div className="text-center">
          <p className="text-blue-800">
            Lowest Price:{' '}
            {stats.min !== null ? `${formatCurrency(stats.min)}/hr` : 'N/A'}
          </p>
        </div>
        <div className="text-center">
          <p className="text-blue-800">
            Highest Price:{' '}
            {stats.max !== null ? `${formatCurrency(stats.max)}/hr` : 'N/A'}
          </p>
        </div>
      </div>
    </div>
  )
}
</file>

<file path="app/[locale]/(auth)/login/page.tsx">
//app/[locale]/login/page.tsx
import { Suspense } from 'react';
import LoginClient from './LoginClient';

export const dynamic = 'force-dynamic';
export const revalidate = 0;

export default function LoginPage() {
  return (
    <Suspense fallback={<div className="min-h-screen flex items-center justify-center">Loading...</div>}>
      <LoginClient />
    </Suspense>
  );
}
</file>

<file path="app/[locale]/(dashboard)/games/new/page.tsx">
'use client';

import {useMemo, useState} from 'react';
import {createClient} from '@/lib/supabase/client';
import {usePathname, useRouter} from 'next/navigation';
import Link from 'next/link';
import {ArrowLeft, Calendar, Clock, MapPin, Users, Trophy} from 'lucide-react';

export default function CreateGamePage() {
  const router = useRouter();
  const pathname = usePathname();
  const supabase = createClient();

  // Derive locale from the first path segment: /{locale}/...
  const locale = useMemo(() => (pathname?.split('/')?.[1] || '').trim(), [pathname]);

  // Helper to build a locale-prefixed path
  const withLocale = (p: string) => `/${locale || ''}${p}`.replace('//', '/');

  const [loading, setLoading] = useState(false);
  const [formData, setFormData] = useState({
    title: '',
    game_date: '',
    game_time: '',
    location: '',
    age_group: 'U11',
    skill_level: 'Intermediate',
    description: '',
    max_players: '',
    contact_info: ''
  });

  const ageGroups = ['U7', 'U9', 'U11', 'U13', 'U15', 'U18', 'Adult'];
  const skillLevels = ['Beginner', 'Intermediate', 'Advanced', 'Elite'];

  async function handleSubmit(e: React.FormEvent) {
    e.preventDefault();
    setLoading(true);

    try {
      // Require auth and redirect to localized login
      const {
        data: {user}
      } = await supabase.auth.getUser();

      if (!user) {
        router.push(withLocale('/login'));
        return;
      }

      // Create game invitation
      const {data, error} = await supabase
        .from('game_invitations')
        .insert({
          title: formData.title,
          game_date: formData.game_date,
          game_time: formData.game_time,
          location: formData.location,
          age_group: formData.age_group,
          skill_level: formData.skill_level,
          description: formData.description,
          max_players: formData.max_players ? parseInt(formData.max_players) : null,
          contact_info: formData.contact_info,
          status: 'open',
          created_by: user.id,
          view_count: 0,
          interested_count: 0
        })
        .select()
        .single();

      if (error) throw error;

      // Localized redirect to details page
      router.push(withLocale(`/games/${data.id}`));
    } catch (error: any) {
      console.error('Error creating game:', error);
      alert(error.message || 'Failed to create game');
    } finally {
      setLoading(false);
    }
  }

  function handleChange(
    e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement>
  ) {
    setFormData(prev => ({
      ...prev,
      [e.target.name]: e.target.value
    }));
  }

  // Use tomorrow as the earliest selectable date
  const tomorrow = new Date();
  tomorrow.setDate(tomorrow.getDate() + 1);
  const minDate = tomorrow.toISOString().split('T')[0];

  return (
    <div className="min-h-screen bg-gray-50 py-8">
      <div className="max-w-3xl mx-auto px-4">
        {/* Header */}
        <div className="mb-8">
          <Link
            href={withLocale('/games')}
            className="inline-flex items-center text-gray-600 hover:text-gray-900 mb-4"
          >
            <ArrowLeft className="h-4 w-4 mr-2" />
            Back to Games
          </Link>
          <h1 className="text-3xl font-bold text-gray-900">Post a Game</h1>
          <p className="mt-2 text-gray-600">Create a game invitation for other teams</p>
        </div>

        {/* Form */}
        <form onSubmit={handleSubmit} className="bg-white rounded-lg shadow p-6 space-y-6">
          {/* Title */}
          <div>
            <label htmlFor="title" className="block text-sm font-medium text-gray-700 mb-2">
              Game Title *
            </label>
            <input
              type="text"
              id="title"
              name="title"
              required
              value={formData.title}
              onChange={handleChange}
              placeholder="e.g., U13 Friendly Match Looking for Opponent"
              className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
            />
          </div>

          {/* Date and Time */}
          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label htmlFor="game_date" className="block text-sm font-medium text-gray-700 mb-2">
                <Calendar className="inline h-4 w-4 mr-1" />
                Game Date *
              </label>
              <input
                type="date"
                id="game_date"
                name="game_date"
                required
                min={minDate}
                value={formData.game_date}
                onChange={handleChange}
                className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
              />
            </div>
            <div>
              <label htmlFor="game_time" className="block text-sm font-medium text-gray-700 mb-2">
                <Clock className="inline h-4 w-4 mr-1" />
                Game Time *
              </label>
              <input
                type="time"
                id="game_time"
                name="game_time"
                required
                value={formData.game_time}
                onChange={handleChange}
                className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
              />
            </div>
          </div>

          {/* Location */}
          <div>
            <label htmlFor="location" className="block text-sm font-medium text-gray-700 mb-2">
              <MapPin className="inline h-4 w-4 mr-1" />
              Location *
            </label>
            <input
              type="text"
              id="location"
              name="location"
              required
              value={formData.location}
              onChange={handleChange}
              placeholder="e.g., Bell Sensplex, Kanata"
              className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
            />
          </div>

          {/* Age Group and Skill Level */}
          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label htmlFor="age_group" className="block text-sm font-medium text-gray-700 mb-2">
                <Users className="inline h-4 w-4 mr-1" />
                Age Group *
              </label>
              <select
                id="age_group"
                name="age_group"
                required
                value={formData.age_group}
                onChange={handleChange}
                className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
              >
                {ageGroups.map(group => (
                  <option key={group} value={group}>
                    {group}
                  </option>
                ))}
              </select>
            </div>
            <div>
              <label htmlFor="skill_level" className="block text-sm font-medium text-gray-700 mb-2">
                <Trophy className="inline h-4 w-4 mr-1" />
                Skill Level *
              </label>
              <select
                id="skill_level"
                name="skill_level"
                required
                value={formData.skill_level}
                onChange={handleChange}
                className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
              >
                {skillLevels.map(level => (
                  <option key={level} value={level}>
                    {level}
                  </option>
                ))}
              </select>
            </div>
          </div>

          {/* Max Players */}
          <div>
            <label htmlFor="max_players" className="block text-sm font-medium text-gray-700 mb-2">
              Max Players (Optional)
            </label>
            <input
              type="number"
              id="max_players"
              name="max_players"
              min="1"
              max="50"
              value={formData.max_players}
              onChange={handleChange}
              placeholder="e.g., 20"
              className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
            />
          </div>

          {/* Description */}
          <div>
            <label htmlFor="description" className="block text-sm font-medium text-gray-700 mb-2">
              Description
            </label>
            <textarea
              id="description"
              name="description"
              rows={4}
              value={formData.description}
              onChange={handleChange}
              placeholder="Provide additional details about the game, rules, or requirements..."
              className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
            />
          </div>

          {/* Contact Info */}
          <div>
            <label htmlFor="contact_info" className="block text-sm font-medium text-gray-700 mb-2">
              Contact Information (Optional)
            </label>
            <input
              type="text"
              id="contact_info"
              name="contact_info"
              value={formData.contact_info}
              onChange={handleChange}
              placeholder="e.g., Coach John - 613-555-0123"
              className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
            />
            <p className="mt-1 text-sm text-gray-500">This will be shared only with interested teams</p>
          </div>

          {/* Submit Buttons */}
          <div className="flex gap-4 pt-4">
            <button
              type="submit"
              disabled={loading}
              className="flex-1 bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition"
            >
              {loading ? 'Creating...' : 'Post Game'}
            </button>
            <Link
              href={withLocale('/games')}
              className="flex-1 bg-gray-200 text-gray-800 py-2 px-4 rounded-md hover:bg-gray-300 text-center transition"
            >
              Cancel
            </Link>
          </div>
        </form>

        {/* Tips */}
        <div className="mt-8 bg-blue-50 border border-blue-200 rounded-lg p-4">
          <h3 className="font-semibold text-blue-900 mb-2">Tips for a successful game post:</h3>
          <ul className="text-sm text-blue-800 space-y-1">
            <li>‚Ä¢ Include specific time and location details</li>
            <li>‚Ä¢ Be clear about skill level expectations</li>
            <li>‚Ä¢ Mention if you have ice time already booked</li>
            <li>‚Ä¢ Provide contact information for quick responses</li>
          </ul>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="app/[locale]/(dashboard)/games/page.tsx">
// app/[locale]/(dashboard)/games/page.tsx
'use client';

import {useCallback, useEffect, useMemo, useState} from 'react';
import {createClient} from '@/lib/supabase/client';
import Link from 'next/link';
import {useParams} from 'next/navigation';
import {
  Calendar,
  MapPin,
  Users,
  Trophy,
  Eye,
  Heart,
  Plus,
  AlertCircle,
  Search,
  Filter,
  X,
  BadgeInfo,
} from 'lucide-react';

type GameStatus = 'open' | 'matched' | 'closed' | 'cancelled';

interface Game {
  id: string;
  title: string;
  game_date: string;
  game_time: string;
  age_group: string;
  skill_level: string;
  description: string;
  status: GameStatus;
  location?: string;
  view_count?: number;
  interested_count?: number;
  created_at: string;
  isExpired?: boolean;
}

type DateFilter = 'all' | 'upcoming' | 'past';
type SortBy = 'date' | 'interest' | 'views';

export default function GamesPage() {
  const { locale } = useParams<{ locale: string }>();
  const supabase = useMemo(() => createClient(), []);

  // list + ui state
  const [games, setGames] = useState<Game[]>([]);
  const [filteredGames, setFilteredGames] = useState<Game[]>([]);
  const [loading, setLoading] = useState(true);

  const [dateFilter, setDateFilter] = useState<DateFilter>('upcoming');
  const [searchTerm, setSearchTerm] = useState('');
  const [ageGroupFilter, setAgeGroupFilter] = useState('all');
  const [skillLevelFilter, setSkillLevelFilter] = useState('all');
  const [locationFilter, setLocationFilter] = useState('');
  const [showFilters, setShowFilters] = useState(false);
  const [sortBy, setSortBy] = useState<SortBy>('date');

  // constants
  const ageGroups = ['U7', 'U9', 'U11', 'U13', 'U15', 'U18', 'Adult'];
  const skillLevels = ['Beginner', 'Intermediate', 'Advanced', 'Elite'];

  // status badge Ê†∑ÂºèÁªü‰∏Ä
  const statusBadge: Record<GameStatus, string> = {
    open: 'bg-green-100 text-green-800',
    matched: 'bg-blue-100 text-blue-800',
    closed: 'bg-gray-100 text-gray-800',
    cancelled: 'bg-red-100 text-red-800',
  };

  // locale-aware link helper
  const withLocale = useCallback(
    (p: string) => `/${locale || ''}${p}`.replace('//', '/'),
    [locale],
  );

  const fetchGames = useCallback(async () => {
    try {
      const { data, error } = await supabase
        .from('game_invitations')
        .select('*')
        .order('game_date', { ascending: true });

      if (error) throw error;

      // Ê†áËÆ∞ËøáÊúüÔºöÊåâÊó•ÊúüÔºà‰øùÁïôËøë 7 Â§©ÂÜÖÁöÑÂéÜÂè≤Ôºâ
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      const todayStr = today.toISOString().split('T')[0];

      const sevenDaysAgo = new Date(today);
      sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);
      const sevenDaysAgoStr = sevenDaysAgo.toISOString().split('T')[0];

      const processed: Game[] = (data || [])
        .filter((g) => !g.game_date || g.game_date >= sevenDaysAgoStr)
        .map((g) => ({
          ...(g as Game),
          // Áªü‰∏ÄÂÖúÂ∫ïÈùûÊ≥ïÁä∂ÊÄÅ
          status: (['open', 'matched', 'closed', 'cancelled'] as GameStatus[]).includes(g.status as GameStatus)
            ? (g.status as GameStatus)
            : 'open',
          isExpired: g.game_date ? g.game_date < todayStr : false,
        }));

      setGames(processed);
    } catch (e) {
      console.error('fetchGames error:', e);
      setGames([]);
    } finally {
      setLoading(false);
    }
  }, [supabase]);

  useEffect(() => {
    fetchGames();
  }, [fetchGames]);

  useEffect(() => {
    // apply filters + sorting
    let list = [...games];

    if (dateFilter === 'upcoming') list = list.filter((g) => !g.isExpired);
    if (dateFilter === 'past') list = list.filter((g) => g.isExpired);

    if (searchTerm) {
      const q = searchTerm.toLowerCase();
      list = list.filter(
        (g) =>
          g.title?.toLowerCase().includes(q) ||
          g.description?.toLowerCase().includes(q) ||
          g.location?.toLowerCase().includes(q),
      );
    }

    if (ageGroupFilter !== 'all') list = list.filter((g) => g.age_group === ageGroupFilter);
    if (skillLevelFilter !== 'all') list = list.filter((g) => g.skill_level === skillLevelFilter);

    if (locationFilter) {
      const q = locationFilter.toLowerCase();
      list = list.filter((g) => g.location?.toLowerCase().includes(q));
    }

    list.sort((a, b) => {
      switch (sortBy) {
        case 'interest':
          return (b.interested_count || 0) - (a.interested_count || 0);
        case 'views':
          return (b.view_count || 0) - (a.view_count || 0);
        case 'date':
        default:
          if (a.isExpired !== b.isExpired) return a.isExpired ? 1 : -1; // upcoming first
          return (a.game_date || '').localeCompare(b.game_date || '');
      }
    });

    setFilteredGames(list);
  }, [
    games,
    dateFilter,
    searchTerm,
    ageGroupFilter,
    skillLevelFilter,
    locationFilter,
    sortBy,
  ]);

  const clearFilters = () => {
    setSearchTerm('');
    setAgeGroupFilter('all');
    setSkillLevelFilter('all');
    setLocationFilter('');
    setDateFilter('upcoming');
    setSortBy('date');
  };

  const hasActiveFilters = () =>
    Boolean(
      searchTerm ||
        locationFilter ||
        ageGroupFilter !== 'all' ||
        skillLevelFilter !== 'all' ||
        sortBy !== 'date',
    );

  const formatDate = (dateStr: string) => {
    if (!dateStr) return 'TBD';
    const d = new Date(dateStr);
    const today = new Date();
    today.setHours(0,0,0,0);
    d.setHours(0,0,0,0);
    const diffDays = Math.round((d.getTime() - today.getTime()) / (1000 * 60 * 60 * 24));

    let relative = '';
    if (diffDays === 0) relative = ' (Today)';
    else if (diffDays === 1) relative = ' (Tomorrow)';
    else if (diffDays === -1) relative = ' (Yesterday)';
    else if (diffDays < -1) relative = ` (${Math.abs(diffDays)} days ago)`;
    else if (diffDays > 1 && diffDays <= 7) relative = ` (In ${diffDays} days)`;

    return (
      d.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' }) +
      relative
    );
  };

  if (loading) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600" />
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gray-50 py-8">
      <div className="max-w-7xl mx-auto px-4">
        {/* Header */}
        <div className="mb-8 flex justify-between items-center">
          <div>
            <h1 className="text-3xl font-bold text-gray-900">Find Games</h1>
            <p className="mt-2 text-gray-600">
              {filteredGames.length} games found
              {hasActiveFilters() && ' (filtered)'}
            </p>
          </div>

          <Link
            href={withLocale('/games/new')}
            className="flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
          >
            <Plus className="h-5 w-5 mr-2" />
            Post a Game
          </Link>
        </div>

        {/* Search + Filters */}
        <div className="mb-6 bg-white rounded-lg shadow p-4">
          <div className="flex flex-col lg:flex-row gap-4">
            <div className="flex-1 relative">
              <Search className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 h-5 w-5" />
              <input
                type="text"
                placeholder="Search games by title, description, or location..."
                value={searchTerm}
                onChange={(e) => setSearchTerm(e.target.value)}
                className="pl-10 pr-3 py-2 w-full border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
              />
            </div>

            <button
              onClick={() => setShowFilters((v) => !v)}
              className={`px-4 py-2 border rounded-md transition flex items-center gap-2 ${
                showFilters || hasActiveFilters()
                  ? 'bg-blue-50 border-blue-300 text-blue-700'
                  : 'border-gray-300 text-gray-700 hover:bg-gray-50'
              }`}
            >
              <Filter className="h-4 w-4" />
              Filters
              {hasActiveFilters() && (
                <span className="bg-blue-600 text-white text-xs px-2 py-0.5 rounded-full">
                  Active
                </span>
              )}
            </button>
          </div>

          {showFilters && (
            <div className="mt-4 pt-4 border-t grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">Age Group</label>
                <select
                  value={ageGroupFilter}
                  onChange={(e) => setAgeGroupFilter(e.target.value)}
                  className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                >
                  <option value="all">All Ages</option>
                  {ageGroups.map((g) => (
                    <option key={g} value={g}>
                      {g}
                    </option>
                  ))}
                </select>
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">Skill Level</label>
                <select
                  value={skillLevelFilter}
                  onChange={(e) => setSkillLevelFilter(e.target.value)}
                  className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                >
                  <option value="all">All Levels</option>
                  {skillLevels.map((s) => (
                    <option key={s} value={s}>
                      {s}
                    </option>
                  ))}
                </select>
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">Location</label>
                <input
                  type="text"
                  placeholder="e.g., Kanata"
                  value={locationFilter}
                  onChange={(e) => setLocationFilter(e.target.value)}
                  className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                />
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">Sort By</label>
                <select
                  value={sortBy}
                  onChange={(e) => setSortBy(e.target.value as SortBy)}
                  className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                >
                  <option value="date">Date</option>
                  <option value="interest">Most Interested</option>
                  <option value="views">Most Viewed</option>
                </select>
              </div>

              <div className="flex items-end">
                <button
                  onClick={clearFilters}
                  className="w-full px-4 py-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-md transition flex items-center justify-center gap-2"
                >
                  <X className="h-4 w-4" />
                  Clear All
                </button>
              </div>
            </div>
          )}
        </div>

        {/* Date Tabs */}
        <div className="mb-6 flex space-x-4 border-b">
          {([
            ['all', `All Games (${games.length})`],
            ['upcoming', `Upcoming (${games.filter((g) => !g.isExpired).length})`],
            ['past', `Recent Past (${games.filter((g) => g.isExpired).length})`],
          ] as const).map(([key, label]) => (
            <button
              key={key}
              onClick={() => setDateFilter(key)}
              className={`pb-2 px-1 border-b-2 transition ${
                dateFilter === key
                  ? 'border-blue-600 text-blue-600 font-medium'
                  : 'border-transparent text-gray-500 hover:text-gray-700'
              }`}
            >
              {label}
            </button>
          ))}
        </div>

        {/* Grid */}
        {filteredGames.length > 0 ? (
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {filteredGames.map((game) => {
              const expiredBadge =
                game.isExpired ? (
                  <span className="bg-gray-500 text-white text-xs px-2 py-1 rounded-full inline-flex items-center">
                    <AlertCircle className="h-3 w-3 mr-1" />
                    Expired
                  </span>
                ) : null;

              return (
                <div
                  key={game.id}
                  className={`bg-white rounded-lg shadow-md hover:shadow-lg transition-shadow relative ${
                    game.isExpired ? 'opacity-75' : ''
                  }`}
                >
                  <div className="absolute top-4 right-4 z-10 flex gap-2">
                    {/* Áªü‰∏ÄÁä∂ÊÄÅÂæΩÁ´† */}
                    <span className={`text-xs px-2 py-1 rounded-full ${statusBadge[game.status]}`}>
                      {game.status}
                    </span>
                    {expiredBadge}
                  </div>

                  <div className="p-6">
                    <h3 className="text-lg font-semibold text-gray-900 mb-4 pr-16">
                      {game.title || 'Untitled Game'}
                    </h3>

                    <div className="space-y-2 text-sm text-gray-600">
                      <div className="flex items-center">
                        <Calendar className="h-4 w-4 mr-2" />
                        <span className={game.isExpired ? 'line-through' : ''}>
                          {formatDate(game.game_date)}
                        </span>
                        {game.game_time && <span className="ml-1">at {game.game_time}</span>}
                      </div>

                      {game.location && (
                        <div className="flex items-center">
                          <MapPin className="h-4 w-4 mr-2" />
                          <span>{game.location}</span>
                        </div>
                      )}

                      <div className="flex items-center">
                        <Users className="h-4 w-4 mr-2" />
                        <span>
                          {game.age_group} - {game.skill_level}
                        </span>
                      </div>
                    </div>

                    {game.description && (
                      <p className="mt-3 text-sm text-gray-500 line-clamp-2">{game.description}</p>
                    )}

                    <div className="mt-4 flex items-center space-x-4 text-xs text-gray-500">
                      <span className="flex items-center">
                        <Eye className="h-3 w-3 mr-1" />
                        {game.view_count || 0} views
                      </span>
                      <span className="flex items-center">
                        <Heart className="h-3 w-3 mr-1" />
                        {game.interested_count || 0} interested
                      </span>
                    </div>

                    <Link
                      href={withLocale(`/games/${game.id}`)}
                      className={`mt-4 block text-center px-4 py-2 rounded-md transition ${
                        game.isExpired
                          ? 'bg-gray-400 text-white hover:bg-gray-500'
                          : 'bg-blue-600 text-white hover:bg-blue-700'
                      }`}
                    >
                      {game.isExpired ? 'View Details (Expired)' : 'View Details'}
                    </Link>
                  </div>
                </div>
              );
            })}
          </div>
        ) : (
          <div className="text-center py-12 bg-white rounded-lg shadow">
            <Trophy className="mx-auto h-12 w-12 text-gray-400 mb-4" />
            <h3 className="text-lg font-medium text-gray-900 mb-2">No games found</h3>
            <p className="text-gray-500 mb-6">
              {hasActiveFilters()
                ? 'Try adjusting your filters or search terms'
                : 'Be the first to post a game invitation!'}
            </p>
            {hasActiveFilters() ? (
              <button
                onClick={clearFilters}
                className="inline-flex items-center px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-50"
              >
                <X className="h-5 w-5 mr-2" />
                Clear Filters
              </button>
            ) : (
              <Link
                href={withLocale('/games/new')}
                className="inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700"
              >
                <Plus className="h-5 w-5 mr-2" />
                Post First Game
              </Link>
            )}
          </div>
        )}
      </div>
    </div>
  );
}
</file>

<file path="app/api/sync-ottawa-rinks/route.ts">
import { NextResponse } from 'next/server'
import { createClient } from '@/lib/supabase/client'

// Complete Ottawa rinks dataset (60 entries)
// Keep this list as-is; code below will deduplicate by address+phone in-memory.
const OTTAWA_RINKS_COMPLETE = [
  // === CITY OF OTTAWA FACILITIES (35) ===
  // Central Ottawa
  { name: 'Jim Durrell Recreation Complex', address: '1265 Walkley Rd, Ottawa, ON K1V 6P9', phone: '(613) 247-4846', hourly_rate: 275, booking_url: 'https://ottawa.ca/recreation' },
  { name: 'Canterbury Recreation Complex', address: '2185 Arch St, Ottawa, ON K1G 2H5', phone: '(613) 247-4869', hourly_rate: 185, booking_url: 'https://ottawa.ca/recreation' },
  { name: 'Jack Purcell Community Centre', address: '320 Jack Purcell Lane, Ottawa, ON K2P 2J5', phone: '(613) 564-1050', hourly_rate: 165, booking_url: 'https://ottawa.ca/recreation' },
  { name: 'Tom Brown Arena', address: '141 Bayview Rd, Ottawa, ON K1Y 4K8', phone: '(613) 247-4832', hourly_rate: 175, booking_url: 'https://ottawa.ca/recreation' },
  { name: 'Sandy Hill Arena', address: '2020 Riverside Dr, Ottawa, ON K1H 7X1', phone: '(613) 580-2532', hourly_rate: 165, booking_url: 'https://ottawa.ca/recreation' },

  // East Ottawa
  { name: 'Bob MacQuarrie Recreation Complex', address: '1490 Youville Dr, Orl√©ans, ON K1C 2X8', phone: '(613) 824-0018', hourly_rate: 250, booking_url: 'https://ottawa.ca/recreation' },
  { name: 'Ray Friel Recreation Complex', address: '1585 Tenth Line Rd, Orleans, ON K1E 3E8', phone: '(613) 830-7223', hourly_rate: 180, booking_url: 'https://ottawa.ca/recreation' },
  { name: 'Fran√ßois Dupuis Recreation Centre', address: '2263 Portobello Blvd, Ottawa, ON K4A 0X3', phone: '(613) 824-3119', hourly_rate: 180, booking_url: 'https://ottawa.ca/recreation' },
  { name: 'Potvin Arena', address: '3009 St Joseph Blvd, Orleans, ON K1C 1E1', phone: '(613) 837-9470', hourly_rate: 165, booking_url: 'https://ottawa.ca/recreation' },
  { name: 'Bernard Grandma√Ætre Arena', address: '309 McArthur Ave, Vanier, ON K1L 6P1', phone: '(613) 564-1290', hourly_rate: 160, booking_url: 'https://ottawa.ca/recreation' },
  { name: 'Navan Memorial Centre', address: '1295 Colonial Rd, Navan, ON K4B 1H8', phone: '(613) 835-2766', hourly_rate: 145, booking_url: 'https://ottawa.ca/recreation' },

  // West Ottawa
  { name: 'Nepean Sportsplex', address: '1701 Woodroffe Ave, Nepean, ON K2G 1W2', phone: '(613) 580-2828', hourly_rate: 240, booking_url: 'https://ottawa.ca/recreation' },
  { name: 'Goulbourn Recreation Complex', address: '1500 Shea Rd, Stittsville, ON K2S 0H9', phone: '(613) 580-2532', hourly_rate: 175, booking_url: 'https://ottawa.ca/recreation' },
  { name: 'W. Erskine Johnston Arena', address: '3832 Carp Rd, Carp, ON K0A 1L0', phone: '(613) 839-2273', hourly_rate: 150, booking_url: 'https://ottawa.ca/recreation' },
  { name: 'Richmond Memorial Community Centre', address: '6038 Perth St, Richmond, ON K0A 2Z0', phone: '(613) 838-5196', hourly_rate: 140, booking_url: 'https://ottawa.ca/recreation' },
  { name: 'Nick Kaneb Arena', address: '3500 Campeau Dr, Goulbourn, ON K2J 5G1', phone: '(613) 254-5048', hourly_rate: 180, booking_url: 'https://ottawa.ca/recreation' },

  // Kanata
  { name: 'Kanata Recreation Complex', address: '100 Charlie Rogers Pl, Kanata, ON K2L 4E7', phone: '(613) 591-9018', hourly_rate: 185, booking_url: 'https://ottawa.ca/recreation' },
  { name: 'Glen Cairn Community Centre', address: '110 Mikanagan Rd, Kanata, ON K2L 1C9', phone: '(613) 254-8710', hourly_rate: 160, booking_url: 'https://ottawa.ca/recreation' },
  { name: 'Mlacak Arena', address: '100 Malvern Dr, Kanata, ON K2W 0A2', phone: '(613) 591-9012', hourly_rate: 170, booking_url: 'https://ottawa.ca/recreation' },

  // Barrhaven
  { name: 'Walter Baker Sports Centre', address: '100 Malvern Dr, Barrhaven, ON K2J 4P6', phone: '(613) 580-2532', hourly_rate: 195, booking_url: 'https://ottawa.ca/recreation' },
  { name: 'Minto Recreation Complex - Barrhaven', address: '3500 Cambrian Rd, Nepean, ON K2J 0V1', phone: '(613) 692-5661', hourly_rate: 190, booking_url: 'https://ottawa.ca/recreation' },

  // South Ottawa
  { name: 'Manotick Arena', address: '5572 Doctor Leach Dr, Manotick, ON K4M 1K7', phone: '(613) 692-3571', hourly_rate: 155, booking_url: 'https://ottawa.ca/recreation' },
  { name: 'Fred Barrett Arena', address: '3280 Leitrim Rd, Ottawa, ON K1V 1H9', phone: '(613) 822-0110', hourly_rate: 170, booking_url: 'https://ottawa.ca/recreation' },
  { name: 'Howard Darwin Arena', address: '2010 Merivale Rd, Ottawa, ON K2G 1G1', phone: '(613) 225-1924', hourly_rate: 160, booking_url: 'https://ottawa.ca/recreation' },
  { name: 'Jim Tubman Chevrolet Arena', address: '2010 Merivale Rd, Ottawa, ON K2G 1G1', phone: '(613) 225-1924', hourly_rate: 160, booking_url: 'https://ottawa.ca/recreation' },

  // Community Centres
  { name: 'Dovercourt Recreation Centre', address: '411 Dovercourt Ave, Ottawa, ON K2A 0S9', phone: '(613) 798-8950', hourly_rate: 155, booking_url: 'https://ottawa.ca/recreation' },
  { name: 'Heron Community Centre', address: '1480 Heron Rd, Ottawa, ON K1V 6A5', phone: '(613) 247-4820', hourly_rate: 150, booking_url: 'https://ottawa.ca/recreation' },
  { name: 'Merivale Arena', address: '1665 Merivale Rd, Nepean, ON K2G 3K2', phone: '(613) 225-1924', hourly_rate: 165, booking_url: 'https://ottawa.ca/recreation' },
  { name: 'Brewer Arena', address: '100 Brewer Way, Ottawa, ON K1S 5T1', phone: '(613) 247-4938', hourly_rate: 170, booking_url: 'https://ottawa.ca/recreation' },
  { name: 'Lansdowne Park', address: '1015 Bank St, Ottawa, ON K1S 3W7', phone: '(613) 580-2429', hourly_rate: 185, booking_url: 'https://ottawa.ca/recreation' },

  // === PRIVATE/SEMI-PRIVATE FACILITIES (25) ===
  // Sensplex
  { name: 'Bell Sensplex', address: '1565 Maple Grove Rd, Kanata, ON K2V 1A3', phone: '(613) 599-2255', hourly_rate: 260, booking_url: 'https://sensplex.ca/book' },
  { name: 'Richcraft Sensplex', address: '4101 Innovation Dr, Kanata, ON K2K 0J3', phone: '(613) 599-2255', hourly_rate: 260, booking_url: 'https://sensplex.ca/book' },
  { name: 'Canadian Tire Centre', address: '1000 Palladium Dr, Kanata, ON K2V 1A5', phone: '(613) 599-0100', hourly_rate: 500, booking_url: 'https://www.canadiantirecentre.com' },

  // University
  { name: 'uOttawa Minto Sports Complex', address: '801 King Edward Ave, Ottawa, ON K1N 6N5', phone: '(613) 562-5800', hourly_rate: 250, booking_url: 'https://geegees.ca' },
  { name: 'Carleton Ice House', address: '3280 Leitrim Rd, Ottawa, ON K1V 1H9', phone: '(613) 792-4799', hourly_rate: 200, booking_url: 'https://athletics.carleton.ca' },
  { name: 'Algonquin College Arena', address: '1385 Woodroffe Ave, Ottawa, ON K2G 1V8', phone: '(613) 727-4723', hourly_rate: 180, booking_url: 'https://algonquincollege.com' },

  // Private
  { name: 'RA Centre', address: '2451 Riverside Dr, Ottawa, ON K1H 7X7', phone: '(613) 733-5100', hourly_rate: 225, booking_url: 'https://racentre.com' },
  { name: 'Minto Skating Club', address: '950 Somerset St W, Ottawa, ON K1R 6R1', phone: '(613) 695-5425', hourly_rate: 195, booking_url: 'https://mintoskatingclub.com' },
  { name: 'Ottawa Athletic Club', address: '3500 Riverside Dr, Ottawa, ON K1V 8N5', phone: '(613) 737-1111', hourly_rate: 210, booking_url: 'https://oac.ca' },
  { name: 'Rideau Sports Centre', address: '1 Donald St, Ottawa, ON K1K 4E4', phone: '(613) 748-1182', hourly_rate: 185, booking_url: 'https://rideausportscentre.com' },

  // School
  { name: 'St. Laurent Complex', address: '525 C√¥t√© St, Ottawa, ON K1K 0Z8', phone: '(613) 742-6761', hourly_rate: 165, booking_url: 'https://ottawa.ca' },
  { name: 'Earl of March Secondary School', address: '4 The Parkway, Kanata, ON K2K 1Y4', phone: '(613) 592-4903', hourly_rate: 155, booking_url: null },
  { name: 'Rideau High School Arena', address: '815 St. Laurent Blvd, Ottawa, ON K1K 3A7', phone: '(613) 744-6834', hourly_rate: 150, booking_url: null },

  // Training
  { name: 'Capital Skills Development', address: '2451 Riverside Dr, Ottawa, ON K1H 7X7', phone: '(613) 852-2652', hourly_rate: 195, booking_url: 'https://capitalskills.ca' },
  { name: 'Pure Hockey Arena', address: '80 Marketplace Ave, Nepean, ON K2J 5K7', phone: '(613) 823-0343', hourly_rate: 175, booking_url: 'https://purehockey.com' },
  { name: 'Warrior Ice Arena', address: '1000 Innovation Dr, Kanata, ON K2K 3E7', phone: '(613) 271-9500', hourly_rate: 180, booking_url: 'https://warriorice.ca' },

  // Additional Community
  { name: 'Orleans Recreation Complex', address: '1490 Youville Dr, Orleans, ON K1C 2X8', phone: '(613) 824-5131', hourly_rate: 165, booking_url: 'https://ottawa.ca' },
  { name: 'Blackburn Arena', address: '190 Glen Park Dr, Gloucester, ON K1B 5A3', phone: '(613) 837-1066', hourly_rate: 155, booking_url: 'https://blackburnarena.ca' },
  { name: 'Vars Community Centre', address: '40 Rockdale Rd, Vars, ON K0A 3H0', phone: '(613) 835-2766', hourly_rate: 140, booking_url: 'https://ottawa.ca' },
  { name: 'Greely Community Centre', address: '1448 Meadow Dr, Greely, ON K4P 1P5', phone: '(613) 821-1558', hourly_rate: 145, booking_url: 'https://ottawa.ca' },
  { name: 'Metcalfe Community Centre', address: '3081 8th Line Rd, Metcalfe, ON K0A 2P0', phone: '(613) 821-1224', hourly_rate: 140, booking_url: 'https://ottawa.ca' },
  { name: 'Osgoode Community Centre', address: '5660 Osgoode Main St, Osgoode, ON K0A 2W0', phone: '(613) 826-2209', hourly_rate: 145, booking_url: 'https://ottawa.ca' },
  { name: 'Russell Arena', address: '1084 Concession St, Russell, ON K4R 1C7', phone: '(613) 445-3444', hourly_rate: 150, booking_url: 'https://russell.ca' }
]

export async function GET(request: Request) {
  const { searchParams } = new URL(request.url)
  const testMode = searchParams.get('test') === 'true'

  // Skip auth in test mode, otherwise check CRON secret
  if (!testMode && process.env.NODE_ENV === 'production') {
    const authHeader = request.headers.get('authorization')
    if (authHeader !== `Bearer ${process.env.CRON_SECRET}`) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })
    }
  }

  try {
    console.log('üèí Sync started at:', new Date().toISOString())

    const supabase = createClient()

    // Current count
    const { count: currentCount } = await supabase
      .from('rinks')
      .select('*', { count: 'exact', head: true })

    // Test mode only reports status
    if (testMode) {
      return NextResponse.json({
        test: true,
        message: 'Ready to sync! Remove ?test=true to execute',
        current_rinks: currentCount || 0,
        available_rinks: OTTAWA_RINKS_COMPLETE.length,
        to_add: OTTAWA_RINKS_COMPLETE.length - (currentCount || 0),
        time: new Date().toISOString(),
      })
    }

    // --- in-memory dedup by (address + name) to allow multi-pad per address ---
const uniqueMap = new Map<string, typeof OTTAWA_RINKS_COMPLETE[number]>()
for (const r of OTTAWA_RINKS_COMPLETE) {
  const k = `${String(r.address).trim().toLowerCase()}|${String(r.name).trim().toLowerCase()}`
  if (!uniqueMap.has(k)) uniqueMap.set(k, r)
}
const INPUT = Array.from(uniqueMap.values())


    let added = 0
    let updated = 0
    const errors: string[] = []

    for (const rink of INPUT) {
      try {
        // Match by name OR address (treat same-address as the same rink)
        const { data: existing, error: findErr } = await supabase
  .from('rinks')
  .select('id, hourly_rate, address, phone, booking_url')
  .eq('address', rink.address)
  .eq('name', rink.name)
  .maybeSingle()


        if (findErr) {
          errors.push(`Lookup failed for ${rink.name}: ${findErr.message}`)
          continue
        }

        if (existing) {
          // Update if any key field changed
          const shouldUpdate =
            existing.hourly_rate !== rink.hourly_rate ||
            existing.address !== rink.address ||
            existing.phone !== rink.phone ||
            existing.booking_url !== (rink.booking_url || null)

          if (shouldUpdate) {
            const { error } = await supabase
              .from('rinks')
              .update({
                hourly_rate: rink.hourly_rate,
                address: rink.address,
                phone: rink.phone,
                booking_url: rink.booking_url || null,
                availability_hours: '6:00 AM - 11:00 PM',
                source: 'ottawa_sync',
              })
              .eq('id', existing.id)

            if (error) {
              errors.push(`Update failed for ${rink.name}: ${error.message}`)
            } else {
              updated++
              console.log(`‚úÖ Updated: ${rink.name}`)
            }
          }
        } else {
          // New rink: simple amenities heuristic
          const amenitiesList = ['parking', 'canteen', 'wheelchair_accessible']
          if (rink.hourly_rate > 200) amenitiesList.push('skate_rental')
          if (rink.hourly_rate > 250) amenitiesList.push('pro_shop')

          const { error } = await supabase
            .from('rinks')
            .insert({
              name: rink.name,
              address: rink.address,
              phone: rink.phone,
              hourly_rate: rink.hourly_rate,
              booking_url: rink.booking_url || null,
              availability_hours: '6:00 AM - 11:00 PM',
              source: 'ottawa_sync',
              amenities: amenitiesList,
            })

          if (error) {
            errors.push(`Insert failed for ${rink.name}: ${error.message}`)
          } else {
            added++
            console.log(`‚úÖ Added: ${rink.name}`)
          }
        }
      } catch (e: any) {
        errors.push(`Error processing ${rink.name}: ${e.message}`)
      }
    }

    // Write log
    await supabase
      .from('rink_updates_log')
      .insert({
        changes: {
          added,
          updated,
          errors: errors.length,
          total_processed: OTTAWA_RINKS_COMPLETE.length,
          error_details: errors.length > 0 ? errors : null,
        },
        update_type: 'full_sync',
      })

    // Final count
    const { count: finalCount } = await supabase
      .from('rinks')
      .select('*', { count: 'exact', head: true })

    console.log(`üéâ Sync completed: ${added} added, ${updated} updated`)

    return NextResponse.json({
      success: true,
      message: 'Sync completed successfully!',
      stats: {
        initial_count: currentCount || 0,
        final_count: finalCount || 0,
        added,
        updated,
        errors: errors.length,
      },
      errors: errors.length > 0 ? errors : undefined,
      time: new Date().toISOString(),
    })
  } catch (error: any) {
    console.error('‚ùå Sync error:', error)
    return NextResponse.json(
      { error: 'Sync failed', details: error?.message },
      { status: 500 }
    )
  }
}

export async function POST(request: Request) {
  return GET(request)
}
</file>

<file path="app/layout.tsx">
// app/layout.tsx
import type { ReactNode } from 'react';

export default function RootLayout({ children }: { children: ReactNode }) {
  return children;
}
</file>

<file path="app/page.tsx">
// app/page.tsx
import {redirect} from 'next/navigation';

export default function Root() {
  // Áªü‰∏ÄÈáçÂÆöÂêëÂà∞ /enÔºàmiddleware ‰πü‰ºöÂÖúÂ∫ïÔºâ
  redirect('/en');
}
</file>

<file path="app/[locale]/(dashboard)/my-games/page.tsx">
'use client';

import { useEffect, useState } from 'react';
import { createClient } from '@/lib/supabase/client';
import Link from 'next/link';
import { useRouter } from 'next/navigation';
import { 
  Calendar, 
  MapPin, 
  Users, 
  Eye, 
  Heart, 
  Edit, 
  X,
  Plus,
  Trophy,
  Clock,
  CheckCircle,
  AlertCircle,
  Edit2
} from 'lucide-react';

interface Game {
  id: string;
  title: string;
  game_date: string;
  game_time: string;
  location: string;
  age_group: string;
  skill_level: string;
  description: string;
  status: string;
  view_count: number;
  interested_count: number;
  created_at: string;
}

interface GameInterest {
  id: string;
  game_id: string;
  user_id: string;
  status: string;
  created_at: string;
  game_invitations: Game;
}

interface Stats {
  total: number;
  open: number;
  matched: number;
  cancelled: number;
  totalViews: number;
  totalInterested: number;
}

export default function MyGamesPage() {
  const [games, setGames] = useState<Game[]>([]);
  const [interestedGames, setInterestedGames] = useState<GameInterest[]>([]);
  const [loading, setLoading] = useState(true);
  const [stats, setStats] = useState<Stats>({
    total: 0,
    open: 0,
    matched: 0,
    cancelled: 0,
    totalViews: 0,
    totalInterested: 0
  });
  const [filter, setFilter] = useState<'all' | 'open' | 'matched' | 'cancelled'>('all');
  const [activeTab, setActiveTab] = useState<'posted' | 'interested'>('posted');
  
  const router = useRouter();
  const supabase = createClient();

  useEffect(() => {
    loadMyGames();
  }, []);

  async function loadMyGames() {
    try {
      const { data: { user } } = await supabase.auth.getUser();
      if (!user) {
        router.push('/login');
        return;
      }

      // Load posted games
      const { data, error } = await supabase
        .from('game_invitations')
        .select('*')
        .eq('created_by', user.id)
        .order('created_at', { ascending: false });

      // Load interested games
      const { data: interests, error: interestError } = await supabase
        .from('game_interests')
        .select(`
          *,
          game_invitations (*)
        `)
        .eq('user_id', user.id)
        .order('created_at', { ascending: false });

      if (error) throw error;

      const gamesData = data || [];
      setGames(gamesData);
      setInterestedGames(interests || []);

      // Calculate stats for posted games
      const statsData = {
        total: gamesData.length,
        open: gamesData.filter(g => g.status === 'open').length,
        matched: gamesData.filter(g => g.status === 'matched').length,
        cancelled: gamesData.filter(g => g.status === 'cancelled').length,
        totalViews: gamesData.reduce((sum, g) => sum + (g.view_count || 0), 0),
        totalInterested: gamesData.reduce((sum, g) => sum + (g.interested_count || 0), 0)
      };
      setStats(statsData);

    } catch (error) {
      console.error('Error loading games:', error);
    } finally {
      setLoading(false);
    }
  }

  async function updateGameStatus(gameId: string, newStatus: string) {
    try {
      const { error } = await supabase
        .from('game_invitations')
        .update({ status: newStatus })
        .eq('id', gameId);

      if (error) throw error;

      loadMyGames();
      
      if (newStatus === 'cancelled') {
        alert('Game cancelled successfully');
      } else if (newStatus === 'matched') {
        alert('Game marked as matched');
      }
    } catch (error) {
      console.error('Error updating game:', error);
      alert('Failed to update game status');
    }
  }

  async function deleteGame(gameId: string) {
    if (!confirm('Are you sure you want to delete this game? This action cannot be undone.')) {
      return;
    }

    try {
      const { error } = await supabase
        .from('game_invitations')
        .delete()
        .eq('id', gameId);

      if (error) throw error;

      loadMyGames();
      alert('Game deleted successfully');
    } catch (error) {
      console.error('Error deleting game:', error);
      alert('Failed to delete game');
    }
  }

  async function removeInterest(interestId: string) {
    if (!confirm('Remove your interest in this game?')) {
      return;
    }

    try {
      const { error } = await supabase
        .from('game_interests')
        .delete()
        .eq('id', interestId);

      if (error) throw error;

      loadMyGames();
    } catch (error) {
      console.error('Error removing interest:', error);
      alert('Failed to remove interest');
    }
  }

  function formatDate(dateStr: string) {
    if (!dateStr) return 'TBD';
    const date = new Date(dateStr);
    const today = new Date();
    const diffTime = date.getTime() - today.getTime();
    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
    
    let relativeTime = '';
    if (diffDays === 0) relativeTime = ' (Today)';
    else if (diffDays === 1) relativeTime = ' (Tomorrow)';
    else if (diffDays === -1) relativeTime = ' (Yesterday)';
    else if (diffDays < -1) relativeTime = ` (${Math.abs(diffDays)} days ago)`;
    else if (diffDays > 1 && diffDays <= 7) relativeTime = ` (in ${diffDays} days)`;
    
    return new Date(dateStr).toLocaleDateString('en-US', { 
      weekday: 'short',
      month: 'short', 
      day: 'numeric' 
    }) + relativeTime;
  }

  function getStatusBadge(status: string) {
    switch (status) {
      case 'open':
        return <span className="px-2 py-1 text-xs rounded-full bg-green-100 text-green-800">Open</span>;
      case 'matched':
        return <span className="px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-800">Matched</span>;
      case 'cancelled':
        return <span className="px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-800">Cancelled</span>;
      default:
        return <span className="px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-800">{status}</span>;
    }
  }

  const filteredGames = filter === 'all' 
    ? games 
    : games.filter(g => g.status === filter);

  if (loading) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gray-50 py-8">
      <div className="max-w-7xl mx-auto px-4">
        {/* Header */}
        <div className="mb-8 flex justify-between items-center">
          <div>
            <h1 className="text-3xl font-bold text-gray-900">My Games</h1>
            <p className="mt-2 text-gray-600">
              {activeTab === 'posted' ? 'Manage your posted games' : 'Games you\'re interested in'}
            </p>
          </div>
          <Link
            href="/games/new"
            className="flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
          >
            <Plus className="h-5 w-5 mr-2" />
            Post New Game
          </Link>
        </div>

        {/* Main Tabs */}
        <div className="mb-6 flex space-x-1 bg-gray-100 p-1 rounded-lg">
          <button
            onClick={() => setActiveTab('posted')}
            className={`flex-1 py-2 px-4 rounded-md transition ${
              activeTab === 'posted'
                ? 'bg-white text-blue-600 shadow-sm font-medium'
                : 'text-gray-600 hover:text-gray-900'
            }`}
          >
            My Posted Games ({games.length})
          </button>
          <button
            onClick={() => setActiveTab('interested')}
            className={`flex-1 py-2 px-4 rounded-md transition ${
              activeTab === 'interested'
                ? 'bg-white text-blue-600 shadow-sm font-medium'
                : 'text-gray-600 hover:text-gray-900'
            }`}
          >
            Games I'm Interested In ({interestedGames.length})
          </button>
        </div>

        {activeTab === 'posted' ? (
          <>
            {/* Stats Cards - Only for posted games */}
            <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-8">
              <div className="bg-white rounded-lg shadow p-4">
                <div className="text-2xl font-bold text-gray-900">{stats.total}</div>
                <div className="text-sm text-gray-500">Total Games</div>
              </div>
              <div className="bg-white rounded-lg shadow p-4">
                <div className="text-2xl font-bold text-green-600">{stats.open}</div>
                <div className="text-sm text-gray-500">Open</div>
              </div>
              <div className="bg-white rounded-lg shadow p-4">
                <div className="text-2xl font-bold text-blue-600">{stats.matched}</div>
                <div className="text-sm text-gray-500">Matched</div>
              </div>
              <div className="bg-white rounded-lg shadow p-4">
                <div className="text-2xl font-bold text-gray-600">{stats.cancelled}</div>
                <div className="text-sm text-gray-500">Cancelled</div>
              </div>
              <div className="bg-white rounded-lg shadow p-4">
                <div className="text-2xl font-bold text-purple-600">{stats.totalViews}</div>
                <div className="text-sm text-gray-500">Total Views</div>
              </div>
              <div className="bg-white rounded-lg shadow p-4">
                <div className="text-2xl font-bold text-red-600">{stats.totalInterested}</div>
                <div className="text-sm text-gray-500">Total Interested</div>
              </div>
            </div>

            {/* Filter Tabs - Only for posted games */}
            <div className="mb-6 flex space-x-4 border-b">
              <button
                onClick={() => setFilter('all')}
                className={`pb-2 px-1 border-b-2 transition ${
                  filter === 'all' 
                    ? 'border-blue-600 text-blue-600 font-medium' 
                    : 'border-transparent text-gray-500 hover:text-gray-700'
                }`}
              >
                All ({games.length})
              </button>
              <button
                onClick={() => setFilter('open')}
                className={`pb-2 px-1 border-b-2 transition ${
                  filter === 'open' 
                    ? 'border-blue-600 text-blue-600 font-medium' 
                    : 'border-transparent text-gray-500 hover:text-gray-700'
                }`}
              >
                Open ({stats.open})
              </button>
              <button
                onClick={() => setFilter('matched')}
                className={`pb-2 px-1 border-b-2 transition ${
                  filter === 'matched' 
                    ? 'border-blue-600 text-blue-600 font-medium' 
                    : 'border-transparent text-gray-500 hover:text-gray-700'
                }`}
              >
                Matched ({stats.matched})
              </button>
              <button
                onClick={() => setFilter('cancelled')}
                className={`pb-2 px-1 border-b-2 transition ${
                  filter === 'cancelled' 
                    ? 'border-blue-600 text-blue-600 font-medium' 
                    : 'border-transparent text-gray-500 hover:text-gray-700'
                }`}
              >
                Cancelled ({stats.cancelled})
              </button>
            </div>

            {/* Posted Games List */}
            {filteredGames.length > 0 ? (
              <div className="space-y-4">
                {filteredGames.map((game) => (
                  <div key={game.id} className="bg-white rounded-lg shadow hover:shadow-md transition-shadow">
                    <div className="p-6">
                      <div className="flex items-start justify-between">
                        <div className="flex-1">
                          <div className="flex items-center space-x-3 mb-2">
                            <h3 className="text-lg font-semibold text-gray-900">
                              {game.title}
                            </h3>
                            {getStatusBadge(game.status)}
                          </div>

                          <div className="grid md:grid-cols-2 gap-4 text-sm text-gray-600">
                            <div className="space-y-1">
                              <div className="flex items-center">
                                <Calendar className="h-4 w-4 mr-2" />
                                {formatDate(game.game_date)} at {game.game_time || 'TBD'}
                              </div>
                              <div className="flex items-center">
                                <MapPin className="h-4 w-4 mr-2" />
                                {game.location || 'Location TBD'}
                              </div>
                              <div className="flex items-center">
                                <Users className="h-4 w-4 mr-2" />
                                {game.age_group} - {game.skill_level}
                              </div>
                            </div>
                            
                            <div className="space-y-1">
                              <div className="flex items-center">
                                <Eye className="h-4 w-4 mr-2" />
                                {game.view_count || 0} views
                              </div>
                              <div className="flex items-center">
                                <Heart className="h-4 w-4 mr-2" />
                                {game.interested_count || 0} interested
                              </div>
                              <div className="flex items-center">
                                <Clock className="h-4 w-4 mr-2" />
                                Created {new Date(game.created_at).toLocaleDateString()}
                              </div>
                            </div>
                          </div>

                          {game.description && (
                            <p className="mt-3 text-sm text-gray-500 line-clamp-2">
                              {game.description}
                            </p>
                          )}

                          {/* Interest Alert */}
                          {game.interested_count > 0 && game.status === 'open' && (
                            <div className="mt-3 p-2 bg-blue-50 border border-blue-200 rounded text-sm">
                              <AlertCircle className="inline h-4 w-4 text-blue-600 mr-1" />
                              <span className="text-blue-800">
                                {game.interested_count} team{game.interested_count > 1 ? 's are' : ' is'} interested! 
                                <Link href="/notifications" className="ml-2 underline font-medium">
                                  View in notifications
                                </Link>
                              </span>
                            </div>
                          )}
                        </div>

                        {/* Actions */}
                        <div className="ml-4 flex flex-col space-y-2">
                          <Link
                            href={`/games/${game.id}`}
                            className="text-blue-600 hover:text-blue-800 text-sm"
                          >
                            View Details
                          </Link>
                          
                          <Link
                            href={`/games/${game.id}/edit`}
                            className="text-purple-600 hover:text-purple-800 text-sm"
                          >
                            Edit Game
                          </Link>
                          
                          {game.status === 'open' && (
                            <>
                              <button
                                onClick={() => updateGameStatus(game.id, 'matched')}
                                className="text-green-600 hover:text-green-800 text-sm text-left"
                              >
                                Mark as Matched
                              </button>
                              <button
                                onClick={() => updateGameStatus(game.id, 'cancelled')}
                                className="text-orange-600 hover:text-orange-800 text-sm text-left"
                              >
                                Cancel Game
                              </button>
                            </>
                          )}
                          
                          {game.status === 'cancelled' && (
                            <button
                              onClick={() => updateGameStatus(game.id, 'open')}
                              className="text-green-600 hover:text-green-800 text-sm text-left"
                            >
                              Reopen Game
                            </button>
                          )}
                          
                          <button
                            onClick={() => deleteGame(game.id)}
                            className="text-red-600 hover:text-red-800 text-sm text-left"
                          >
                            Delete
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            ) : (
              <div className="text-center py-12 bg-white rounded-lg shadow">
                <Trophy className="mx-auto h-12 w-12 text-gray-400 mb-4" />
                <h3 className="text-lg font-medium text-gray-900 mb-2">
                  {filter === 'all' ? 'No games posted yet' : `No ${filter} games`}
                </h3>
                <p className="text-gray-500 mb-6">Start by posting your first game invitation</p>
                <Link
                  href="/games/new"
                  className="inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700"
                >
                  <Plus className="h-5 w-5 mr-2" />
                  Post Your First Game
                </Link>
              </div>
            )}
          </>
        ) : (
          /* Interested Games Tab */
          <div className="space-y-4">
            {interestedGames.length > 0 ? (
              interestedGames.map((interest) => (
                <div key={interest.id} className="bg-white rounded-lg shadow hover:shadow-md transition-shadow">
                  <div className="p-6">
                    <div className="flex items-start justify-between">
                      <div className="flex-1">
                        <div className="flex items-center space-x-3 mb-2">
                          <h3 className="text-lg font-semibold text-gray-900">
                            {interest.game_invitations?.title}
                          </h3>
                          {getStatusBadge(interest.game_invitations?.status)}
                        </div>

                        <div className="grid md:grid-cols-2 gap-4 text-sm text-gray-600">
                          <div className="space-y-1">
                            <div className="flex items-center">
                              <Calendar className="h-4 w-4 mr-2" />
                              {formatDate(interest.game_invitations?.game_date)} at {interest.game_invitations?.game_time || 'TBD'}
                            </div>
                            <div className="flex items-center">
                              <MapPin className="h-4 w-4 mr-2" />
                              {interest.game_invitations?.location || 'Location TBD'}
                            </div>
                            <div className="flex items-center">
                              <Users className="h-4 w-4 mr-2" />
                              {interest.game_invitations?.age_group} - {interest.game_invitations?.skill_level}
                            </div>
                          </div>
                          
                          <div className="space-y-1">
                            <div className="flex items-center">
                              <Heart className="h-4 w-4 mr-2" />
                              Interested since {new Date(interest.created_at).toLocaleDateString()}
                            </div>
                            <div className="flex items-center">
                              <CheckCircle className="h-4 w-4 mr-2" />
                              Status: {interest.status || 'pending'}
                            </div>
                          </div>
                        </div>

                        {interest.game_invitations?.description && (
                          <p className="mt-3 text-sm text-gray-500 line-clamp-2">
                            {interest.game_invitations.description}
                          </p>
                        )}
                      </div>

                      {/* Actions */}
                      <div className="ml-4 flex flex-col space-y-2">
                        <Link
                          href={`/games/${interest.game_invitations?.id}`}
                          className="text-blue-600 hover:text-blue-800 text-sm"
                        >
                          View Details
                        </Link>
                        
                        <button
                          onClick={() => removeInterest(interest.id)}
                          className="text-red-600 hover:text-red-800 text-sm text-left"
                        >
                          Remove Interest
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              ))
            ) : (
              <div className="text-center py-12 bg-white rounded-lg shadow">
                <Heart className="mx-auto h-12 w-12 text-gray-400 mb-4" />
                <h3 className="text-lg font-medium text-gray-900 mb-2">No games interested yet</h3>
                <p className="text-gray-500 mb-6">Browse available games and show your interest</p>
                <Link
                  href="/games"
                  className="inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700"
                >
                  Browse Games
                </Link>
              </div>
            )}
          </div>
        )}
      </div>
    </div>
  );
}
</file>

<file path="components/layout/navbar.tsx">
// components/layout/navbar.tsx
'use client';

import Link from 'next/link';
import {useEffect, useState, useMemo, Suspense} from 'react'; // ‚Üê Ê∑ªÂä† Suspense
import {usePathname} from 'next/navigation';
import {createClient} from '@/lib/supabase/client';
import {User} from '@supabase/supabase-js';
import {Home, Users, MapPin, Bell, LogOut, User as UserIcon, Trophy} from 'lucide-react';
import LocaleSwitcher from '@/components/LocaleSwitcher';

function cx(...cls: (string | false | null | undefined)[]) {
  return cls.filter(Boolean).join(' ');
}

const SUPPORTED = new Set(['en', 'fr']);

export default function Navbar() {
  const supabase = useMemo(() => createClient(), []);
  const [user, setUser] = useState<User | null>(null);
  const pathname = usePathname();

  const seg = pathname?.split('/').filter(Boolean)[0] ?? '';
  const locale = SUPPORTED.has(seg as any) ? (seg as 'en' | 'fr') : 'en';
  const withLocale = (p: string) => (`/${locale}${p}`).replace(/\/{2,}/g, '/');

  useEffect(() => {
    let unsub: (() => void) | undefined;
    (async () => {
      const {data: {user}} = await supabase.auth.getUser();
      setUser(user ?? null);
      const {data} = supabase.auth.onAuthStateChange((_e, session) => {
        setUser(session?.user ?? null);
      });
      unsub = () => data.subscription.unsubscribe();
    })();
    return () => unsub?.();
  }, [supabase]);

  const isActive = (href: string) => pathname?.startsWith(withLocale(href));

  const logout = async () => {
    await supabase.auth.signOut();
    window.location.href = withLocale('/');
  };

  return (
    <header className="sticky top-0 z-40 bg-white/90 backdrop-blur border-b">
      <nav className="container mx-auto h-16 px-4 flex items-center justify-between">
        <Link href={withLocale('/')} className="flex items-center gap-3 group" aria-label="Go home">
          <span
            aria-hidden
            className="inline-flex h-10 w-10 items-center justify-center rounded-2xl
                       bg-gradient-to-br from-blue-600 to-sky-400 text-white
                       shadow-[0_8px_20px_rgba(56,189,248,.35)]
                       ring-1 ring-white/30 transition-transform duration-200 ease-out
                       group-hover:-translate-y-0.5"
          >
            <Trophy className="h-5 w-5" />
          </span>
          <span
            className="text-2xl font-extrabold tracking-tight
                       bg-clip-text text-transparent bg-gradient-to-r from-slate-900 to-sky-600
                       drop-shadow-sm transition-colors duration-200
                       group-hover:from-slate-900 group-hover:to-sky-500"
          >
            HockeyHub
          </span>
        </Link>

        <ul className="hidden md:flex items-center gap-6 text-[15px]">
          <li>
            <Link
              href={withLocale('/games')}
              className={cx(
                'inline-flex items-center gap-2 px-3 py-2 rounded-lg transition',
                isActive('/games')
                  ? 'bg-sky-50 text-sky-700 ring-1 ring-sky-200'
                  : 'text-slate-700 hover:text-sky-700 hover:bg-slate-50'
              )}
            >
              <Home className="h-4 w-4" /> Games
            </Link>
          </li>
          <li>
            <Link
              href={withLocale('/clubs')}
              className={cx(
                'inline-flex items-center gap-2 px-3 py-2 rounded-lg transition',
                isActive('/clubs')
                  ? 'bg-sky-50 text-sky-700 ring-1 ring-sky-200'
                  : 'text-slate-700 hover:text-sky-700 hover:bg-slate-50'
              )}
            >
              <Users className="h-4 w-4" /> Clubs
            </Link>
          </li>
          <li>
            <Link
              href={withLocale('/rinks')}
              className={cx(
                'inline-flex items-center gap-2 px-3 py-2 rounded-lg transition',
                isActive('/rinks')
                  ? 'bg-sky-50 text-sky-700 ring-1 ring-sky-200'
                  : 'text-slate-700 hover:text-sky-700 hover:bg-slate-50'
              )}
            >
              <MapPin className="h-4 w-4" /> Rinks
            </Link>
          </li>
        </ul>

        <div className="flex items-center gap-3">
          {/* ‚úÖ Áî® Suspense ÂåÖË£π LocaleSwitcher */}
          <Suspense fallback={<div className="w-20 h-8" />}>
            <LocaleSwitcher />
          </Suspense>

          {user ? (
            <>
              <Link
                href={withLocale('/notifications')}
                className="hidden sm:inline-flex h-9 items-center gap-2 px-3 rounded-lg
                           text-slate-700 hover:text-sky-700 hover:bg-slate-50 transition"
              >
                <Bell className="h-4 w-4" /> Notifications
              </Link>

              <Link
                href={withLocale('/games/new')}
                className="hidden sm:inline-flex h-9 items-center px-4 rounded-lg text-white
                           bg-gradient-to-r from-blue-600 to-sky-500 hover:to-sky-400
                           shadow hover:shadow-md transition"
              >
                Post Game
              </Link>

              <div className="relative group">
                <button
                  className="h-9 w-9 inline-flex items-center justify-center rounded-full bg-slate-100
                             hover:bg-slate-200 text-slate-700"
                  aria-label="Open user menu"
                >
                  <UserIcon className="h-5 w-5" />
                </button>
                <div
                  className="absolute right-0 mt-2 w-44 bg-white rounded-lg border shadow-lg py-2
                             invisible opacity-0 group-hover:visible group-hover:opacity-100
                             transition"
                >
                  <Link href={withLocale('/profile')} className="block px-3 py-2 text-sm hover:bg-slate-50">
                    My Profile
                  </Link>
                  <button
                    onClick={logout}
                    className="w-full text-left px-3 py-2 text-sm hover:bg-slate-50 flex items-center gap-2"
                  >
                    <LogOut className="h-4 w-4" /> Logout
                  </button>
                </div>
              </div>
            </>
          ) : (
            <>
              <Link
                href={withLocale('/login')}
                className="h-9 inline-flex items-center px-3 rounded-lg text-slate-700
                           hover:text-sky-700 hover:bg-slate-50 transition"
              >
                Login
              </Link>
              <Link
                href={withLocale('/register')}
                className="h-9 inline-flex items-center px-4 rounded-lg text-white
                           bg-gradient-to-r from-blue-600 to-sky-500 hover:to-sky-400
                           shadow hover:shadow-md transition"
              >
                Sign Up
              </Link>
            </>
          )}
        </div>
      </nav>

      <div className="h-[3px] w-full bg-gradient-to-r from-blue-600 via-sky-400 to-blue-600" />
    </header>
  );
}
</file>

<file path="package.json">
{
  "name": "hockeyhub",
  "version": "2.0.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "next lint"
  },
  "dependencies": {
    "@hookform/resolvers": "^3.9.0",
    "@radix-ui/react-avatar": "^1.1.0",
    "@radix-ui/react-dropdown-menu": "^2.1.1",
    "@radix-ui/react-label": "^2.1.7",
    "@radix-ui/react-slot": "^1.2.3",
    "@react-email/components": "^0.0.27",
    "@stripe/stripe-js": "^4.8.0",
    "@supabase/auth-helpers-nextjs": "^0.10.0",
    "@supabase/ssr": "^0.5.0",
    "@supabase/supabase-js": "^2.58.0",
    "@tanstack/react-query": "^5.59.0",
    "@tremor/react": "^3.18.3",
    "class-variance-authority": "^0.7.1",
    "clsx": "^2.1.1",
    "date-fns": "^3.6.0",
    "framer-motion": "^11.18.2",
    "lucide-react": "^0.454.0",
    "next": "^15.5.4",
    "next-intl": "^4.3.9",
    "react": "^18.3.1",
    "react-dom": "^18.3.1",
    "react-dropzone": "^14.2.3",
    "react-hook-form": "^7.53.0",
    "react-hot-toast": "^2.4.1",
    "react-type-animation": "^3.2.0",
    "recharts": "^2.12.7",
    "resend": "^4.0.0",
    "sonner": "^1.5.0",
    "stripe": "^17.0.0",
    "tailwind-merge": "^2.6.0",
    "zod": "^3.23.8"
  },
  "devDependencies": {
    "@tailwindcss/aspect-ratio": "^0.4.2",
    "@tailwindcss/container-queries": "^0.1.1",
    "@tailwindcss/forms": "^0.5.10",
    "@tailwindcss/postcss": "^4.1.12",
    "@tailwindcss/typography": "^0.5.16",
    "@types/node": "^20",
    "@types/react": "^18",
    "@types/react-dom": "^18",
    "autoprefixer": "^10.4.21",
    "eslint": "^8",
    "eslint-config-next": "14.2.5",
    "eslint-import-resolver-typescript": "^4.4.4",
    "postcss": "^8.5.6",
    "tailwindcss": "^3.4.1",
    "tailwindcss-animate": "^1.0.7",
    "typescript": "^5"
  }
}
</file>

<file path="app/(dashboard)/games/[id]/page.tsx">
'use client'

import { useState, useEffect } from 'react'
import { createClient } from '@/lib/supabase/client'
import { useParams, useRouter } from 'next/navigation'
import RatingStars from '@/components/rating/RatingStars'

interface Game {
  id: string
  title: string
  game_date: string
  game_time: string
  age_group: string
  skill_level: string
  description: string
  status: string
  created_by: string
  rink_id: string
  host_club_id: string
  guest_club_id: string | null
  view_count?: number
  interested_count?: number
  created_at: string
  creator?: {
    full_name: string
    email: string
    phone: string
  }
  host_club?: {
    name: string
    contact_email: string
    contact_phone: string
  }
  rink?: {
    name: string
    address: string
    phone: string
  }
}

interface GameInterest {
  id: string
  game_id: string
  user_id: string
  message: string
  status: string
  created_at: string
}

export default function GameDetailsPage() {
  const params = useParams()
  const router = useRouter()
  const [game, setGame] = useState<Game | null>(null)
  const [loading, setLoading] = useState(true)
  const [currentUser, setCurrentUser] = useState<any>(null)
  const [isInterested, setIsInterested] = useState(false)
  const [showContactInfo, setShowContactInfo] = useState(false)
  const [message, setMessage] = useState('')
  const [showMessageForm, setShowMessageForm] = useState(false)
  
  // Rating states
  const [hasRated, setHasRated] = useState(false)
  const [userRating, setUserRating] = useState(0)
  const [tempRating, setTempRating] = useState(0)
  const [ratingComment, setRatingComment] = useState('')

  useEffect(() => {
    loadGameDetails()
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [params.id])

  const loadGameDetails = async () => {
    try {
      const supabase = createClient()
      
      // Get current user
      const { data: { user } } = await supabase.auth.getUser()
      setCurrentUser(user)

      // Load game details
      const { data: gameData, error: gameError } = await supabase
        .from('game_invitations')
        .select('*')
        .eq('id', params.id)
        .single()

      if (gameError) {
        console.error('Error loading game:', gameError)
        return
      }

      // Load creator info
      if (gameData?.created_by) {
        const { data: creatorData } = await supabase
          .from('profiles')
          .select('full_name, email, phone')
          .eq('id', gameData.created_by)
          .single()

        if (creatorData) {
          gameData.creator = creatorData
        }
      }

      // Load host club info
      if (gameData?.host_club_id) {
        const { data: clubData } = await supabase
          .from('clubs')
          .select('name, contact_email, contact_phone')
          .eq('id', gameData.host_club_id)
          .single()

        if (clubData) {
          gameData.host_club = clubData
        }
      }

      // Load rink info
      if (gameData?.rink_id) {
        const { data: rinkData } = await supabase
          .from('rinks')
          .select('name, address, phone')
          .eq('id', gameData.rink_id)
          .single()

        if (rinkData) {
          gameData.rink = rinkData
        }
      }

      setGame(gameData)

      // Check if current user is interested
      if (user) {
        const { data: interestData } = await supabase
          .from('game_interests')
          .select('*')
          .eq('game_id', params.id)
          .eq('user_id', user.id)
          .single()

        if (interestData) {
          setIsInterested(true)
          if (interestData.status === 'accepted') {
            setShowContactInfo(true)
          }
        }

        // Check if user already rated (for matched games)
        if (gameData.status === 'matched') {
          const { data: ratingData } = await supabase
            .from('game_ratings')
            .select('*')
            .eq('game_id', params.id)
            .eq('rater_id', user.id)
            .single()
          
          if (ratingData) {
            setHasRated(true)
            setUserRating(ratingData.rating)
          }
        }
      }

      // Update view count (only if not the creator)
      if (user && gameData.created_by !== user.id) {
        await supabase
          .from('game_invitations')
          .update({ 
            view_count: (gameData.view_count || 0) + 1 
          })
          .eq('id', params.id)
      }

    } catch (error) {
      console.error('Error in loadGameDetails:', error)
    } finally {
      setLoading(false)
    }
  }

  const handleInterest = async () => {
    if (!currentUser) {
      router.push('/login')
      return
    }

    try {
      const supabase = createClient()

      if (!isInterested) {
        // Express interest
        const { error } = await supabase
          .from('game_interests')
          .insert({
            game_id: params.id,
            user_id: currentUser.id,
            message: message,
            status: 'pending'
          })

        if (!error) {
          setIsInterested(true)
          setShowMessageForm(false)
          setMessage('')
          
          // Update interested count
          if (game) {
            await supabase
              .from('game_invitations')
              .update({ 
                interested_count: (game.interested_count || 0) + 1 
              })
              .eq('id', params.id)

            // Reload game data
            loadGameDetails()
          }
        }
      } else {
        // Remove interest
        await supabase
          .from('game_interests')
          .delete()
          .eq('game_id', params.id)
          .eq('user_id', currentUser.id)

        setIsInterested(false)
        setShowContactInfo(false)

        // Update interested count
        if (game) {
          await supabase
            .from('game_invitations')
            .update({ 
              interested_count: Math.max((game.interested_count || 0) - 1, 0)
            })
            .eq('id', params.id)

          // Reload game data
          loadGameDetails()
        }
      }
    } catch (error) {
      console.error('Error handling interest:', error)
    }
  }

  const handleSubmitRating = async () => {
    if (!currentUser || tempRating === 0) return
    
    try {
      const supabase = createClient()
      
      // Find opponent ID
      let opponentId = null
      if (isCreator) {
        // If creator, find interested user
        const { data } = await supabase
          .from('game_interests')
          .select('user_id')
          .eq('game_id', params.id)
          .single()
        opponentId = data?.user_id
      } else {
        // If participant, rate the creator
        opponentId = game?.created_by
      }

      if (!opponentId) {
        alert('Cannot determine opponent')
        return
      }
      
      const { error } = await supabase
        .from('game_ratings')
        .insert({
          game_id: params.id,
          rater_id: currentUser.id,
          rated_user_id: opponentId,
          rating: tempRating,
          comment: ratingComment.trim() || null
        })
      
      if (!error) {
        setHasRated(true)
        setUserRating(tempRating)
        
        // Update user's average rating
        const { data: ratings } = await supabase
          .from('game_ratings')
          .select('rating')
          .eq('rated_user_id', opponentId)

        if (ratings && ratings.length > 0) {
          const avg = ratings.reduce((sum, r) => sum + r.rating, 0) / ratings.length
          await supabase
            .from('profiles')
            .update({ 
              average_rating: avg,
              total_ratings: ratings.length
            })
            .eq('id', opponentId)
        }
        
        alert('Rating submitted successfully!')
      }
    } catch (error) {
      console.error('Error submitting rating:', error)
      alert('Failed to submit rating')
    }
  }

  if (loading) {
    return (
      <div className="min-h-screen bg-gray-50 flex items-center justify-center">
        <p>Loading game details...</p>
      </div>
    )
  }

  if (!game) {
    return (
      <div className="min-h-screen bg-gray-50">
        <div className="container mx-auto px-4 py-8">
          <p>Game not found</p>
          <a href="/games" className="text-blue-600 hover:underline">Back to games</a>
        </div>
      </div>
    )
  }

  const isCreator = currentUser?.id === game.created_by
  const gameDate = new Date(game.game_date).toLocaleDateString()

  return (
    <div className="min-h-screen bg-gray-50">
      {/* Navigation */}
      <nav className="bg-white shadow-sm">
        <div className="container mx-auto px-4 h-16 flex items-center justify-between">
          <a href="/" className="text-xl font-bold">üèí HockeyHub</a>
          <div className="flex gap-4">
            <a href="/games" className="text-gray-600">Games</a>
            <a href="/rinks" className="text-gray-600">Rinks</a>
            <a href="/clubs" className="text-gray-600">Clubs</a>
            <a href="/profile" className="text-gray-600">Profile</a>
          </div>
        </div>
      </nav>

      {/* Game Details */}
      <div className="container mx-auto px-4 py-8">
        <div className="max-w-4xl mx-auto">
          {/* Back button */}
          <a href="/games" className="text-blue-600 hover:underline mb-4 inline-block">
            ‚Üê Back to games
          </a>

          {/* Main content */}
          <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
            <div className="mb-6">
              <h1 className="text-3xl font-bold mb-2">{game.title}</h1>
              <div className="flex gap-4 text-sm text-gray-600">
                <span>üìÖ {gameDate}</span>
                <span>‚è∞ {game.game_time}</span>
                <span>üëÅ {game.view_count || 0} views</span>
                <span>üèí {game.interested_count || 0} interested</span>
              </div>
            </div>

            {/* Game Info */}
            <div className="grid md:grid-cols-2 gap-6 mb-6">
              <div>
                <h3 className="font-semibold mb-2">Game Details</h3>
                <div className="space-y-2 text-gray-700">
                  <p><strong>Age Group:</strong> {game.age_group}</p>
                  <p><strong>Skill Level:</strong> {game.skill_level}</p>
                  <p><strong>Status:</strong> 
                    <span className={`ml-2 px-2 py-1 rounded text-sm ${
                      game.status === 'open' ? 'bg-green-100 text-green-800' :
                      game.status === 'matched' ? 'bg-blue-100 text-blue-800' :
                      'bg-gray-100 text-gray-800'
                    }`}>
                      {game.status}
                    </span>
                  </p>
                </div>
              </div>

              <div>
                <h3 className="font-semibold mb-2">Venue</h3>
                <div className="space-y-2 text-gray-700">
                  {game.rink && (
                    <>
                      <p><strong>{game.rink.name}</strong></p>
                      <p>{game.rink.address}</p>
                      {game.rink.phone && <p>üìû {game.rink.phone}</p>}
                    </>
                  )}
                </div>
              </div>
            </div>

            {/* Description */}
            {game.description && (
              <div className="mb-6">
                <h3 className="font-semibold mb-2">Description</h3>
                <p className="text-gray-700 whitespace-pre-wrap">{game.description}</p>
              </div>
            )}

            {/* Host Club */}
            {game.host_club && (
              <div className="mb-6">
                <h3 className="font-semibold mb-2">Host Club</h3>
                <div className="bg-gray-50 p-4 rounded">
                  <p className="font-medium">{game.host_club.name}</p>
                  {(showContactInfo || isCreator) && (
                    <div className="mt-2 text-sm text-gray-600">
                      <p>üìß {game.host_club.contact_email}</p>
                      {game.host_club.contact_phone && <p>üìû {game.host_club.contact_phone}</p>}
                    </div>
                  )}
                </div>
              </div>
            )}

            {/* Contact Information */}
            {(showContactInfo || isCreator) && game.creator && (
              <div className="mb-6">
                <h3 className="font-semibold mb-2">Contact Person</h3>
                <div className="bg-blue-50 p-4 rounded">
                  <p className="font-medium">{game.creator.full_name}</p>
                  <p className="text-sm text-gray-600">üìß {game.creator.email}</p>
                  {game.creator.phone && <p className="text-sm text-gray-600">üìû {game.creator.phone}</p>}
                </div>
              </div>
            )}

            {/* Action Buttons */}
            <div className="border-t pt-6">
              {isCreator ? (
                <div>
                  <p className="text-green-600 font-medium mb-2">
                    You created this game. {(game.interested_count || 0) > 0 ? `${game.interested_count || 0} teams have shown interest.` : 'No teams have shown interest yet.'}
                  </p>
                  {(game.interested_count || 0) > 0 && (
                    <p className="text-sm text-gray-500 mt-2">
                      Check the notifications section to see who's interested.
                    </p>
                  )}
                </div>
              ) : currentUser ? (
                <div>
                  {!isInterested && !showMessageForm && (
                    <button
                      onClick={() => setShowMessageForm(true)}
                      className="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700"
                    >
                      I'm Interested
                    </button>
                  )}

                  {showMessageForm && !isInterested && (
                    <div className="space-y-4">
                      <textarea
                        value={message}
                        onChange={(e) => setMessage(e.target.value)}
                        placeholder="Add a message (optional)"
                        className="w-full p-3 border rounded-lg"
                        rows={3}
                      />
                      <div className="flex gap-2">
                        <button
                          onClick={handleInterest}
                          className="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700"
                        >
                          Send Interest
                        </button>
                        <button
                          onClick={() => {
                            setShowMessageForm(false)
                            setMessage('')
                          }}
                          className="bg-gray-300 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-400"
                        >
                          Cancel
                        </button>
                      </div>
                    </div>
                  )}

                  {isInterested && (
                    <div>
                      <p className="text-green-600 font-medium mb-2">
                        ‚úÖ You've expressed interest in this game
                      </p>
                      {showContactInfo && (
                        <p className="text-sm text-gray-600 mb-4">
                          Contact information is now visible to you.
                        </p>
                      )}
                      <button
                        onClick={handleInterest}
                        className="bg-gray-300 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-400"
                      >
                        Remove Interest
                      </button>
                    </div>
                  )}
                </div>
              ) : (
                <div>
                  <p className="text-gray-600 mb-4">Sign in to express interest in this game</p>
                 <a 
                    href="/login"
                    className="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 inline-block"
                  >
                    Sign In
                  </a>
                </div>
              )}
            </div>

            {/* Rating Section - NEW */}
            {game.status === 'matched' && currentUser && (isCreator || isInterested) && (
              <div className="border-t mt-6 pt-6">
                <h3 className="font-semibold mb-4">Rate This Game</h3>
                
                {hasRated ? (
                  <div className="bg-gray-50 p-4 rounded">
                    <p className="text-gray-600">‚úÖ You have already rated this game</p>
                    <div className="mt-2">
                      <RatingStars rating={userRating} readonly showNumber />
                    </div>
                  </div>
                ) : (
                  <div className="space-y-4">
                    <div>
                      <label className="block text-sm font-medium mb-2">
                        How was your experience?
                      </label>
                      <RatingStars 
                        rating={tempRating} 
                        onChange={setTempRating}
                        size="lg"
                      />
                    </div>
                    
                    <textarea
                      value={ratingComment}
                      onChange={(e) => setRatingComment(e.target.value)}
                      placeholder="Share your experience (optional)"
                      className="w-full p-3 border rounded-lg resize-none"
                      rows={3}
                      maxLength={500}
                    />
                    
                    <button
                      onClick={handleSubmitRating}
                      disabled={tempRating === 0}
                      className="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50"
                    >
                      Submit Rating
                    </button>
                  </div>
                )}
              </div>
            )}
          </div>
        </div>
      </div>
    </div>
  )
}
</file>

<file path="app/[locale]/(dashboard)/games/[id]/page.tsx">
// app/[locale]/(dashboard)/games/[id]/page.tsx
'use client';

import { useEffect, useMemo, useState, useCallback } from 'react';
import { createClient } from '@/lib/supabase/client';
import { useParams, useRouter } from 'next/navigation';
import Link from 'next/link';
import RatingStars from '@/components/rating/RatingStars';
import { ArrowLeft } from 'lucide-react';

type GameStatus = 'open' | 'matched' | 'closed' | 'cancelled';

type Game = {
  id: string;
  title: string;
  game_date: string; // ISO (yyyy-mm-dd)
  game_time: string; // HH:mm
  age_group: string;
  skill_level: string;
  description: string | null;
  status: GameStatus;
  created_by: string;
  rink_id: string | null;
  host_club_id: string | null;
  guest_club_id: string | null;
  view_count?: number | null;
  interested_count?: number | null;
  created_at: string;
  creator?: { full_name: string; email: string; phone: string | null };
  host_club?: { name: string; contact_email: string | null; contact_phone: string | null };
  rink?: { name: string; address: string | null; phone: string | null };
};

export default function GameDetailsPage() {
  const router = useRouter();
  const { locale, id } = useParams<{ locale: string; id: string }>();
  const supabase = useMemo(() => createClient(), []);
  const [game, setGame] = useState<Game | null>(null);
  const [loading, setLoading] = useState(true);
  const [currentUser, setCurrentUser] = useState<any>(null);

  // Interest UI state
  const [isInterested, setIsInterested] = useState(false);
  const [showContactInfo, setShowContactInfo] = useState(false);
  const [message, setMessage] = useState('');
  const [showMessageForm, setShowMessageForm] = useState(false);

  // Rating UI state
  const [hasRated, setHasRated] = useState(false);
  const [userRating, setUserRating] = useState(0);
  const [tempRating, setTempRating] = useState(0);
  const [ratingComment, setRatingComment] = useState('');

  // locale helper
  const withLocale = useCallback((p: string) => `/${locale || ''}${p}`.replace('//', '/'), [locale]);

  const isCreator = currentUser && game ? currentUser.id === game.created_by : false;

  const loadGameDetails = useCallback(async () => {
    try {
      const { data: auth } = await supabase.auth.getUser();
      setCurrentUser(auth.user || null);

      // base game
      const { data: g, error: gameError } = await supabase
        .from('game_invitations')
        .select('*')
        .eq('id', id)
        .single();

      if (gameError || !g) {
        console.error('Game not found:', gameError);
        setGame(null);
        return;
      }

      // hydrate creator
      if (g.created_by) {
        const { data: creator } = await supabase
          .from('profiles')
          .select('full_name, email, phone')
          .eq('id', g.created_by)
          .single();
        if (creator) g.creator = creator;
      }

      // hydrate club
      if (g.host_club_id) {
        const { data: club } = await supabase
          .from('clubs')
          .select('name, contact_email, contact_phone')
          .eq('id', g.host_club_id)
          .single();
        if (club) g.host_club = club;
      }

      // hydrate rink
      if (g.rink_id) {
        const { data: rink } = await supabase
          .from('rinks')
          .select('name, address, phone')
          .eq('id', g.rink_id)
          .single();
        if (rink) g.rink = rink;
      }

      // normalize status
      if (g.status && !['open', 'matched', 'closed', 'cancelled'].includes(g.status)) {
        g.status = 'open';
      }

      setGame(g as Game);

      // interest + rating (for logged-in)
      if (auth.user) {
        const { data: interest } = await supabase
          .from('game_interests')
          .select('*')
          .eq('game_id', id)
          .eq('user_id', auth.user.id)
          .maybeSingle();

        if (interest) {
          setIsInterested(true);
          if (interest.status === 'accepted') setShowContactInfo(true);
        } else {
          setIsInterested(false);
          setShowContactInfo(false);
        }

        if ((g as Game).status === 'matched') {
          const { data: rating } = await supabase
            .from('game_ratings')
            .select('*')
            .eq('game_id', id)
            .eq('rater_id', auth.user.id)
            .maybeSingle();

          if (rating) {
            setHasRated(true);
            setUserRating(rating.rating);
          } else {
            setHasRated(false);
            setUserRating(0);
          }
        } else {
          setHasRated(false);
          setUserRating(0);
        }
      }

      // increment views (only non-creator & logged-in)
      if (auth.user && g.created_by !== auth.user.id) {
        await supabase.from('game_invitations').update({ view_count: (g.view_count || 0) + 1 }).eq('id', id);
      }
    } catch (e) {
      console.error('loadGameDetails error:', e);
    } finally {
      setLoading(false);
    }
  }, [id, supabase]);

  useEffect(() => {
    loadGameDetails();
  }, [loadGameDetails]);

  // interest toggle
  const handleInterest = useCallback(async () => {
    if (!currentUser) {
      router.push(withLocale('/login'));
      return;
    }
    try {
      if (!isInterested) {
        const { error } = await supabase.from('game_interests').insert({
          game_id: id,
          user_id: currentUser.id,
          message,
          status: 'pending'
        });
        if (error) throw error;

        setIsInterested(true);
        setShowMessageForm(false);
        setMessage('');

        if (game) {
          await supabase
            .from('game_invitations')
            .update({ interested_count: (game.interested_count || 0) + 1 })
            .eq('id', id);
        }
      } else {
        const { error } = await supabase
          .from('game_interests')
          .delete()
          .eq('game_id', id)
          .eq('user_id', currentUser.id);
        if (error) throw error;

        setIsInterested(false);
        setShowContactInfo(false);

        if (game) {
          await supabase
            .from('game_invitations')
            .update({ interested_count: Math.max((game.interested_count || 0) - 1, 0) })
            .eq('id', id);
        }
      }
      // refresh hydrated state
      loadGameDetails();
    } catch (e) {
      console.error('handleInterest error:', e);
    }
  }, [currentUser, game, id, isInterested, message, router, supabase, withLocale, loadGameDetails]);

  // submit rating
  const handleSubmitRating = useCallback(async () => {
    if (!currentUser || !game || tempRating === 0) return;

    try {
      let opponentId: string | null = null;
      if (isCreator) {
        const { data } = await supabase
          .from('game_interests')
          .select('user_id')
          .eq('game_id', id)
          .maybeSingle();
        opponentId = data?.user_id ?? null;
      } else {
        opponentId = game.created_by;
      }
      if (!opponentId) {
        alert('Cannot determine opponent');
        return;
      }

      const { error } = await supabase.from('game_ratings').insert({
        game_id: id,
        rater_id: currentUser.id,
        rated_user_id: opponentId,
        rating: tempRating,
        comment: ratingComment.trim() || null
      });
      if (error) throw error;

      setHasRated(true);
      setUserRating(tempRating);

      const { data: ratings } = await supabase
        .from('game_ratings')
        .select('rating')
        .eq('rated_user_id', opponentId);

      if (ratings && ratings.length > 0) {
        const avg = ratings.reduce((s, r) => s + r.rating, 0) / ratings.length;
        await supabase
          .from('profiles')
          .update({ average_rating: avg, total_ratings: ratings.length })
          .eq('id', opponentId);
      }

      alert('Rating submitted successfully!');
    } catch (e) {
      console.error('handleSubmitRating error:', e);
      alert('Failed to submit rating');
    }
  }, [currentUser, game, id, isCreator, ratingComment, tempRating, supabase]);

  if (loading) {
    return (
      <div className="min-h-screen bg-gray-50 flex items-center justify-center">
        <p>Loading game details...</p>
      </div>
    );
  }

  if (!game) {
    return (
      <div className="min-h-screen bg-gray-50">
        <div className="container mx-auto px-4 py-8">
          <p>Game not found</p>
          <Link href={withLocale('/games')} className="text-blue-600 hover:underline">
            Back to games
          </Link>
        </div>
      </div>
    );
  }

  // ‚úÖ ËøôÈáå‰∏çÂÜçÈáçÂ§çÂ£∞Êòé isCreator
  const gameDateFormatted = new Date(game.game_date).toLocaleDateString();

  const statusBadge: Record<GameStatus, string> = {
    open: 'bg-green-100 text-green-800',
    matched: 'bg-blue-100 text-blue-800',
    closed: 'bg-gray-100 text-gray-800',
    cancelled: 'bg-red-100 text-red-800',
  };

  return (
    <div className="min-h-screen bg-gray-50">
      {/* Header */}
      <div className="max-w-5xl mx-auto px-4 pt-6">
        <Link href={withLocale('/games')} className="inline-flex items-center text-gray-600 hover:text-gray-900 mb-4">
          <ArrowLeft className="h-4 w-4 mr-2" />
          Back to Games
        </Link>
      </div>

      {/* Game Details */}
      <div className="container mx-auto px-4 py-6">
        <div className="max-w-4xl mx-auto">
          <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
            <div className="mb-6">
              <h1 className="text-3xl font-bold mb-2">{game.title}</h1>
              <div className="flex flex-wrap gap-4 text-sm text-gray-600">
                <span>üìÖ {gameDateFormatted}</span>
                <span>‚è∞ {game.game_time}</span>
                <span>üëÅ {game.view_count || 0} views</span>
                <span>üèí {game.interested_count || 0} interested</span>
              </div>
            </div>

            <div className="grid md:grid-cols-2 gap-6 mb-6">
              <div>
                <h3 className="font-semibold mb-2">Game Details</h3>
                <div className="space-y-2 text-gray-700">
                  <p><strong>Age Group:</strong> {game.age_group}</p>
                  <p><strong>Skill Level:</strong> {game.skill_level}</p>
                  <p>
                    <strong>Status:</strong>
                    <span className={`ml-2 px-2 py-1 rounded text-sm ${statusBadge[game.status]}`}>
                      {game.status}
                    </span>
                  </p>
                </div>
              </div>

              <div>
                <h3 className="font-semibold mb-2">Venue</h3>
                <div className="space-y-2 text-gray-700">
                  {game.rink && (
                    <>
                      <p><strong>{game.rink.name}</strong></p>
                      <p>{game.rink.address}</p>
                      {game.rink.phone && <p>üìû {game.rink.phone}</p>}
                    </>
                  )}
                </div>
              </div>
            </div>

            {game.description && (
              <div className="mb-6">
                <h3 className="font-semibold mb-2">Description</h3>
                <p className="text-gray-700 whitespace-pre-wrap">{game.description}</p>
              </div>
            )}

            {game.host_club && (
              <div className="mb-6">
                <h3 className="font-semibold mb-2">Host Club</h3>
                <div className="bg-gray-50 p-4 rounded">
                  <p className="font-medium">{game.host_club.name}</p>
                  {(showContactInfo || isCreator) && (
                    <div className="mt-2 text-sm text-gray-600">
                      {game.host_club.contact_email && <p>üìß {game.host_club.contact_email}</p>}
                      {game.host_club.contact_phone && <p>üìû {game.host_club.contact_phone}</p>}
                    </div>
                  )}
                </div>
              </div>
            )}

            {(showContactInfo || isCreator) && game.creator && (
              <div className="mb-6">
                <h3 className="font-semibold mb-2">Contact Person</h3>
                <div className="bg-blue-50 p-4 rounded">
                  <p className="font-medium">{game.creator.full_name}</p>
                  <p className="text-sm text-gray-600">üìß {game.creator.email}</p>
                  {game.creator.phone && <p className="text-sm text-gray-600">üìû {game.creator.phone}</p>}
                </div>
              </div>
            )}

            {/* Actions */}
            <div className="border-t pt-6">
              {isCreator ? (
                <div>
                  <p className="text-green-600 font-medium mb-2">
                    You created this game{' '}
                    {(game.interested_count || 0) > 0
                      ? `‚Äî ${game.interested_count || 0} teams have shown interest.`
                      : '‚Äî No teams have shown interest yet.'}
                  </p>
                </div>
              ) : currentUser ? (
                <div>
                  {!isInterested && !showMessageForm && (
                    <button
                      onClick={() => setShowMessageForm(true)}
                      className="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700"
                    >
                      I'm Interested
                    </button>
                  )}

                  {showMessageForm && !isInterested && (
                    <div className="space-y-4">
                      <textarea
                        value={message}
                        onChange={(e) => setMessage(e.target.value)}
                        placeholder="Add a message (optional)"
                        className="w-full p-3 border rounded-lg"
                        rows={3}
                      />
                      <div className="flex gap-2">
                        <button
                          onClick={handleInterest}
                          className="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700"
                        >
                          Send Interest
                        </button>
                        <button
                          onClick={() => {
                            setShowMessageForm(false);
                            setMessage('');
                          }}
                          className="bg-gray-300 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-400"
                        >
                          Cancel
                        </button>
                      </div>
                    </div>
                  )}

                  {isInterested && (
                    <div>
                      <p className="text-green-600 font-medium mb-2">‚úÖ You've expressed interest in this game</p>
                      {showContactInfo && (
                        <p className="text-sm text-gray-600 mb-4">Contact information is now visible to you.</p>
                      )}
                      <button
                        onClick={handleInterest}
                        className="bg-gray-300 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-400"
                      >
                        Remove Interest
                      </button>
                    </div>
                  )}
                </div>
              ) : (
                <div>
                  <p className="text-gray-600 mb-4">Sign in to express interest in this game</p>
                  <Link
                    href={withLocale('/login')}
                    className="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 inline-block"
                  >
                    Sign In
                  </Link>
                </div>
              )}
            </div>

            {/* Rating */}
            {game.status === 'matched' && currentUser && (isCreator || isInterested) && (
              <div className="border-t mt-6 pt-6">
                <h3 className="font-semibold mb-4">Rate This Game</h3>
                {hasRated ? (
                  <div className="bg-gray-50 p-4 rounded">
                    <p className="text-gray-600">‚úÖ You have already rated this game</p>
                    <div className="mt-2">
                      <RatingStars rating={userRating} readonly showNumber />
                    </div>
                  </div>
                ) : (
                  <div className="space-y-4">
                    <div>
                      <label className="block text-sm font-medium mb-2">How was your experience?</label>
                      <RatingStars rating={tempRating} onChange={setTempRating} size="lg" />
                    </div>

                    <textarea
                      value={ratingComment}
                      onChange={(e) => setRatingComment(e.target.value)}
                      placeholder="Share your experience (optional)"
                      className="w-full p-3 border rounded-lg resize-none"
                      rows={3}
                      maxLength={500}
                    />

                    <button
                      onClick={handleSubmitRating}
                      disabled={tempRating === 0}
                      className="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50"
                    >
                      Submit Rating
                    </button>
                  </div>
                )}
              </div>
            )}
          </div>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="next.config.mjs">
// next.config.mjs
import createNextIntlPlugin from 'next-intl/plugin';

const withNextIntl = createNextIntlPlugin('./i18n.ts');

const nextConfig = {
  eslint: {
    ignoreDuringBuilds: true,
  },
};

export default withNextIntl(nextConfig);
</file>

<file path="app/[locale]/layout.tsx">
// app/[locale]/layout.tsx
import '../globals.css';
import {NextIntlClientProvider} from 'next-intl';
import {notFound} from 'next/navigation';
import type {ReactNode} from 'react';
import {locales} from '../../i18n';
import Navbar from '@/components/layout/navbar';
import Footer from '@/components/layout/footer';

type Params = { locale: string };

/** ‰∏∫ SSG È¢ÑÁîüÊàê locale ÊÆµ */
export function generateStaticParams(): Params[] {
  return (locales as readonly string[]).map((locale) => ({ locale }));
}

/**
 * Ê≥®ÊÑèÔºöNext 15 ‰∏≠ layout ÁöÑ params ÊòØ PromiseÔºåÈúÄË¶Å await
 */
export default async function LocaleLayout({
  children,
  params
}: {
  children: ReactNode;
  params: Promise<Params>;
}) {
  const { locale } = await params;

  // ‰∏•Ê†ºÊ†°È™å locale
  if (!(locales as readonly string[]).includes(locale)) {
    notFound();
  }

  // Âä†ËΩΩÂ§öËØ≠Ë®ÄÊ∂àÊÅØ
  const messages = (await import(`../../messages/${locale}.json`)).default;

  return (
    <html lang={locale} suppressHydrationWarning>
      <body suppressHydrationWarning>
        <NextIntlClientProvider locale={locale} messages={messages}>
          <Navbar />
          {children}
          <Footer />
        </NextIntlClientProvider>
      </body>
    </html>
  );
}
</file>

</files>
