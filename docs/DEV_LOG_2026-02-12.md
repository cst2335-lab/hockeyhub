# GoGoHockey 开发日志 — 2026-02-12

本文档记录 2026 年 2 月 12 日本轮开发修改内容及下阶段任务。  
**日期格式**：统一使用 `YYYY-MM-DD`（年-月-日）。

---

## 一、本次修改内容

### 1. Hero 区域「Get Started Free」按钮文字不可见

**日期**：2026-02-12  
**优先级**：高  
**文件**：`components/features/hero-section.tsx`

#### 修改内容
- outline 按钮默认使用 `text-white`，配合 `bg-background`（白底）导致文字几乎 invisible
- 改为 `bg-white/95 text-gogo-dark`，悬停时 `hover:bg-gogo-secondary hover:text-gogo-dark`
- 增加 `font-semibold` 提升可读性

#### 解决的问题
- 白色按钮上白色文字不可见
- 非悬停状态下用户无法看到按钮文案

---

### 2. Sign In 页面闪退

**日期**：2026-02-12  
**优先级**：高  
**文件**：
- `app/[locale]/(auth)/login/LoginClient.tsx`
- `lib/supabase/client.ts`
- `app/(auth)/login/page.tsx`

#### 修改内容
- **LoginClient**：`useParams()` 可能返回 `undefined`，添加 `const locale = params?.locale ?? 'en'` 防御性处理
- **Supabase 客户端**：增加 `NEXT_PUBLIC_SUPABASE_URL` 与 `NEXT_PUBLIC_SUPABASE_ANON_KEY` 校验，缺失时抛出明确错误
- **根级登录页**：`app/(auth)/login/page.tsx` 改为 redirect 到 `/en/login`，避免重复表单与路由冲突

#### 解决的问题
- 点击 Sign In 后页面闪退或白屏
- 未配置 env 时崩溃无提示
- 根路径 `/login` 与 `[locale]/login` 重复

---

### 3. 登录后两行导航栏 + 头像无用户名

**日期**：2026-02-12  
**优先级**：高  
**文件**：
- `components/layout/conditional-nav.tsx`（新建）
- `app/[locale]/layout.tsx`
- `components/layout/navbar.tsx`

#### 修改内容
- **conditional-nav.tsx**：新增 `ConditionalNavbar`、`ConditionalFooter`，根据 pathname 判断是否为 Dashboard 路由（dashboard、games、my-games、rinks、bookings、clubs、notifications、profile、manage-rink、book、games-test），若为上述路由则隐藏主导航与页脚
- **layout.tsx**：将 `<Navbar />`、`<Footer />` 替换为 `<ConditionalNavbar />`、`<ConditionalFooter />`
- **navbar.tsx**：登录状态下，头像左侧显示 `user.email`（`hidden sm:inline-block`，移动端隐藏以节省空间）

#### 解决的问题
- 登录后主导航（深蓝）与 Dashboard 导航（白底）同时出现，造成两行导航栏
- 主导航头像旁无用户标识，体验不清

---

### 4. Dashboard 内 GoGoHockey Logo 指向错误

**日期**：2026-02-12  
**优先级**：中  
**文件**：`app/[locale]/(dashboard)/layout.tsx`

#### 修改内容
- Logo 链接由 `href={withLocale('/dashboard')}` 改为 `href={withLocale('/')}`
- 增加 `aria-label="Go to homepage"`

#### 解决的问题
- 点击 Logo 只能回到 Dashboard，无法回到主页
- 用户期望 Logo 可返回首页

---

## 二、下阶段任务

### 高优先级（P0）
- [ ] **支付流程**：接入 Stripe checkout 与 Webhook，完成冰场预订支付闭环
- [ ] **测试**：运行 `npm run test` 验证单元测试通过，补充关键流程 E2E 测试

### 中优先级（P1）
- [ ] **监控**：集成 Sentry 错误监控、Vercel Analytics 行为分析
- [ ] **文档**：API 文档、部署指南、贡献指南
- [ ] **PWA**：优化 Service Worker 缓存策略，确保 /login、/register 等关键路径不被错误缓存

### 低优先级（P2）
- [ ] **无障碍**：补充 ARIA 属性，键盘导航与屏幕阅读器支持
- [ ] **性能**：图片懒加载、首屏 LCP 优化
- [ ] **i18n**：Dashboard 导航栏部分文案（如 "Logout"）尚未使用翻译 key，可统一接入 messages

---

## 三、Commit 建议

```
fix(ui): hero button, login crash, double nav, avatar email, homepage link

- Hero: readable text on Get Started Free outline button
- Login: locale fallback, env validation, root redirect
- Conditional nav: single bar on dashboard routes
- Navbar: show email next to user avatar
- Dashboard logo: link to / instead of /dashboard
```

---

*文档生成时间：2026-02-12*
